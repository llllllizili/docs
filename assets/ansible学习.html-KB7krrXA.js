import{_ as a,c as n,a as i,f as s,o as l}from"./app-BfCDUtKQ.js";const e="/assets/2511748-ee48dcc8af53cf00-BwKWT13U.jpg",p="/assets/2511748-1001b5832ebba246-Dnh71AMI.jpg",r={},o=s('<h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><div class="hint-container caution"><p class="hint-container-title">请注意</p><p>本文内容可能已过时，请自行甄别。</p></div><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p><strong>Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是</strong> <span style="color:red;"><strong>分布式集中管理工具</strong></span>， <strong>通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块</strong></p>',4),t=s('<h2 id="什么是ansible" tabindex="-1"><a class="header-anchor" href="#什么是ansible"><span>什么是ansible?</span></a></h2><figure><img src="'+e+'" alt="ansible架构" tabindex="0" loading="lazy"><figcaption>ansible架构</figcaption></figure><table><thead><tr><th style="text-align:left;">五大部分</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">connection plugins</td><td style="text-align:left;">远程连接插件</td></tr><tr><td style="text-align:left;">hosts</td><td style="text-align:left;">定义管理主机或主机组</td></tr><tr><td style="text-align:left;">modules</td><td style="text-align:left;">包含各个核心模块及自定义模块</td></tr><tr><td style="text-align:left;">Plugin</td><td style="text-align:left;">完成模块功能的补充，如日志插件、邮件插件等</td></tr><tr><td style="text-align:left;">Playbook</td><td style="text-align:left;">ansible的任务配置文件，将多个任务定义在剧本中进行管理</td></tr></tbody></table><h2 id="ansible-的工作流程" tabindex="-1"><a class="header-anchor" href="#ansible-的工作流程"><span>ansible 的工作流程</span></a></h2><p><img src="'+p+`" alt="ansible流程" loading="lazy"><br> ​</p><p>​</p><h2 id="安装ansible" tabindex="-1"><a class="header-anchor" href="#安装ansible"><span>安装ansible</span></a></h2><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#配置源  ansible默认不在yum仓库中</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -iUvh</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel//7/x86_64/e/epel-release-7-9.noarch.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#此源主要是为了安装PyYAML</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mv</span><span style="color:#98C379;--shiki-dark:#98C379;"> CentOS7-Base-163.repo</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/yum.repos.d/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> ansible</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可查看当前ansible版本</span></span></code></pre></div><h2 id="配置登录" tabindex="-1"><a class="header-anchor" href="#配置登录"><span>配置登录</span></a></h2><blockquote><p>ansible 使用ssh登录，所以主奴之间要配置密钥进行认证，这样才能开始正常工作</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ssh-keygen</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span><span style="color:#98C379;--shiki-dark:#98C379;"> rsa</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #回车</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#将会生成密钥/root/.ssh/id_rsa.pub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ssh-copy-id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -i</span><span style="color:#98C379;--shiki-dark:#98C379;"> root@ipaddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#公钥将会被cp到各个ipaddress节点</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#至此 已经实现了master与各节点的连接</span></span></code></pre></div><h2 id="定义ansible的节点清单" tabindex="-1"><a class="header-anchor" href="#定义ansible的节点清单"><span>定义Ansible的节点清单</span></a></h2><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>vim /etc/ansible/hosts</span></span>
<span class="line"><span>[testgroup]-----#服务器组的名字，方便统一管理，划分和命名要有规划</span></span>
<span class="line"><span>192.168.1.XX----#组内节点的地址</span></span>
<span class="line"><span>192.168.1.XXX</span></span>
<span class="line"><span>等等</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[websever]</span></span>
<span class="line"><span>....</span></span>
<span class="line"><span>[DBserver]</span></span>
<span class="line"><span>....</span></span></code></pre></div><h2 id="简单的远程操作" tabindex="-1"><a class="header-anchor" href="#简单的远程操作"><span>简单的远程操作</span></a></h2><p><strong>通过执行who，查看服务器登录信息</strong></p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> testgroup</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #组</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 所有</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> 192.168.1.XX</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #单个ip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#E06C75;--shiki-dark:#E06C75;">rc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     :0</span><span style="color:#98C379;--shiki-dark:#98C379;">           2017-02-15</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:33</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/0</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-02-15</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:34</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/1</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-02-18</span><span style="color:#98C379;--shiki-dark:#98C379;"> 13:08</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (192.168.247.1)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/2</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-03-07</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:52</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/3</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-03-07</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:54</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (192.168.247.156)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 以ashin用户身份ping .134</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.1.134</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> zili</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 以用户zili身份使用sudo来ping 组testgroup</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -K是输入root密码</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> v1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> zili</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -K</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="定义变量" tabindex="-1"><a class="header-anchor" href="#定义变量"><span>定义变量</span></a></h2><h3 id="定义主机变量" tabindex="-1"><a class="header-anchor" href="#定义主机变量"><span>定义主机变量</span></a></h3><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    192.168.247.152  http_port=80</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ...............  http_port=303</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #组名以及ip根本自己需求定义</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #主机指定变量，以便后面供palybooks配置使用。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #定义两台web服务器的apache参数http_port，可以让两台服务器产生的apache配置文件httpd.conf差异化</span></span></code></pre></div><h3 id="定义组变量" tabindex="-1"><a class="header-anchor" href="#定义组变量"><span>定义组变量</span></a></h3><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web:vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    http_port=80</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #组变量的作用域是覆盖组所有成员，通过定义一个新块，块名由组名+ &quot;:vars&quot;组成。</span></span></code></pre></div><h3 id="嵌套组" tabindex="-1"><a class="header-anchor" href="#嵌套组"><span>嵌套组</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">nested：children</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    web</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    mysql</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">nested：vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ntp_server=s1b.time.edu.cn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">嵌套组定义一个新块，块名由 组名+&quot;:chilren&quot; 组成。</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">同是嵌套组也可以定义组变量，作用域是嵌套组里的所有组,</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">嵌套组只能在/usr/bin/ansible-playbook中，</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">在/usr/bin/ansible中不起作用，下面会介绍playbook</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="分离主机和组特定数据" tabindex="-1"><a class="header-anchor" href="#分离主机和组特定数据"><span>分离主机和组特定数据</span></a></h3><blockquote><p>为更好的规范定义的<strong>主机与组变量</strong>，我们实际是不会在hosts里直接写的var，将定义的主机名与组变量单独剥离出来放到指定的文件中，将采用YAML格式存放<br> 全局的变量放在group_vars/all中，局部变量放在group_vars/x中，特定的host使用特定的变量可以使用host_vars/x，子group中的变量会覆盖上级变量，hosts变量总是覆盖groups变量<br> 存放位置规定：&quot;/etc/ansible/group_vars/名&quot;和&quot;/etc/ansible/host_vars/主机名&quot;分别存放指定组名或主机名定义的变量，如<br><code>/etc/ansible/group\\_vars/mysql.yml</code><br><code>/etc/ansible/host\\_vars/192.168.11.1.yml</code><br> 使用变量要用jinja语法去引用</p></blockquote><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">cat mysql.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   ---</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ntp_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">s1b.time.edu.cn</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    database_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">规范变量名字，是因为，ansible会自动加载这目录下的变量，</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">否则无法调用，当然也有解决不放此目录的方法</span></span></code></pre></div><p>例如</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master ansible]# tree</span></span>
<span class="line"><span>├── create_user.yml</span></span>
<span class="line"><span>├── group_vars</span></span>
<span class="line"><span>│   └── t1.yml</span></span>
<span class="line"><span>├── hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat hosts</span></span>
<span class="line"><span>[t1]</span></span>
<span class="line"><span>10.1.27.24</span></span>
<span class="line"><span></span></span>
<span class="line"><span>所以</span></span>
<span class="line"><span>├── group_vars</span></span>
<span class="line"><span>│   └── t1.yml  #他的内容就是t1的变量</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat group_vars/t1.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>user: ansibleTest1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat create_user.yml </span></span>
<span class="line"><span># create user</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- name: create user</span></span>
<span class="line"><span>  hosts: t1</span></span>
<span class="line"><span>  user: root</span></span>
<span class="line"><span>  tasks:</span></span>
<span class="line"><span>  - name: useradd {{ user }}  #引用t1变量</span></span>
<span class="line"><span>    user: name=&quot;{{ user }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>返回结果如下</span></span>
<span class="line"><span>[root@master ansible]# ansible-playbook create_user.yml </span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY [create user] ***********************************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [Gathering Facts] *******************************************************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [useradd ansibleTest1] **************************************************************************************************</span></span>
<span class="line"><span>changed: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY RECAP *******************************************************************************************************************</span></span>
<span class="line"><span>10.1.27.24                 : ok=2    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="命令参数" tabindex="-1"><a class="header-anchor" href="#命令参数"><span>命令参数</span></a></h2><blockquote><p>ansible &lt; host-pattern &gt; [ options ]</p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-m</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_NAME,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --module-name=MODULE_NAME</span><span style="color:#98C379;--shiki-dark:#98C379;">     要执行的模块，默认为</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-a</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_ARGS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --args=MODULE_ARGS</span><span style="color:#98C379;--shiki-dark:#98C379;">      模块的参数</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-u</span><span style="color:#98C379;--shiki-dark:#98C379;"> REMOTE_USER,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --user=REMOTE_USER</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="color:#98C379;--shiki-dark:#98C379;">      连接的用户名，默认用</span><span style="color:#98C379;--shiki-dark:#98C379;"> root，ansible.cfg</span><span style="color:#98C379;--shiki-dark:#98C379;"> 中可以配置</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-k,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --ask-pass</span><span style="color:#98C379;--shiki-dark:#98C379;">      提示输入</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> 登录密码，当使用密码验证登录的时候用</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-s,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo</span><span style="color:#98C379;--shiki-dark:#98C379;">      sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> 运行</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-U</span><span style="color:#98C379;--shiki-dark:#98C379;"> SUDO_USER,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo-user=SUDO_USER</span><span style="color:#98C379;--shiki-dark:#98C379;">     sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> 到哪个用户，默认为</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-K,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --ask-sudo-pass</span><span style="color:#98C379;--shiki-dark:#98C379;">     提示输入</span><span style="color:#98C379;--shiki-dark:#98C379;"> sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> 密码，当不是</span><span style="color:#98C379;--shiki-dark:#98C379;"> NOPASSWD</span><span style="color:#98C379;--shiki-dark:#98C379;"> 模式时使用</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-B</span><span style="color:#98C379;--shiki-dark:#98C379;"> SECONDS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --background=SECONDS</span><span style="color:#98C379;--shiki-dark:#98C379;">       run</span><span style="color:#98C379;--shiki-dark:#98C379;"> asynchronously,</span><span style="color:#98C379;--shiki-dark:#98C379;"> failing</span><span style="color:#98C379;--shiki-dark:#98C379;"> after</span><span style="color:#98C379;--shiki-dark:#98C379;"> X</span><span style="color:#98C379;--shiki-dark:#98C379;"> seconds</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">default</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">N/A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-P</span><span style="color:#98C379;--shiki-dark:#98C379;"> POLL_INTERVAL,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --poll=POLL_INTERVAL</span><span style="color:#98C379;--shiki-dark:#98C379;">      set</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> poll</span><span style="color:#98C379;--shiki-dark:#98C379;"> interval</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default=15)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-C,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --check</span><span style="color:#98C379;--shiki-dark:#98C379;">     只是测试一下会改变什么内容，不会真正去执行</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-c</span><span style="color:#98C379;--shiki-dark:#98C379;"> CONNECTION</span><span style="color:#98C379;--shiki-dark:#98C379;">   连接类型</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">default</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">smart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-f</span><span style="color:#98C379;--shiki-dark:#98C379;"> FORKS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --forks=FORKS</span><span style="color:#98C379;--shiki-dark:#98C379;">     fork</span><span style="color:#98C379;--shiki-dark:#98C379;"> 多少个进程并发处理，默认</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-i</span><span style="color:#98C379;--shiki-dark:#98C379;"> INVENTORY,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --inventory-file=INVENTORY</span><span style="color:#98C379;--shiki-dark:#98C379;">      指定hosts文件路径默认</span><span style="color:#98C379;--shiki-dark:#98C379;"> default</span><span style="color:#98C379;--shiki-dark:#98C379;"> =/etc/ansible/hosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-l</span><span style="color:#98C379;--shiki-dark:#98C379;"> SUBSET,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --limit=SUBSET</span><span style="color:#98C379;--shiki-dark:#98C379;">       指定一个</span><span style="color:#98C379;--shiki-dark:#98C379;"> pattern，对</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">host_patter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">n&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">已经匹配的主机中再过滤一次</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">--list-hosts</span><span style="color:#98C379;--shiki-dark:#98C379;">        只打印有哪些主机会执行这个</span><span style="color:#98C379;--shiki-dark:#98C379;"> playbook</span><span style="color:#98C379;--shiki-dark:#98C379;"> 文件：不是实际执行该</span><span style="color:#98C379;--shiki-dark:#98C379;"> playbook</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-M</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_PATH,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --module-path=MODULE_PATH</span><span style="color:#98C379;--shiki-dark:#98C379;">       要执行的模块的路径，默认为/usr/share/ansible/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-o,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --one-line</span><span style="color:#98C379;--shiki-dark:#98C379;">      压缩输出，摘要输出</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">--private-key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">PRIVATE_KEY_FILE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      私钥路径</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-T</span><span style="color:#98C379;--shiki-dark:#98C379;"> TIMEOUT,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --timeout=TIMEOUT</span><span style="color:#98C379;--shiki-dark:#98C379;">   ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> 连接超时时间，默认</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#98C379;--shiki-dark:#98C379;"> 秒</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-t</span><span style="color:#98C379;--shiki-dark:#98C379;"> TREE,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --tree=TREE</span><span style="color:#98C379;--shiki-dark:#98C379;">            日志输出到该目录，日志文件名会以主机名命名</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-v,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --verbose</span><span style="color:#98C379;--shiki-dark:#98C379;">   verbose</span><span style="color:#98C379;--shiki-dark:#98C379;"> mode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (-vvv </span><span style="color:#98C379;--shiki-dark:#98C379;">for</span><span style="color:#98C379;--shiki-dark:#98C379;"> more,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -vvvv</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> enable</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> debugging</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pattern" tabindex="-1"><a class="header-anchor" href="#pattern"><span>Pattern</span></a></h2><p>可以直接指定ip或hosts中的组名，同时指定多个组或者多个<code>ip</code>使用<code>:</code>分割</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible group1:group2 -m ping</span></span>
<span class="line"><span>ansible ip1:ip2 -m ping</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#all  或者 *  代表全部</span></span>
<span class="line"><span>ansible all -m ping</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 感叹号 ! 表示非</span></span>
<span class="line"><span>g1:!g2   #表示在g1分组中，但是不在g2中的hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span># &amp;符号表示交集</span></span>
<span class="line"><span>g1:&amp;g2  #表示在g1分组中，也在g2中的hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#使用下标</span></span>
<span class="line"><span>g1[2]  #组的第三个</span></span>
<span class="line"><span>g1[0:3] #组的前四个</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常用模块" tabindex="-1"><a class="header-anchor" href="#常用模块"><span>常用模块</span></a></h2><h3 id="copy模块" tabindex="-1"><a class="header-anchor" href="#copy模块"><span>copy模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：把主控端/root目录下的a.sh文件拷贝到到指定节点上</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> copy</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;src=/root/a.sh dest=/tmp/ owner=root group=root mode=0755&#39;</span></span></code></pre></div><h3 id="file模块" tabindex="-1"><a class="header-anchor" href="#file模块"><span>file模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：更改指定节点上/tmp/t.sh的权限为755，属主和属组为root</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;dest=/tmp/t.sh mode=755 owner=root group=root&quot;</span></span></code></pre></div><h3 id="cron模块" tabindex="-1"><a class="header-anchor" href="#cron模块"><span>cron模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    目的：在指定节点上定义一个计划任务，每隔3分钟到主控端更新一次时间</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> cron</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=&quot;custom job&quot; minute=*/3 hour=* day=* month=* weekday=* job=&quot;/usr/sbin/ntpdate 192.168.247.152&quot;&#39;</span></span></code></pre></div><h3 id="group模块" tabindex="-1"><a class="header-anchor" href="#group模块"><span>group模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在所有节点上创建一个组名为nolinux，gid为2014的组</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> group</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;gid=2014 name=nolinux&#39;</span></span></code></pre></div><h3 id="uesr模块" tabindex="-1"><a class="header-anchor" href="#uesr模块"><span>uesr模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在所有节点上创建一个用户名为nolinux，组为nolinux的用户</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=nolinux groups=nolinux state=present&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">删除用户</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=nolinux state=absent remove=yes&#39;</span></span></code></pre></div><h3 id="yum模块" tabindex="-1"><a class="header-anchor" href="#yum模块"><span>yum模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在指定节点上安装</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#98C379;--shiki-dark:#98C379;"> 服务</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;state=present name=httpd&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#state=latest 安装最新版本</span></span></code></pre></div><h3 id="shell模块" tabindex="-1"><a class="header-anchor" href="#shell模块"><span>shell模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在指定节点上安装</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#98C379;--shiki-dark:#98C379;"> 服务</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> testgroup</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;yum -y install httpd&#39;</span></span></code></pre></div><h3 id="command模块" tabindex="-1"><a class="header-anchor" href="#command模块"><span>command模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：在指定节点上运行hostname命令</span></span>
<span class="line"><span>命令：ansible 192.168.247.152 -m command -a &#39;hostname&#39;</span></span></code></pre></div><h3 id="raw模块" tabindex="-1"><a class="header-anchor" href="#raw模块"><span>raw模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：在192.168.247.152节点上运行ifconfig命令</span></span>
<span class="line"><span>命令：ansible 192.168.247.152 -m raw-a &#39;ifconfig|eth0&#39;</span></span></code></pre></div><h3 id="script模块" tabindex="-1"><a class="header-anchor" href="#script模块"><span>script模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在指定节点上执行/root/a.sh脚本(该脚本是在ansible主控端</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10.1.1.113</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> script</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/root/a.sh&#39;</span></span></code></pre></div><h3 id="command-script-shell-raw的区别" tabindex="-1"><a class="header-anchor" href="#command-script-shell-raw的区别"><span>command,script,shell,raw的区别</span></a></h3><blockquote><p>思考：四者有何区别？</p></blockquote><p>command模块 [执行远程命令]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m command -a &quot;uname -n&quot; -s</span></span></code></pre></div><p>script模块 [在远程主机执行主控端的shell/python脚本]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m script -a &quot;/soft/ntpdate.py&quot; -s</span></span></code></pre></div><p>shell模块 [执行远程主机的shell/python脚本]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m shell -a &quot;/soft/file.py&quot; -s</span></span></code></pre></div><p>raw模块 [类似于command模块、支持管道传递]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m raw -a &quot;ifconfig eth0|sed -n 2p|awk &#39;{print \\$2}&#39;&quot; -s</span></span></code></pre></div><h3 id="service模块" tabindex="-1"><a class="header-anchor" href="#service模块"><span>service模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：启动指定节点上的</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span><span style="color:#98C379;--shiki-dark:#98C379;"> 服务，并让其开机自启动</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> service</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=httpd state=restarted enabled=yes&#39;</span></span></code></pre></div><h3 id="ping模块" tabindex="-1"><a class="header-anchor" href="#ping模块"><span>ping模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：检查指定节点机器是否还能连通</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span></span></code></pre></div><h3 id="get-url" tabindex="-1"><a class="header-anchor" href="#get-url"><span>get_url</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：下载百度下的图标文件到节点的/tmp文件下</span></span>
<span class="line"><span>命令：ansible testgroup -m get_url -a &#39;url=https://www.baidu.com/favicon dest=/tmp&#39;</span></span>
<span class="line"><span>#结果为error.html，但是证明了模块是可用的</span></span></code></pre></div><h3 id="stat模块" tabindex="-1"><a class="header-anchor" href="#stat模块"><span>stat模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：获取远程文件状态信息，包括atime、ctime、mtime、md5、uid、gid等信息</span></span>
<span class="line"><span>ansible web -m stat -a &#39;path=/etc/sysctl.conf&#39;</span></span></code></pre></div><h3 id="template模块" tabindex="-1"><a class="header-anchor" href="#template模块"><span>template模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>template使用了Jinja2格式作为文件模版，进行文档内变量的替换的模块。它的每次使用都会被ansible标记为”changed”状态。</span></span></code></pre></div><h2 id="模块参数" tabindex="-1"><a class="header-anchor" href="#模块参数"><span>模块参数</span></a></h2><table><thead><tr><th>参数名</th><th>是否必须</th><th>默认值</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>backup</td><td>no</td><td>no</td><td>yes/no</td><td>建立个包括timestamp在内的文件备份，以备不时之需.</td></tr><tr><td>dest</td><td>yes</td><td></td><td></td><td>远程节点上的绝对路径，用于放置template文件。</td></tr><tr><td>group</td><td>no</td><td></td><td></td><td>设置远程节点上的的template文件的所属用户组</td></tr><tr><td>mode</td><td>no</td><td></td><td></td><td>设置远程节点上的template文件权限。类似<a href="http://www.2cto.com/os/linux/" target="_blank" rel="noopener noreferrer">Linux</a>中<em>chmod</em>的用法</td></tr><tr><td>owner</td><td>no</td><td></td><td></td><td>设置远程节点上的template文件所属用户</td></tr><tr><td>src</td><td>yes</td><td></td><td></td><td>本地Jinjia2模版的template文件位置</td></tr></tbody></table><h2 id="模块参数案例" tabindex="-1"><a class="header-anchor" href="#模块参数案例"><span>模块参数案例</span></a></h2><p>把/mytemplates/foo.j2文件经过填写参数后，复制到远程节点的/etc/file.conf，文件权限相关略过</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span> - template: src=/mytemplates/foo.j2 dest=/etc/file.conf owner=bin group=wheel mode=0644</span></span></code></pre></div><p>跟上面一样的效果，不一样的文件权限设置方式</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span> - template: src=/mytemplates/foo.j2 dest=/etc/file.conf owner=bin group=wheel mode=&quot;u=rw,g=r,o=r&quot;</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#详细说明 </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">roles/templates/server.xml中的template文件关键部分如下：</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;user </span><span style="color:#E06C75;--shiki-dark:#E06C75;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;{{ admin_username }}&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;{{ admin_password }}&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> roles</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;manager-gui&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> /</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#当这个文件还没被template执行的时候，本地的admin_username及admin_password 都是变量状态。 </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#当playbook执行完template的时候，远程的admin_username*及admin_password 会变成变量所对应的值。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#例 </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#前面的那个Playbook,如果我们在tomcat-servers设置了这两个变量如下：</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">dmin_username:</span><span style="color:#98C379;--shiki-dark:#98C379;"> admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">admin_password:</span><span style="color:#98C379;--shiki-dark:#98C379;"> adminsecret</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#那么在执行这个Playbook前，对应的那个template文件（俗称模版），</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">将在本地保持{{ admin_username }}及{{ admin_password }}的状态。</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">在Ansible调用template模版执行的时候，这里将由Jinjia2从”tomcat-servers”读取对应的值，</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">然后替换掉模版里的变量，然后把这个替换变量值后的文件拷贝到远程节点。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这个就是template的意义所在。</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="更多模块" tabindex="-1"><a class="header-anchor" href="#更多模块"><span>更多模块</span></a></h3><p>ansible-doc -l 查询</p><hr><h2 id="playbook的配置和使用" tabindex="-1"><a class="header-anchor" href="#playbook的配置和使用"><span>playbook的配置和使用</span></a></h2><p>配置文件后缀名为.yml</p><h3 id="官网demo说明" tabindex="-1"><a class="header-anchor" href="#官网demo说明"><span>官网demo说明</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这个是你选择的主机</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">webservers</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这个是变量</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    http_port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    max_clients</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">200</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#远端的执行权限</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#利用yum模块来操作</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure apache is at the latest version</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    yum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">pkg=httpd state=latest</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the apache config file</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/srv/httpd.j2 dest=/etc/httpd.conf</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#触发重启服务器</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">restart apache</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure apache is running</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=started</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这里的restart apache 和上面的触发是配对的。这就是handlers的作用。相当于tag</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  handlers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">restart apache</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=restarted</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#有的系统做了sudo限制，所以需要在playbook中开启权限，如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">vic</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=nginx state=started</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      sudo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">yes</span></span></code></pre></div><h3 id="脚本实例" tabindex="-1"><a class="header-anchor" href="#脚本实例"><span>脚本实例</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  ##facts可以调用client的变量来使用，后面变量里会详细介绍</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=&quot;{{ user }}&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest1] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=1    changed=0    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="给脚本添加service的调用" tabindex="-1"><a class="header-anchor" href="#给脚本添加service的调用"><span>给脚本添加service的调用</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #返回结果如下 </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到 TASK [service]显示已经开启了</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [service] *****************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="给脚本添加copy模块的调用" tabindex="-1"><a class="header-anchor" href="#给脚本添加copy模块的调用"><span>给脚本添加copy模块的调用</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了copy服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #返回结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] ************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] *******************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [service] ****************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到 TASK [copy file to clent]已成功</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to clent] *****************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP ********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=3    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>copy传送的时候，可能报错</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>afewbug | FAILED &gt;&gt; {</span></span>
<span class="line"><span>    &quot;checksum&quot;: &quot;4ee72f7427050dcd97068734d35ca7b2c651bc88&quot;, </span></span>
<span class="line"><span>    &quot;failed&quot;: true, </span></span>
<span class="line"><span>    &quot;msg&quot;: &quot;Aborting, target uses selinux but python bindings (libselinux-python) aren‘t installed!&quot;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>是因为ansible需要libselinux-python包。（被控端需要安装libselinux-python**）  </span></span>
<span class="line"><span>可以在copy前先调用yum模块，安装libselinux-python</span></span></code></pre></div><h2 id="template模板-支持jinja2" tabindex="-1"><a class="header-anchor" href="#template模板-支持jinja2"><span>template模板（支持jinja2）</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">temp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了copy服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}变量来自vars</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了template模板使用</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [start httpd] *************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to clent] ******************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到 返回结果显示成功，去client相关目录即可看到文件</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=4    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#template模块可以引用变量到源文件</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">/tmp/temp</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{user}}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{temp}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#执行yml后</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m command -a &#39;cat /tmp/temptest&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##client返回的就是主机源文件中引入的变量</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">usertest1</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="执行外部命令的模块" tabindex="-1"><a class="header-anchor" href="#执行外部命令的模块"><span>执行外部命令的模块</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">temp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了copy服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}变量来自vars</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了template模板使用</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">run shell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/bin/ls /tmp/ || /bin/true</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #/bin/true 防中断</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">run  command</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">mkdir /tmp/command-test</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #添加了两个执行外部命令模块shell和command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [start httpd] *************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to client] *****************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [shell~] ******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [run this command] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="color:#98C379;--shiki-dark:#98C379;">WARNING</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]: </span><span style="color:#98C379;--shiki-dark:#98C379;">Consider using file module with state=directory rather than running</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">mkdir</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=6    changed=4    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#1./usr/bin/...||/bin/true  前面失败的话/bin/true：返回true。防止中断，继续执行。类似的判断还有chenge_when参数</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="变量功能" tabindex="-1"><a class="header-anchor" href="#变量功能"><span>变量功能</span></a></h2><h3 id="facts" tabindex="-1"><a class="header-anchor" href="#facts"><span>facts</span></a></h3><blockquote><p>一个常用的组件，可实现对远程自己系统信息的获取，比如：主机名，IP地址，操作系统，分区情况，硬件信息等，配合playbook使用，更加的灵活和个性化定制</p></blockquote><p><code>ansible ip/group -m setup</code>可以获取clients的facts信息</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> testgroup -m setup</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    &quot;ansible_facts&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_all_ipv4_addresses&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;192.168.122.1&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;192.168.247.152&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_all_ipv6_addresses&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;fe80::20c:29ff:feb5:6e6&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_architecture&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;x86_64&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_bios_date&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;07/02/2015&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_bios_version&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;6.00&quot;,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        ......</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>脚本中开启Facts功能</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #开启facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}变量来自vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果，</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#查看</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m raw -a &quot;ls /tmp | grep 192*&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.122.1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.247.152&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Shared connection to 192.168.247.152 closed.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#IP地址有两个所以文件名很奇怪</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>当然，我们也可以在主机的/tmp/temp下调用facts变量</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#修改/tmp/temp文件</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{ansible_all_ipv4_addresses}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #开启facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/factstest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m raw -a &quot;cat /tmp/factstest&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.122.1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.247.152&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Shared connection to 192.168.247.152 closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义变量" tabindex="-1"><a class="header-anchor" href="#自定义变量"><span>自定义变量</span></a></h3><blockquote><p>如何facts的变量并不能满足需求的，就可以自定义facts模板来实现</p><p>另外可以通过本地facts来实现，只需在client的/etc/ansible/facts.d目录定义JSON,INI或可执行的JSON输出，后缀名一定要用.fact，那么这些文件就可以作为本地的facts</p></blockquote><p>##在client定义变量，供ansible主机使用</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 ~]# mkdir /etc/ansible/facts.d -p</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 ~]# cd /etc/ansible/facts.d/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 facts.d]# cat client.fact</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[general]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">zili</span></span></code></pre></div><p><strong>ansible主机</strong></p><div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]$ansible </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -m setup -a </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;filter=ansible_local&quot;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | SUCCESS =&gt; {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;ansible_facts&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        &quot;ansible_local&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {      </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#本地facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;client&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {       </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#文件名</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                &quot;general&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {       </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#节点名</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    &quot;name&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;zili&quot;</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">    #key-value</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;changed&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>那么就可以通过如下方式去调用自定义的facts变量</strong></p><p><code>{{ansible_local.client.general.name}}</code></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [create </span><span style="color:#98C379;--shiki-dark:#98C379;">user]</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [template </span><span style="color:#98C379;--shiki-dark:#98C379;">test]</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ***********************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">changed:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#调用成功，并可看到client内容已变化</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> testgroup -m raw -a </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cat /tmp/factstest2&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          192.168.247.152 | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#E06C75;--shiki-dark:#E06C75;">rc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zili</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Shared</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;"> closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="在操作主机定义变量-来控制client" tabindex="-1"><a class="header-anchor" href="#在操作主机定义变量-来控制client"><span>在操作主机定义变量，来控制client</span></a></h2><p>思路就是在执行playbook的时候将本地的facts推送到client相关目录下</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create directory for ansible custom facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">state=directory recurse=yes path=/etc/ansible/facts.d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">install custom facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/etc/ansible/host.fact dest=/etc/ansible/facts.d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">re-read facts after adding custom fact</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        setup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">filter=ansible_local</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #如此相当于批量在client创建了facts变量</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #然后就可以主机调用了!</span></span></code></pre></div><h3 id="注册变量" tabindex="-1"><a class="header-anchor" href="#注册变量"><span>注册变量</span></a></h3><blockquote><p>变量可以将一条命令的返回值进行保存，然后提供给playbook使用</p></blockquote><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root@ansible ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]# </span><span style="color:#98C379;--shiki-dark:#98C379;">cat user1.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/bin/foo</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">z</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #注册了一个foo\\_resul变量，变量值为shell: /usr/bin/foo的运行结果;  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ignore_errors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #ignore\\_errors: True为忽略错误</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">touch /tmp/LLL</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #当变量注册完成后，就可以在后面的playbook中使用了</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">z.rc == 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#当条件语句when: z.rc == 5成立时，shell: touch /tmp/LLL命令才会执行</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到command是skipping的。因为返回值是127，所以client肯定还是没有创建LLL的</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook user1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [testgroup] ***************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]: FAILED! </span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{&quot;changed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cmd&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/usr/bin/foo&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;delta&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;0:00:00.003488&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;end&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:08:45.996549&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;failed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;rc&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 127,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;start&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:08:45.993061&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stderr&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/bin/sh: /usr/bin/foo: No such file or directory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout_lines&quot;:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [], </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;warnings&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: []}</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">..</span><span style="color:#98C379;--shiki-dark:#98C379;">.ignoring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">skipping:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##所以我门修改z.rc的返回值为127在执行</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#以为返回值是对的，所以执行了touch，warning是友情提示，最好用线管模块进行文件的操作</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook user1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [testgroup] ***************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]: FAILED! </span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{&quot;changed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cmd&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/usr/bin/foo&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;delta&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;0:00:00.003539&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;end&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:11:01.955975&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;failed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;rc&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 127,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;start&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:11:01.952436&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stderr&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/bin/sh: /usr/bin/foo: No such file or directory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout_lines&quot;:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [], </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;warnings&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: []}</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">..</span><span style="color:#98C379;--shiki-dark:#98C379;">.ignoring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">changed:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [WARNING]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Consider</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#98C379;--shiki-dark:#98C379;"> module</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#98C379;--shiki-dark:#98C379;"> state=touch</span><span style="color:#98C379;--shiki-dark:#98C379;"> rather</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span><span style="color:#98C379;--shiki-dark:#98C379;"> touch</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="语句" tabindex="-1"><a class="header-anchor" href="#语句"><span>语句</span></a></h2><h3 id="条件语句" tabindex="-1"><a class="header-anchor" href="#条件语句"><span>条件语句</span></a></h3><blockquote><p>playbook的执行结果取决于变量，不管是facts还是tasks结果赋值的，而变量的值可以依赖于其他变量，当然一会印象ansible的执行</p><p>有时候我们，想要跳过某些主机的执行步骤，比如，某些client不安装某个软件包，不清理垃圾等等</p><p>就要使用判断了</p></blockquote><h2 id="when" tabindex="-1"><a class="header-anchor" href="#when"><span>when</span></a></h2><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">when</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">shutdown centos</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/sbin/shutdown -t now</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ansible_hostname == &#39;test1&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#when返回bool值，为true是执行，false则不执行</span></span></code></pre></div><p><strong>when 针对不同分支的二级处理</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">when</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/sbin/ip a</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ignore_errors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/something</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|failed</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/something_else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|success</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/still/something_else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|skipped</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># when: result|success&quot;的意思为当变量result执行结果为成功</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#将执行/bin/something_else命令，其他同理。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#其中success为Ansible内部过滤器方法，返回True代表命令运行成功。</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="循环语句" tabindex="-1"><a class="header-anchor" href="#循环语句"><span>循环语句</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ item }} state=present groups=wheel</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    with_items</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">tiger1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">tiger2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#创建用户的。with_items会自动循环执行上面的语句&quot;user: name={{ item }} state=present groups=wheel&quot;，循环的次数为with_items的元素个数。这里有2个元素，分别为tiger1、tiger2，会分别替换{{ item }}项</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#等同于</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user tiger1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=tiger1 state=present groups=wheel</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user tiger2&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=tiger2 state=present groups=wheel</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="循环元素支持列表" tabindex="-1"><a class="header-anchor" href="#循环元素支持列表"><span>循环元素支持列表</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#首先定义好列表 list.yml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">packages_base</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;vsftpd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;vim&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">packages_apps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - [[ </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;mysql&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">httpd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#然后引入使用</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  var_files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#98C379;--shiki-dark:#98C379;">/etc/ansible/list.yml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;install rpm&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    yum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ item }} state=installed</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    with_flattened</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#此语句 用来循环定义好的列表</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">packages_base</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">packages_apps</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="handlers-和-include" tabindex="-1"><a class="header-anchor" href="#handlers-和-include"><span>handlers 和 include</span></a></h3><blockquote><p>当多个playbook涉及复用的任务列表时，可以将复用的内容剥离出来，写到独立的文件里，需要的地方include进来即可</p><p>除了tasks之外，还有一个handlers的命令，handlers是在执行tasks之后服务器发生变化之后可供调用的handler</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the httpd config file</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the httpd.conf to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:    </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果copy执行完之后/etc/httpd/conf/httpd.conf文件发送了变化，则执行</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">restart httpd</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 调用handler</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">include</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">playbook/tasks/httpd.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    handlers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">restart httpd</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #此处的标识必须和notify一样才可以引起触发</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=restarted</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #注意上面使用的- include: playbook/tasks/httpd.yml，看一下这个文件的内容</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure httpd is running</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=started</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>notify这个action可用于在每个play的最后被触发，这样可以避免多次有改变发生时每次都执行指定的操作，取而代之，仅在所有的变化发生完成后一次性地执行指定操作。</p><p>Handlers 是由通知者进行 notify, 如果没有被 notify,handlers 不会执行。</p><p>Handlers 最佳的应用场景是用来重启服务,或者触发系统重启操作.除此以外很少用到了。</p></blockquote><h2 id="roles-使用" tabindex="-1"><a class="header-anchor" href="#roles-使用"><span>roles 使用</span></a></h2><p>前面的所有都在一个文件内.还有一种方法可以进行更好的组织架构<br> 使用roles</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master roles]# tree</span></span>
<span class="line"><span>.</span></span>
<span class="line"><span>├── test</span></span>
<span class="line"><span>│   └── tasks</span></span>
<span class="line"><span>│       └── main.yml</span></span>
<span class="line"><span>└── test.yml</span></span>
<span class="line"><span>test.yml为入口文件,每次执行它即可.他的内容如下</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master roles]# cat test.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- hosts: all</span></span>
<span class="line"><span>  roles:</span></span>
<span class="line"><span>    - role: test</span></span>
<span class="line"><span>定义了主机/主机组,然后定义了要使用的roles,(也就是roles下的文件夹的名字)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>test文件夹下定义了tasks,内有 **main.yml**  这个命名是规定好的.必须是main</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>main.yml 书写了tasks的任务.</span></span>
<span class="line"><span>[root@master roles]# cat test/tasks/main.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- name: test role ping</span></span>
<span class="line"><span>  ping:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master roles]#</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果如下:</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master roles]# ansible-playbook test.yml </span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY [all] ************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [Gathering Facts] ************************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.28]</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [test : test role ping] ******************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.28]</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY RECAP ************************************************************************************</span></span>
<span class="line"><span>10.1.27.24                 : ok=2    changed=0    unreachable=0    failed=0   </span></span>
<span class="line"><span>10.1.27.28                 : ok=2    changed=0    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>roles有很多结构,ansible可以根据其进行解析.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>├── defaults</span></span>
<span class="line"><span>├── files</span></span>
<span class="line"><span>├── handlers</span></span>
<span class="line"><span>├── meta</span></span>
<span class="line"><span>├── tasks</span></span>
<span class="line"><span>├── templates</span></span>
<span class="line"><span>└── vars</span></span></code></pre></div><p>如果<code>roles/x/tasks/main.yml</code>存在,则自动将里面的tasks添加到play中。</p><p>如果<code>roles/x/handlers/main.yml</code>存在,则自动将里面的handlers添加到play中。</p><p>如果<code>roles/x/vars/main.yml</code>存在, 则自动将其中的variables添加到play中。</p><p>如果<code>roles/x/meta/main.yml</code>存在,则添加role的依赖关系roles中。</p><p>任何<code>copy</code>任务、<code>script</code>任务都可以引用<code>roles/x/files</code>中的文件，无论是使用绝对或相对路径都可以。</p><p>任何<code>template</code>任务都可以引用<code>roles/x/templates</code>中的文件，无论绝对或相对路径。</p><p>任何<code>include</code>任务都可以引用<code>roles/x/tasks/</code>中的文件，无论相对或绝对路径</p><p>具体可以参见文档：<a href="http://docs.ansible.com/playbooks_intro.html" target="_blank" rel="noopener noreferrer">http://docs.ansible.com/playbooks_intro.html</a></p><h2 id="ansible和saltstack的对比" tabindex="-1"><a class="header-anchor" href="#ansible和saltstack的对比"><span>ansible和saltstack的对比</span></a></h2><blockquote><p>1、salt要安装agent , ansible通过ssh连接。</p><p>2、salt在server端要启进程；ansible不需要。</p><p>3、salt与ansible都有模块，可使用任意语言开发模块。</p><p>4、salt与ansible都使用yaml语言格式编写剧本。</p><p>ansible走的是ssh,所以它有认证以及加密码的过程，使得ansible非常慢，不适用于大规模环境（指上千台）</p></blockquote><hr>`,161);function c(d,k){return l(),n("div",null,[o,i("more"),t])}const h=a(r,[["render",c],["__file","ansible学习.html.vue"]]),y=JSON.parse(`{"path":"/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html","title":"Ansible","lang":"zh-CN","frontmatter":{"article":true,"title":"Ansible","order":11,"category":["自动化工具","linux"],"tag":["ansible"],"index":true,"description":"请注意 本文内容可能已过时，请自行甄别。 前言 Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是 分布式集中管理工具， 通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块 什么是ans...","head":[["meta",{"property":"og:url","content":"https://docs.lizili.online/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html"}],["meta",{"property":"og:site_name","content":"lzz's Blog"}],["meta",{"property":"og:title","content":"Ansible"}],["meta",{"property":"og:description","content":"请注意 本文内容可能已过时，请自行甄别。 前言 Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是 分布式集中管理工具， 通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块 什么是ans..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-23T05:06:11.000Z"}],["meta",{"property":"article:author","content":"z"}],["meta",{"property":"article:tag","content":"ansible"}],["meta",{"property":"article:modified_time","content":"2024-04-23T05:06:11.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Ansible\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-23T05:06:11.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"z\\",\\"url\\":\\"https://docs.lizili.online\\"}]}"]]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"什么是ansible?","slug":"什么是ansible","link":"#什么是ansible","children":[]},{"level":2,"title":"ansible 的工作流程","slug":"ansible-的工作流程","link":"#ansible-的工作流程","children":[]},{"level":2,"title":"安装ansible","slug":"安装ansible","link":"#安装ansible","children":[]},{"level":2,"title":"配置登录","slug":"配置登录","link":"#配置登录","children":[]},{"level":2,"title":"定义Ansible的节点清单","slug":"定义ansible的节点清单","link":"#定义ansible的节点清单","children":[]},{"level":2,"title":"简单的远程操作","slug":"简单的远程操作","link":"#简单的远程操作","children":[]},{"level":2,"title":"定义变量","slug":"定义变量","link":"#定义变量","children":[{"level":3,"title":"定义主机变量","slug":"定义主机变量","link":"#定义主机变量","children":[]},{"level":3,"title":"定义组变量","slug":"定义组变量","link":"#定义组变量","children":[]},{"level":3,"title":"嵌套组","slug":"嵌套组","link":"#嵌套组","children":[]},{"level":3,"title":"分离主机和组特定数据","slug":"分离主机和组特定数据","link":"#分离主机和组特定数据","children":[]}]},{"level":2,"title":"命令参数","slug":"命令参数","link":"#命令参数","children":[]},{"level":2,"title":"Pattern","slug":"pattern","link":"#pattern","children":[]},{"level":2,"title":"常用模块","slug":"常用模块","link":"#常用模块","children":[{"level":3,"title":"copy模块","slug":"copy模块","link":"#copy模块","children":[]},{"level":3,"title":"file模块","slug":"file模块","link":"#file模块","children":[]},{"level":3,"title":"cron模块","slug":"cron模块","link":"#cron模块","children":[]},{"level":3,"title":"group模块","slug":"group模块","link":"#group模块","children":[]},{"level":3,"title":"uesr模块","slug":"uesr模块","link":"#uesr模块","children":[]},{"level":3,"title":"yum模块","slug":"yum模块","link":"#yum模块","children":[]},{"level":3,"title":"shell模块","slug":"shell模块","link":"#shell模块","children":[]},{"level":3,"title":"command模块","slug":"command模块","link":"#command模块","children":[]},{"level":3,"title":"raw模块","slug":"raw模块","link":"#raw模块","children":[]},{"level":3,"title":"script模块","slug":"script模块","link":"#script模块","children":[]},{"level":3,"title":"command,script,shell,raw的区别","slug":"command-script-shell-raw的区别","link":"#command-script-shell-raw的区别","children":[]},{"level":3,"title":"service模块","slug":"service模块","link":"#service模块","children":[]},{"level":3,"title":"ping模块","slug":"ping模块","link":"#ping模块","children":[]},{"level":3,"title":"get_url","slug":"get-url","link":"#get-url","children":[]},{"level":3,"title":"stat模块","slug":"stat模块","link":"#stat模块","children":[]},{"level":3,"title":"template模块","slug":"template模块","link":"#template模块","children":[]}]},{"level":2,"title":"模块参数","slug":"模块参数","link":"#模块参数","children":[]},{"level":2,"title":"模块参数案例","slug":"模块参数案例","link":"#模块参数案例","children":[{"level":3,"title":"更多模块","slug":"更多模块","link":"#更多模块","children":[]}]},{"level":2,"title":"playbook的配置和使用","slug":"playbook的配置和使用","link":"#playbook的配置和使用","children":[{"level":3,"title":"官网demo说明","slug":"官网demo说明","link":"#官网demo说明","children":[]},{"level":3,"title":"脚本实例","slug":"脚本实例","link":"#脚本实例","children":[]}]},{"level":2,"title":"给脚本添加service的调用","slug":"给脚本添加service的调用","link":"#给脚本添加service的调用","children":[]},{"level":2,"title":"给脚本添加copy模块的调用","slug":"给脚本添加copy模块的调用","link":"#给脚本添加copy模块的调用","children":[]},{"level":2,"title":"template模板（支持jinja2）","slug":"template模板-支持jinja2","link":"#template模板-支持jinja2","children":[]},{"level":2,"title":"执行外部命令的模块","slug":"执行外部命令的模块","link":"#执行外部命令的模块","children":[]},{"level":2,"title":"变量功能","slug":"变量功能","link":"#变量功能","children":[{"level":3,"title":"facts","slug":"facts","link":"#facts","children":[]},{"level":3,"title":"自定义变量","slug":"自定义变量","link":"#自定义变量","children":[]}]},{"level":2,"title":"在操作主机定义变量，来控制client","slug":"在操作主机定义变量-来控制client","link":"#在操作主机定义变量-来控制client","children":[{"level":3,"title":"注册变量","slug":"注册变量","link":"#注册变量","children":[]}]},{"level":2,"title":"语句","slug":"语句","link":"#语句","children":[{"level":3,"title":"条件语句","slug":"条件语句","link":"#条件语句","children":[]}]},{"level":2,"title":"when","slug":"when","link":"#when","children":[{"level":3,"title":"循环语句","slug":"循环语句","link":"#循环语句","children":[]}]},{"level":2,"title":"循环元素支持列表","slug":"循环元素支持列表","link":"#循环元素支持列表","children":[{"level":3,"title":"handlers 和 include","slug":"handlers-和-include","link":"#handlers-和-include","children":[]}]},{"level":2,"title":"roles 使用","slug":"roles-使用","link":"#roles-使用","children":[]},{"level":2,"title":"ansible和saltstack的对比","slug":"ansible和saltstack的对比","link":"#ansible和saltstack的对比","children":[]}],"git":{"createdTime":1680433735000,"updatedTime":1713848771000,"contributors":[{"name":"lizili","email":"cn.zili.lee@outlook.com","commits":3}]},"readingTime":{"minutes":19.37,"words":5811},"filePathRelative":"ops/linux/ansible学习.md","localizedDate":"2023年4月2日","excerpt":"\\n<div class=\\"hint-container caution\\">\\n<p class=\\"hint-container-title\\">请注意</p>\\n<p>本文内容可能已过时，请自行甄别。</p>\\n</div>\\n<h2>前言</h2>\\n<p><strong>Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是</strong> <span style=\\"color:red\\"> <strong>分布式集中管理工具</strong></span>， <strong>通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块</strong></p>","autoDesc":true}`);export{h as comp,y as data};
