import{_ as s,c as a,o as i,f as n}from"./app-BfCDUtKQ.js";const l={},e=n(`<h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><div class="hint-container caution"><p class="hint-container-title">请注意</p><p>本文内容可能已过时，请自行甄别。</p></div><blockquote><p>Keepalived使用的vrrp协议方式，虚拟路由冗余协议 (Virtual Router Redundancy Protocol，简称VRRP).</p></blockquote><p>Keepalived模拟路由器的高可用，Heartbeat或Corosync的目的是实现Service的高可用。</p><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p>如无特殊需求,直接yum安装<code>yum install keepalived</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>主配置文件：/etc/keepalived/keepalived.conf</span></span>
<span class="line"><span>主程序文件：/usr/sbin/keepalived</span></span>
<span class="line"><span>Unit File：keepalived.service</span></span>
<span class="line"><span>Unit File的环境配置文件：/etc/sysconfig/keepalived</span></span></code></pre></div><h2 id="单主模式" tabindex="-1"><a class="header-anchor" href="#单主模式"><span>单主模式</span></a></h2><p>10.1.27.23 主,27.24 备,vip:27.21</p><h3 id="master" tabindex="-1"><a class="header-anchor" href="#master"><span>master</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master keepalived]# cat keepalived.conf</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">! </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Configuration</span><span style="color:#98C379;--shiki-dark:#98C379;"> File</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> keepalived</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">global_defs</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #全局配置</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   notification_email</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   	lizili@xxxxxx.com</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #出问题是,接收人邮件</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   notification_email_from</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili@xxxxxx.com</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #发件人邮箱</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   smtp_server</span><span style="color:#98C379;--shiki-dark:#98C379;"> smtp.xxxxxx.com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   smtp_connect_timeout</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 30</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   router_id</span><span style="color:#98C379;--shiki-dark:#98C379;"> LVS_DEVEL</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 这个邮件比较鸡肋,建议通过脚本发送.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vrrp_instance</span><span style="color:#98C379;--shiki-dark:#98C379;"> VI_1</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">       #vrrp命名,多个的时候,命名要不一致.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    state</span><span style="color:#98C379;--shiki-dark:#98C379;"> MASTER</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         #虚拟机路由器状态MASTER/BACKUP</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    interface</span><span style="color:#98C379;--shiki-dark:#98C379;"> eno16777984</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #通过那个网卡发送vrrp广播</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_router_id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 51</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #虚拟路由器ID,如果有多个VI要注意区分这个ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    priority</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 100</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #优先级,越大越优先(取值范围1-255)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    advert_int</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #广播时间间隔,默认1s</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    authentication</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #传递信息认证方式,密码仅支持8位</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_type</span><span style="color:#98C379;--shiki-dark:#98C379;"> PASS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_pass</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_ipaddress</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #虚拟路由地址</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        10.1.27.21</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="slave" tabindex="-1"><a class="header-anchor" href="#slave"><span>slave</span></a></h3><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@slave keepalived]# cat keepalived.conf</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">! </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Configuration</span><span style="color:#98C379;--shiki-dark:#98C379;"> File</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> keepalived</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">global_defs</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   notification_email</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   	lizili@xxxxxx.com</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   notification_email_from</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili@xxxxxx.com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   smtp_server</span><span style="color:#98C379;--shiki-dark:#98C379;"> smtp.xxxxxx.com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   smtp_connect_timeout</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 30</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   router_id</span><span style="color:#98C379;--shiki-dark:#98C379;"> LVS_DEVEL</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vrrp_instance</span><span style="color:#98C379;--shiki-dark:#98C379;"> VI_1</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    state</span><span style="color:#98C379;--shiki-dark:#98C379;"> BACKUP</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    interface</span><span style="color:#98C379;--shiki-dark:#98C379;"> eno16777984</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_router_id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 51</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    priority</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 99</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    advert_int</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    authentication</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_type</span><span style="color:#98C379;--shiki-dark:#98C379;"> PASS</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_pass</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_ipaddress</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        10.1.27.21</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h3><p>两台都安装httpd服务<code>yum -y install httpd</code></p><p><code>vi /var/www/html/index.html</code></p><p>内容分别写上本机IP,然后通过浏览器访问vip,应该能查看到master的IP地址.</p><p>然后关闭master的keepalived服务,刷新网页,应该出现slave的地址</p><h2 id="邮件告警" tabindex="-1"><a class="header-anchor" href="#邮件告警"><span>邮件告警</span></a></h2><p>安装mailx</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#安装mailx邮件服务</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> mailx</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#配置文件追加信息（/etc/mail.rc）</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/mail.rc</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#发件人信息</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> from=lizili@xxxxxx.com</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> smtp=smtp.xxxxxx.com</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> smtp-auth-user=lizili</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> smtp-auth-password=xxxxxx</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">set</span><span style="color:#98C379;--shiki-dark:#98C379;"> smtp-auth=login</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#测试发送</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;hello world&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mail</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;hello&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili@xxxxxx.com</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#echo &quot;邮件内容&quot; | mail -s &quot;标题&quot; 邮箱地址</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#邮件策略上,把账号加如白名单,以防被拉黑.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置keepalived</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#在VRRP实例中虚拟IP下配置添加以下信息</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vrrp_instance</span><span style="color:#98C379;--shiki-dark:#98C379;"> VI_1</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #Keepalived进入MASTER状态执行脚本</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    notify_master</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/etc/keepalived/mail_notify.sh master&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #Keepalived进入BACKUP状态执行脚本</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    notify_backup</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/etc/keepalived/mail_notify.sh backup&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #Keepalived进入FAULT状态执行脚本</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    notify_fault</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/etc/keepalived/mail_notify.sh fault&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">｝</span></span></code></pre></div><p>新建脚本 755权限</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/keepalived/mail_notify.sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;keepalived 10.1.27.23 </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="color:#98C379;--shiki-dark:#98C379;"> 状态被激活，请确认服务运行状态&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">|</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mail</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;keepalived状态切换&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili@wondersgroup.com</span></span></code></pre></div><h2 id="双主模式" tabindex="-1"><a class="header-anchor" href="#双主模式"><span>双主模式</span></a></h2><p>配置并没有太大的变化,在添加一个vrrp实例即可,配置如下</p><p>master</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vrrp_instance</span><span style="color:#98C379;--shiki-dark:#98C379;"> VI_2</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">       #vrrp命名,多个的时候,命名要不一致.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    state</span><span style="color:#98C379;--shiki-dark:#98C379;"> BACKUP</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         #修改为backup</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    interface</span><span style="color:#98C379;--shiki-dark:#98C379;"> eno16777984</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #通过那个网卡发送vrrp广播</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_router_id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 52</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #虚拟路由器ID,如果有多个VI要注意区分这个ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    priority</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 99</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #优先级,越大越优先(取值范围1-255)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    advert_int</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #广播时间间隔,默认1s</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    authentication</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #传递信息认证方式,密码仅支持8位</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_type</span><span style="color:#98C379;--shiki-dark:#98C379;"> PASS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_pass</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_ipaddress</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #虚拟路由地址</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        10.1.27.11</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>slave</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vrrp_instance</span><span style="color:#98C379;--shiki-dark:#98C379;"> VI_1</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    state</span><span style="color:#98C379;--shiki-dark:#98C379;"> MASTER</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    interface</span><span style="color:#98C379;--shiki-dark:#98C379;"> eno16777984</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_router_id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 52</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    priority</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 100</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    advert_int</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    authentication</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_type</span><span style="color:#98C379;--shiki-dark:#98C379;"> PASS</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        auth_pass</span><span style="color:#98C379;--shiki-dark:#98C379;"> lizili</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    virtual_ipaddress</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        10.1.27.11</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>其实就是增加新的配置 VI_2 使用Server B 做主，如此 Server A、B 各自拥有主虚拟 IP，同时备份对方的虚拟 IP, 这个方案可以是不同的服务，或者是同一服务的访问分流(配合 DNS 使用).</p>`,32),p=[e];function r(o,t){return i(),a("div",null,p)}const d=s(l,[["render",r],["__file","keepalived.html.vue"]]),k=JSON.parse(`{"path":"/ops/linux/keepalived.html","title":"keepalived","lang":"zh-CN","frontmatter":{"title":"keepalived","order":100,"index":true,"article":false,"category":["linux"],"tag":["keepalived"],"description":"请注意 本文内容可能已过时，请自行甄别。 Keepalived使用的vrrp协议方式，虚拟路由冗余协议 (Virtual Router Redundancy Protocol，简称VRRP). Keepalived模拟路由器的高可用，Heartbeat或Corosync的目的是实现Service的高可用。 安装 如无特殊需求,直接yum安装yum in...","head":[["meta",{"property":"og:url","content":"https://docs.lizili.online/ops/linux/keepalived.html"}],["meta",{"property":"og:site_name","content":"lzz's Blog"}],["meta",{"property":"og:title","content":"keepalived"}],["meta",{"property":"og:description","content":"请注意 本文内容可能已过时，请自行甄别。 Keepalived使用的vrrp协议方式，虚拟路由冗余协议 (Virtual Router Redundancy Protocol，简称VRRP). Keepalived模拟路由器的高可用，Heartbeat或Corosync的目的是实现Service的高可用。 安装 如无特殊需求,直接yum安装yum in..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-23T05:06:11.000Z"}],["meta",{"property":"article:author","content":"z"}],["meta",{"property":"article:tag","content":"keepalived"}],["meta",{"property":"article:modified_time","content":"2024-04-23T05:06:11.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"keepalived\\",\\"description\\":\\"请注意 本文内容可能已过时，请自行甄别。 Keepalived使用的vrrp协议方式，虚拟路由冗余协议 (Virtual Router Redundancy Protocol，简称VRRP). Keepalived模拟路由器的高可用，Heartbeat或Corosync的目的是实现Service的高可用。 安装 如无特殊需求,直接yum安装yum in...\\"}"]]},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"单主模式","slug":"单主模式","link":"#单主模式","children":[{"level":3,"title":"master","slug":"master","link":"#master","children":[]},{"level":3,"title":"slave","slug":"slave","link":"#slave","children":[]},{"level":3,"title":"测试","slug":"测试","link":"#测试","children":[]}]},{"level":2,"title":"邮件告警","slug":"邮件告警","link":"#邮件告警","children":[]},{"level":2,"title":"双主模式","slug":"双主模式","link":"#双主模式","children":[]}],"git":{"createdTime":1709270097000,"updatedTime":1713848771000,"contributors":[{"name":"lizili","email":"cn.zili.lee@outlook.com","commits":2}]},"readingTime":{"minutes":2.81,"words":843},"filePathRelative":"ops/linux/keepalived.md","localizedDate":"2024年3月1日","excerpt":"\\n<div class=\\"hint-container caution\\">\\n<p class=\\"hint-container-title\\">请注意</p>\\n<p>本文内容可能已过时，请自行甄别。</p>\\n</div>\\n<blockquote>\\n<p>Keepalived使用的vrrp协议方式，虚拟路由冗余协议 (Virtual Router Redundancy Protocol，简称VRRP).</p>\\n</blockquote>\\n<p>Keepalived模拟路由器的高可用，Heartbeat或Corosync的目的是实现Service的高可用。</p>\\n<h2>安装</h2>\\n<p>如无特殊需求,直接yum安装<code>yum install keepalived</code></p>","autoDesc":true}`);export{d as comp,k as data};
