import{_ as i,c as a,o as n,f as s}from"./app-BfCDUtKQ.js";const o="/assets/2023-09-20-11-56-05-Biy4XMeJ.png",e="/assets/2023-09-20-13-54-56-BkKhSo6f.png",l="/assets/2023-09-20-13-58-21-DlrGX6vz.png",t="/assets/2023-09-20-14-00-05-CEGi9dAo.png",r="/assets/2023-09-20-14-02-11-BaTT92kp.png",p="/assets/2023-09-20-14-08-07-DupC3nBq.png",c="/assets/2023-09-20-14-21-14-BKjK9TCA.png",d="/assets/2023-09-20-14-21-57-Dnn3GJ9O.png",h="/assets/2023-09-20-14-24-21-z5VT7A9g.png",g="/assets/2023-09-20-14-27-57-D7er6Slg.png",k="/assets/2023-09-20-14-38-46-DB4B6MdE.png",m="/assets/2023-09-20-14-44-30-B75LFTj9.png",f="/assets/2023-09-20-15-53-46-wIoRU0pe.png",y={},u=s('<h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><h2 id="前置准备" tabindex="-1"><a class="header-anchor" href="#前置准备"><span>前置准备</span></a></h2><ol><li>集群内安装minio，并上传文件，模拟业务应用</li><li>集群外搭建minio 作为longhorn 备份的存储服务</li></ol><h3 id="集群内安装minio" tabindex="-1"><a class="header-anchor" href="#集群内安装minio"><span>集群内安装minio</span></a></h3><p>此minio用作模拟业务应用使用 安装参考： <a href="https://github.com/bitnami/charts/tree/main/bitnami/minio" target="_blank" rel="noopener noreferrer">Bitnami Minio</a></p><figure><img src="'+o+`" alt="minio" tabindex="0" loading="lazy"><figcaption>minio</figcaption></figure><h3 id="集群外安装minio" tabindex="-1"><a class="header-anchor" href="#集群外安装minio"><span>集群外安装minio</span></a></h3><p>此minio用以作为备份的存储使用</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">docker</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#98C379;--shiki-dark:#98C379;"> 9000:9000</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#98C379;--shiki-dark:#98C379;"> 9001:9001</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     --net=host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     --name</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     -v</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $PWD</span><span style="color:#98C379;--shiki-dark:#98C379;">/data:/data</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     -v</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> $PWD</span><span style="color:#98C379;--shiki-dark:#98C379;">/config:/root/.minio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     -d</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --restart=always</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;MINIO_ACCESS_KEY=admin&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">     -e</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;MINIO_SECRET_KEY=Passw0rd&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">     minio/minio:RELEASE.2021-11-09T03-21-45Z</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">     server</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --console-address</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;:9001&quot;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -address</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;:9000&quot;</span></span></code></pre></div><h3 id="添加secret" tabindex="-1"><a class="header-anchor" href="#添加secret"><span>添加secret</span></a></h3><p>这个secret的ns需要和longhorn保持一致</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">kubectl</span><span style="color:#98C379;--shiki-dark:#98C379;"> create</span><span style="color:#98C379;--shiki-dark:#98C379;"> secret</span><span style="color:#98C379;--shiki-dark:#98C379;"> generic</span><span style="color:#98C379;--shiki-dark:#98C379;"> minio-secret</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    --from-literal=AWS_ACCESS_KEY_ID=admin</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    --from-literal=AWS_SECRET_ACCESS_KEY=Passw0rd</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    --from-literal=AWS_ENDPOINTS=http://xxxxxx:9000</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    -n</span><span style="color:#98C379;--shiki-dark:#98C379;"> longhorn-system</span></span></code></pre></div><h2 id="备份" tabindex="-1"><a class="header-anchor" href="#备份"><span>备份</span></a></h2><ol><li><p>集群外minio，创建备份存放的bucket 如: <code>longhorn</code></p></li><li><p>longhorn 关联S3 服务</p></li></ol><figure><img src="`+e+'" alt="longhorn设置" tabindex="0" loading="lazy"><figcaption>longhorn设置</figcaption></figure><ol start="3"><li>模拟业务使用，上传文件到 集群内minio 服务中</li></ol><figure><img src="'+l+'" alt="文件上传" tabindex="0" loading="lazy"><figcaption>文件上传</figcaption></figure><ol start="4"><li>备份</li></ol><figure><img src="'+t+'" alt="备份" tabindex="0" loading="lazy"><figcaption>备份</figcaption></figure><figure><img src="'+r+'" alt="label" tabindex="0" loading="lazy"><figcaption>label</figcaption></figure><h2 id="恢复" tabindex="-1"><a class="header-anchor" href="#恢复"><span>恢复</span></a></h2><ol><li>删除集群内的minio服务，并清空volume。模拟数据丢失</li></ol><figure><img src="'+p+'" alt="卸载应用" tabindex="0" loading="lazy"><figcaption>卸载应用</figcaption></figure><ol start="2"><li>将备份数据转换为 恢复卷</li></ol><figure><img src="'+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+h+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="3"><li>激活恢复卷</li></ol><figure><img src="'+g+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+k+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="4"><li>挂载volume</li></ol><figure><img src="'+m+'" alt="挂载已存在的卷" tabindex="0" loading="lazy"><figcaption>挂载已存在的卷</figcaption></figure><h2 id="定时备份" tabindex="-1"><a class="header-anchor" href="#定时备份"><span>定时备份</span></a></h2><p>入口一 为创建定时任务<br> 入口二 可关联定时任务，也可创建定时任务</p><figure><img src="'+f+'" alt="定时任务" tabindex="0" loading="lazy"><figcaption>定时任务</figcaption></figure><h2 id="扩容" tabindex="-1"><a class="header-anchor" href="#扩容"><span>扩容</span></a></h2><ol><li>根据应用容器找到对应的PVC</li><li>将容器副本数设置为0，使PVC处于未分配模式</li><li>修改申请磁盘空间（限制只能扩容不能缩容）</li><li>恢复容器副本数，使PVC处于分配模式，重新挂载</li></ol>',37),C=[u];function b(_,A){return n(),a("div",null,C)}const B=i(y,[["render",b],["__file","longhorn-backup.html.vue"]]),x=JSON.parse(`{"path":"/cloud-native/backup/longhorn-backup.html","title":"longhorn备份","lang":"zh-CN","frontmatter":{"article":true,"title":"longhorn备份","order":11,"category":["云原生"],"tag":["longhorn","backup"],"description":"前置准备 集群内安装minio，并上传文件，模拟业务应用 集群外搭建minio 作为longhorn 备份的存储服务 集群内安装minio 此minio用作模拟业务应用使用 安装参考： Bitnami Minio miniominio 集群外安装minio 此minio用以作为备份的存储使用 添加secret 这个secret的ns需要和longhor...","head":[["meta",{"property":"og:url","content":"https://docs.lizili.online/cloud-native/backup/longhorn-backup.html"}],["meta",{"property":"og:site_name","content":"lzz's Blog"}],["meta",{"property":"og:title","content":"longhorn备份"}],["meta",{"property":"og:description","content":"前置准备 集群内安装minio，并上传文件，模拟业务应用 集群外搭建minio 作为longhorn 备份的存储服务 集群内安装minio 此minio用作模拟业务应用使用 安装参考： Bitnami Minio miniominio 集群外安装minio 此minio用以作为备份的存储使用 添加secret 这个secret的ns需要和longhor..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-09-20T08:34:13.000Z"}],["meta",{"property":"article:author","content":"z"}],["meta",{"property":"article:tag","content":"longhorn"}],["meta",{"property":"article:tag","content":"backup"}],["meta",{"property":"article:modified_time","content":"2023-09-20T08:34:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"longhorn备份\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-20T08:34:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"z\\",\\"url\\":\\"https://docs.lizili.online\\"}]}"]]},"headers":[{"level":2,"title":"前置准备","slug":"前置准备","link":"#前置准备","children":[{"level":3,"title":"集群内安装minio","slug":"集群内安装minio","link":"#集群内安装minio","children":[]},{"level":3,"title":"集群外安装minio","slug":"集群外安装minio","link":"#集群外安装minio","children":[]},{"level":3,"title":"添加secret","slug":"添加secret","link":"#添加secret","children":[]}]},{"level":2,"title":"备份","slug":"备份","link":"#备份","children":[]},{"level":2,"title":"恢复","slug":"恢复","link":"#恢复","children":[]},{"level":2,"title":"定时备份","slug":"定时备份","link":"#定时备份","children":[]},{"level":2,"title":"扩容","slug":"扩容","link":"#扩容","children":[]}],"git":{"createdTime":1695198853000,"updatedTime":1695198853000,"contributors":[{"name":"zili","email":"zili@zilimbp.local","commits":1}]},"readingTime":{"minutes":1.6,"words":480},"filePathRelative":"cloud-native/backup/longhorn-backup.md","localizedDate":"2023年9月20日","excerpt":"\\n<h2>前置准备</h2>\\n<ol>\\n<li>集群内安装minio，并上传文件，模拟业务应用</li>\\n<li>集群外搭建minio 作为longhorn 备份的存储服务</li>\\n</ol>\\n<h3>集群内安装minio</h3>\\n<p>此minio用作模拟业务应用使用 安装参考： <a href=\\"https://github.com/bitnami/charts/tree/main/bitnami/minio\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Bitnami Minio</a></p>\\n<figure><figcaption>minio</figcaption></figure>","autoDesc":true}`);export{B as comp,x as data};
