import{_ as s,c as a,o as n,f as i}from"./app-BfCDUtKQ.js";const l="/assets/2023-07-26-11-34-44-B0dd4746.png",o="/assets/2023-07-26-11-44-01-qGlZmL_Y.png",r="/assets/2023-07-26-11-45-47-VHmLc8p5.png",e="/assets/2023-07-26-11-56-43-CJfp3Z-s.png",p="data:image/png;base64,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",t="/assets/2023-07-26-13-59-31-BqxG3bgD.png",B="/assets/2023-07-26-14-00-28-CacDmD17.png",A={},k=i(`<h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><blockquote><p>以下引于 <a href="http://claude.ai" target="_blank" rel="noopener noreferrer">claude.ai</a></p></blockquote><p>goroutine是Go语言中的轻量级线程。具体来说,goroutine有以下几个主要特征:</p><ol><li>goroutine由Go运行时(runtime)管理,可以实现高度的并发。一个程序可以同时运行成千上万个goroutine。</li><li>goroutine之间通过channel进行通信。channel使得不同goroutine之间可以安全地共享内存。</li><li>创建goroutine的代价非常小。因为goroutine的堆栈起始很小(仅2KB),所以可以很容易地创建很多goroutine。</li><li>goroutine使用协作式调度(cooperative scheduling),多个goroutine可以在一个或几个操作系统线程上执行。Go运行时内部使用自举调度器在goroutine之间快速切换。</li><li>goroutine通信安全。通信和内存同步都隐式实现,不需加锁。<br> 总之,goroutine作为Go并发的核心,使得编写并发程序变得简单、高效。它独特的设计对Go语言的高并发性能起到关键作用。</li></ol><h2 id="创建goroutine" tabindex="-1"><a class="header-anchor" href="#创建goroutine"><span>创建goroutine</span></a></h2><p><code>go</code> ，只要在函数前添加它，就实现了并发。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">package</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;fmt&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;time&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> SubTask</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;15:04:05&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;this is a SubTask&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 100</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> *</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Millisecond</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 延迟0.5s</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	go</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> SubTask</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//创建一个协程</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Second</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 延迟1s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;15:04:05&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">), </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;this is a main goroutine&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+l+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这里就可以到一个问题，虽然<code>SubTask</code>是个循环，但是<code>main</code>执行完毕的时候，它也就结束了。所以这里需要注意，<mark>当主协程结束的时候，子协程也会退出</mark>。那我们做并行的时候，一定要注意这种关系</p><p>如何保证子协程执行完毕，主协程再退出呢？</p><h2 id="runtime" tabindex="-1"><a class="header-anchor" href="#runtime"><span>runtime</span></a></h2><h3 id="gosched" tabindex="-1"><a class="header-anchor" href="#gosched"><span>Gosched</span></a></h3><blockquote><p>以下引于 <a href="http://claude.ai" target="_blank" rel="noopener noreferrer">claude.ai</a></p></blockquote><p>gosched()是一个Go运行时(runtime)提供的函数,它允许当前goroutine主动放弃CPU,将CPU时间片让给其他可运行的goroutine。</p><p>具体来说,gosched()函数有以下几个主要作用:</p><ol><li>将CPU时间片让给同一物理线程上的其他goroutine运行。因为Go运行时会对goroutine进行合理调度,所以一个线程上可能有多个goroutine在运行。gosched()可以在适当的时候放弃时间片,避免goroutine独占CPU。</li><li>当缺少goroutine可运行时,它允许运行时内核线程安全地寻找其他物理线程上的可运行goroutine。如果找到,可以提前恢复已阻塞的goroutine,并为其分配CPU时间。</li><li>在多核环境下,它也可以触发work-stealing算法,让处于空闲的线程帮助正在执行的线程,提高多核CPU的利用率。</li><li>最后,gosched()还可以作为runtime内部算法的一部分,帮助对goroutine、线程进行优化管理。<br> 所以,gosched()对Go并发程序的性能优化是非常重要的。使用它可以达到更高的CPU利用率,最小化线程阻塞,优化goroutine执行。</li></ol><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">package</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;fmt&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	go</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">++</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">			fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;goroutine...&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">++</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		//runtime.Gosched()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;hello main&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>子协程要么没执行，要么顺序是乱的</p><figure><img src="`+o+'" alt="无Gosched" tabindex="0" loading="lazy"><figcaption>无Gosched</figcaption></figure><p>按预期执行</p><figure><img src="'+r+`" alt="Gosched" tabindex="0" loading="lazy"><figcaption>Gosched</figcaption></figure><hr><h3 id="goexit" tabindex="-1"><a class="header-anchor" href="#goexit"><span>Goexit</span></a></h3><blockquote><p>以下引于 <a href="http://claude.ai" target="_blank" rel="noopener noreferrer">claude.ai</a></p></blockquote><p>goexit是Go语言runtime包中提供的一个函数,它可以立即终止当前goroutine的执行,但是defer函数会正常执行。</p><p>具体来说,goexit函数有以下几个重要作用:</p><ol><li>立即终止当前goroutine,抛弃当前goroutine所占用的资源。</li><li>正常执行defer指定的函数。defer函数会按照逆序执行并退出,资源正常释放。</li><li>直接终止goroutine,不会造成阻塞。如果只调用return,仍需等待函数返回。</li><li>终止隐式创建的goroutine。一些操作如go语句、通道操作会隐式创建goroutine。goexit可以安全终止它们。</li><li>在一些阻塞的场景下,可以使用goexit完全终止goroutine,如死锁场景。</li><li>终止goroutine时,退出执行而不影响程序其它goroutine的执行。<br> 总之,goexit可以强制但优雅地终止当前goroutine。它通常在goroutine中使用,特别是在出现致命错误需要立即退出,或者隐式goroutine需要立即停止的场景下使用。</li></ol><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">package</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;fmt&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;runtime&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	defer</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;333&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	runtime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Goexit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//表示终止所在的协程</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;444&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	//创建新的协程</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	go</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;111&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		//调用别的函数</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;222&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+e+'" alt="使用Goexit" tabindex="0" loading="lazy"><figcaption>使用Goexit</figcaption></figure><figure><img src="'+p+`" alt="不使用Goexit" tabindex="0" loading="lazy"><figcaption>不使用Goexit</figcaption></figure><h3 id="gomaxprocs" tabindex="-1"><a class="header-anchor" href="#gomaxprocs"><span>GOMAXPROCS</span></a></h3><blockquote><p>以下引于 <a href="http://claude.ai" target="_blank" rel="noopener noreferrer">claude.ai</a></p></blockquote><p>GOMAXPROCS是Go语言中的一个重要环境变量,它控制Go程序可以同时使用的CPU逻辑核心数。</p><p>具体来说,GOMAXPROCS主要有以下几个作用:</p><ol><li><p>它设置可同时执行Go代码的OS线程数。默认值是机器上的CPU核心数。</p></li><li><p>通过将其设置为1,可以限制Go程序只使用1个OS线程,用于调试。</p></li><li><p>在多核环境下,适当增加GOMAXPROCS可以使Go程序利用多核心,提高并发性能。比如设置为CPU核心数的50%~80%。</p></li><li><p>GOMAXPROCS也影响Go的并行GC和调度器,增加GOMAXPROCS需要相应调整运行时参数。</p></li><li><p>在容器、serverless等环境下,合理设置GOMAXPROCS可以限制Go程序占用的CPU资源。</p></li></ol><p>总之,GOMAXPROCS能够合理限制和利用Go程序的并发性。但设置不当也会适得其反,需要根据具体场景选择合适的值。适当增加GOMAXPROCS可以提高CPU利用率,但超过物理核心数效果不大。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">package</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;fmt&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">	&quot;runtime&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	n</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> runtime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">GOMAXPROCS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//指定以单核运算</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;n = &quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">n</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		go</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		fmt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>单核最多只有一个goroutine，所以就是000...111...000这样的循环打印。多核就是交替打印</p><figure><img src="`+t+'" alt="单核" tabindex="0" loading="lazy"><figcaption>单核</figcaption></figure><figure><img src="'+B+`" alt="多核" tabindex="0" loading="lazy"><figcaption>多核</figcaption></figure><h2 id="sync-waitgroup" tabindex="-1"><a class="header-anchor" href="#sync-waitgroup"><span>sync.WaitGroup</span></a></h2><blockquote><p>以下引于 <a href="http://claude.ai" target="_blank" rel="noopener noreferrer">claude.ai</a></p></blockquote><p>sync.WaitGroup是Go语言中的一个同步原语,它可以用于等待一组goroutine都完成执行。</p><p>具体来说,sync.WaitGroup有以下几个主要用法:</p><ol><li><p>在开始执行一组goroutine时,调用Add添加计数。</p></li><li><p>每个goroutine执行完成后,调用Done来减少计数。</p></li><li><p>主goroutine调用Wait方法来等待计数减为0,则表示所有goroutine都执行完成。</p></li><li><p>可以使用counters来获取当前的计数值。</p></li><li><p>WaitGroup重用需要调用Reset方法重置计数值为0。</p></li><li><p>WaitGroup使用一个计数器和cond来实现阻塞等待,以优雅地同步多个goroutine。</p></li><li><p>WaitGroup可用于生产者-消费者队列,确保完全处理完成。</p></li><li><p>也可以用来等待直到关闭通道,等待完成操作的超时等场景。</p></li></ol><p>总之,WaitGroup是一个非常有用的同步工具,可以方便协调goroutine,实现阻塞直到指定的一组goroutine都结束执行。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//UpLoadFile 将整个目录都上传,遍历所有文件夹及子文件夹上传</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">c </span><span style="color:#C678DD;--shiki-dark:#C678DD;">*</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MinioClient</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">UpLoadFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	bucketName</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Getenv</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;MINIO_BUCKET_NAME&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//加判断</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> bucketName</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		panic</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;MINIO_BUCKET_NAME is empty&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	var</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> []</span><span style="color:#C678DD;--shiki-dark:#C678DD;">string</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 下载路径和bucket路径保持一致</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	err</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> filepath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Walk</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">bucketName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">path</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">info</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">FileInfo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">err</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		if</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !</span><span style="color:#E06C75;--shiki-dark:#E06C75;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">IsDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">			files</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">path</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	})</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> err</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> nil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">		panic</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	var</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> wg</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">WaitGroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	wg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;请稍等，执行中....&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> k</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">file</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> range</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">		fileID</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> k</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">		go</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> func</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">filePath</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> string</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">			defer</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> wg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Done</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">			objectName</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> strings</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Replace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">bucketName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			// 检查对象是否存在</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">			objectInfo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">_</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> c</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">StatObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">context</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Background</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="color:#E06C75;--shiki-dark:#E06C75;">bucketName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">objectName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">GetObjectOptions</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">			if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> objectInfo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">				log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">fileID</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">objectName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">				_</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">err</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> :=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> c</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">FPutObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">context</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Background</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="color:#E06C75;--shiki-dark:#E06C75;">bucketName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">objectName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;">filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">minio</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">PutObjectOptions</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">					ContentType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">				})</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">				if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> err</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> nil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">					panic</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">				}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		}(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	wg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Done&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">	return</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个是写的Minio的初始化工具，用来实现文件类的离线部署和自动化交付，中间就使用了WaitGroup，减少文件导入的时间</p>`,48),c=[k];function d(h,F){return n(),a("div",null,c)}const C=s(A,[["render",d],["__file","goroutine.html.vue"]]),u=JSON.parse(`{"path":"/coder/code/Golang/goroutine.html","title":"goroutine","lang":"zh-CN","frontmatter":{"title":"goroutine","order":100,"index":true,"article":true,"description":"以下引于 claude.ai goroutine是Go语言中的轻量级线程。具体来说,goroutine有以下几个主要特征: goroutine由Go运行时(runtime)管理,可以实现高度的并发。一个程序可以同时运行成千上万个goroutine。 goroutine之间通过channel进行通信。channel使得不同goroutine之间可以安全地...","head":[["meta",{"property":"og:url","content":"https://docs.lizili.online/coder/code/Golang/goroutine.html"}],["meta",{"property":"og:site_name","content":"lzz's Blog"}],["meta",{"property":"og:title","content":"goroutine"}],["meta",{"property":"og:description","content":"以下引于 claude.ai goroutine是Go语言中的轻量级线程。具体来说,goroutine有以下几个主要特征: goroutine由Go运行时(runtime)管理,可以实现高度的并发。一个程序可以同时运行成千上万个goroutine。 goroutine之间通过channel进行通信。channel使得不同goroutine之间可以安全地..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-10T04:16:31.000Z"}],["meta",{"property":"article:author","content":"z"}],["meta",{"property":"article:modified_time","content":"2024-11-10T04:16:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"goroutine\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-10T04:16:31.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"z\\",\\"url\\":\\"https://docs.lizili.online\\"}]}"]]},"headers":[{"level":2,"title":"创建goroutine","slug":"创建goroutine","link":"#创建goroutine","children":[]},{"level":2,"title":"runtime","slug":"runtime","link":"#runtime","children":[{"level":3,"title":"Gosched","slug":"gosched","link":"#gosched","children":[]},{"level":3,"title":"Goexit","slug":"goexit","link":"#goexit","children":[]},{"level":3,"title":"GOMAXPROCS","slug":"gomaxprocs","link":"#gomaxprocs","children":[]}]},{"level":2,"title":"sync.WaitGroup","slug":"sync-waitgroup","link":"#sync-waitgroup","children":[]}],"git":{"createdTime":1690356708000,"updatedTime":1731212191000,"contributors":[{"name":"lizili","email":"cn.zili.lee@outlook.com","commits":1}]},"readingTime":{"minutes":6.5,"words":1950},"filePathRelative":"coder/code/Golang/goroutine.md","localizedDate":"2023年7月26日","excerpt":"\\n<blockquote>\\n<p>以下引于 <a href=\\"http://claude.ai\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">claude.ai</a></p>\\n</blockquote>\\n<p>goroutine是Go语言中的轻量级线程。具体来说,goroutine有以下几个主要特征:</p>\\n<ol>\\n<li>goroutine由Go运行时(runtime)管理,可以实现高度的并发。一个程序可以同时运行成千上万个goroutine。</li>\\n<li>goroutine之间通过channel进行通信。channel使得不同goroutine之间可以安全地共享内存。</li>\\n<li>创建goroutine的代价非常小。因为goroutine的堆栈起始很小(仅2KB),所以可以很容易地创建很多goroutine。</li>\\n<li>goroutine使用协作式调度(cooperative scheduling),多个goroutine可以在一个或几个操作系统线程上执行。Go运行时内部使用自举调度器在goroutine之间快速切换。</li>\\n<li>goroutine通信安全。通信和内存同步都隐式实现,不需加锁。<br>\\n总之,goroutine作为Go并发的核心,使得编写并发程序变得简单、高效。它独特的设计对Go语言的高并发性能起到关键作用。</li>\\n</ol>","autoDesc":true}`);export{C as comp,u as data};
