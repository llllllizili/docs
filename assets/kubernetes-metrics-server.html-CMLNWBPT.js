import{_ as s,c as a,o as e,f as n}from"./app-BfCDUtKQ.js";const i="/assets/2024-03-11-17-03-42-SdW46yPh.png",r={},l=n(`<p><a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener noreferrer">github-metrics-server</a></p><ul><li>kubeadm 默认是不部署的。</li><li>依赖于 API Aggregator</li><li>只可以查询当前的度量数据，不保存历史数据。</li></ul><p>检查Aggregator是否开启</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ps</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -ef</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> apiserver</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> enable-aggregator-routing</span></span></code></pre></div><p>修改配置，并开启。</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> vi</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/kubernetes/manifests/kube-apiserver.yaml</span></span></code></pre></div><p>增加 <code>--enable-aggregator-routing=true</code>，修改后，服务会自动重启</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">apiVersion</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">kind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Pod</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span><span style="color:#D19A66;--shiki-dark:#D19A66;">...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">spec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  containers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">kube-apiserver</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">	......</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">--enable-bootstrap-token-auth=true</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 新增</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">--enable-aggregator-routing=true</span></span></code></pre></div><p>下载文件</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span></span></code></pre></div><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">spec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    spec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      containers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">--cert-dir=/tmp</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">--secure-port=10250</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 默认是InternalIP,ExternalIP,Hostname</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">--kubelet-preferred-address-types=InternalIP</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">--kubelet-use-node-status-port</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">--metric-resolution=15s</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 添加此行</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">--kubelet-insecure-tls</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 修改镜像地址</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        image</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">registry.cn-hangzhou.aliyuncs.com/chenby/metrics-server:v0.6.1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        imagePullPolicy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">IfNotPresent</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+i+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',12),t=[l];function o(p,c){return e(),a("div",null,t)}const k=s(r,[["render",o],["__file","kubernetes-metrics-server.html.vue"]]),B=JSON.parse(`{"path":"/cloud-native/kubernetes/kubernetes-metrics-server.html","title":"metrics-server","lang":"zh-CN","frontmatter":{"article":true,"title":"metrics-server","order":22,"category":["云原生"],"tag":["k8s"],"index":true,"description":"github-metrics-server kubeadm 默认是不部署的。 依赖于 API Aggregator 只可以查询当前的度量数据，不保存历史数据。 检查Aggregator是否开启 修改配置，并开启。 增加 --enable-aggregator-routing=true，修改后，服务会自动重启 下载文件","head":[["meta",{"property":"og:url","content":"https://docs.lizili.online/cloud-native/kubernetes/kubernetes-metrics-server.html"}],["meta",{"property":"og:site_name","content":"lzz's Blog"}],["meta",{"property":"og:title","content":"metrics-server"}],["meta",{"property":"og:description","content":"github-metrics-server kubeadm 默认是不部署的。 依赖于 API Aggregator 只可以查询当前的度量数据，不保存历史数据。 检查Aggregator是否开启 修改配置，并开启。 增加 --enable-aggregator-routing=true，修改后，服务会自动重启 下载文件"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-07T13:03:38.000Z"}],["meta",{"property":"article:author","content":"z"}],["meta",{"property":"article:tag","content":"k8s"}],["meta",{"property":"article:modified_time","content":"2024-10-07T13:03:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"metrics-server\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-07T13:03:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"z\\",\\"url\\":\\"https://docs.lizili.online\\"}]}"]]},"headers":[],"git":{"createdTime":1710214937000,"updatedTime":1728306218000,"contributors":[{"name":"lizili","email":"cn.zili.lee@outlook.com","commits":1}]},"readingTime":{"minutes":0.64,"words":192},"filePathRelative":"cloud-native/kubernetes/kubernetes-metrics-server.md","localizedDate":"2024年3月12日","excerpt":"<p><a href=\\"https://github.com/kubernetes-sigs/metrics-server\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">github-metrics-server</a></p>\\n<ul>\\n<li>kubeadm 默认是不部署的。</li>\\n<li>依赖于 API Aggregator</li>\\n<li>只可以查询当前的度量数据，不保存历史数据。</li>\\n</ul>\\n<p>检查Aggregator是否开启</p>\\n<div class=\\"language-shell\\" data-ext=\\"shell\\" data-title=\\"shell\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\" style=\\"background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf\\" tabindex=\\"0\\"><code><span class=\\"line\\"><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">ps</span><span style=\\"color:#D19A66;--shiki-dark:#D19A66\\"> -ef</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\"> | </span><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">grep</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> apiserver</span><span style=\\"color:#ABB2BF;--shiki-dark:#ABB2BF\\"> | </span><span style=\\"color:#61AFEF;--shiki-dark:#61AFEF\\">grep</span><span style=\\"color:#98C379;--shiki-dark:#98C379\\"> enable-aggregator-routing</span></span></code></pre>\\n</div>","autoDesc":true}`);export{k as comp,B as data};
