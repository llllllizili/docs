<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://docs.lizili.online/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html"><meta property="og:site_name" content="lzz's Blog"><meta property="og:title" content="Ansible"><meta property="og:description" content="è¯·æ³¨æ„ æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚ å‰è¨€ Ansible is Simple IT Automationâ€”â€”ç®€å•çš„è‡ªåŠ¨åŒ–ITå·¥å…·ï¼Œå¯ä»¥å®ç° æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ åˆ†å¸ƒå¼é›†ä¸­ç®¡ç†å·¥å…·ï¼Œ é€šä¿—çš„è®²å°±æ˜¯æ‰¹é‡åœ¨è¿œç«¯æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚å…¶å®ï¼Œansibleè‡ªèº«ä¸å…·å¤‡éƒ¨ç½²èƒ½åŠ›çš„ï¼Œåªæ˜¯æä¾›æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¸ºæ¨¡å— ä»€ä¹ˆæ˜¯ans..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-23T05:06:11.000Z"><meta property="article:author" content="z"><meta property="article:tag" content="ansible"><meta property="article:modified_time" content="2024-04-23T05:06:11.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Ansible","image":[""],"dateModified":"2024-04-23T05:06:11.000Z","author":[{"@type":"Person","name":"z","url":"https://docs.lizili.online"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?088df8f788eb6cfa86e86b04cee94211";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
        </script><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://docs.lizili.online/rss.xml" title="lzz's Blog RSS Feed"><title>Ansible | lzz's Blog</title><meta name="description" content="è¯·æ³¨æ„ æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚ å‰è¨€ Ansible is Simple IT Automationâ€”â€”ç®€å•çš„è‡ªåŠ¨åŒ–ITå·¥å…·ï¼Œå¯ä»¥å®ç° æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ åˆ†å¸ƒå¼é›†ä¸­ç®¡ç†å·¥å…·ï¼Œ é€šä¿—çš„è®²å°±æ˜¯æ‰¹é‡åœ¨è¿œç«¯æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚å…¶å®ï¼Œansibleè‡ªèº«ä¸å…·å¤‡éƒ¨ç½²èƒ½åŠ›çš„ï¼Œåªæ˜¯æä¾›æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¸ºæ¨¡å— ä»€ä¹ˆæ˜¯ans...">
    <link rel="preload" href="/assets/style-BWhSO6JG.css" as="style"><link rel="stylesheet" href="/assets/style-BWhSO6JG.css">
    <link rel="modulepreload" href="/assets/app-BfCDUtKQ.js"><link rel="modulepreload" href="/assets/ansibleå­¦ä¹ .html-KB7krrXA.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">lzz&#39;s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="è¿å¼€"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span>è¿å¼€<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">è¿ç»´ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/ops/linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/GitOps/" aria-label="GitOps"><!--[--><span class="font-icon icon iconfont icon-git" style=""></span><!--]-->GitOps<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/monitor/" aria-label="Monitor"><!--[--><span class="font-icon icon iconfont icon-monitor" style=""></span><!--]-->Monitor<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å¼€å‘ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/code/" aria-label="Code"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->Code<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/ops/" aria-label="Ops"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Ops<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/script/" aria-label="Script"><!--[--><span class="font-icon icon iconfont icon-script" style=""></span><!--]-->Script<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å…¶ä»–</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/team/" aria-label="Team"><!--[--><span class="font-icon icon iconfont icon-tuandui" style=""></span><!--]-->Team<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/faq/" aria-label="FAQ"><!--[--><span class="font-icon icon iconfont icon-Faq" style=""></span><!--]-->FAQ<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="äº‘åŸç”Ÿ"><!--[--><span class="font-icon icon iconfont icon-yunyuansheng" style=""></span>äº‘åŸç”Ÿ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/kubernetes/" aria-label="kubernetes"><!--[--><span class="font-icon icon iconfont icon-kubernetes" style=""></span><!--]-->kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/backup/" aria-label="backup"><!--[--><span class="font-icon icon iconfont icon-backup" style=""></span><!--]-->backup<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/middleware/" aria-label="middleware"><!--[--><span class="font-icon icon iconfont icon-zhongjianjian" style=""></span><!--]-->middleware<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ‰‹å†Œ"><!--[--><span class="font-icon icon iconfont icon-shouce" style=""></span>æ‰‹å†Œ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/shell.html" aria-label="shell"><!--[--><span class="font-icon icon iconfont icon-shell" style=""></span><!--]-->shell<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/markdown/" aria-label="markdown"><!--[--><span class="font-icon icon iconfont icon-markdown" style=""></span><!--]-->markdown<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/vuepress/" aria-label="vuepress"><!--[--><span class="font-icon icon iconfont icon-vue" style=""></span><!--]-->vuepress<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tools/" aria-label="å·¥å…·åˆ†äº«"><!--[--><span class="font-icon icon iconfont icon-tools" style=""></span><!--]-->å·¥å…·åˆ†äº«<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/hobby/" aria-label="çˆ±å¥½"><!--[--><span class="font-icon icon iconfont icon-xingquaihao" style=""></span><!--]-->çˆ±å¥½<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="ç•™è¨€æ¿"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->ç•™è¨€æ¿<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="å‹é“¾"><!--[--><span class="font-icon icon iconfont icon-link" style=""></span><!--]-->å‹é“¾<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://foreverblog.cn/go.html" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢" target="_blank" rel="noopener noreferrer" aria-label="wormhole"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M644.608 665.6c192.512-171.008 342.016-395.776 254.464-494.592-27.648-31.232-66.56-45.568-108.032-41.472-34.816 3.584-70.656 20.992-107.008 50.176-116.224-59.904-254.464-55.296-366.592 11.776-86.016 51.2-148.48 134.656-172.544 231.936-18.944 74.24-14.336 152.064 12.8 223.744-44.544 50.688-86.528 154.624-34.816 212.992 21.504 24.576 52.736 35.328 90.112 35.328 114.176-0.512 286.72-100.864 431.616-229.888z m155.648-452.608c14.848-1.536 26.624 2.56 36.352 13.824 9.728 10.752 7.168 39.936-10.752 80.896-18.944-28.672-41.984-55.296-68.096-77.824 17.92-10.752 32.256-15.872 42.496-16.896z m-598.528 517.12c18.944 27.136 40.96 51.712 66.048 73.216-43.008 12.8-72.192 11.776-81.92 1.024-8.704-10.752 0.512-45.056 15.872-74.24z m685.568-246.784c-51.2 75.264-122.368 154.112-200.704 224.256-81.408 72.192-171.008 134.656-254.464 176.64 26.112 5.632 52.224 8.704 78.848 8.704 68.096 0 135.168-18.944 194.048-53.76 124.416-73.216 195.072-211.968 182.272-355.84z m0 0" p-id="4157"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://www.travellings.cn/go.html" title="å¼€å¾€" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html" aria-label="Ansible"><!---->Ansible<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><!---->Centos 9 init<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/SaltStack%E5%AD%A6%E4%B9%A0.html" aria-label="SaltStack"><!---->SaltStack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Docker%E5%AD%A6%E4%B9%A0.html" aria-label="Docker"><!---->Docker<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Nginx.html" aria-label="Nginx"><!---->Nginx<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/git.html" aria-label="Git"><!---->Git<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/package-rpm.html" aria-label="rpmåŒ…åˆ¶ä½œ"><!---->rpmåŒ…åˆ¶ä½œ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/%E8%A7%A3%E5%8E%8B%E7%BC%A9.html" aria-label="å‹ç¼©ä¸è§£å‹"><!---->å‹ç¼©ä¸è§£å‹<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/keepalived.html" aria-label="keepalived"><!---->keepalived<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Ansible</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://docs.lizili.online" target="_blank" rel="noopener noreferrer">z</a></span><span property="author" content="z"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-02T11:08:55.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 19 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT19M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">è‡ªåŠ¨åŒ–å·¥å…·</span><span class="page-category-item color8 clickable" role="navigation">linux</span><!--]--><meta property="articleSection" content="è‡ªåŠ¨åŒ–å·¥å…·,linux"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color0 clickable" role="navigation">ansible</span><!--]--><meta property="keywords" content="ansible"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‰è¨€">å‰è¨€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä»€ä¹ˆæ˜¯ansible">ä»€ä¹ˆæ˜¯ansible?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ansible-çš„å·¥ä½œæµç¨‹">ansible çš„å·¥ä½œæµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å®‰è£…ansible">å®‰è£…ansible</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#é…ç½®ç™»å½•">é…ç½®ç™»å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å®šä¹‰ansibleçš„èŠ‚ç‚¹æ¸…å•">å®šä¹‰Ansibleçš„èŠ‚ç‚¹æ¸…å•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç®€å•çš„è¿œç¨‹æ“ä½œ">ç®€å•çš„è¿œç¨‹æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å®šä¹‰å˜é‡">å®šä¹‰å˜é‡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®šä¹‰ä¸»æœºå˜é‡">å®šä¹‰ä¸»æœºå˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®šä¹‰ç»„å˜é‡">å®šä¹‰ç»„å˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åµŒå¥—ç»„">åµŒå¥—ç»„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ†ç¦»ä¸»æœºå’Œç»„ç‰¹å®šæ•°æ®">åˆ†ç¦»ä¸»æœºå’Œç»„ç‰¹å®šæ•°æ®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‘½ä»¤å‚æ•°">å‘½ä»¤å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#pattern">Pattern</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¸¸ç”¨æ¨¡å—">å¸¸ç”¨æ¨¡å—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#copyæ¨¡å—">copyæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#fileæ¨¡å—">fileæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cronæ¨¡å—">cronæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#groupæ¨¡å—">groupæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uesræ¨¡å—">uesræ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#yumæ¨¡å—">yumæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#shellæ¨¡å—">shellæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#commandæ¨¡å—">commandæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rawæ¨¡å—">rawæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#scriptæ¨¡å—">scriptæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#command-script-shell-rawçš„åŒºåˆ«">command,script,shell,rawçš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#serviceæ¨¡å—">serviceæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pingæ¨¡å—">pingæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#get-url">get_url</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#statæ¨¡å—">statæ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#templateæ¨¡å—">templateæ¨¡å—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ¨¡å—å‚æ•°">æ¨¡å—å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ¨¡å—å‚æ•°æ¡ˆä¾‹">æ¨¡å—å‚æ•°æ¡ˆä¾‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ›´å¤šæ¨¡å—">æ›´å¤šæ¨¡å—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#playbookçš„é…ç½®å’Œä½¿ç”¨">playbookçš„é…ç½®å’Œä½¿ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®˜ç½‘demoè¯´æ˜">å®˜ç½‘demoè¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è„šæœ¬å®ä¾‹">è„šæœ¬å®ä¾‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç»™è„šæœ¬æ·»åŠ serviceçš„è°ƒç”¨">ç»™è„šæœ¬æ·»åŠ serviceçš„è°ƒç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç»™è„šæœ¬æ·»åŠ copyæ¨¡å—çš„è°ƒç”¨">ç»™è„šæœ¬æ·»åŠ copyæ¨¡å—çš„è°ƒç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#templateæ¨¡æ¿-æ”¯æŒjinja2">templateæ¨¡æ¿ï¼ˆæ”¯æŒjinja2ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ¨¡å—">æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å˜é‡åŠŸèƒ½">å˜é‡åŠŸèƒ½</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#facts">facts</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è‡ªå®šä¹‰å˜é‡">è‡ªå®šä¹‰å˜é‡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åœ¨æ“ä½œä¸»æœºå®šä¹‰å˜é‡-æ¥æ§åˆ¶client">åœ¨æ“ä½œä¸»æœºå®šä¹‰å˜é‡ï¼Œæ¥æ§åˆ¶client</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨å†Œå˜é‡">æ³¨å†Œå˜é‡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è¯­å¥">è¯­å¥</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¡ä»¶è¯­å¥">æ¡ä»¶è¯­å¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#when">when</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¾ªç¯è¯­å¥">å¾ªç¯è¯­å¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¾ªç¯å…ƒç´ æ”¯æŒåˆ—è¡¨">å¾ªç¯å…ƒç´ æ”¯æŒåˆ—è¡¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#handlers-å’Œ-include">handlers å’Œ include</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#roles-ä½¿ç”¨">roles ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ansibleå’Œsaltstackçš„å¯¹æ¯”">ansibleå’Œsaltstackçš„å¯¹æ¯”</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><div class="hint-container caution"><p class="hint-container-title">è¯·æ³¨æ„</p><p>æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚</p></div><h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€"><span>å‰è¨€</span></a></h2><p><strong>Ansible is Simple IT Automationâ€”â€”ç®€å•çš„è‡ªåŠ¨åŒ–ITå·¥å…·ï¼Œå¯ä»¥å®ç° æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯</strong> <span style="color:red;"><strong>åˆ†å¸ƒå¼é›†ä¸­ç®¡ç†å·¥å…·</strong></span>ï¼Œ <strong>é€šä¿—çš„è®²å°±æ˜¯æ‰¹é‡åœ¨è¿œç«¯æœåŠ¡å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚å…¶å®ï¼Œansibleè‡ªèº«ä¸å…·å¤‡éƒ¨ç½²èƒ½åŠ›çš„ï¼Œåªæ˜¯æä¾›æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¸ºæ¨¡å—</strong></p><!--more--><h2 id="ä»€ä¹ˆæ˜¯ansible" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ansible"><span>ä»€ä¹ˆæ˜¯ansible?</span></a></h2><figure><img src="/assets/2511748-ee48dcc8af53cf00-BwKWT13U.jpg" alt="ansibleæ¶æ„" tabindex="0" loading="lazy"><figcaption>ansibleæ¶æ„</figcaption></figure><table><thead><tr><th style="text-align:left;">äº”å¤§éƒ¨åˆ†</th><th style="text-align:left;">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:left;">connection plugins</td><td style="text-align:left;">è¿œç¨‹è¿æ¥æ’ä»¶</td></tr><tr><td style="text-align:left;">hosts</td><td style="text-align:left;">å®šä¹‰ç®¡ç†ä¸»æœºæˆ–ä¸»æœºç»„</td></tr><tr><td style="text-align:left;">modules</td><td style="text-align:left;">åŒ…å«å„ä¸ªæ ¸å¿ƒæ¨¡å—åŠè‡ªå®šä¹‰æ¨¡å—</td></tr><tr><td style="text-align:left;">Plugin</td><td style="text-align:left;">å®Œæˆæ¨¡å—åŠŸèƒ½çš„è¡¥å……ï¼Œå¦‚æ—¥å¿—æ’ä»¶ã€é‚®ä»¶æ’ä»¶ç­‰</td></tr><tr><td style="text-align:left;">Playbook</td><td style="text-align:left;">ansibleçš„ä»»åŠ¡é…ç½®æ–‡ä»¶ï¼Œå°†å¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨å‰§æœ¬ä¸­è¿›è¡Œç®¡ç†</td></tr></tbody></table><h2 id="ansible-çš„å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#ansible-çš„å·¥ä½œæµç¨‹"><span>ansible çš„å·¥ä½œæµç¨‹</span></a></h2><p><img src="/assets/2511748-1001b5832ebba246-Dnh71AMI.jpg" alt="ansibleæµç¨‹" loading="lazy"><br> â€‹</p><p>â€‹</p><h2 id="å®‰è£…ansible" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ansible"><span>å®‰è£…ansible</span></a></h2><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é…ç½®æº  ansibleé»˜è®¤ä¸åœ¨yumä»“åº“ä¸­</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -iUvh</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel//7/x86_64/e/epel-release-7-9.noarch.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ­¤æºä¸»è¦æ˜¯ä¸ºäº†å®‰è£…PyYAML</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mv</span><span style="color:#98C379;--shiki-dark:#98C379;"> CentOS7-Base-163.repo</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/yum.repos.d/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> ansible</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯æŸ¥çœ‹å½“å‰ansibleç‰ˆæœ¬</span></span></code></pre></div><h2 id="é…ç½®ç™»å½•" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç™»å½•"><span>é…ç½®ç™»å½•</span></a></h2><blockquote><p>ansible ä½¿ç”¨sshç™»å½•ï¼Œæ‰€ä»¥ä¸»å¥´ä¹‹é—´è¦é…ç½®å¯†é’¥è¿›è¡Œè®¤è¯ï¼Œè¿™æ ·æ‰èƒ½å¼€å§‹æ­£å¸¸å·¥ä½œ</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ssh-keygen</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span><span style="color:#98C379;--shiki-dark:#98C379;"> rsa</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å›è½¦</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†ä¼šç”Ÿæˆå¯†é’¥/root/.ssh/id_rsa.pub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ssh-copy-id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -i</span><span style="color:#98C379;--shiki-dark:#98C379;"> root@ipaddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å…¬é’¥å°†ä¼šè¢«cpåˆ°å„ä¸ªipaddressèŠ‚ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è‡³æ­¤ å·²ç»å®ç°äº†masterä¸å„èŠ‚ç‚¹çš„è¿æ¥</span></span></code></pre></div><h2 id="å®šä¹‰ansibleçš„èŠ‚ç‚¹æ¸…å•" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰ansibleçš„èŠ‚ç‚¹æ¸…å•"><span>å®šä¹‰Ansibleçš„èŠ‚ç‚¹æ¸…å•</span></a></h2><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>vim /etc/ansible/hosts</span></span>
<span class="line"><span>[testgroup]-----#æœåŠ¡å™¨ç»„çš„åå­—ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†ï¼Œåˆ’åˆ†å’Œå‘½åè¦æœ‰è§„åˆ’</span></span>
<span class="line"><span>192.168.1.XX----#ç»„å†…èŠ‚ç‚¹çš„åœ°å€</span></span>
<span class="line"><span>192.168.1.XXX</span></span>
<span class="line"><span>ç­‰ç­‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[websever]</span></span>
<span class="line"><span>....</span></span>
<span class="line"><span>[DBserver]</span></span>
<span class="line"><span>....</span></span></code></pre></div><h2 id="ç®€å•çš„è¿œç¨‹æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç®€å•çš„è¿œç¨‹æ“ä½œ"><span>ç®€å•çš„è¿œç¨‹æ“ä½œ</span></a></h2><p><strong>é€šè¿‡æ‰§è¡Œwhoï¼ŒæŸ¥çœ‹æœåŠ¡å™¨ç™»å½•ä¿¡æ¯</strong></p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> testgroup</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #ç»„</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # æ‰€æœ‰</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> 192.168.1.XX</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #å•ä¸ªip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#E06C75;--shiki-dark:#E06C75;">rc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     :0</span><span style="color:#98C379;--shiki-dark:#98C379;">           2017-02-15</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:33</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/0</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-02-15</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:34</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/1</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-02-18</span><span style="color:#98C379;--shiki-dark:#98C379;"> 13:08</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (192.168.247.1)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/2</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-03-07</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:52</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/3</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-03-07</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:54</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (192.168.247.156)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»¥ashinç”¨æˆ·èº«ä»½ping .134</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.1.134</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> zili</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä»¥ç”¨æˆ·zilièº«ä»½ä½¿ç”¨sudoæ¥ping ç»„testgroup</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -Kæ˜¯è¾“å…¥rootå¯†ç </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> v1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> zili</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -K</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®šä¹‰å˜é‡" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰å˜é‡"><span>å®šä¹‰å˜é‡</span></a></h2><h3 id="å®šä¹‰ä¸»æœºå˜é‡" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰ä¸»æœºå˜é‡"><span>å®šä¹‰ä¸»æœºå˜é‡</span></a></h3><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    192.168.247.152  http_port=80</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ...............  http_port=303</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #ç»„åä»¥åŠipæ ¹æœ¬è‡ªå·±éœ€æ±‚å®šä¹‰</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #ä¸»æœºæŒ‡å®šå˜é‡ï¼Œä»¥ä¾¿åé¢ä¾›palybooksé…ç½®ä½¿ç”¨ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #å®šä¹‰ä¸¤å°webæœåŠ¡å™¨çš„apacheå‚æ•°http_portï¼Œå¯ä»¥è®©ä¸¤å°æœåŠ¡å™¨äº§ç”Ÿçš„apacheé…ç½®æ–‡ä»¶httpd.confå·®å¼‚åŒ–</span></span></code></pre></div><h3 id="å®šä¹‰ç»„å˜é‡" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰ç»„å˜é‡"><span>å®šä¹‰ç»„å˜é‡</span></a></h3><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web:vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    http_port=80</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #ç»„å˜é‡çš„ä½œç”¨åŸŸæ˜¯è¦†ç›–ç»„æ‰€æœ‰æˆå‘˜ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªæ–°å—ï¼Œå—åç”±ç»„å+ &quot;:vars&quot;ç»„æˆã€‚</span></span></code></pre></div><h3 id="åµŒå¥—ç»„" tabindex="-1"><a class="header-anchor" href="#åµŒå¥—ç»„"><span>åµŒå¥—ç»„</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">nestedï¼šchildren</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    web</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    mysql</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">nestedï¼švars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ntp_server=s1b.time.edu.cn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">åµŒå¥—ç»„å®šä¹‰ä¸€ä¸ªæ–°å—ï¼Œå—åç”± ç»„å+&quot;:chilren&quot; ç»„æˆã€‚</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">åŒæ˜¯åµŒå¥—ç»„ä¹Ÿå¯ä»¥å®šä¹‰ç»„å˜é‡ï¼Œä½œç”¨åŸŸæ˜¯åµŒå¥—ç»„é‡Œçš„æ‰€æœ‰ç»„,</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">åµŒå¥—ç»„åªèƒ½åœ¨/usr/bin/ansible-playbookä¸­ï¼Œ</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">åœ¨/usr/bin/ansibleä¸­ä¸èµ·ä½œç”¨ï¼Œä¸‹é¢ä¼šä»‹ç»playbook</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ†ç¦»ä¸»æœºå’Œç»„ç‰¹å®šæ•°æ®" tabindex="-1"><a class="header-anchor" href="#åˆ†ç¦»ä¸»æœºå’Œç»„ç‰¹å®šæ•°æ®"><span>åˆ†ç¦»ä¸»æœºå’Œç»„ç‰¹å®šæ•°æ®</span></a></h3><blockquote><p>ä¸ºæ›´å¥½çš„è§„èŒƒå®šä¹‰çš„<strong>ä¸»æœºä¸ç»„å˜é‡</strong>ï¼Œæˆ‘ä»¬å®é™…æ˜¯ä¸ä¼šåœ¨hostsé‡Œç›´æ¥å†™çš„varï¼Œå°†å®šä¹‰çš„ä¸»æœºåä¸ç»„å˜é‡å•ç‹¬å‰¥ç¦»å‡ºæ¥æ”¾åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå°†é‡‡ç”¨YAMLæ ¼å¼å­˜æ”¾<br> å…¨å±€çš„å˜é‡æ”¾åœ¨group_vars/allä¸­ï¼Œå±€éƒ¨å˜é‡æ”¾åœ¨group_vars/xä¸­ï¼Œç‰¹å®šçš„hostä½¿ç”¨ç‰¹å®šçš„å˜é‡å¯ä»¥ä½¿ç”¨host_vars/xï¼Œå­groupä¸­çš„å˜é‡ä¼šè¦†ç›–ä¸Šçº§å˜é‡ï¼Œhostså˜é‡æ€»æ˜¯è¦†ç›–groupså˜é‡<br> å­˜æ”¾ä½ç½®è§„å®šï¼š&quot;/etc/ansible/group_vars/å&quot;å’Œ&quot;/etc/ansible/host_vars/ä¸»æœºå&quot;åˆ†åˆ«å­˜æ”¾æŒ‡å®šç»„åæˆ–ä¸»æœºåå®šä¹‰çš„å˜é‡ï¼Œå¦‚<br><code>/etc/ansible/group\_vars/mysql.yml</code><br><code>/etc/ansible/host\_vars/192.168.11.1.yml</code><br> ä½¿ç”¨å˜é‡è¦ç”¨jinjaè¯­æ³•å»å¼•ç”¨</p></blockquote><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">cat mysql.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   ---</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ntp_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">s1b.time.edu.cn</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    database_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">è§„èŒƒå˜é‡åå­—ï¼Œæ˜¯å› ä¸ºï¼Œansibleä¼šè‡ªåŠ¨åŠ è½½è¿™ç›®å½•ä¸‹çš„å˜é‡ï¼Œ</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">å¦åˆ™æ— æ³•è°ƒç”¨ï¼Œå½“ç„¶ä¹Ÿæœ‰è§£å†³ä¸æ”¾æ­¤ç›®å½•çš„æ–¹æ³•</span></span></code></pre></div><p>ä¾‹å¦‚</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master ansible]# tree</span></span>
<span class="line"><span>â”œâ”€â”€ create_user.yml</span></span>
<span class="line"><span>â”œâ”€â”€ group_vars</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ t1.yml</span></span>
<span class="line"><span>â”œâ”€â”€ hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat hosts</span></span>
<span class="line"><span>[t1]</span></span>
<span class="line"><span>10.1.27.24</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ‰€ä»¥</span></span>
<span class="line"><span>â”œâ”€â”€ group_vars</span></span>
<span class="line"><span>â”‚   â””â”€â”€ t1.yml  #ä»–çš„å†…å®¹å°±æ˜¯t1çš„å˜é‡</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat group_vars/t1.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>user: ansibleTest1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat create_user.yml </span></span>
<span class="line"><span># create user</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- name: create user</span></span>
<span class="line"><span>  hosts: t1</span></span>
<span class="line"><span>  user: root</span></span>
<span class="line"><span>  tasks:</span></span>
<span class="line"><span>  - name: useradd {{ user }}  #å¼•ç”¨t1å˜é‡</span></span>
<span class="line"><span>    user: name=&quot;{{ user }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è¿”å›ç»“æœå¦‚ä¸‹</span></span>
<span class="line"><span>[root@master ansible]# ansible-playbook create_user.yml </span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY [create user] ***********************************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [Gathering Facts] *******************************************************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [useradd ansibleTest1] **************************************************************************************************</span></span>
<span class="line"><span>changed: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY RECAP *******************************************************************************************************************</span></span>
<span class="line"><span>10.1.27.24                 : ok=2    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å‘½ä»¤å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤å‚æ•°"><span>å‘½ä»¤å‚æ•°</span></a></h2><blockquote><p>ansible &lt; host-pattern &gt; [ options ]</p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-m</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_NAME,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --module-name=MODULE_NAME</span><span style="color:#98C379;--shiki-dark:#98C379;">     è¦æ‰§è¡Œçš„æ¨¡å—ï¼Œé»˜è®¤ä¸º</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-a</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_ARGS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --args=MODULE_ARGS</span><span style="color:#98C379;--shiki-dark:#98C379;">      æ¨¡å—çš„å‚æ•°</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-u</span><span style="color:#98C379;--shiki-dark:#98C379;"> REMOTE_USER,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --user=REMOTE_USER</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="color:#98C379;--shiki-dark:#98C379;">      è¿æ¥çš„ç”¨æˆ·åï¼Œé»˜è®¤ç”¨</span><span style="color:#98C379;--shiki-dark:#98C379;"> rootï¼Œansible.cfg</span><span style="color:#98C379;--shiki-dark:#98C379;"> ä¸­å¯ä»¥é…ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-k,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --ask-pass</span><span style="color:#98C379;--shiki-dark:#98C379;">      æç¤ºè¾“å…¥</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> ç™»å½•å¯†ç ï¼Œå½“ä½¿ç”¨å¯†ç éªŒè¯ç™»å½•çš„æ—¶å€™ç”¨</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-s,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo</span><span style="color:#98C379;--shiki-dark:#98C379;">      sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> è¿è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-U</span><span style="color:#98C379;--shiki-dark:#98C379;"> SUDO_USER,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo-user=SUDO_USER</span><span style="color:#98C379;--shiki-dark:#98C379;">     sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> åˆ°å“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤ä¸º</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-K,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --ask-sudo-pass</span><span style="color:#98C379;--shiki-dark:#98C379;">     æç¤ºè¾“å…¥</span><span style="color:#98C379;--shiki-dark:#98C379;"> sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> å¯†ç ï¼Œå½“ä¸æ˜¯</span><span style="color:#98C379;--shiki-dark:#98C379;"> NOPASSWD</span><span style="color:#98C379;--shiki-dark:#98C379;"> æ¨¡å¼æ—¶ä½¿ç”¨</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-B</span><span style="color:#98C379;--shiki-dark:#98C379;"> SECONDS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --background=SECONDS</span><span style="color:#98C379;--shiki-dark:#98C379;">       run</span><span style="color:#98C379;--shiki-dark:#98C379;"> asynchronously,</span><span style="color:#98C379;--shiki-dark:#98C379;"> failing</span><span style="color:#98C379;--shiki-dark:#98C379;"> after</span><span style="color:#98C379;--shiki-dark:#98C379;"> X</span><span style="color:#98C379;--shiki-dark:#98C379;"> seconds</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">default</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">N/A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-P</span><span style="color:#98C379;--shiki-dark:#98C379;"> POLL_INTERVAL,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --poll=POLL_INTERVAL</span><span style="color:#98C379;--shiki-dark:#98C379;">      set</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> poll</span><span style="color:#98C379;--shiki-dark:#98C379;"> interval</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default=15)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-C,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --check</span><span style="color:#98C379;--shiki-dark:#98C379;">     åªæ˜¯æµ‹è¯•ä¸€ä¸‹ä¼šæ”¹å˜ä»€ä¹ˆå†…å®¹ï¼Œä¸ä¼šçœŸæ­£å»æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-c</span><span style="color:#98C379;--shiki-dark:#98C379;"> CONNECTION</span><span style="color:#98C379;--shiki-dark:#98C379;">   è¿æ¥ç±»å‹</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">default</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">smart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-f</span><span style="color:#98C379;--shiki-dark:#98C379;"> FORKS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --forks=FORKS</span><span style="color:#98C379;--shiki-dark:#98C379;">     fork</span><span style="color:#98C379;--shiki-dark:#98C379;"> å¤šå°‘ä¸ªè¿›ç¨‹å¹¶å‘å¤„ç†ï¼Œé»˜è®¤</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-i</span><span style="color:#98C379;--shiki-dark:#98C379;"> INVENTORY,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --inventory-file=INVENTORY</span><span style="color:#98C379;--shiki-dark:#98C379;">      æŒ‡å®šhostsæ–‡ä»¶è·¯å¾„é»˜è®¤</span><span style="color:#98C379;--shiki-dark:#98C379;"> default</span><span style="color:#98C379;--shiki-dark:#98C379;"> =/etc/ansible/hosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-l</span><span style="color:#98C379;--shiki-dark:#98C379;"> SUBSET,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --limit=SUBSET</span><span style="color:#98C379;--shiki-dark:#98C379;">       æŒ‡å®šä¸€ä¸ª</span><span style="color:#98C379;--shiki-dark:#98C379;"> patternï¼Œå¯¹</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">host_patter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">n&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">å·²ç»åŒ¹é…çš„ä¸»æœºä¸­å†è¿‡æ»¤ä¸€æ¬¡</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">--list-hosts</span><span style="color:#98C379;--shiki-dark:#98C379;">        åªæ‰“å°æœ‰å“ªäº›ä¸»æœºä¼šæ‰§è¡Œè¿™ä¸ª</span><span style="color:#98C379;--shiki-dark:#98C379;"> playbook</span><span style="color:#98C379;--shiki-dark:#98C379;"> æ–‡ä»¶ï¼šä¸æ˜¯å®é™…æ‰§è¡Œè¯¥</span><span style="color:#98C379;--shiki-dark:#98C379;"> playbook</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-M</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_PATH,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --module-path=MODULE_PATH</span><span style="color:#98C379;--shiki-dark:#98C379;">       è¦æ‰§è¡Œçš„æ¨¡å—çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º/usr/share/ansible/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-o,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --one-line</span><span style="color:#98C379;--shiki-dark:#98C379;">      å‹ç¼©è¾“å‡ºï¼Œæ‘˜è¦è¾“å‡º</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">--private-key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">PRIVATE_KEY_FILE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      ç§é’¥è·¯å¾„</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-T</span><span style="color:#98C379;--shiki-dark:#98C379;"> TIMEOUT,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --timeout=TIMEOUT</span><span style="color:#98C379;--shiki-dark:#98C379;">   ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#98C379;--shiki-dark:#98C379;"> ç§’</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-t</span><span style="color:#98C379;--shiki-dark:#98C379;"> TREE,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --tree=TREE</span><span style="color:#98C379;--shiki-dark:#98C379;">            æ—¥å¿—è¾“å‡ºåˆ°è¯¥ç›®å½•ï¼Œæ—¥å¿—æ–‡ä»¶åä¼šä»¥ä¸»æœºåå‘½å</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-v,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --verbose</span><span style="color:#98C379;--shiki-dark:#98C379;">   verbose</span><span style="color:#98C379;--shiki-dark:#98C379;"> mode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (-vvv </span><span style="color:#98C379;--shiki-dark:#98C379;">for</span><span style="color:#98C379;--shiki-dark:#98C379;"> more,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -vvvv</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> enable</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> debugging</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pattern" tabindex="-1"><a class="header-anchor" href="#pattern"><span>Pattern</span></a></h2><p>å¯ä»¥ç›´æ¥æŒ‡å®šipæˆ–hostsä¸­çš„ç»„åï¼ŒåŒæ—¶æŒ‡å®šå¤šä¸ªç»„æˆ–è€…å¤šä¸ª<code>ip</code>ä½¿ç”¨<code>:</code>åˆ†å‰²</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible group1:group2 -m ping</span></span>
<span class="line"><span>ansible ip1:ip2 -m ping</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#all  æˆ–è€… *  ä»£è¡¨å…¨éƒ¨</span></span>
<span class="line"><span>ansible all -m ping</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æ„Ÿå¹å· ! è¡¨ç¤ºé</span></span>
<span class="line"><span>g1:!g2   #è¡¨ç¤ºåœ¨g1åˆ†ç»„ä¸­ï¼Œä½†æ˜¯ä¸åœ¨g2ä¸­çš„hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span># &amp;ç¬¦å·è¡¨ç¤ºäº¤é›†</span></span>
<span class="line"><span>g1:&amp;g2  #è¡¨ç¤ºåœ¨g1åˆ†ç»„ä¸­ï¼Œä¹Ÿåœ¨g2ä¸­çš„hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#ä½¿ç”¨ä¸‹æ ‡</span></span>
<span class="line"><span>g1[2]  #ç»„çš„ç¬¬ä¸‰ä¸ª</span></span>
<span class="line"><span>g1[0:3] #ç»„çš„å‰å››ä¸ª</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¸¸ç”¨æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨æ¨¡å—"><span>å¸¸ç”¨æ¨¡å—</span></a></h2><h3 id="copyæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#copyæ¨¡å—"><span>copyæ¨¡å—</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šæŠŠä¸»æ§ç«¯/rootç›®å½•ä¸‹çš„a.shæ–‡ä»¶æ‹·è´åˆ°åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Š</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> copy</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;src=/root/a.sh dest=/tmp/ owner=root group=root mode=0755&#39;</span></span></code></pre></div><h3 id="fileæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#fileæ¨¡å—"><span>fileæ¨¡å—</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šæ›´æ”¹æŒ‡å®šèŠ‚ç‚¹ä¸Š/tmp/t.shçš„æƒé™ä¸º755ï¼Œå±ä¸»å’Œå±ç»„ä¸ºroot</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;dest=/tmp/t.sh mode=755 owner=root group=root&quot;</span></span></code></pre></div><h3 id="cronæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#cronæ¨¡å—"><span>cronæ¨¡å—</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ç›®çš„ï¼šåœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šå®šä¹‰ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡ï¼Œæ¯éš”3åˆ†é’Ÿåˆ°ä¸»æ§ç«¯æ›´æ–°ä¸€æ¬¡æ—¶é—´</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> cron</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=&quot;custom job&quot; minute=*/3 hour=* day=* month=* weekday=* job=&quot;/usr/sbin/ntpdate 192.168.247.152&quot;&#39;</span></span></code></pre></div><h3 id="groupæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#groupæ¨¡å—"><span>groupæ¨¡å—</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªç»„åä¸ºnolinuxï¼Œgidä¸º2014çš„ç»„</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> group</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;gid=2014 name=nolinux&#39;</span></span></code></pre></div><h3 id="uesræ¨¡å—" tabindex="-1"><a class="header-anchor" href="#uesræ¨¡å—"><span>uesræ¨¡å—</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸ºnolinuxï¼Œç»„ä¸ºnolinuxçš„ç”¨æˆ·</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=nolinux groups=nolinux state=present&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">åˆ é™¤ç”¨æˆ·</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=nolinux state=absent remove=yes&#39;</span></span></code></pre></div><h3 id="yumæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#yumæ¨¡å—"><span>yumæ¨¡å—</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šåœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šå®‰è£…</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#98C379;--shiki-dark:#98C379;"> æœåŠ¡</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;state=present name=httpd&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#state=latest å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span></code></pre></div><h3 id="shellæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#shellæ¨¡å—"><span>shellæ¨¡å—</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šåœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šå®‰è£…</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#98C379;--shiki-dark:#98C379;"> æœåŠ¡</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> testgroup</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;yum -y install httpd&#39;</span></span></code></pre></div><h3 id="commandæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#commandæ¨¡å—"><span>commandæ¨¡å—</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ç›®çš„ï¼šåœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šè¿è¡Œhostnameå‘½ä»¤</span></span>
<span class="line"><span>å‘½ä»¤ï¼šansible 192.168.247.152 -m command -a &#39;hostname&#39;</span></span></code></pre></div><h3 id="rawæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#rawæ¨¡å—"><span>rawæ¨¡å—</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ç›®çš„ï¼šåœ¨192.168.247.152èŠ‚ç‚¹ä¸Šè¿è¡Œifconfigå‘½ä»¤</span></span>
<span class="line"><span>å‘½ä»¤ï¼šansible 192.168.247.152 -m raw-a &#39;ifconfig|eth0&#39;</span></span></code></pre></div><h3 id="scriptæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#scriptæ¨¡å—"><span>scriptæ¨¡å—</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šåœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ‰§è¡Œ/root/a.shè„šæœ¬(è¯¥è„šæœ¬æ˜¯åœ¨ansibleä¸»æ§ç«¯</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10.1.1.113</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> script</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/root/a.sh&#39;</span></span></code></pre></div><h3 id="command-script-shell-rawçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#command-script-shell-rawçš„åŒºåˆ«"><span>command,script,shell,rawçš„åŒºåˆ«</span></a></h3><blockquote><p>æ€è€ƒï¼šå››è€…æœ‰ä½•åŒºåˆ«ï¼Ÿ</p></blockquote><p>commandæ¨¡å— [æ‰§è¡Œè¿œç¨‹å‘½ä»¤]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m command -a &quot;uname -n&quot; -s</span></span></code></pre></div><p>scriptæ¨¡å— [åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œä¸»æ§ç«¯çš„shell/pythonè„šæœ¬]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m script -a &quot;/soft/ntpdate.py&quot; -s</span></span></code></pre></div><p>shellæ¨¡å— [æ‰§è¡Œè¿œç¨‹ä¸»æœºçš„shell/pythonè„šæœ¬]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m shell -a &quot;/soft/file.py&quot; -s</span></span></code></pre></div><p>rawæ¨¡å— [ç±»ä¼¼äºcommandæ¨¡å—ã€æ”¯æŒç®¡é“ä¼ é€’]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m raw -a &quot;ifconfig eth0|sed -n 2p|awk &#39;{print \$2}&#39;&quot; -s</span></span></code></pre></div><h3 id="serviceæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#serviceæ¨¡å—"><span>serviceæ¨¡å—</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šå¯åŠ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šçš„</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span><span style="color:#98C379;--shiki-dark:#98C379;"> æœåŠ¡ï¼Œå¹¶è®©å…¶å¼€æœºè‡ªå¯åŠ¨</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> service</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=httpd state=restarted enabled=yes&#39;</span></span></code></pre></div><h3 id="pingæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#pingæ¨¡å—"><span>pingæ¨¡å—</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç›®çš„ï¼šæ£€æŸ¥æŒ‡å®šèŠ‚ç‚¹æœºå™¨æ˜¯å¦è¿˜èƒ½è¿é€š</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å‘½ä»¤ï¼šansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span></span></code></pre></div><h3 id="get-url" tabindex="-1"><a class="header-anchor" href="#get-url"><span>get_url</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ç›®çš„ï¼šä¸‹è½½ç™¾åº¦ä¸‹çš„å›¾æ ‡æ–‡ä»¶åˆ°èŠ‚ç‚¹çš„/tmpæ–‡ä»¶ä¸‹</span></span>
<span class="line"><span>å‘½ä»¤ï¼šansible testgroup -m get_url -a &#39;url=https://www.baidu.com/favicon dest=/tmp&#39;</span></span>
<span class="line"><span>#ç»“æœä¸ºerror.htmlï¼Œä½†æ˜¯è¯æ˜äº†æ¨¡å—æ˜¯å¯ç”¨çš„</span></span></code></pre></div><h3 id="statæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#statæ¨¡å—"><span>statæ¨¡å—</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ç›®çš„ï¼šè·å–è¿œç¨‹æ–‡ä»¶çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬atimeã€ctimeã€mtimeã€md5ã€uidã€gidç­‰ä¿¡æ¯</span></span>
<span class="line"><span>ansible web -m stat -a &#39;path=/etc/sysctl.conf&#39;</span></span></code></pre></div><h3 id="templateæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#templateæ¨¡å—"><span>templateæ¨¡å—</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>templateä½¿ç”¨äº†Jinja2æ ¼å¼ä½œä¸ºæ–‡ä»¶æ¨¡ç‰ˆï¼Œè¿›è¡Œæ–‡æ¡£å†…å˜é‡çš„æ›¿æ¢çš„æ¨¡å—ã€‚å®ƒçš„æ¯æ¬¡ä½¿ç”¨éƒ½ä¼šè¢«ansibleæ ‡è®°ä¸ºâ€changedâ€çŠ¶æ€ã€‚</span></span></code></pre></div><h2 id="æ¨¡å—å‚æ•°" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—å‚æ•°"><span>æ¨¡å—å‚æ•°</span></a></h2><table><thead><tr><th>å‚æ•°å</th><th>æ˜¯å¦å¿…é¡»</th><th>é»˜è®¤å€¼</th><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>backup</td><td>no</td><td>no</td><td>yes/no</td><td>å»ºç«‹ä¸ªåŒ…æ‹¬timestampåœ¨å†…çš„æ–‡ä»¶å¤‡ä»½ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€.</td></tr><tr><td>dest</td><td>yes</td><td></td><td></td><td>è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„ç»å¯¹è·¯å¾„ï¼Œç”¨äºæ”¾ç½®templateæ–‡ä»¶ã€‚</td></tr><tr><td>group</td><td>no</td><td></td><td></td><td>è®¾ç½®è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„çš„templateæ–‡ä»¶çš„æ‰€å±ç”¨æˆ·ç»„</td></tr><tr><td>mode</td><td>no</td><td></td><td></td><td>è®¾ç½®è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„templateæ–‡ä»¶æƒé™ã€‚ç±»ä¼¼<a href="http://www.2cto.com/os/linux/" target="_blank" rel="noopener noreferrer">Linux</a>ä¸­<em>chmod</em>çš„ç”¨æ³•</td></tr><tr><td>owner</td><td>no</td><td></td><td></td><td>è®¾ç½®è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„templateæ–‡ä»¶æ‰€å±ç”¨æˆ·</td></tr><tr><td>src</td><td>yes</td><td></td><td></td><td>æœ¬åœ°Jinjia2æ¨¡ç‰ˆçš„templateæ–‡ä»¶ä½ç½®</td></tr></tbody></table><h2 id="æ¨¡å—å‚æ•°æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—å‚æ•°æ¡ˆä¾‹"><span>æ¨¡å—å‚æ•°æ¡ˆä¾‹</span></a></h2><p>æŠŠ/mytemplates/foo.j2æ–‡ä»¶ç»è¿‡å¡«å†™å‚æ•°åï¼Œå¤åˆ¶åˆ°è¿œç¨‹èŠ‚ç‚¹çš„/etc/file.confï¼Œæ–‡ä»¶æƒé™ç›¸å…³ç•¥è¿‡</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span> - template: src=/mytemplates/foo.j2 dest=/etc/file.conf owner=bin group=wheel mode=0644</span></span></code></pre></div><p>è·Ÿä¸Šé¢ä¸€æ ·çš„æ•ˆæœï¼Œä¸ä¸€æ ·çš„æ–‡ä»¶æƒé™è®¾ç½®æ–¹å¼</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span> - template: src=/mytemplates/foo.j2 dest=/etc/file.conf owner=bin group=wheel mode=&quot;u=rw,g=r,o=r&quot;</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯¦ç»†è¯´æ˜ </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">roles/templates/server.xmlä¸­çš„templateæ–‡ä»¶å…³é”®éƒ¨åˆ†å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;user </span><span style="color:#E06C75;--shiki-dark:#E06C75;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;{{ admin_username }}&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;{{ admin_password }}&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> roles</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;manager-gui&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> /</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“è¿™ä¸ªæ–‡ä»¶è¿˜æ²¡è¢«templateæ‰§è¡Œçš„æ—¶å€™ï¼Œæœ¬åœ°çš„admin_usernameåŠadmin_password éƒ½æ˜¯å˜é‡çŠ¶æ€ã€‚ </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“playbookæ‰§è¡Œå®Œtemplateçš„æ—¶å€™ï¼Œè¿œç¨‹çš„admin_username*åŠadmin_password ä¼šå˜æˆå˜é‡æ‰€å¯¹åº”çš„å€¼ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¾‹ </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å‰é¢çš„é‚£ä¸ªPlaybook,å¦‚æœæˆ‘ä»¬åœ¨tomcat-serversè®¾ç½®äº†è¿™ä¸¤ä¸ªå˜é‡å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">dmin_username:</span><span style="color:#98C379;--shiki-dark:#98C379;"> admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">admin_password:</span><span style="color:#98C379;--shiki-dark:#98C379;"> adminsecret</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‚£ä¹ˆåœ¨æ‰§è¡Œè¿™ä¸ªPlaybookå‰ï¼Œå¯¹åº”çš„é‚£ä¸ªtemplateæ–‡ä»¶ï¼ˆä¿—ç§°æ¨¡ç‰ˆï¼‰ï¼Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">å°†åœ¨æœ¬åœ°ä¿æŒ{{ admin_username }}åŠ{{ admin_password }}çš„çŠ¶æ€ã€‚</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">åœ¨Ansibleè°ƒç”¨templateæ¨¡ç‰ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œè¿™é‡Œå°†ç”±Jinjia2ä»â€tomcat-serversâ€è¯»å–å¯¹åº”çš„å€¼ï¼Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç„¶åæ›¿æ¢æ‰æ¨¡ç‰ˆé‡Œçš„å˜é‡ï¼Œç„¶åæŠŠè¿™ä¸ªæ›¿æ¢å˜é‡å€¼åçš„æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹èŠ‚ç‚¹ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™ä¸ªå°±æ˜¯templateçš„æ„ä¹‰æ‰€åœ¨ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ›´å¤šæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#æ›´å¤šæ¨¡å—"><span>æ›´å¤šæ¨¡å—</span></a></h3><p>ansible-doc -l æŸ¥è¯¢</p><hr><h2 id="playbookçš„é…ç½®å’Œä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#playbookçš„é…ç½®å’Œä½¿ç”¨"><span>playbookçš„é…ç½®å’Œä½¿ç”¨</span></a></h2><p>é…ç½®æ–‡ä»¶åç¼€åä¸º.yml</p><h3 id="å®˜ç½‘demoè¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å®˜ç½‘demoè¯´æ˜"><span>å®˜ç½‘demoè¯´æ˜</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™ä¸ªæ˜¯ä½ é€‰æ‹©çš„ä¸»æœº</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">webservers</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™ä¸ªæ˜¯å˜é‡</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    http_port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    max_clients</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">200</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿œç«¯çš„æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åˆ©ç”¨yumæ¨¡å—æ¥æ“ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure apache is at the latest version</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    yum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">pkg=httpd state=latest</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the apache config file</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/srv/httpd.j2 dest=/etc/httpd.conf</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è§¦å‘é‡å¯æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">restart apache</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure apache is running</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=started</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™é‡Œçš„restart apache å’Œä¸Šé¢çš„è§¦å‘æ˜¯é…å¯¹çš„ã€‚è¿™å°±æ˜¯handlersçš„ä½œç”¨ã€‚ç›¸å½“äºtag</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  handlers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">restart apache</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=restarted</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æœ‰çš„ç³»ç»Ÿåšäº†sudoé™åˆ¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨playbookä¸­å¼€å¯æƒé™ï¼Œå¦‚ä¸‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">vic</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=nginx state=started</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      sudo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">yes</span></span></code></pre></div><h3 id="è„šæœ¬å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#è„šæœ¬å®ä¾‹"><span>è„šæœ¬å®ä¾‹</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  ##factså¯ä»¥è°ƒç”¨clientçš„å˜é‡æ¥ä½¿ç”¨ï¼Œåé¢å˜é‡é‡Œä¼šè¯¦ç»†ä»‹ç»</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=&quot;{{ user }}&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿”å›ç»“æœå¦‚ä¸‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest1] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=1    changed=0    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç»™è„šæœ¬æ·»åŠ serviceçš„è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#ç»™è„šæœ¬æ·»åŠ serviceçš„è°ƒç”¨"><span>ç»™è„šæœ¬æ·»åŠ serviceçš„è°ƒç”¨</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #æ·»åŠ äº†httpdæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #è¿”å›ç»“æœå¦‚ä¸‹ </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯ä»¥æ³¨æ„åˆ° TASK [service]æ˜¾ç¤ºå·²ç»å¼€å¯äº†</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [service] *****************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç»™è„šæœ¬æ·»åŠ copyæ¨¡å—çš„è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#ç»™è„šæœ¬æ·»åŠ copyæ¨¡å—çš„è°ƒç”¨"><span>ç»™è„šæœ¬æ·»åŠ copyæ¨¡å—çš„è°ƒç”¨</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #æ·»åŠ äº†httpdæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #æ·»åŠ äº†copyæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #è¿”å›ç»“æœå¦‚ä¸‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] ************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] *******************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [service] ****************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯ä»¥æ³¨æ„åˆ° TASK [copy file to clent]å·²æˆåŠŸ</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to clent] *****************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP ********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=3    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>copyä¼ é€çš„æ—¶å€™ï¼Œå¯èƒ½æŠ¥é”™</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>afewbug | FAILED &gt;&gt; {</span></span>
<span class="line"><span>    &quot;checksum&quot;: &quot;4ee72f7427050dcd97068734d35ca7b2c651bc88&quot;, </span></span>
<span class="line"><span>    &quot;failed&quot;: true, </span></span>
<span class="line"><span>    &quot;msg&quot;: &quot;Aborting, target uses selinux but python bindings (libselinux-python) arenâ€˜t installed!&quot;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>æ˜¯å› ä¸ºansibleéœ€è¦libselinux-pythonåŒ…ã€‚ï¼ˆè¢«æ§ç«¯éœ€è¦å®‰è£…libselinux-python**ï¼‰  </span></span>
<span class="line"><span>å¯ä»¥åœ¨copyå‰å…ˆè°ƒç”¨yumæ¨¡å—ï¼Œå®‰è£…libselinux-python</span></span></code></pre></div><h2 id="templateæ¨¡æ¿-æ”¯æŒjinja2" tabindex="-1"><a class="header-anchor" href="#templateæ¨¡æ¿-æ”¯æŒjinja2"><span>templateæ¨¡æ¿ï¼ˆæ”¯æŒjinja2ï¼‰</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">temp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #æ·»åŠ äº†httpdæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #æ·»åŠ äº†copyæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}å˜é‡æ¥è‡ªvars</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #æ·»åŠ äº†templateæ¨¡æ¿ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿”å›ç»“æœ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [start httpd] *************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to clent] ******************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯ä»¥æ³¨æ„åˆ° è¿”å›ç»“æœæ˜¾ç¤ºæˆåŠŸï¼Œå»clientç›¸å…³ç›®å½•å³å¯çœ‹åˆ°æ–‡ä»¶</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=4    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#templateæ¨¡å—å¯ä»¥å¼•ç”¨å˜é‡åˆ°æºæ–‡ä»¶</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">/tmp/temp</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{user}}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{temp}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ‰§è¡Œymlå</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m command -a &#39;cat /tmp/temptest&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##clientè¿”å›çš„å°±æ˜¯ä¸»æœºæºæ–‡ä»¶ä¸­å¼•å…¥çš„å˜é‡</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">usertest1</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ¨¡å—"><span>æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ¨¡å—</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">temp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #æ·»åŠ äº†httpdæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #æ·»åŠ äº†copyæœåŠ¡çš„å¼€å¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}å˜é‡æ¥è‡ªvars</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #æ·»åŠ äº†templateæ¨¡æ¿ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">run shell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/bin/ls /tmp/ || /bin/true</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #/bin/true é˜²ä¸­æ–­</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">run  command</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">mkdir /tmp/command-test</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #æ·»åŠ äº†ä¸¤ä¸ªæ‰§è¡Œå¤–éƒ¨å‘½ä»¤æ¨¡å—shellå’Œcommand</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿”å›ç»“æœå¦‚ä¸‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [start httpd] *************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to client] *****************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [shell~] ******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [run this command] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="color:#98C379;--shiki-dark:#98C379;">WARNING</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]: </span><span style="color:#98C379;--shiki-dark:#98C379;">Consider using file module with state=directory rather than running</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">mkdir</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=6    changed=4    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#1./usr/bin/...||/bin/true  å‰é¢å¤±è´¥çš„è¯/bin/trueï¼šè¿”å›trueã€‚é˜²æ­¢ä¸­æ–­ï¼Œç»§ç»­æ‰§è¡Œã€‚ç±»ä¼¼çš„åˆ¤æ–­è¿˜æœ‰chenge_whenå‚æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å˜é‡åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#å˜é‡åŠŸèƒ½"><span>å˜é‡åŠŸèƒ½</span></a></h2><h3 id="facts" tabindex="-1"><a class="header-anchor" href="#facts"><span>facts</span></a></h3><blockquote><p>ä¸€ä¸ªå¸¸ç”¨çš„ç»„ä»¶ï¼Œå¯å®ç°å¯¹è¿œç¨‹è‡ªå·±ç³»ç»Ÿä¿¡æ¯çš„è·å–ï¼Œæ¯”å¦‚ï¼šä¸»æœºåï¼ŒIPåœ°å€ï¼Œæ“ä½œç³»ç»Ÿï¼Œåˆ†åŒºæƒ…å†µï¼Œç¡¬ä»¶ä¿¡æ¯ç­‰ï¼Œé…åˆplaybookä½¿ç”¨ï¼Œæ›´åŠ çš„çµæ´»å’Œä¸ªæ€§åŒ–å®šåˆ¶</p></blockquote><p><code>ansible ip/group -m setup</code>å¯ä»¥è·å–clientsçš„factsä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> testgroup -m setup</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    &quot;ansible_facts&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_all_ipv4_addresses&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;192.168.122.1&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;192.168.247.152&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_all_ipv6_addresses&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;fe80::20c:29ff:feb5:6e6&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_architecture&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;x86_64&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_bios_date&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;07/02/2015&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_bios_version&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;6.00&quot;,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        ......</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è„šæœ¬ä¸­å¼€å¯FactsåŠŸèƒ½</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å¼€å¯facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}å˜é‡æ¥è‡ªvars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿”å›ç»“æœï¼Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŸ¥çœ‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m raw -a &quot;ls /tmp | grep 192*&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.122.1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.247.152&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Shared connection to 192.168.247.152 closed.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#IPåœ°å€æœ‰ä¸¤ä¸ªæ‰€ä»¥æ–‡ä»¶åå¾ˆå¥‡æ€ª</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸»æœºçš„/tmp/tempä¸‹è°ƒç”¨factså˜é‡</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¿®æ”¹/tmp/tempæ–‡ä»¶</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{ansible_all_ipv4_addresses}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å¼€å¯facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/factstest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç»“æœå¦‚ä¸‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m raw -a &quot;cat /tmp/factstest&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.122.1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.247.152&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Shared connection to 192.168.247.152 closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è‡ªå®šä¹‰å˜é‡" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰å˜é‡"><span>è‡ªå®šä¹‰å˜é‡</span></a></h3><blockquote><p>å¦‚ä½•factsçš„å˜é‡å¹¶ä¸èƒ½æ»¡è¶³éœ€æ±‚çš„ï¼Œå°±å¯ä»¥è‡ªå®šä¹‰factsæ¨¡æ¿æ¥å®ç°</p><p>å¦å¤–å¯ä»¥é€šè¿‡æœ¬åœ°factsæ¥å®ç°ï¼Œåªéœ€åœ¨clientçš„/etc/ansible/facts.dç›®å½•å®šä¹‰JSON,INIæˆ–å¯æ‰§è¡Œçš„JSONè¾“å‡ºï¼Œåç¼€åä¸€å®šè¦ç”¨.factï¼Œé‚£ä¹ˆè¿™äº›æ–‡ä»¶å°±å¯ä»¥ä½œä¸ºæœ¬åœ°çš„facts</p></blockquote><p>##åœ¨clientå®šä¹‰å˜é‡ï¼Œä¾›ansibleä¸»æœºä½¿ç”¨</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 ~]# mkdir /etc/ansible/facts.d -p</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 ~]# cd /etc/ansible/facts.d/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 facts.d]# cat client.fact</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[general]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">zili</span></span></code></pre></div><p><strong>ansibleä¸»æœº</strong></p><div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]$ansible </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -m setup -a </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;filter=ansible_local&quot;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | SUCCESS =&gt; {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;ansible_facts&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        &quot;ansible_local&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {      </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#æœ¬åœ°facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;client&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {       </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#æ–‡ä»¶å</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                &quot;general&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {       </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#èŠ‚ç‚¹å</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    &quot;name&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;zili&quot;</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">    #key-value</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;changed&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å»è°ƒç”¨è‡ªå®šä¹‰çš„factså˜é‡</strong></p><p><code>{{ansible_local.client.general.name}}</code></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [create </span><span style="color:#98C379;--shiki-dark:#98C379;">user]</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [template </span><span style="color:#98C379;--shiki-dark:#98C379;">test]</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ***********************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">changed:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è°ƒç”¨æˆåŠŸï¼Œå¹¶å¯çœ‹åˆ°clientå†…å®¹å·²å˜åŒ–</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> testgroup -m raw -a </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cat /tmp/factstest2&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          192.168.247.152 | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#E06C75;--shiki-dark:#E06C75;">rc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zili</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Shared</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;"> closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åœ¨æ“ä½œä¸»æœºå®šä¹‰å˜é‡-æ¥æ§åˆ¶client" tabindex="-1"><a class="header-anchor" href="#åœ¨æ“ä½œä¸»æœºå®šä¹‰å˜é‡-æ¥æ§åˆ¶client"><span>åœ¨æ“ä½œä¸»æœºå®šä¹‰å˜é‡ï¼Œæ¥æ§åˆ¶client</span></a></h2><p>æ€è·¯å°±æ˜¯åœ¨æ‰§è¡Œplaybookçš„æ—¶å€™å°†æœ¬åœ°çš„factsæ¨é€åˆ°clientç›¸å…³ç›®å½•ä¸‹</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create directory for ansible custom facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">state=directory recurse=yes path=/etc/ansible/facts.d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">install custom facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/etc/ansible/host.fact dest=/etc/ansible/facts.d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">re-read facts after adding custom fact</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        setup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">filter=ansible_local</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #å¦‚æ­¤ç›¸å½“äºæ‰¹é‡åœ¨clientåˆ›å»ºäº†factså˜é‡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #ç„¶åå°±å¯ä»¥ä¸»æœºè°ƒç”¨äº†!</span></span></code></pre></div><h3 id="æ³¨å†Œå˜é‡" tabindex="-1"><a class="header-anchor" href="#æ³¨å†Œå˜é‡"><span>æ³¨å†Œå˜é‡</span></a></h3><blockquote><p>å˜é‡å¯ä»¥å°†ä¸€æ¡å‘½ä»¤çš„è¿”å›å€¼è¿›è¡Œä¿å­˜ï¼Œç„¶åæä¾›ç»™playbookä½¿ç”¨</p></blockquote><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root@ansible ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]# </span><span style="color:#98C379;--shiki-dark:#98C379;">cat user1.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/bin/foo</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">z</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #æ³¨å†Œäº†ä¸€ä¸ªfoo\_resulå˜é‡ï¼Œå˜é‡å€¼ä¸ºshell: /usr/bin/fooçš„è¿è¡Œç»“æœ;  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ignore_errors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #ignore\_errors: Trueä¸ºå¿½ç•¥é”™è¯¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">touch /tmp/LLL</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å½“å˜é‡æ³¨å†Œå®Œæˆåï¼Œå°±å¯ä»¥åœ¨åé¢çš„playbookä¸­ä½¿ç”¨äº†</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">z.rc == 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“æ¡ä»¶è¯­å¥when: z.rc == 5æˆç«‹æ—¶ï¼Œshell: touch /tmp/LLLå‘½ä»¤æ‰ä¼šæ‰§è¡Œ</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯ä»¥æ³¨æ„åˆ°commandæ˜¯skippingçš„ã€‚å› ä¸ºè¿”å›å€¼æ˜¯127ï¼Œæ‰€ä»¥clientè‚¯å®šè¿˜æ˜¯æ²¡æœ‰åˆ›å»ºLLLçš„</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook user1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [testgroup] ***************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]: FAILED! </span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{&quot;changed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cmd&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/usr/bin/foo&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;delta&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;0:00:00.003488&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;end&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:08:45.996549&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;failed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;rc&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 127,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;start&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:08:45.993061&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stderr&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/bin/sh: /usr/bin/foo: No such file or directory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout_lines&quot;:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [], </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;warnings&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: []}</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">..</span><span style="color:#98C379;--shiki-dark:#98C379;">.ignoring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">skipping:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##æ‰€ä»¥æˆ‘é—¨ä¿®æ”¹z.rcçš„è¿”å›å€¼ä¸º127åœ¨æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä»¥ä¸ºè¿”å›å€¼æ˜¯å¯¹çš„ï¼Œæ‰€ä»¥æ‰§è¡Œäº†touchï¼Œwarningæ˜¯å‹æƒ…æç¤ºï¼Œæœ€å¥½ç”¨çº¿ç®¡æ¨¡å—è¿›è¡Œæ–‡ä»¶çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook user1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [testgroup] ***************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]: FAILED! </span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{&quot;changed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cmd&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/usr/bin/foo&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;delta&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;0:00:00.003539&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;end&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:11:01.955975&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;failed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;rc&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 127,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;start&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:11:01.952436&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stderr&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/bin/sh: /usr/bin/foo: No such file or directory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout_lines&quot;:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [], </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;warnings&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: []}</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">..</span><span style="color:#98C379;--shiki-dark:#98C379;">.ignoring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">changed:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [WARNING]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Consider</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#98C379;--shiki-dark:#98C379;"> module</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#98C379;--shiki-dark:#98C379;"> state=touch</span><span style="color:#98C379;--shiki-dark:#98C379;"> rather</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span><span style="color:#98C379;--shiki-dark:#98C379;"> touch</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è¯­å¥" tabindex="-1"><a class="header-anchor" href="#è¯­å¥"><span>è¯­å¥</span></a></h2><h3 id="æ¡ä»¶è¯­å¥" tabindex="-1"><a class="header-anchor" href="#æ¡ä»¶è¯­å¥"><span>æ¡ä»¶è¯­å¥</span></a></h3><blockquote><p>playbookçš„æ‰§è¡Œç»“æœå–å†³äºå˜é‡ï¼Œä¸ç®¡æ˜¯factsè¿˜æ˜¯tasksç»“æœèµ‹å€¼çš„ï¼Œè€Œå˜é‡çš„å€¼å¯ä»¥ä¾èµ–äºå…¶ä»–å˜é‡ï¼Œå½“ç„¶ä¸€ä¼šå°è±¡ansibleçš„æ‰§è¡Œ</p><p>æœ‰æ—¶å€™æˆ‘ä»¬ï¼Œæƒ³è¦è·³è¿‡æŸäº›ä¸»æœºçš„æ‰§è¡Œæ­¥éª¤ï¼Œæ¯”å¦‚ï¼ŒæŸäº›clientä¸å®‰è£…æŸä¸ªè½¯ä»¶åŒ…ï¼Œä¸æ¸…ç†åƒåœ¾ç­‰ç­‰</p><p>å°±è¦ä½¿ç”¨åˆ¤æ–­äº†</p></blockquote><h2 id="when" tabindex="-1"><a class="header-anchor" href="#when"><span>when</span></a></h2><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">when</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">shutdown centos</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/sbin/shutdown -t now</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ansible_hostname == &#39;test1&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#whenè¿”å›boolå€¼ï¼Œä¸ºtrueæ˜¯æ‰§è¡Œï¼Œfalseåˆ™ä¸æ‰§è¡Œ</span></span></code></pre></div><p><strong>when é’ˆå¯¹ä¸åŒåˆ†æ”¯çš„äºŒçº§å¤„ç†</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">when</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/sbin/ip a</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ignore_errors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/something</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|failed</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/something_else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|success</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/still/something_else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|skipped</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># when: result|success&quot;çš„æ„æ€ä¸ºå½“å˜é‡resultæ‰§è¡Œç»“æœä¸ºæˆåŠŸ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†æ‰§è¡Œ/bin/something_elseå‘½ä»¤ï¼Œå…¶ä»–åŒç†ã€‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å…¶ä¸­successä¸ºAnsibleå†…éƒ¨è¿‡æ»¤å™¨æ–¹æ³•ï¼Œè¿”å›Trueä»£è¡¨å‘½ä»¤è¿è¡ŒæˆåŠŸã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¾ªç¯è¯­å¥" tabindex="-1"><a class="header-anchor" href="#å¾ªç¯è¯­å¥"><span>å¾ªç¯è¯­å¥</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ item }} state=present groups=wheel</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    with_items</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">tiger1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">tiger2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åˆ›å»ºç”¨æˆ·çš„ã€‚with_itemsä¼šè‡ªåŠ¨å¾ªç¯æ‰§è¡Œä¸Šé¢çš„è¯­å¥&quot;user: name={{ item }} state=present groups=wheel&quot;ï¼Œå¾ªç¯çš„æ¬¡æ•°ä¸ºwith_itemsçš„å…ƒç´ ä¸ªæ•°ã€‚è¿™é‡Œæœ‰2ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«ä¸ºtiger1ã€tiger2ï¼Œä¼šåˆ†åˆ«æ›¿æ¢{{ item }}é¡¹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç­‰åŒäº</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user tiger1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=tiger1 state=present groups=wheel</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user tiger2&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=tiger2 state=present groups=wheel</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¾ªç¯å…ƒç´ æ”¯æŒåˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#å¾ªç¯å…ƒç´ æ”¯æŒåˆ—è¡¨"><span>å¾ªç¯å…ƒç´ æ”¯æŒåˆ—è¡¨</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é¦–å…ˆå®šä¹‰å¥½åˆ—è¡¨ list.yml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">packages_base</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;vsftpd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;vim&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">packages_apps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - [[ </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;mysql&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">httpd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç„¶åå¼•å…¥ä½¿ç”¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  var_files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#98C379;--shiki-dark:#98C379;">/etc/ansible/list.yml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;install rpm&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    yum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ item }} state=installed</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    with_flattened</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ­¤è¯­å¥ ç”¨æ¥å¾ªç¯å®šä¹‰å¥½çš„åˆ—è¡¨</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">packages_base</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">packages_apps</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="handlers-å’Œ-include" tabindex="-1"><a class="header-anchor" href="#handlers-å’Œ-include"><span>handlers å’Œ include</span></a></h3><blockquote><p>å½“å¤šä¸ªplaybookæ¶‰åŠå¤ç”¨çš„ä»»åŠ¡åˆ—è¡¨æ—¶ï¼Œå¯ä»¥å°†å¤ç”¨çš„å†…å®¹å‰¥ç¦»å‡ºæ¥ï¼Œå†™åˆ°ç‹¬ç«‹çš„æ–‡ä»¶é‡Œï¼Œéœ€è¦çš„åœ°æ–¹includeè¿›æ¥å³å¯</p><p>é™¤äº†tasksä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªhandlersçš„å‘½ä»¤ï¼Œhandlersæ˜¯åœ¨æ‰§è¡Œtasksä¹‹åæœåŠ¡å™¨å‘ç”Ÿå˜åŒ–ä¹‹åå¯ä¾›è°ƒç”¨çš„handler</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the httpd config file</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the httpd.conf to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:    </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœcopyæ‰§è¡Œå®Œä¹‹å/etc/httpd/conf/httpd.confæ–‡ä»¶å‘é€äº†å˜åŒ–ï¼Œåˆ™æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">restart httpd</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # è°ƒç”¨handler</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">include</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">playbook/tasks/httpd.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    handlers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">restart httpd</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #æ­¤å¤„çš„æ ‡è¯†å¿…é¡»å’Œnotifyä¸€æ ·æ‰å¯ä»¥å¼•èµ·è§¦å‘</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=restarted</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #æ³¨æ„ä¸Šé¢ä½¿ç”¨çš„- include: playbook/tasks/httpd.ymlï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure httpd is running</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=started</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>notifyè¿™ä¸ªactionå¯ç”¨äºåœ¨æ¯ä¸ªplayçš„æœ€åè¢«è§¦å‘ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤šæ¬¡æœ‰æ”¹å˜å‘ç”Ÿæ—¶æ¯æ¬¡éƒ½æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œå–è€Œä»£ä¹‹ï¼Œä»…åœ¨æ‰€æœ‰çš„å˜åŒ–å‘ç”Ÿå®Œæˆåä¸€æ¬¡æ€§åœ°æ‰§è¡ŒæŒ‡å®šæ“ä½œã€‚</p><p>Handlers æ˜¯ç”±é€šçŸ¥è€…è¿›è¡Œ notify, å¦‚æœæ²¡æœ‰è¢« notify,handlers ä¸ä¼šæ‰§è¡Œã€‚</p><p>Handlers æœ€ä½³çš„åº”ç”¨åœºæ™¯æ˜¯ç”¨æ¥é‡å¯æœåŠ¡,æˆ–è€…è§¦å‘ç³»ç»Ÿé‡å¯æ“ä½œ.é™¤æ­¤ä»¥å¤–å¾ˆå°‘ç”¨åˆ°äº†ã€‚</p></blockquote><h2 id="roles-ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#roles-ä½¿ç”¨"><span>roles ä½¿ç”¨</span></a></h2><p>å‰é¢çš„æ‰€æœ‰éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶å†….è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è¿›è¡Œæ›´å¥½çš„ç»„ç»‡æ¶æ„<br> ä½¿ç”¨roles</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master roles]# tree</span></span>
<span class="line"><span>.</span></span>
<span class="line"><span>â”œâ”€â”€ test</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ tasks</span></span>
<span class="line"><span>â”‚Â Â      â””â”€â”€ main.yml</span></span>
<span class="line"><span>â””â”€â”€ test.yml</span></span>
<span class="line"><span>test.ymlä¸ºå…¥å£æ–‡ä»¶,æ¯æ¬¡æ‰§è¡Œå®ƒå³å¯.ä»–çš„å†…å®¹å¦‚ä¸‹</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master roles]# cat test.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- hosts: all</span></span>
<span class="line"><span>  roles:</span></span>
<span class="line"><span>    - role: test</span></span>
<span class="line"><span>å®šä¹‰äº†ä¸»æœº/ä¸»æœºç»„,ç„¶åå®šä¹‰äº†è¦ä½¿ç”¨çš„roles,(ä¹Ÿå°±æ˜¯rolesä¸‹çš„æ–‡ä»¶å¤¹çš„åå­—)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>testæ–‡ä»¶å¤¹ä¸‹å®šä¹‰äº†tasks,å†…æœ‰ **main.yml**  è¿™ä¸ªå‘½åæ˜¯è§„å®šå¥½çš„.å¿…é¡»æ˜¯main</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>main.yml ä¹¦å†™äº†tasksçš„ä»»åŠ¡.</span></span>
<span class="line"><span>[root@master roles]# cat test/tasks/main.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- name: test role ping</span></span>
<span class="line"><span>  ping:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master roles]#</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœå¦‚ä¸‹:</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master roles]# ansible-playbook test.yml </span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY [all] ************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [Gathering Facts] ************************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.28]</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [test : test role ping] ******************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.28]</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY RECAP ************************************************************************************</span></span>
<span class="line"><span>10.1.27.24                 : ok=2    changed=0    unreachable=0    failed=0   </span></span>
<span class="line"><span>10.1.27.28                 : ok=2    changed=0    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>rolesæœ‰å¾ˆå¤šç»“æ„,ansibleå¯ä»¥æ ¹æ®å…¶è¿›è¡Œè§£æ.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>â”œâ”€â”€ defaults</span></span>
<span class="line"><span>â”œâ”€â”€ files</span></span>
<span class="line"><span>â”œâ”€â”€ handlers</span></span>
<span class="line"><span>â”œâ”€â”€ meta</span></span>
<span class="line"><span>â”œâ”€â”€ tasks</span></span>
<span class="line"><span>â”œâ”€â”€ templates</span></span>
<span class="line"><span>â””â”€â”€ vars</span></span></code></pre></div><p>å¦‚æœ<code>roles/x/tasks/main.yml</code>å­˜åœ¨,åˆ™è‡ªåŠ¨å°†é‡Œé¢çš„tasksæ·»åŠ åˆ°playä¸­ã€‚</p><p>å¦‚æœ<code>roles/x/handlers/main.yml</code>å­˜åœ¨,åˆ™è‡ªåŠ¨å°†é‡Œé¢çš„handlersæ·»åŠ åˆ°playä¸­ã€‚</p><p>å¦‚æœ<code>roles/x/vars/main.yml</code>å­˜åœ¨, åˆ™è‡ªåŠ¨å°†å…¶ä¸­çš„variablesæ·»åŠ åˆ°playä¸­ã€‚</p><p>å¦‚æœ<code>roles/x/meta/main.yml</code>å­˜åœ¨,åˆ™æ·»åŠ roleçš„ä¾èµ–å…³ç³»rolesä¸­ã€‚</p><p>ä»»ä½•<code>copy</code>ä»»åŠ¡ã€<code>script</code>ä»»åŠ¡éƒ½å¯ä»¥å¼•ç”¨<code>roles/x/files</code>ä¸­çš„æ–‡ä»¶ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„éƒ½å¯ä»¥ã€‚</p><p>ä»»ä½•<code>template</code>ä»»åŠ¡éƒ½å¯ä»¥å¼•ç”¨<code>roles/x/templates</code>ä¸­çš„æ–‡ä»¶ï¼Œæ— è®ºç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„ã€‚</p><p>ä»»ä½•<code>include</code>ä»»åŠ¡éƒ½å¯ä»¥å¼•ç”¨<code>roles/x/tasks/</code>ä¸­çš„æ–‡ä»¶ï¼Œæ— è®ºç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„</p><p>å…·ä½“å¯ä»¥å‚è§æ–‡æ¡£ï¼š<a href="http://docs.ansible.com/playbooks_intro.html" target="_blank" rel="noopener noreferrer">http://docs.ansible.com/playbooks_intro.html</a></p><h2 id="ansibleå’Œsaltstackçš„å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#ansibleå’Œsaltstackçš„å¯¹æ¯”"><span>ansibleå’Œsaltstackçš„å¯¹æ¯”</span></a></h2><blockquote><p>1ã€saltè¦å®‰è£…agent , ansibleé€šè¿‡sshè¿æ¥ã€‚</p><p>2ã€saltåœ¨serverç«¯è¦å¯è¿›ç¨‹ï¼›ansibleä¸éœ€è¦ã€‚</p><p>3ã€saltä¸ansibleéƒ½æœ‰æ¨¡å—ï¼Œå¯ä½¿ç”¨ä»»æ„è¯­è¨€å¼€å‘æ¨¡å—ã€‚</p><p>4ã€saltä¸ansibleéƒ½ä½¿ç”¨yamlè¯­è¨€æ ¼å¼ç¼–å†™å‰§æœ¬ã€‚</p><p>ansibleèµ°çš„æ˜¯ssh,æ‰€ä»¥å®ƒæœ‰è®¤è¯ä»¥åŠåŠ å¯†ç çš„è¿‡ç¨‹ï¼Œä½¿å¾—ansibleéå¸¸æ…¢ï¼Œä¸é€‚ç”¨äºå¤§è§„æ¨¡ç¯å¢ƒï¼ˆæŒ‡ä¸Šåƒå°ï¼‰</p></blockquote><hr></div><!--[--><Sponsor></Sponsor><!--]--><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Centos 9 init<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--17c4bf36:;"><!-- <div class="busuanzi">
      <span id="busuanzi_container_site_pv" style="display: none">
        æœ¬ç«™æ€»è®¿é—®é‡
        <span id="busuanzi_value_site_pv"></span>æ¬¡
        <span class="post-meta-divider">|</span>
      </span>
      <span id="busuanzi_container_site_uv" style="display: none">
        æ‚¨æ˜¯æœ¬ç«™ç¬¬
        <span id="busuanzi_value_site_uv"></span>ä½è®¿é—®è€…
      </span>
    </div> --><div class="footer-content"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2016-2024 z</div></div><span id="runtime_span"></span><div class="footer-link"><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1.gif" alt="" style="width:auto;height:32px;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="https://www.travellings.cn/assets/logo.gif" alt="" style="width:auto;height:32px;" title="å¼€å¾€-å‹é“¾æ¥åŠ›"></a><!-- <a href="https://www.foreverblog.cn/" target="_blank">
        <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width: auto; height: 16px" />
      </a> --></div></footer></div><!--]--><!--[--><!----><!----><div></div><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BfCDUtKQ.js" defer></script>
  </body>
</html>
