<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://docs.lizili.online/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html"><meta property="og:site_name" content="lzz's Blog"><meta property="og:title" content="Ansible"><meta property="og:description" content="请注意 本文内容可能已过时，请自行甄别。 前言 Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是 分布式集中管理工具， 通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块 什么是ans..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-23T05:06:11.000Z"><meta property="article:author" content="z"><meta property="article:tag" content="ansible"><meta property="article:modified_time" content="2024-04-23T05:06:11.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Ansible","image":[""],"dateModified":"2024-04-23T05:06:11.000Z","author":[{"@type":"Person","name":"z","url":"https://docs.lizili.online"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?088df8f788eb6cfa86e86b04cee94211";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
        </script><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://docs.lizili.online/rss.xml" title="lzz's Blog RSS Feed"><title>Ansible | lzz's Blog</title><meta name="description" content="请注意 本文内容可能已过时，请自行甄别。 前言 Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是 分布式集中管理工具， 通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块 什么是ans...">
    <link rel="preload" href="/assets/style-BWhSO6JG.css" as="style"><link rel="stylesheet" href="/assets/style-BWhSO6JG.css">
    <link rel="modulepreload" href="/assets/app-BfCDUtKQ.js"><link rel="modulepreload" href="/assets/ansible学习.html-KB7krrXA.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">lzz&#39;s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="运开"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span>运开<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">运维笔记</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/ops/linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/GitOps/" aria-label="GitOps"><!--[--><span class="font-icon icon iconfont icon-git" style=""></span><!--]-->GitOps<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/monitor/" aria-label="Monitor"><!--[--><span class="font-icon icon iconfont icon-monitor" style=""></span><!--]-->Monitor<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">开发笔记</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/code/" aria-label="Code"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->Code<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/ops/" aria-label="Ops"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Ops<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/script/" aria-label="Script"><!--[--><span class="font-icon icon iconfont icon-script" style=""></span><!--]-->Script<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">其他</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/team/" aria-label="Team"><!--[--><span class="font-icon icon iconfont icon-tuandui" style=""></span><!--]-->Team<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/faq/" aria-label="FAQ"><!--[--><span class="font-icon icon iconfont icon-Faq" style=""></span><!--]-->FAQ<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="云原生"><!--[--><span class="font-icon icon iconfont icon-yunyuansheng" style=""></span>云原生<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/kubernetes/" aria-label="kubernetes"><!--[--><span class="font-icon icon iconfont icon-kubernetes" style=""></span><!--]-->kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/backup/" aria-label="backup"><!--[--><span class="font-icon icon iconfont icon-backup" style=""></span><!--]-->backup<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/middleware/" aria-label="middleware"><!--[--><span class="font-icon icon iconfont icon-zhongjianjian" style=""></span><!--]-->middleware<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="手册"><!--[--><span class="font-icon icon iconfont icon-shouce" style=""></span>手册<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/shell.html" aria-label="shell"><!--[--><span class="font-icon icon iconfont icon-shell" style=""></span><!--]-->shell<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/markdown/" aria-label="markdown"><!--[--><span class="font-icon icon iconfont icon-markdown" style=""></span><!--]-->markdown<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/vuepress/" aria-label="vuepress"><!--[--><span class="font-icon icon iconfont icon-vue" style=""></span><!--]-->vuepress<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tools/" aria-label="工具分享"><!--[--><span class="font-icon icon iconfont icon-tools" style=""></span><!--]-->工具分享<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/hobby/" aria-label="爱好"><!--[--><span class="font-icon icon iconfont icon-xingquaihao" style=""></span><!--]-->爱好<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="留言板"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->留言板<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="友链"><!--[--><span class="font-icon icon iconfont icon-link" style=""></span><!--]-->友链<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://foreverblog.cn/go.html" title="穿梭虫洞-随机访问十年之约友链博客" target="_blank" rel="noopener noreferrer" aria-label="wormhole"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M644.608 665.6c192.512-171.008 342.016-395.776 254.464-494.592-27.648-31.232-66.56-45.568-108.032-41.472-34.816 3.584-70.656 20.992-107.008 50.176-116.224-59.904-254.464-55.296-366.592 11.776-86.016 51.2-148.48 134.656-172.544 231.936-18.944 74.24-14.336 152.064 12.8 223.744-44.544 50.688-86.528 154.624-34.816 212.992 21.504 24.576 52.736 35.328 90.112 35.328 114.176-0.512 286.72-100.864 431.616-229.888z m155.648-452.608c14.848-1.536 26.624 2.56 36.352 13.824 9.728 10.752 7.168 39.936-10.752 80.896-18.944-28.672-41.984-55.296-68.096-77.824 17.92-10.752 32.256-15.872 42.496-16.896z m-598.528 517.12c18.944 27.136 40.96 51.712 66.048 73.216-43.008 12.8-72.192 11.776-81.92 1.024-8.704-10.752 0.512-45.056 15.872-74.24z m685.568-246.784c-51.2 75.264-122.368 154.112-200.704 224.256-81.408 72.192-171.008 134.656-254.464 176.64 26.112 5.632 52.224 8.704 78.848 8.704 68.096 0 135.168-18.944 194.048-53.76 124.416-73.216 195.072-211.968 182.272-355.84z m0 0" p-id="4157"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://www.travellings.cn/go.html" title="开往" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html" aria-label="Ansible"><!---->Ansible<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><!---->Centos 9 init<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/SaltStack%E5%AD%A6%E4%B9%A0.html" aria-label="SaltStack"><!---->SaltStack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Docker%E5%AD%A6%E4%B9%A0.html" aria-label="Docker"><!---->Docker<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Nginx.html" aria-label="Nginx"><!---->Nginx<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/git.html" aria-label="Git"><!---->Git<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/package-rpm.html" aria-label="rpm包制作"><!---->rpm包制作<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/%E8%A7%A3%E5%8E%8B%E7%BC%A9.html" aria-label="压缩与解压"><!---->压缩与解压<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/keepalived.html" aria-label="keepalived"><!---->keepalived<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Ansible</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://docs.lizili.online" target="_blank" rel="noopener noreferrer">z</a></span><span property="author" content="z"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-02T11:08:55.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">自动化工具</span><span class="page-category-item color8 clickable" role="navigation">linux</span><!--]--><meta property="articleSection" content="自动化工具,linux"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color0 clickable" role="navigation">ansible</span><!--]--><meta property="keywords" content="ansible"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#前言">前言</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#什么是ansible">什么是ansible?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ansible-的工作流程">ansible 的工作流程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安装ansible">安装ansible</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#配置登录">配置登录</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#定义ansible的节点清单">定义Ansible的节点清单</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#简单的远程操作">简单的远程操作</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#定义变量">定义变量</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#定义主机变量">定义主机变量</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#定义组变量">定义组变量</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#嵌套组">嵌套组</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#分离主机和组特定数据">分离主机和组特定数据</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#命令参数">命令参数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#pattern">Pattern</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#常用模块">常用模块</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#copy模块">copy模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#file模块">file模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cron模块">cron模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#group模块">group模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uesr模块">uesr模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#yum模块">yum模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#shell模块">shell模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#command模块">command模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#raw模块">raw模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#script模块">script模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#command-script-shell-raw的区别">command,script,shell,raw的区别</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#service模块">service模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ping模块">ping模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#get-url">get_url</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stat模块">stat模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#template模块">template模块</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#模块参数">模块参数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#模块参数案例">模块参数案例</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#更多模块">更多模块</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#playbook的配置和使用">playbook的配置和使用</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#官网demo说明">官网demo说明</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#脚本实例">脚本实例</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#给脚本添加service的调用">给脚本添加service的调用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#给脚本添加copy模块的调用">给脚本添加copy模块的调用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#template模板-支持jinja2">template模板（支持jinja2）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#执行外部命令的模块">执行外部命令的模块</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#变量功能">变量功能</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#facts">facts</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#自定义变量">自定义变量</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#在操作主机定义变量-来控制client">在操作主机定义变量，来控制client</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#注册变量">注册变量</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#语句">语句</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#条件语句">条件语句</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#when">when</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#循环语句">循环语句</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#循环元素支持列表">循环元素支持列表</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#handlers-和-include">handlers 和 include</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#roles-使用">roles 使用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ansible和saltstack的对比">ansible和saltstack的对比</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><div class="hint-container caution"><p class="hint-container-title">请注意</p><p>本文内容可能已过时，请自行甄别。</p></div><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p><strong>Ansible is Simple IT Automation——简单的自动化IT工具，可以实现 批量系统配置、批量程序部署、批量运行命令等功能，简而言之，就是</strong> <span style="color:red;"><strong>分布式集中管理工具</strong></span>， <strong>通俗的讲就是批量在远端服务器上执行命令。其实，ansible自身不具备部署能力的，只是提供框架，其核心为模块</strong></p><!--more--><h2 id="什么是ansible" tabindex="-1"><a class="header-anchor" href="#什么是ansible"><span>什么是ansible?</span></a></h2><figure><img src="/assets/2511748-ee48dcc8af53cf00-BwKWT13U.jpg" alt="ansible架构" tabindex="0" loading="lazy"><figcaption>ansible架构</figcaption></figure><table><thead><tr><th style="text-align:left;">五大部分</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">connection plugins</td><td style="text-align:left;">远程连接插件</td></tr><tr><td style="text-align:left;">hosts</td><td style="text-align:left;">定义管理主机或主机组</td></tr><tr><td style="text-align:left;">modules</td><td style="text-align:left;">包含各个核心模块及自定义模块</td></tr><tr><td style="text-align:left;">Plugin</td><td style="text-align:left;">完成模块功能的补充，如日志插件、邮件插件等</td></tr><tr><td style="text-align:left;">Playbook</td><td style="text-align:left;">ansible的任务配置文件，将多个任务定义在剧本中进行管理</td></tr></tbody></table><h2 id="ansible-的工作流程" tabindex="-1"><a class="header-anchor" href="#ansible-的工作流程"><span>ansible 的工作流程</span></a></h2><p><img src="/assets/2511748-1001b5832ebba246-Dnh71AMI.jpg" alt="ansible流程" loading="lazy"><br> ​</p><p>​</p><h2 id="安装ansible" tabindex="-1"><a class="header-anchor" href="#安装ansible"><span>安装ansible</span></a></h2><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#配置源  ansible默认不在yum仓库中</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -iUvh</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel//7/x86_64/e/epel-release-7-9.noarch.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#此源主要是为了安装PyYAML</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mv</span><span style="color:#98C379;--shiki-dark:#98C379;"> CentOS7-Base-163.repo</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/yum.repos.d/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> ansible</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可查看当前ansible版本</span></span></code></pre></div><h2 id="配置登录" tabindex="-1"><a class="header-anchor" href="#配置登录"><span>配置登录</span></a></h2><blockquote><p>ansible 使用ssh登录，所以主奴之间要配置密钥进行认证，这样才能开始正常工作</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ssh-keygen</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span><span style="color:#98C379;--shiki-dark:#98C379;"> rsa</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #回车</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#将会生成密钥/root/.ssh/id_rsa.pub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ssh-copy-id</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -i</span><span style="color:#98C379;--shiki-dark:#98C379;"> root@ipaddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#公钥将会被cp到各个ipaddress节点</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#至此 已经实现了master与各节点的连接</span></span></code></pre></div><h2 id="定义ansible的节点清单" tabindex="-1"><a class="header-anchor" href="#定义ansible的节点清单"><span>定义Ansible的节点清单</span></a></h2><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>vim /etc/ansible/hosts</span></span>
<span class="line"><span>[testgroup]-----#服务器组的名字，方便统一管理，划分和命名要有规划</span></span>
<span class="line"><span>192.168.1.XX----#组内节点的地址</span></span>
<span class="line"><span>192.168.1.XXX</span></span>
<span class="line"><span>等等</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[websever]</span></span>
<span class="line"><span>....</span></span>
<span class="line"><span>[DBserver]</span></span>
<span class="line"><span>....</span></span></code></pre></div><h2 id="简单的远程操作" tabindex="-1"><a class="header-anchor" href="#简单的远程操作"><span>简单的远程操作</span></a></h2><p><strong>通过执行who，查看服务器登录信息</strong></p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> testgroup</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #组</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 所有</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> 192.168.1.XX</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;who&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #单个ip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#E06C75;--shiki-dark:#E06C75;">rc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     :0</span><span style="color:#98C379;--shiki-dark:#98C379;">           2017-02-15</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:33</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/0</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-02-15</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:34</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/1</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-02-18</span><span style="color:#98C379;--shiki-dark:#98C379;"> 13:08</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (192.168.247.1)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/2</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-03-07</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:52</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (:0)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#98C379;--shiki-dark:#98C379;">     pts/3</span><span style="color:#98C379;--shiki-dark:#98C379;">        2017-03-07</span><span style="color:#98C379;--shiki-dark:#98C379;"> 22:54</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (192.168.247.156)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 以ashin用户身份ping .134</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.1.134</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> zili</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 以用户zili身份使用sudo来ping 组testgroup</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -K是输入root密码</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> v1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> zili</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -K</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="定义变量" tabindex="-1"><a class="header-anchor" href="#定义变量"><span>定义变量</span></a></h2><h3 id="定义主机变量" tabindex="-1"><a class="header-anchor" href="#定义主机变量"><span>定义主机变量</span></a></h3><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    192.168.247.152  http_port=80</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ...............  http_port=303</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #组名以及ip根本自己需求定义</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #主机指定变量，以便后面供palybooks配置使用。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #定义两台web服务器的apache参数http_port，可以让两台服务器产生的apache配置文件httpd.conf差异化</span></span></code></pre></div><h3 id="定义组变量" tabindex="-1"><a class="header-anchor" href="#定义组变量"><span>定义组变量</span></a></h3><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web:vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    http_port=80</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #组变量的作用域是覆盖组所有成员，通过定义一个新块，块名由组名+ &quot;:vars&quot;组成。</span></span></code></pre></div><h3 id="嵌套组" tabindex="-1"><a class="header-anchor" href="#嵌套组"><span>嵌套组</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">web</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    192.168.247.152</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">nested：children</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    web</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    mysql</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    [</span><span style="color:#98C379;--shiki-dark:#98C379;">nested：vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    ntp_server=s1b.time.edu.cn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">嵌套组定义一个新块，块名由 组名+&quot;:chilren&quot; 组成。</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">同是嵌套组也可以定义组变量，作用域是嵌套组里的所有组,</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">嵌套组只能在/usr/bin/ansible-playbook中，</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">在/usr/bin/ansible中不起作用，下面会介绍playbook</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="分离主机和组特定数据" tabindex="-1"><a class="header-anchor" href="#分离主机和组特定数据"><span>分离主机和组特定数据</span></a></h3><blockquote><p>为更好的规范定义的<strong>主机与组变量</strong>，我们实际是不会在hosts里直接写的var，将定义的主机名与组变量单独剥离出来放到指定的文件中，将采用YAML格式存放<br> 全局的变量放在group_vars/all中，局部变量放在group_vars/x中，特定的host使用特定的变量可以使用host_vars/x，子group中的变量会覆盖上级变量，hosts变量总是覆盖groups变量<br> 存放位置规定：&quot;/etc/ansible/group_vars/名&quot;和&quot;/etc/ansible/host_vars/主机名&quot;分别存放指定组名或主机名定义的变量，如<br><code>/etc/ansible/group\_vars/mysql.yml</code><br><code>/etc/ansible/host\_vars/192.168.11.1.yml</code><br> 使用变量要用jinja语法去引用</p></blockquote><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">cat mysql.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   ---</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ntp_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">s1b.time.edu.cn</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    database_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">规范变量名字，是因为，ansible会自动加载这目录下的变量，</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">否则无法调用，当然也有解决不放此目录的方法</span></span></code></pre></div><p>例如</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master ansible]# tree</span></span>
<span class="line"><span>├── create_user.yml</span></span>
<span class="line"><span>├── group_vars</span></span>
<span class="line"><span>│   └── t1.yml</span></span>
<span class="line"><span>├── hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat hosts</span></span>
<span class="line"><span>[t1]</span></span>
<span class="line"><span>10.1.27.24</span></span>
<span class="line"><span></span></span>
<span class="line"><span>所以</span></span>
<span class="line"><span>├── group_vars</span></span>
<span class="line"><span>│   └── t1.yml  #他的内容就是t1的变量</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat group_vars/t1.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>user: ansibleTest1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master ansible]# cat create_user.yml </span></span>
<span class="line"><span># create user</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- name: create user</span></span>
<span class="line"><span>  hosts: t1</span></span>
<span class="line"><span>  user: root</span></span>
<span class="line"><span>  tasks:</span></span>
<span class="line"><span>  - name: useradd {{ user }}  #引用t1变量</span></span>
<span class="line"><span>    user: name=&quot;{{ user }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>返回结果如下</span></span>
<span class="line"><span>[root@master ansible]# ansible-playbook create_user.yml </span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY [create user] ***********************************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [Gathering Facts] *******************************************************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [useradd ansibleTest1] **************************************************************************************************</span></span>
<span class="line"><span>changed: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY RECAP *******************************************************************************************************************</span></span>
<span class="line"><span>10.1.27.24                 : ok=2    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="命令参数" tabindex="-1"><a class="header-anchor" href="#命令参数"><span>命令参数</span></a></h2><blockquote><p>ansible &lt; host-pattern &gt; [ options ]</p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-m</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_NAME,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --module-name=MODULE_NAME</span><span style="color:#98C379;--shiki-dark:#98C379;">     要执行的模块，默认为</span><span style="color:#98C379;--shiki-dark:#98C379;"> command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-a</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_ARGS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --args=MODULE_ARGS</span><span style="color:#98C379;--shiki-dark:#98C379;">      模块的参数</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-u</span><span style="color:#98C379;--shiki-dark:#98C379;"> REMOTE_USER,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --user=REMOTE_USER</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="color:#98C379;--shiki-dark:#98C379;">      连接的用户名，默认用</span><span style="color:#98C379;--shiki-dark:#98C379;"> root，ansible.cfg</span><span style="color:#98C379;--shiki-dark:#98C379;"> 中可以配置</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-k,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --ask-pass</span><span style="color:#98C379;--shiki-dark:#98C379;">      提示输入</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> 登录密码，当使用密码验证登录的时候用</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-s,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo</span><span style="color:#98C379;--shiki-dark:#98C379;">      sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> 运行</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-U</span><span style="color:#98C379;--shiki-dark:#98C379;"> SUDO_USER,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --sudo-user=SUDO_USER</span><span style="color:#98C379;--shiki-dark:#98C379;">     sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> 到哪个用户，默认为</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-K,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --ask-sudo-pass</span><span style="color:#98C379;--shiki-dark:#98C379;">     提示输入</span><span style="color:#98C379;--shiki-dark:#98C379;"> sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> 密码，当不是</span><span style="color:#98C379;--shiki-dark:#98C379;"> NOPASSWD</span><span style="color:#98C379;--shiki-dark:#98C379;"> 模式时使用</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-B</span><span style="color:#98C379;--shiki-dark:#98C379;"> SECONDS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --background=SECONDS</span><span style="color:#98C379;--shiki-dark:#98C379;">       run</span><span style="color:#98C379;--shiki-dark:#98C379;"> asynchronously,</span><span style="color:#98C379;--shiki-dark:#98C379;"> failing</span><span style="color:#98C379;--shiki-dark:#98C379;"> after</span><span style="color:#98C379;--shiki-dark:#98C379;"> X</span><span style="color:#98C379;--shiki-dark:#98C379;"> seconds</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">default</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">N/A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-P</span><span style="color:#98C379;--shiki-dark:#98C379;"> POLL_INTERVAL,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --poll=POLL_INTERVAL</span><span style="color:#98C379;--shiki-dark:#98C379;">      set</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> poll</span><span style="color:#98C379;--shiki-dark:#98C379;"> interval</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (default=15)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-C,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --check</span><span style="color:#98C379;--shiki-dark:#98C379;">     只是测试一下会改变什么内容，不会真正去执行</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-c</span><span style="color:#98C379;--shiki-dark:#98C379;"> CONNECTION</span><span style="color:#98C379;--shiki-dark:#98C379;">   连接类型</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;">default</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">smart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-f</span><span style="color:#98C379;--shiki-dark:#98C379;"> FORKS,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --forks=FORKS</span><span style="color:#98C379;--shiki-dark:#98C379;">     fork</span><span style="color:#98C379;--shiki-dark:#98C379;"> 多少个进程并发处理，默认</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-i</span><span style="color:#98C379;--shiki-dark:#98C379;"> INVENTORY,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --inventory-file=INVENTORY</span><span style="color:#98C379;--shiki-dark:#98C379;">      指定hosts文件路径默认</span><span style="color:#98C379;--shiki-dark:#98C379;"> default</span><span style="color:#98C379;--shiki-dark:#98C379;"> =/etc/ansible/hosts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-l</span><span style="color:#98C379;--shiki-dark:#98C379;"> SUBSET,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --limit=SUBSET</span><span style="color:#98C379;--shiki-dark:#98C379;">       指定一个</span><span style="color:#98C379;--shiki-dark:#98C379;"> pattern，对</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">host_patter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">n&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">已经匹配的主机中再过滤一次</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">--list-hosts</span><span style="color:#98C379;--shiki-dark:#98C379;">        只打印有哪些主机会执行这个</span><span style="color:#98C379;--shiki-dark:#98C379;"> playbook</span><span style="color:#98C379;--shiki-dark:#98C379;"> 文件：不是实际执行该</span><span style="color:#98C379;--shiki-dark:#98C379;"> playbook</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-M</span><span style="color:#98C379;--shiki-dark:#98C379;"> MODULE_PATH,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --module-path=MODULE_PATH</span><span style="color:#98C379;--shiki-dark:#98C379;">       要执行的模块的路径，默认为/usr/share/ansible/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-o,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --one-line</span><span style="color:#98C379;--shiki-dark:#98C379;">      压缩输出，摘要输出</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">--private-key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">PRIVATE_KEY_FILE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      私钥路径</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-T</span><span style="color:#98C379;--shiki-dark:#98C379;"> TIMEOUT,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --timeout=TIMEOUT</span><span style="color:#98C379;--shiki-dark:#98C379;">   ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> 连接超时时间，默认</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#98C379;--shiki-dark:#98C379;"> 秒</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-t</span><span style="color:#98C379;--shiki-dark:#98C379;"> TREE,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --tree=TREE</span><span style="color:#98C379;--shiki-dark:#98C379;">            日志输出到该目录，日志文件名会以主机名命名</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-v,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --verbose</span><span style="color:#98C379;--shiki-dark:#98C379;">   verbose</span><span style="color:#98C379;--shiki-dark:#98C379;"> mode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (-vvv </span><span style="color:#98C379;--shiki-dark:#98C379;">for</span><span style="color:#98C379;--shiki-dark:#98C379;"> more,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -vvvv</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> enable</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> debugging</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pattern" tabindex="-1"><a class="header-anchor" href="#pattern"><span>Pattern</span></a></h2><p>可以直接指定ip或hosts中的组名，同时指定多个组或者多个<code>ip</code>使用<code>:</code>分割</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible group1:group2 -m ping</span></span>
<span class="line"><span>ansible ip1:ip2 -m ping</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#all  或者 *  代表全部</span></span>
<span class="line"><span>ansible all -m ping</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 感叹号 ! 表示非</span></span>
<span class="line"><span>g1:!g2   #表示在g1分组中，但是不在g2中的hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span># &amp;符号表示交集</span></span>
<span class="line"><span>g1:&amp;g2  #表示在g1分组中，也在g2中的hosts</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#使用下标</span></span>
<span class="line"><span>g1[2]  #组的第三个</span></span>
<span class="line"><span>g1[0:3] #组的前四个</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常用模块" tabindex="-1"><a class="header-anchor" href="#常用模块"><span>常用模块</span></a></h2><h3 id="copy模块" tabindex="-1"><a class="header-anchor" href="#copy模块"><span>copy模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：把主控端/root目录下的a.sh文件拷贝到到指定节点上</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> copy</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;src=/root/a.sh dest=/tmp/ owner=root group=root mode=0755&#39;</span></span></code></pre></div><h3 id="file模块" tabindex="-1"><a class="header-anchor" href="#file模块"><span>file模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：更改指定节点上/tmp/t.sh的权限为755，属主和属组为root</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;dest=/tmp/t.sh mode=755 owner=root group=root&quot;</span></span></code></pre></div><h3 id="cron模块" tabindex="-1"><a class="header-anchor" href="#cron模块"><span>cron模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    目的：在指定节点上定义一个计划任务，每隔3分钟到主控端更新一次时间</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> cron</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=&quot;custom job&quot; minute=*/3 hour=* day=* month=* weekday=* job=&quot;/usr/sbin/ntpdate 192.168.247.152&quot;&#39;</span></span></code></pre></div><h3 id="group模块" tabindex="-1"><a class="header-anchor" href="#group模块"><span>group模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在所有节点上创建一个组名为nolinux，gid为2014的组</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> group</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;gid=2014 name=nolinux&#39;</span></span></code></pre></div><h3 id="uesr模块" tabindex="-1"><a class="header-anchor" href="#uesr模块"><span>uesr模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在所有节点上创建一个用户名为nolinux，组为nolinux的用户</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=nolinux groups=nolinux state=present&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">删除用户</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=nolinux state=absent remove=yes&#39;</span></span></code></pre></div><h3 id="yum模块" tabindex="-1"><a class="header-anchor" href="#yum模块"><span>yum模块</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在指定节点上安装</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#98C379;--shiki-dark:#98C379;"> 服务</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;state=present name=httpd&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#state=latest 安装最新版本</span></span></code></pre></div><h3 id="shell模块" tabindex="-1"><a class="header-anchor" href="#shell模块"><span>shell模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在指定节点上安装</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#98C379;--shiki-dark:#98C379;"> 服务</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#98C379;--shiki-dark:#98C379;"> testgroup</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;yum -y install httpd&#39;</span></span></code></pre></div><h3 id="command模块" tabindex="-1"><a class="header-anchor" href="#command模块"><span>command模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：在指定节点上运行hostname命令</span></span>
<span class="line"><span>命令：ansible 192.168.247.152 -m command -a &#39;hostname&#39;</span></span></code></pre></div><h3 id="raw模块" tabindex="-1"><a class="header-anchor" href="#raw模块"><span>raw模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：在192.168.247.152节点上运行ifconfig命令</span></span>
<span class="line"><span>命令：ansible 192.168.247.152 -m raw-a &#39;ifconfig|eth0&#39;</span></span></code></pre></div><h3 id="script模块" tabindex="-1"><a class="header-anchor" href="#script模块"><span>script模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：在指定节点上执行/root/a.sh脚本(该脚本是在ansible主控端</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10.1.1.113</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> script</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;/root/a.sh&#39;</span></span></code></pre></div><h3 id="command-script-shell-raw的区别" tabindex="-1"><a class="header-anchor" href="#command-script-shell-raw的区别"><span>command,script,shell,raw的区别</span></a></h3><blockquote><p>思考：四者有何区别？</p></blockquote><p>command模块 [执行远程命令]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m command -a &quot;uname -n&quot; -s</span></span></code></pre></div><p>script模块 [在远程主机执行主控端的shell/python脚本]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m script -a &quot;/soft/ntpdate.py&quot; -s</span></span></code></pre></div><p>shell模块 [执行远程主机的shell/python脚本]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m shell -a &quot;/soft/file.py&quot; -s</span></span></code></pre></div><p>raw模块 [类似于command模块、支持管道传递]</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ansible client -m raw -a &quot;ifconfig eth0|sed -n 2p|awk &#39;{print \$2}&#39;&quot; -s</span></span></code></pre></div><h3 id="service模块" tabindex="-1"><a class="header-anchor" href="#service模块"><span>service模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：启动指定节点上的</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span><span style="color:#98C379;--shiki-dark:#98C379;"> 服务，并让其开机自启动</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> service</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;name=httpd state=restarted enabled=yes&#39;</span></span></code></pre></div><h3 id="ping模块" tabindex="-1"><a class="header-anchor" href="#ping模块"><span>ping模块</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">目的：检查指定节点机器是否还能连通</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">命令：ansible</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -m</span><span style="color:#98C379;--shiki-dark:#98C379;"> ping</span></span></code></pre></div><h3 id="get-url" tabindex="-1"><a class="header-anchor" href="#get-url"><span>get_url</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：下载百度下的图标文件到节点的/tmp文件下</span></span>
<span class="line"><span>命令：ansible testgroup -m get_url -a &#39;url=https://www.baidu.com/favicon dest=/tmp&#39;</span></span>
<span class="line"><span>#结果为error.html，但是证明了模块是可用的</span></span></code></pre></div><h3 id="stat模块" tabindex="-1"><a class="header-anchor" href="#stat模块"><span>stat模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>目的：获取远程文件状态信息，包括atime、ctime、mtime、md5、uid、gid等信息</span></span>
<span class="line"><span>ansible web -m stat -a &#39;path=/etc/sysctl.conf&#39;</span></span></code></pre></div><h3 id="template模块" tabindex="-1"><a class="header-anchor" href="#template模块"><span>template模块</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>template使用了Jinja2格式作为文件模版，进行文档内变量的替换的模块。它的每次使用都会被ansible标记为”changed”状态。</span></span></code></pre></div><h2 id="模块参数" tabindex="-1"><a class="header-anchor" href="#模块参数"><span>模块参数</span></a></h2><table><thead><tr><th>参数名</th><th>是否必须</th><th>默认值</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>backup</td><td>no</td><td>no</td><td>yes/no</td><td>建立个包括timestamp在内的文件备份，以备不时之需.</td></tr><tr><td>dest</td><td>yes</td><td></td><td></td><td>远程节点上的绝对路径，用于放置template文件。</td></tr><tr><td>group</td><td>no</td><td></td><td></td><td>设置远程节点上的的template文件的所属用户组</td></tr><tr><td>mode</td><td>no</td><td></td><td></td><td>设置远程节点上的template文件权限。类似<a href="http://www.2cto.com/os/linux/" target="_blank" rel="noopener noreferrer">Linux</a>中<em>chmod</em>的用法</td></tr><tr><td>owner</td><td>no</td><td></td><td></td><td>设置远程节点上的template文件所属用户</td></tr><tr><td>src</td><td>yes</td><td></td><td></td><td>本地Jinjia2模版的template文件位置</td></tr></tbody></table><h2 id="模块参数案例" tabindex="-1"><a class="header-anchor" href="#模块参数案例"><span>模块参数案例</span></a></h2><p>把/mytemplates/foo.j2文件经过填写参数后，复制到远程节点的/etc/file.conf，文件权限相关略过</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span> - template: src=/mytemplates/foo.j2 dest=/etc/file.conf owner=bin group=wheel mode=0644</span></span></code></pre></div><p>跟上面一样的效果，不一样的文件权限设置方式</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span> - template: src=/mytemplates/foo.j2 dest=/etc/file.conf owner=bin group=wheel mode=&quot;u=rw,g=r,o=r&quot;</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#详细说明 </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">roles/templates/server.xml中的template文件关键部分如下：</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;user </span><span style="color:#E06C75;--shiki-dark:#E06C75;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;{{ admin_username }}&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;{{ admin_password }}&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> roles</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;manager-gui&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> /</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#当这个文件还没被template执行的时候，本地的admin_username及admin_password 都是变量状态。 </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#当playbook执行完template的时候，远程的admin_username*及admin_password 会变成变量所对应的值。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#例 </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#前面的那个Playbook,如果我们在tomcat-servers设置了这两个变量如下：</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">dmin_username:</span><span style="color:#98C379;--shiki-dark:#98C379;"> admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">admin_password:</span><span style="color:#98C379;--shiki-dark:#98C379;"> adminsecret</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#那么在执行这个Playbook前，对应的那个template文件（俗称模版），</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">将在本地保持{{ admin_username }}及{{ admin_password }}的状态。</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">在Ansible调用template模版执行的时候，这里将由Jinjia2从”tomcat-servers”读取对应的值，</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">然后替换掉模版里的变量，然后把这个替换变量值后的文件拷贝到远程节点。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这个就是template的意义所在。</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="更多模块" tabindex="-1"><a class="header-anchor" href="#更多模块"><span>更多模块</span></a></h3><p>ansible-doc -l 查询</p><hr><h2 id="playbook的配置和使用" tabindex="-1"><a class="header-anchor" href="#playbook的配置和使用"><span>playbook的配置和使用</span></a></h2><p>配置文件后缀名为.yml</p><h3 id="官网demo说明" tabindex="-1"><a class="header-anchor" href="#官网demo说明"><span>官网demo说明</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这个是你选择的主机</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">webservers</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这个是变量</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    http_port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    max_clients</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">200</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#远端的执行权限</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#利用yum模块来操作</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure apache is at the latest version</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    yum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">pkg=httpd state=latest</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the apache config file</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/srv/httpd.j2 dest=/etc/httpd.conf</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#触发重启服务器</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">restart apache</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure apache is running</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=started</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#这里的restart apache 和上面的触发是配对的。这就是handlers的作用。相当于tag</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  handlers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">restart apache</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=restarted</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#有的系统做了sudo限制，所以需要在playbook中开启权限，如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">vic</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=nginx state=started</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      sudo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">yes</span></span></code></pre></div><h3 id="脚本实例" tabindex="-1"><a class="header-anchor" href="#脚本实例"><span>脚本实例</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  ##facts可以调用client的变量来使用，后面变量里会详细介绍</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=&quot;{{ user }}&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest1] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=1    changed=0    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="给脚本添加service的调用" tabindex="-1"><a class="header-anchor" href="#给脚本添加service的调用"><span>给脚本添加service的调用</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #返回结果如下 </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到 TASK [service]显示已经开启了</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [service] *****************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="给脚本添加copy模块的调用" tabindex="-1"><a class="header-anchor" href="#给脚本添加copy模块的调用"><span>给脚本添加copy模块的调用</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了copy服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #返回结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] ************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] *******************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [service] ****************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到 TASK [copy file to clent]已成功</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to clent] *****************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP ********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=3    changed=1    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>copy传送的时候，可能报错</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>afewbug | FAILED &gt;&gt; {</span></span>
<span class="line"><span>    &quot;checksum&quot;: &quot;4ee72f7427050dcd97068734d35ca7b2c651bc88&quot;, </span></span>
<span class="line"><span>    &quot;failed&quot;: true, </span></span>
<span class="line"><span>    &quot;msg&quot;: &quot;Aborting, target uses selinux but python bindings (libselinux-python) aren‘t installed!&quot;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>是因为ansible需要libselinux-python包。（被控端需要安装libselinux-python**）  </span></span>
<span class="line"><span>可以在copy前先调用yum模块，安装libselinux-python</span></span></code></pre></div><h2 id="template模板-支持jinja2" tabindex="-1"><a class="header-anchor" href="#template模板-支持jinja2"><span>template模板（支持jinja2）</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">temp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了copy服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}变量来自vars</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了template模板使用</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [start httpd] *************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to clent] ******************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到 返回结果显示成功，去client相关目录即可看到文件</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=4    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#template模块可以引用变量到源文件</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">/tmp/temp</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{user}}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{temp}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#执行yml后</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m command -a &#39;cat /tmp/temptest&#39;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##client返回的就是主机源文件中引入的变量</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">usertest1</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="执行外部命令的模块" tabindex="-1"><a class="header-anchor" href="#执行外部命令的模块"><span>执行外部命令的模块</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  vars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;usertest1&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">temp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">temptest</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create {{ user }}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">start httpd</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=startd</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #添加了httpd服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">Copy file to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/test.test dest=/tmp/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了copy服务的开启</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}变量来自vars</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #添加了template模板使用</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">run shell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/bin/ls /tmp/ || /bin/true</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #/bin/true 防中断</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">run  command</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">mkdir /tmp/command-test</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #添加了两个执行外部命令模块shell和command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [create usertest2] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [start httpd] *************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [copy file to client] *****************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [shell~] ******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [run this command] ********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="color:#98C379;--shiki-dark:#98C379;">WARNING</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]: </span><span style="color:#98C379;--shiki-dark:#98C379;">Consider using file module with state=directory rather than running</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">mkdir</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=6    changed=4    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#1./usr/bin/...||/bin/true  前面失败的话/bin/true：返回true。防止中断，继续执行。类似的判断还有chenge_when参数</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="变量功能" tabindex="-1"><a class="header-anchor" href="#变量功能"><span>变量功能</span></a></h2><h3 id="facts" tabindex="-1"><a class="header-anchor" href="#facts"><span>facts</span></a></h3><blockquote><p>一个常用的组件，可实现对远程自己系统信息的获取，比如：主机名，IP地址，操作系统，分区情况，硬件信息等，配合playbook使用，更加的灵活和个性化定制</p></blockquote><p><code>ansible ip/group -m setup</code>可以获取clients的facts信息</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> testgroup -m setup</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    &quot;ansible_facts&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_all_ipv4_addresses&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;192.168.122.1&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;192.168.247.152&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_all_ipv6_addresses&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            &quot;fe80::20c:29ff:feb5:6e6&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_architecture&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;x86_64&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_bios_date&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;07/02/2015&quot;,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        &quot;ansible_bios_version&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;6.00&quot;,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        ......</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>脚本中开启Facts功能</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #开启facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/{{temp}}</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #{{temp}}变量来自vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#返回结果，</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#查看</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m raw -a &quot;ls /tmp | grep 192*&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.122.1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.247.152&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Shared connection to 192.168.247.152 closed.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#IP地址有两个所以文件名很奇怪</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>当然，我们也可以在主机的/tmp/temp下调用facts变量</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#修改/tmp/temp文件</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">{{ansible_all_ipv4_addresses}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#create_user.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create user</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #开启facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">template test</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/tmp/temp dest=/tmp/factstest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#结果如下</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY [create user] *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">ok</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">TASK [template test] ***********************************************************</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">changed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">PLAY RECAP *********************************************************************</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            : </span><span style="color:#98C379;--shiki-dark:#98C379;">ok=2    changed=1    unreachable=0    failed=0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#98C379;--shiki-dark:#98C379;">$ansible testgroup -m raw -a &quot;cat /tmp/factstest&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">192.168.247.152 | SUCCESS | rc=0 &gt;&gt;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.122.1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">u&#39;192.168.247.152&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Shared connection to 192.168.247.152 closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自定义变量" tabindex="-1"><a class="header-anchor" href="#自定义变量"><span>自定义变量</span></a></h3><blockquote><p>如何facts的变量并不能满足需求的，就可以自定义facts模板来实现</p><p>另外可以通过本地facts来实现，只需在client的/etc/ansible/facts.d目录定义JSON,INI或可执行的JSON输出，后缀名一定要用.fact，那么这些文件就可以作为本地的facts</p></blockquote><p>##在client定义变量，供ansible主机使用</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 ~]# mkdir /etc/ansible/facts.d -p</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 ~]# cd /etc/ansible/facts.d/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@test1 facts.d]# cat client.fact</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[general]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">zili</span></span></code></pre></div><p><strong>ansible主机</strong></p><div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">root/ansible_yml</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]$ansible </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -m setup -a </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;filter=ansible_local&quot;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">247.152</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | SUCCESS =&gt; {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;ansible_facts&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        &quot;ansible_local&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {      </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#本地facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            &quot;client&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {       </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#文件名</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                &quot;general&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {       </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">#节点名</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    &quot;name&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;zili&quot;</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">    #key-value</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    &quot;changed&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>那么就可以通过如下方式去调用自定义的facts变量</strong></p><p><code>{{ansible_local.client.general.name}}</code></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook create_user.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [create </span><span style="color:#98C379;--shiki-dark:#98C379;">user]</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [template </span><span style="color:#98C379;--shiki-dark:#98C379;">test]</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ***********************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">changed:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#调用成功，并可看到client内容已变化</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> testgroup -m raw -a </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cat /tmp/factstest2&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          192.168.247.152 | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUCCESS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#E06C75;--shiki-dark:#E06C75;">rc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zili</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Shared</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;"> closed.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="在操作主机定义变量-来控制client" tabindex="-1"><a class="header-anchor" href="#在操作主机定义变量-来控制client"><span>在操作主机定义变量，来控制client</span></a></h2><p>思路就是在执行playbook的时候将本地的facts推送到client相关目录下</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">create directory for ansible custom facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">state=directory recurse=yes path=/etc/ansible/facts.d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">install custom facts</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/etc/ansible/host.fact dest=/etc/ansible/facts.d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">re-read facts after adding custom fact</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        setup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">filter=ansible_local</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #如此相当于批量在client创建了facts变量</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #然后就可以主机调用了!</span></span></code></pre></div><h3 id="注册变量" tabindex="-1"><a class="header-anchor" href="#注册变量"><span>注册变量</span></a></h3><blockquote><p>变量可以将一条命令的返回值进行保存，然后提供给playbook使用</p></blockquote><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#98C379;--shiki-dark:#98C379;">root@ansible ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]# </span><span style="color:#98C379;--shiki-dark:#98C379;">cat user1.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/bin/foo</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">z</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #注册了一个foo\_resul变量，变量值为shell: /usr/bin/foo的运行结果;  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ignore_errors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #ignore\_errors: True为忽略错误</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">shell</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">touch /tmp/LLL</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #当变量注册完成后，就可以在后面的playbook中使用了</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">z.rc == 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#当条件语句when: z.rc == 5成立时，shell: touch /tmp/LLL命令才会执行</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#可以注意到command是skipping的。因为返回值是127，所以client肯定还是没有创建LLL的</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook user1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [testgroup] ***************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]: FAILED! </span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{&quot;changed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cmd&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/usr/bin/foo&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;delta&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;0:00:00.003488&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;end&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:08:45.996549&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;failed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;rc&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 127,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;start&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:08:45.993061&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stderr&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/bin/sh: /usr/bin/foo: No such file or directory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout_lines&quot;:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [], </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;warnings&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: []}</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">..</span><span style="color:#98C379;--shiki-dark:#98C379;">.ignoring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">skipping:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##所以我门修改z.rc的返回值为127在执行</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#以为返回值是对的，所以执行了touch，warning是友情提示，最好用线管模块进行文件的操作</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$ansible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-playbook user1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [testgroup] ***************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [setup] *******************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ok:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fatal:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]: FAILED! </span><span style="color:#98C379;--shiki-dark:#98C379;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">{&quot;changed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cmd&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/usr/bin/foo&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;delta&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;0:00:00.003539&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;end&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:11:01.955975&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;failed&quot;:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#98C379;--shiki-dark:#98C379;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;rc&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 127,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;start&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;2017-03-11 13:11:01.952436&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stderr&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;/bin/sh: /usr/bin/foo: No such file or directory&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout&quot;:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;&quot;,</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;stdout_lines&quot;:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [], </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;warnings&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: []}</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">..</span><span style="color:#98C379;--shiki-dark:#98C379;">.ignoring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">TASK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [command] *****************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">changed:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [192.168.247.152]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [WARNING]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Consider</span><span style="color:#98C379;--shiki-dark:#98C379;"> using</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#98C379;--shiki-dark:#98C379;"> module</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#98C379;--shiki-dark:#98C379;"> state=touch</span><span style="color:#98C379;--shiki-dark:#98C379;"> rather</span><span style="color:#98C379;--shiki-dark:#98C379;"> than</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span><span style="color:#98C379;--shiki-dark:#98C379;"> touch</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">PLAY</span><span style="color:#98C379;--shiki-dark:#98C379;"> RECAP</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> *********************************************************************</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">192.168.247.152</span><span style="color:#98C379;--shiki-dark:#98C379;">            :</span><span style="color:#98C379;--shiki-dark:#98C379;"> ok=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#98C379;--shiki-dark:#98C379;">    changed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#98C379;--shiki-dark:#98C379;">    unreachable=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#98C379;--shiki-dark:#98C379;">    failed=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/ansible_yml] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="语句" tabindex="-1"><a class="header-anchor" href="#语句"><span>语句</span></a></h2><h3 id="条件语句" tabindex="-1"><a class="header-anchor" href="#条件语句"><span>条件语句</span></a></h3><blockquote><p>playbook的执行结果取决于变量，不管是facts还是tasks结果赋值的，而变量的值可以依赖于其他变量，当然一会印象ansible的执行</p><p>有时候我们，想要跳过某些主机的执行步骤，比如，某些client不安装某个软件包，不清理垃圾等等</p><p>就要使用判断了</p></blockquote><h2 id="when" tabindex="-1"><a class="header-anchor" href="#when"><span>when</span></a></h2><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">when</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">shutdown centos</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/sbin/shutdown -t now</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ansible_hostname == &#39;test1&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#when返回bool值，为true是执行，false则不执行</span></span></code></pre></div><p><strong>when 针对不同分支的二级处理</strong></p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">when</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">web</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/sbin/ip a</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    ignore_errors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/something</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|failed</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/something_else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|success</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">command</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/bin/still/something_else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    when</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">result|skipped</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># when: result|success&quot;的意思为当变量result执行结果为成功</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#将执行/bin/something_else命令，其他同理。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#其中success为Ansible内部过滤器方法，返回True代表命令运行成功。</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="循环语句" tabindex="-1"><a class="header-anchor" href="#循环语句"><span>循环语句</span></a></h3><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ item }} state=present groups=wheel</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    with_items</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">tiger1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">tiger2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#创建用户的。with_items会自动循环执行上面的语句&quot;user: name={{ item }} state=present groups=wheel&quot;，循环的次数为with_items的元素个数。这里有2个元素，分别为tiger1、tiger2，会分别替换{{ item }}项</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#等同于</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user tiger1&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=tiger1 state=present groups=wheel</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;add user tiger2&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=tiger2 state=present groups=wheel</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="循环元素支持列表" tabindex="-1"><a class="header-anchor" href="#循环元素支持列表"><span>循环元素支持列表</span></a></h2><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#首先定义好列表 list.yml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">packages_base</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - [ </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;vsftpd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;vim&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">packages_apps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - [[ </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;mysql&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">httpd&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ]]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#然后引入使用</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">whell</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  var_files</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#98C379;--shiki-dark:#98C379;">/etc/ansible/list.yml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;install rpm&quot;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    yum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name={{ item }} state=installed</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    with_flattened</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#此语句 用来循环定义好的列表</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">packages_base</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">packages_apps</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="handlers-和-include" tabindex="-1"><a class="header-anchor" href="#handlers-和-include"><span>handlers 和 include</span></a></h3><blockquote><p>当多个playbook涉及复用的任务列表时，可以将复用的内容剥离出来，写到独立的文件里，需要的地方include进来即可</p><p>除了tasks之外，还有一个handlers的命令，handlers是在执行tasks之后服务器发生变化之后可供调用的handler</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the httpd config file</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">testgroup</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  remote_user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  gather_facts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  tasks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">write the httpd.conf to client</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    template</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">src=/httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:    </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果copy执行完之后/etc/httpd/conf/httpd.conf文件发送了变化，则执行</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#98C379;--shiki-dark:#98C379;">restart httpd</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 调用handler</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">include</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">playbook/tasks/httpd.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    handlers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">restart httpd</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #此处的标识必须和notify一样才可以引起触发</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=restarted</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #注意上面使用的- include: playbook/tasks/httpd.yml，看一下这个文件的内容</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">- </span><span style="color:#E06C75;--shiki-dark:#E06C75;">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">ensure httpd is running</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">name=httpd state=started</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>notify这个action可用于在每个play的最后被触发，这样可以避免多次有改变发生时每次都执行指定的操作，取而代之，仅在所有的变化发生完成后一次性地执行指定操作。</p><p>Handlers 是由通知者进行 notify, 如果没有被 notify,handlers 不会执行。</p><p>Handlers 最佳的应用场景是用来重启服务,或者触发系统重启操作.除此以外很少用到了。</p></blockquote><h2 id="roles-使用" tabindex="-1"><a class="header-anchor" href="#roles-使用"><span>roles 使用</span></a></h2><p>前面的所有都在一个文件内.还有一种方法可以进行更好的组织架构<br> 使用roles</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master roles]# tree</span></span>
<span class="line"><span>.</span></span>
<span class="line"><span>├── test</span></span>
<span class="line"><span>│   └── tasks</span></span>
<span class="line"><span>│       └── main.yml</span></span>
<span class="line"><span>└── test.yml</span></span>
<span class="line"><span>test.yml为入口文件,每次执行它即可.他的内容如下</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master roles]# cat test.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- hosts: all</span></span>
<span class="line"><span>  roles:</span></span>
<span class="line"><span>    - role: test</span></span>
<span class="line"><span>定义了主机/主机组,然后定义了要使用的roles,(也就是roles下的文件夹的名字)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>test文件夹下定义了tasks,内有 **main.yml**  这个命名是规定好的.必须是main</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>main.yml 书写了tasks的任务.</span></span>
<span class="line"><span>[root@master roles]# cat test/tasks/main.yml </span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>- name: test role ping</span></span>
<span class="line"><span>  ping:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master roles]#</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果如下:</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@master roles]# ansible-playbook test.yml </span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY [all] ************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [Gathering Facts] ************************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.28]</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>TASK [test : test role ping] ******************************************************************</span></span>
<span class="line"><span>ok: [10.1.27.28]</span></span>
<span class="line"><span>ok: [10.1.27.24]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLAY RECAP ************************************************************************************</span></span>
<span class="line"><span>10.1.27.24                 : ok=2    changed=0    unreachable=0    failed=0   </span></span>
<span class="line"><span>10.1.27.28                 : ok=2    changed=0    unreachable=0    failed=0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>roles有很多结构,ansible可以根据其进行解析.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>├── defaults</span></span>
<span class="line"><span>├── files</span></span>
<span class="line"><span>├── handlers</span></span>
<span class="line"><span>├── meta</span></span>
<span class="line"><span>├── tasks</span></span>
<span class="line"><span>├── templates</span></span>
<span class="line"><span>└── vars</span></span></code></pre></div><p>如果<code>roles/x/tasks/main.yml</code>存在,则自动将里面的tasks添加到play中。</p><p>如果<code>roles/x/handlers/main.yml</code>存在,则自动将里面的handlers添加到play中。</p><p>如果<code>roles/x/vars/main.yml</code>存在, 则自动将其中的variables添加到play中。</p><p>如果<code>roles/x/meta/main.yml</code>存在,则添加role的依赖关系roles中。</p><p>任何<code>copy</code>任务、<code>script</code>任务都可以引用<code>roles/x/files</code>中的文件，无论是使用绝对或相对路径都可以。</p><p>任何<code>template</code>任务都可以引用<code>roles/x/templates</code>中的文件，无论绝对或相对路径。</p><p>任何<code>include</code>任务都可以引用<code>roles/x/tasks/</code>中的文件，无论相对或绝对路径</p><p>具体可以参见文档：<a href="http://docs.ansible.com/playbooks_intro.html" target="_blank" rel="noopener noreferrer">http://docs.ansible.com/playbooks_intro.html</a></p><h2 id="ansible和saltstack的对比" tabindex="-1"><a class="header-anchor" href="#ansible和saltstack的对比"><span>ansible和saltstack的对比</span></a></h2><blockquote><p>1、salt要安装agent , ansible通过ssh连接。</p><p>2、salt在server端要启进程；ansible不需要。</p><p>3、salt与ansible都有模块，可使用任意语言开发模块。</p><p>4、salt与ansible都使用yaml语言格式编写剧本。</p><p>ansible走的是ssh,所以它有认证以及加密码的过程，使得ansible非常慢，不适用于大规模环境（指上千台）</p></blockquote><hr></div><!--[--><Sponsor></Sponsor><!--]--><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Centos 9 init<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--17c4bf36:;"><!-- <div class="busuanzi">
      <span id="busuanzi_container_site_pv" style="display: none">
        本站总访问量
        <span id="busuanzi_value_site_pv"></span>次
        <span class="post-meta-divider">|</span>
      </span>
      <span id="busuanzi_container_site_uv" style="display: none">
        您是本站第
        <span id="busuanzi_value_site_uv"></span>位访问者
      </span>
    </div> --><div class="footer-content"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2016-2024 z</div></div><span id="runtime_span"></span><div class="footer-link"><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1.gif" alt="" style="width:auto;height:32px;" title="穿梭虫洞-随机访问十年之约友链博客"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="https://www.travellings.cn/assets/logo.gif" alt="" style="width:auto;height:32px;" title="开往-友链接力"></a><!-- <a href="https://www.foreverblog.cn/" target="_blank">
        <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width: auto; height: 16px" />
      </a> --></div></footer></div><!--]--><!--[--><!----><!----><div></div><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BfCDUtKQ.js" defer></script>
  </body>
</html>
