<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://docs.lizili.online/ops/linux/Docker%E5%AD%A6%E4%B9%A0.html"><meta property="og:site_name" content="lzz's Blog"><meta property="og:title" content="Docker"><meta property="og:description" content="è¯·æ³¨æ„ æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚ Dockerä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ é•œåƒï¼ˆimageï¼‰ å®¹å™¨ï¼ˆcontainerï¼‰ ä»“åº“ï¼ˆrrepository) å®‰è£… ä¸åŒç³»ç»Ÿå®‰è£…æ–¹å¼ä¸åŒï¼Œè¯¦è§ ä»¥centosä¸ºä¾‹(ä»…æ”¯æŒ64ä½kernel >=3.10)å»ºè®®ä½¿ç”¨å›½å†…æº å¸è½½åŸæœ‰ç‰ˆæœ¬ yum remove docker docker-common docker-se..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-23T05:06:11.000Z"><meta property="article:author" content="z"><meta property="article:tag" content="docker"><meta property="article:modified_time" content="2024-04-23T05:06:11.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Docker","image":[""],"dateModified":"2024-04-23T05:06:11.000Z","author":[{"@type":"Person","name":"z","url":"https://docs.lizili.online"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?088df8f788eb6cfa86e86b04cee94211";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
        </script><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://docs.lizili.online/rss.xml" title="lzz's Blog RSS Feed"><title>Docker | lzz's Blog</title><meta name="description" content="è¯·æ³¨æ„ æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚ Dockerä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ é•œåƒï¼ˆimageï¼‰ å®¹å™¨ï¼ˆcontainerï¼‰ ä»“åº“ï¼ˆrrepository) å®‰è£… ä¸åŒç³»ç»Ÿå®‰è£…æ–¹å¼ä¸åŒï¼Œè¯¦è§ ä»¥centosä¸ºä¾‹(ä»…æ”¯æŒ64ä½kernel >=3.10)å»ºè®®ä½¿ç”¨å›½å†…æº å¸è½½åŸæœ‰ç‰ˆæœ¬ yum remove docker docker-common docker-se...">
    <link rel="preload" href="/assets/style-BWhSO6JG.css" as="style"><link rel="stylesheet" href="/assets/style-BWhSO6JG.css">
    <link rel="modulepreload" href="/assets/app-BfCDUtKQ.js"><link rel="modulepreload" href="/assets/Dockerå­¦ä¹ .html-CHMsoZlY.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">lzz&#39;s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="è¿å¼€"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span>è¿å¼€<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">è¿ç»´ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/ops/linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/GitOps/" aria-label="GitOps"><!--[--><span class="font-icon icon iconfont icon-git" style=""></span><!--]-->GitOps<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/monitor/" aria-label="Monitor"><!--[--><span class="font-icon icon iconfont icon-monitor" style=""></span><!--]-->Monitor<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å¼€å‘ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/code/" aria-label="Code"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->Code<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/ops/" aria-label="Ops"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Ops<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/script/" aria-label="Script"><!--[--><span class="font-icon icon iconfont icon-script" style=""></span><!--]-->Script<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å…¶ä»–</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/team/" aria-label="Team"><!--[--><span class="font-icon icon iconfont icon-tuandui" style=""></span><!--]-->Team<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/faq/" aria-label="FAQ"><!--[--><span class="font-icon icon iconfont icon-Faq" style=""></span><!--]-->FAQ<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="äº‘åŸç”Ÿ"><!--[--><span class="font-icon icon iconfont icon-yunyuansheng" style=""></span>äº‘åŸç”Ÿ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/kubernetes/" aria-label="kubernetes"><!--[--><span class="font-icon icon iconfont icon-kubernetes" style=""></span><!--]-->kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/backup/" aria-label="backup"><!--[--><span class="font-icon icon iconfont icon-backup" style=""></span><!--]-->backup<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/middleware/" aria-label="middleware"><!--[--><span class="font-icon icon iconfont icon-zhongjianjian" style=""></span><!--]-->middleware<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ‰‹å†Œ"><!--[--><span class="font-icon icon iconfont icon-shouce" style=""></span>æ‰‹å†Œ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/shell.html" aria-label="shell"><!--[--><span class="font-icon icon iconfont icon-shell" style=""></span><!--]-->shell<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/markdown/" aria-label="markdown"><!--[--><span class="font-icon icon iconfont icon-markdown" style=""></span><!--]-->markdown<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/vuepress/" aria-label="vuepress"><!--[--><span class="font-icon icon iconfont icon-vue" style=""></span><!--]-->vuepress<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tools/" aria-label="å·¥å…·åˆ†äº«"><!--[--><span class="font-icon icon iconfont icon-tools" style=""></span><!--]-->å·¥å…·åˆ†äº«<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/hobby/" aria-label="çˆ±å¥½"><!--[--><span class="font-icon icon iconfont icon-xingquaihao" style=""></span><!--]-->çˆ±å¥½<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="ç•™è¨€æ¿"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->ç•™è¨€æ¿<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="å‹é“¾"><!--[--><span class="font-icon icon iconfont icon-link" style=""></span><!--]-->å‹é“¾<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://foreverblog.cn/go.html" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢" target="_blank" rel="noopener noreferrer" aria-label="wormhole"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M644.608 665.6c192.512-171.008 342.016-395.776 254.464-494.592-27.648-31.232-66.56-45.568-108.032-41.472-34.816 3.584-70.656 20.992-107.008 50.176-116.224-59.904-254.464-55.296-366.592 11.776-86.016 51.2-148.48 134.656-172.544 231.936-18.944 74.24-14.336 152.064 12.8 223.744-44.544 50.688-86.528 154.624-34.816 212.992 21.504 24.576 52.736 35.328 90.112 35.328 114.176-0.512 286.72-100.864 431.616-229.888z m155.648-452.608c14.848-1.536 26.624 2.56 36.352 13.824 9.728 10.752 7.168 39.936-10.752 80.896-18.944-28.672-41.984-55.296-68.096-77.824 17.92-10.752 32.256-15.872 42.496-16.896z m-598.528 517.12c18.944 27.136 40.96 51.712 66.048 73.216-43.008 12.8-72.192 11.776-81.92 1.024-8.704-10.752 0.512-45.056 15.872-74.24z m685.568-246.784c-51.2 75.264-122.368 154.112-200.704 224.256-81.408 72.192-171.008 134.656-254.464 176.64 26.112 5.632 52.224 8.704 78.848 8.704 68.096 0 135.168-18.944 194.048-53.76 124.416-73.216 195.072-211.968 182.272-355.84z m0 0" p-id="4157"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://www.travellings.cn/go.html" title="å¼€å¾€" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html" aria-label="Ansible"><!---->Ansible<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><!---->Centos 9 init<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/SaltStack%E5%AD%A6%E4%B9%A0.html" aria-label="SaltStack"><!---->SaltStack<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/ops/linux/Docker%E5%AD%A6%E4%B9%A0.html" aria-label="Docker"><!---->Docker<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Nginx.html" aria-label="Nginx"><!---->Nginx<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/git.html" aria-label="Git"><!---->Git<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/package-rpm.html" aria-label="rpmåŒ…åˆ¶ä½œ"><!---->rpmåŒ…åˆ¶ä½œ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/%E8%A7%A3%E5%8E%8B%E7%BC%A9.html" aria-label="å‹ç¼©ä¸è§£å‹"><!---->å‹ç¼©ä¸è§£å‹<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/keepalived.html" aria-label="keepalived"><!---->keepalived<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Docker</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://docs.lizili.online" target="_blank" rel="noopener noreferrer">z</a></span><span property="author" content="z"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-07-21T15:32:04.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 25 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">linux</span><span class="page-category-item color2 clickable" role="navigation">docker</span><!--]--><meta property="articleSection" content="linux,docker"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">docker</span><!--]--><meta property="keywords" content="docker"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å®‰è£…">å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åˆ›å»ºç”¨æˆ·ç»„">åˆ›å»ºç”¨æˆ·ç»„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#é•œåƒåŠ é€Ÿ">é•œåƒåŠ é€Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#image">image</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dockerfile">Dockerfile</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dockerfileå…¶ä»–æŒ‡ä»¤">Dockerfileå…¶ä»–æŒ‡ä»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dockerfileæ–‡ä»¶è§£æ">Dockerfileæ–‡ä»¶è§£æ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#container">container</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–°å»ºå®¹å™¨">æ–°å»ºå®¹å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯åŠ¨å®¹å™¨">å¯åŠ¨å®¹å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®¹å™¨åå°è¿è¡Œ">å®¹å™¨åå°è¿è¡Œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¿›å…¥å®¹å™¨">è¿›å…¥å®¹å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯¼å…¥å’Œå¯¼å‡º">å¯¼å…¥å’Œå¯¼å‡º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…¶ä»–å‘½ä»¤">å…¶ä»–å‘½ä»¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#repository">Repository</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç§æœ‰ä»“åº“">ç§æœ‰ä»“åº“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ•°æ®ç®¡ç†">æ•°æ®ç®¡ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ•°æ®å·-volumes">æ•°æ®å·(Volumes)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»º-åˆ é™¤volume">åˆ›å»º/åˆ é™¤volume</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯åŠ¨æŒ‚è½½æ•°æ®å·çš„å®¹å™¨">å¯åŠ¨æŒ‚è½½æ•°æ®å·çš„å®¹å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŒ‚è½½ç›®å½•-bind-mounts">æŒ‚è½½ç›®å½•(Bind mounts)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŒ‚è½½å•ä¸ªæ–‡ä»¶">æŒ‚è½½å•ä¸ªæ–‡ä»¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#dockerç½‘ç»œ">dockerç½‘ç»œ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¤–éƒ¨è®¿é—®">å¤–éƒ¨è®¿é—®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®¹å™¨äº’è”">å®¹å™¨äº’è”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dns">DNS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é«˜çº§ç½‘ç»œé…ç½®">é«˜çº§ç½‘ç»œé…ç½®</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#docker-compose">Docker Compose</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®‰è£…-1">å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨">ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‘½ä»¤å‚æ•°è¯´æ˜">å‘½ä»¤å‚æ•°è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹ä¸€">å®ä¾‹ä¸€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹äºŒ">å®ä¾‹äºŒ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#docker-machine">docker machine</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®‰è£…-2">å®‰è£…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-1">ä½¿ç”¨</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><div class="hint-container caution"><p class="hint-container-title">è¯·æ³¨æ„</p><p>æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚</p></div><p>Dockerä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ</p><ul><li>é•œåƒï¼ˆimageï¼‰</li><li>å®¹å™¨ï¼ˆcontainerï¼‰</li><li>ä»“åº“ï¼ˆrrepository)</li></ul><h2 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…"><span>å®‰è£…</span></a></h2><p>ä¸åŒç³»ç»Ÿå®‰è£…æ–¹å¼ä¸åŒï¼Œ<a href="https://github.com/yeasy/docker_practice/blob/master/install/README.md" target="_blank" rel="noopener noreferrer">è¯¦è§</a><br> ä»¥<code>centos</code>ä¸ºä¾‹(ä»…æ”¯æŒ64ä½kernel &gt;=3.10)å»ºè®®ä½¿ç”¨å›½å†…æº</p><p><strong>å¸è½½åŸæœ‰ç‰ˆæœ¬</strong></p><p><code>yum remove docker docker-common docker-selinux docker-engine</code></p><p>yum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–</p><p><code>yum install -y yum-utils device-mapper-persistent-data lvm2</code></p><p><strong>æ·»åŠ yumæº</strong></p><div class="language-conf" data-ext="conf" data-title="conf"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span># é˜¿é‡Œæº</span></span>
<span class="line"><span>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#ä¸­ç§‘å¤§</span></span>
<span class="line"><span>sudo yum-config-manager --add-repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å®˜æ–¹æº</span></span>
<span class="line"><span># sudo yum-config-manager  --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre></div><p>æŸ¥çœ‹ç‰ˆæœ¬<br><code> yum list docker-ce --showduplicates | sort -r</code></p><p>å¯é€‰æ‹©ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚é»˜è®¤ä»“åº“åªå¼€æ”¾ç¨³å®šç‰ˆ</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> docker-ce</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #é»˜è®¤å®‰è£…æœ€æ–°ç¨³å®šç‰ˆ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sudo</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> docker-ce-17.12.0.ce</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span></code></pre></div><p>å¯åŠ¨å¹¶å¼€æœºå¯åŠ¨ï¼Œ<code>docker version</code> å³å¯æŸ¥çœ‹ç‰ˆæœ¬</p><h2 id="åˆ›å»ºç”¨æˆ·ç»„" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç”¨æˆ·ç»„"><span>åˆ›å»ºç”¨æˆ·ç»„</span></a></h2><p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œdockeråªå…è®¸rootå’Œdockerç”¨æˆ·ç»„çš„ç”¨æˆ·è¿›è¡Œè®¿é—®</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">groupadd</span><span style="color:#98C379;--shiki-dark:#98C379;"> docker</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">usermod</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -G</span><span style="color:#98C379;--shiki-dark:#98C379;"> docker</span><span style="color:#98C379;--shiki-dark:#98C379;"> username</span></span></code></pre></div><h2 id="é•œåƒåŠ é€Ÿ" tabindex="-1"><a class="header-anchor" href="#é•œåƒåŠ é€Ÿ"><span>é•œåƒåŠ é€Ÿ</span></a></h2><p>è‹¥æ–‡ä»¶ä¸å­˜åœ¨,åˆ™æ‰‹åŠ¨åˆ›å»º</p><p><code>vim /etc/docker/daemon.json</code></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#dockerå›½å†…é•œåƒåŠ é€Ÿåº”è¯¥æ˜¯æŒ‚äº†</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  &quot;registry-mirrors&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;https://registry.docker-cn.com&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç™»é™†[é˜¿é‡Œäº‘](https://cr.console.aliyun.com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">),è·å–ä¸“å±åŠ é€Ÿåœ°å€</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ç±»ä¼¼</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://xxxx.mirror.aliyuncs.com</span><span style="color:#98C379;--shiki-dark:#98C379;"> æ›¿æ¢ä¸Šé¢çš„åœ°å€</span></span></code></pre></div><p>systemctl daemon-reload</p><p>systemctl restart docker</p><h2 id="image" tabindex="-1"><a class="header-anchor" href="#image"><span>image</span></a></h2><p>è·å–é•œåƒ<br><code>docker pull [é€‰é¡¹] [ ä»“åº“åœ°å€] ä»“åº“å/æ ‡ç­¾</code> é»˜è®¤ä»<code>docker hub</code> ä¸­æ‹‰å–</p><p>ä¾‹å¦‚ ï¼š docker pull centos #é»˜è®¤å°±æ˜¯ä»docker hubä¸‹è½½æœ€æ–°çš„</p><p>å¦‚æœéœ€è¦ä¸‹è½½åˆ¶å®štagçš„ï¼Œå¯å»å®˜ç½‘æŸ¥è¯¢</p><p><code>docker search xxxx</code> ä¸æ˜¾ç¤ºtag</p><p><code>docker pull centos:7.4.1708</code> ä¸‹è½½æŒ‡å®šç‰ˆæœ¬</p><p><code>docker images -a </code> åˆ—å‡ºé•œåƒ (æ˜¾ç¤ºåŒ…æ‹¬ä¸­é—´å±‚é•œåƒ)</p><p>ä¸­é—´å±‚é•œåƒï¼šæ˜¯å…¶ä»–é•œåƒæ‰€ä¾èµ–çš„é•œåƒï¼Œä¸èƒ½åˆ é™¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸Šå±‚é•œåƒå› ä¸ºä¾èµ–ä¸¢å¤±æŠ¥é”™ï¼Œäº‹å®ä¸Šä¹Ÿæ— éœ€åˆ é™¤ï¼Œç›¸åŒçš„å±‚åªä¼šå­˜å‚¨ä¸€éã€‚</p><p><code>docker system df</code> æŸ¥çœ‹é•œåƒ,å®¹å™¨,æ•°æ®å·å ç”¨ç©ºé—´</p><p><code>docker images -f since(æˆ–before)=image name</code> åˆ—å‡ºæŸä¸ªimageä¹‹å‰(ä¹‹å)çš„é•œåƒ</p><p><code>docker image prune</code>åˆ é™¤è™šæ‚¬é•œåƒ(dangling)</p><p>è™šæ‚¬é•œåƒï¼šä¹Ÿå°±æ˜¯æ–°æ—§é•œåƒé‡åè€Œå¯¼è‡´çš„ï¼Œpullå’Œbuildéƒ½å¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œ<code>docker image ls -f dangling=true</code>å¯ æŸ¥çœ‹ï¼Œè™šæ‚¬é•œåƒéƒ½æ˜¯æ— ä»·å€¼çš„ï¼Œå¯åˆ é™¤</p><p><code>docker rmi $(docker images -q -f dangling=true)</code> æ‰¹é‡åˆ é™¤dangling</p><p><code>docker run --name webserver -d -p 80:80 nginx</code> ä»¥nginxé•œåƒä¸ºåŸºç¡€ï¼Œè¿è¡Œå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯æ–°å»ºä¸ªå®¹å™¨</p><h3 id="æ„å»ºé•œåƒ" tabindex="-1"><a class="header-anchor" href="#æ„å»ºé•œåƒ"><span>æ„å»ºé•œåƒ</span></a></h3><h3 id="dockerfile" tabindex="-1"><a class="header-anchor" href="#dockerfile"><span>Dockerfile</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;">   mkdir</span><span style="color:#98C379;--shiki-dark:#98C379;">   mynginx</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;">   cd</span><span style="color:#98C379;--shiki-dark:#98C379;">  mynginx</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;">   touch</span><span style="color:#98C379;--shiki-dark:#98C379;">   Dockerfile</span></span></code></pre></div><p>cat Dockerfile</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">FROM</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;&lt;h1&gt;Dockerfile&lt;/h1&gt;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;    &gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/share/nginx/html/index.html</span></span></code></pre></div><p><code>FROM image</code></p><p>å¿…å†™,å®šåˆ¶é•œåƒä¹Ÿæ˜¯ä»¥é•œåƒä¸ºåŸºç¡€çš„.è¿™é‡Œå°±æ˜¯é€‰å®šä¸€ä¸ªåŸºç¡€é•œåƒ,å¯ä»¥ä»¥ç›¸å…³æœåŠ¡é•œåƒä¸ºåŸºç¡€(nginx,mysqlç­‰),ä¹Ÿå¯æ˜¯æ˜¯ç³»ç»Ÿ(ubuntu,centosç­‰).</p><p>å¦å¤–,dockerè¿˜æä¾›<code>FROM scratch</code> æ„å‘³ä¸ä»¥ä»»ä½•é•œåƒä¸ºåŸºç¡€.</p><p><code>RUN</code></p><p>shellæ ¼å¼ : ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤.</p><p>execæ ¼å¼: <code>RUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;,&quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;]</code>è¿™åƒæ˜¯å‡½æ•°è°ƒç”¨</p><p><code>RUN</code>å‘½ä»¤å¸¸ç”¨æ¥å®‰è£…è½¯ä»¶åŒ…</p><h4 id="æ„å»º" tabindex="-1"><a class="header-anchor" href="#æ„å»º"><span>æ„å»º</span></a></h4><p><code>docker build [é€‰é¡¹] &lt;ä¸Šä¸‹æ–‡è·¯å¾„/URL/-&gt;</code><br> åœ¨æ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œ<code>docker build -t nginx:v3 .</code></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@docker docker]# docker build -t nginx:v3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Sending</span><span style="color:#98C379;--shiki-dark:#98C379;"> build</span><span style="color:#98C379;--shiki-dark:#98C379;"> context</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> Docker</span><span style="color:#98C379;--shiki-dark:#98C379;"> daemon</span><span style="color:#98C379;--shiki-dark:#98C379;">  2.048kB</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Step</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1/2</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> FROM</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ---</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">b8efb18f159b</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Step</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2/2</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;&lt;h1&gt; Dockerfile!&lt;/h1&gt;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">/usr/share/nginx/html/index.html</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ---</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">Running</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> 8b921720af4c</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ---</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">2cd0174a0aea</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Removing</span><span style="color:#98C379;--shiki-dark:#98C379;"> intermediate</span><span style="color:#98C379;--shiki-dark:#98C379;"> container</span><span style="color:#98C379;--shiki-dark:#98C379;"> 8b921720af4c</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Successfully</span><span style="color:#98C379;--shiki-dark:#98C379;"> built</span><span style="color:#98C379;--shiki-dark:#98C379;"> 2cd0174a0aea</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Successfully</span><span style="color:#98C379;--shiki-dark:#98C379;"> tagged</span><span style="color:#98C379;--shiki-dark:#98C379;"> nginx:v3</span></span></code></pre></div><h4 id="å®ä¾‹è§£æ" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è§£æ"><span>å®ä¾‹è§£æ</span></a></h4><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">FROM</span><span style="color:#98C379;--shiki-dark:#98C379;">    debian:jessie</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> apt-get</span><span style="color:#98C379;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> apt-get</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;">  gcc</span><span style="color:#98C379;--shiki-dark:#98C379;"> libc6-dev</span><span style="color:#98C379;--shiki-dark:#98C379;">   make</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> wget</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    -O</span><span style="color:#98C379;--shiki-dark:#98C379;">  redis.tar.gz</span><span style="color:#98C379;--shiki-dark:#98C379;">    &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> mkdir</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   -p</span><span style="color:#98C379;--shiki-dark:#98C379;">  /usr/src/redis</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> tar</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -xzf</span><span style="color:#98C379;--shiki-dark:#98C379;">    redis.tar.gz</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    -C</span><span style="color:#98C379;--shiki-dark:#98C379;">  /usr/src/redis</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  --strip-components=1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> make</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    -C</span><span style="color:#98C379;--shiki-dark:#98C379;">  /usr/src/redis</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RUN</span><span style="color:#98C379;--shiki-dark:#98C379;"> make</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    -C</span><span style="color:#98C379;--shiki-dark:#98C379;">  /usr/src/redis</span><span style="color:#98C379;--shiki-dark:#98C379;">  install</span></span></code></pre></div><p>Dockerfileä¸­ä¸€ä¸ªRUNæŒ‡ä»¤,å°±ä¼šå»ºç«‹ä¸€å±‚.å°±å’Œcimmitç±»ä¼¼,ä¸€å±‚å±‚çš„å åŠ ç„¶åç”Ÿæˆæ–°çš„image.è¿™æ ·æ²¡æœ‰æ„ä¹‰,å¾ˆå¤šæ— ç”¨çš„ä¸œè¥¿éƒ½è£…è¿›äº†image.ç¼–è¯‘ç¯å¢ƒ,è½¯ä»¶åŒ…ç­‰.è€Œä¸”UnionFSæ˜¯æœ‰å±‚æ•°é™åˆ¶çš„çš„.<br> æ‰€ä»¥,æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯è¿™æ ·</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>FROM    debian:jessie</span></span>
<span class="line"><span>RUN buildDeps=&#39;gcc  libc6-dev   make&#39;   \</span></span>
<span class="line"><span>                &amp;&amp;  apt-get update  \</span></span>
<span class="line"><span>                &amp;&amp;  apt-get install -y  $buildDeps  \</span></span>
<span class="line"><span>                &amp;&amp;  wget    -O  redis.tar.gz    &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot;  \</span></span>
<span class="line"><span>                &amp;&amp;  mkdir   -p  /usr/src/redis  \</span></span>
<span class="line"><span>                &amp;&amp;  tar -xzf    redis.tar.gz    -C  /usr/src/redis  --strip-components=1    \</span></span>
<span class="line"><span>                &amp;&amp;  make    -C  /usr/src/redis  \</span></span>
<span class="line"><span>                &amp;&amp;  make    -C  /usr/src/redis  install \</span></span>
<span class="line"><span>                &amp;&amp;  rm  -rf /var/lib/apt/lists/*    \</span></span>
<span class="line"><span>                &amp;&amp;  rm  redis.tar.gz    \</span></span>
<span class="line"><span>                &amp;&amp;  rm  -r  /usr/src/redis  \</span></span>
<span class="line"><span>                &amp;&amp;  apt-get purge   -y  --auto-remove   $buildDeps</span></span></code></pre></div><p>ä¸€å±‚ä¸€ä¸ªç›®çš„,è€Œä¸æ˜¯ä¸€å±‚ä¸€æ¡å‘½ä»¤,æˆ‘ä»¬æ˜¯åœ¨æ„å»ºimageå¹¶ä¸æ˜¯åœ¨å†™shellè„šæœ¬.å¹¶ä¸”è¦è®°å¾—åšç›¸å…³æ¸…ç†å·¥ä½œ.</p><h4 id="buildä¸­çš„ç‚¹" tabindex="-1"><a class="header-anchor" href="#buildä¸­çš„ç‚¹"><span>buildä¸­çš„ç‚¹<code>.</code></span></a></h4><p>docker build å‘½ä»¤æœ€åæœ‰ä¸ªç‚¹<code>.</code>,å®ƒè¡¨ç¤ºå½“å‰ç›®å½•,è€ŒDockerfileå°±åœ¨å½“å‰ç›®å½•.æ‰€ä»¥ä¼šè®©äººè®¤ä¸ºç‚¹<code>.</code>æŒ‡çš„å°±æ˜¯Dockerfileçš„è·¯å¾„,å…¶å®æ˜¯ä¸å‡†ç¡®çš„.å¦‚æœå¯¹ç…§bulidæ ¼å¼,ä¼šå‘ç°,è¿™é‡Œçš„ç‚¹å…¶å®æŒ‡çš„æ˜¯ä¸Šä¸‹æ–‡.<br> ç†è§£ä¸Šä¸‹æ–‡è¦ç†è§£ä¸‹dockerå·¥ä½œåŸç†,dockerè¿è¡Œæ—¶,åˆ†ä¸ºserverå’Œclient.æˆ‘ä»¬å…¶å®æ˜¯ä½¿ç”¨clientæ§åˆ¶dockeræœåŠ¡ç«¯,æ‰€æœ‰çš„æ“ä½œå…¶å®æ˜¯æœåŠ¡ç«¯å®Œæˆçš„.ä¹Ÿå°±æ˜¯C/Sç»“æ„.<br> æ‰€ä»¥æˆ‘ä»¬æ„å»ºimageçš„æ—¶å€™,å¯ä»¥ä½¿ç”¨ADD.COPYç­‰æŒ‡ä»¤,å°†æœ¬åœ°æ–‡ä»¶å¤åˆ¶è¿›é•œåƒ.æ„å»ºæ˜¯åœ¨æœåŠ¡ç«¯.æœåŠ¡ç«¯å¦‚ä½•è·å–æœ¬åœ°æ–‡ä»¶å‘¢?è¿™é‡Œå°±ç”¨åˆ°äº†ä¸Šä¸‹æ–‡.ç”¨æˆ·æŒ‡å®šäº†ä¸Šä¸‹æ–‡è·¯å¾„,buildçš„æ—¶å€™å°±ä¼šå°†è·¯å¾„ä¸‹çš„å†…å®¹æ‰“åŒ….ç„¶åä¸Šä¼ åˆ°Docker server.å½“Docker serveræ”¶åˆ°åå±•å¼€å°±èƒ½è·å¾—æ‰€éœ€çš„ä¸€åˆ‡æ–‡ä»¶<br> æ¯”å¦‚<br><code>COPY ./package.json /app</code><br> è¿™å¹¶ä¸æ˜¯è¦å¤åˆ¶æ‰§è¡Œdocker buildå‘½ä»¤æ‰€åœ¨çš„ç›®å½•ä¸‹çš„package.json ,ä¹Ÿä¸æ˜¯å¤åˆ¶Dockerfileæ‰€åœ¨ç›®å½•ä¸‹çš„package.jsonè€Œæ˜¯å¤åˆ¶ä¸Šä¸‹æ–‡(context)ç›®å½•ä¸‹çš„p<br> ackage.json<br> æ‰€ä»¥,è¿™é‡Œçš„è·¯å¾„æ˜¯ç›¸å¯¹çš„, <code>COPY ../package.json /app</code>æˆ–è€…<code>COPY /opt/xxxx /app</code> å…¶å®éƒ½å·²ç»è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´.é‚£å½“æˆ‘ä»¬éœ€è¦contextèŒƒå›´å¤–çš„æ–‡ä»¶æ€ä¹ˆåŠ?å¾ˆç®€å•,å…ˆæŠŠæ–‡ä»¶cpåˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­.<br> é»˜è®¤æƒ…å†µä¸‹,Dockerfileä¼šå°†ä¸Šä¸‹æ–‡ç›®å½•ä¸‹çš„Dockerfileæ–‡ä»¶ä½œä¸ºDockerfile.æ‰€ä»¥å¾ˆå¤šäººä¼šè¯¯è®¤ä¸º <code>.</code>å°±æ˜¯æŒ‡Dockerfileæ‰€åœ¨ç›®å½•<br> é€šå¸¸ä¹ æƒ¯ä¸Šæˆ‘ä»¬ä¹Ÿä¸ä¼šå»æ›´æ”¹.</p><h3 id="dockerfileå…¶ä»–æŒ‡ä»¤" tabindex="-1"><a class="header-anchor" href="#dockerfileå…¶ä»–æŒ‡ä»¤"><span>Dockerfileå…¶ä»–æŒ‡ä»¤</span></a></h3><h4 id="copy" tabindex="-1"><a class="header-anchor" href="#copy"><span>COPY</span></a></h4><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>    COPY    &lt;æºè·¯å¾„&gt;...    &lt;ç›®æ ‡è·¯å¾„&gt;  </span></span>
<span class="line"><span>    COPY    [&quot;&lt;æºè·¯å¾„1&gt;&quot;,...   &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;]</span></span></code></pre></div><p>æºè·¯å¾„å¯ä»¥æŒ‡å®šå¤šä¸ª,ä¹Ÿå¯ä»¥æ˜¯è¿˜æ˜¯ç”¨é€šé…ç¬¦.<br> æ­¤COPY è‡ªå¸¦ -p.ä¼šä¿ç•™æºæ–‡ä»¶çš„å±æ€§.</p><h4 id="add" tabindex="-1"><a class="header-anchor" href="#add"><span>ADD</span></a></h4><p>åŸºæœ¬å’ŒCOPYæ˜¯ä¸€è‡´çš„.ä½†æ˜¯ä»–ä¿©çš„ä½¿ç”¨å»ºè®®éµå®ˆä¸€ä¸ªåŸåˆ™<br> æ–‡ä»¶å¤åˆ¶ä½¿ç”¨<code>COPY</code>,éœ€è¦è§£å‹ç¼©ä½¿ç”¨<code>ADD</code></p><h4 id="cmd" tabindex="-1"><a class="header-anchor" href="#cmd"><span>CMD</span></a></h4><p>æ­¤å‘½ä»¤ç±»ä¼¼<code>RUN</code> æ”¯æŒä¸¤ç§æ ¼å¼ <code>shell</code> å’Œ <code>exec</code><br> shell æ ¼å¼: <code>CMD &lt;å‘½ä»¤&gt;</code><br> execæ ¼å¼: <code>CMD [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;...]</code><br> å‚æ•°åˆ—è¡¨æ ¼å¼: <code>CMD[&quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;...]</code>åœ¨æŒ‡å®šäº† <code>ENTRYPOINT</code> æŒ‡ä»¤å,ç”¨ CMDæŒ‡å®šå…·ä½“çš„å‚æ•°ã€‚</p><p>Dockerä¸æ˜¯è™šæ‹Ÿæœº,å®¹å™¨æ˜¯è¿›ç¨‹.æ‰€ä»¥å®¹å™¨çš„å¯åŠ¨éœ€è¦æŒ‡å®šè¿è¡Œç¨‹åºå’Œå‚æ•°.<code>CMD</code> å°±æ˜¯ç”¨äºæŒ‡å®šé»˜è®¤å®¹æ˜“ä¸»è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤<br> æˆ–è€…è¿™æ ·ç†è§£,<code>CMD</code> æ‰§è¡Œçš„æ˜¯é»˜è®¤å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ä»¥åŠå‚æ•°.ä¸€èˆ¬<code>åªå…è®¸ä½¿ç”¨ä¸€æ¬¡CMD,å¸¸ç”¨äºæ–‡ä»¶æœ€å</code></p><p>å‘½ä»¤æ ¼å¼ä¸Šæ¨èä½¿ç”¨<code>exec</code> , é»˜è®¤æƒ…å†µä¸‹ shell æ˜¯ä¼šè¢«å°è£…æˆä¸º<code>sh -c</code><br> å¦‚:<br><code>CMD echo $HOME</code> --&gt; <code>CMD [&quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot;]</code><br> æ³¨æ„! <code>exec</code>æ ¼å¼ ä¸€å®šè¦ç”¨åŒå¼•å·!å› ä¸ºåœ¨è§£ææ—¶ä¼šè¢«è§£ææˆ<code>json</code></p><p>dockerä¸æ˜¯è™šæ‹Ÿæœº,å®¹å™¨çš„åº”ç”¨ä¹Ÿåº”è¯¥æ˜¯ä»¥å‰å°æ‰§è¡Œçš„,å®¹å™¨ä¸å­˜åœ¨åå°çš„æ¦‚å¿µ.ä¸èƒ½ä»¥è™šæ‹Ÿæœºçš„æ–¹å¼å»æ‰§è¡Œåå°æœåŠ¡ç­‰<br> æ‰€ä»¥ <code>CMD service nginx start</code>è‚¯å®šæ˜¯é”™è¯¯çš„.ä¼šè½¬æ¢ä¸º <code>CMD [&quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]</code> æ˜¾è€Œæ˜“è§,ä¸»è¿›ç¨‹æ˜¯<code>sh</code>,æ‰€ä»¥è¿™ç§æ ¼å¼çš„å‘½ä»¤,ä¼šå¯¼è‡´å®¹å™¨é€€å‡º.<br> æ­£ç¡®çš„æ–¹å¼ æ˜¯<code>CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off&quot;]</code></p><h4 id="entrypoint" tabindex="-1"><a class="header-anchor" href="#entrypoint"><span>ENTRYPOINT</span></a></h4><p>åŒæ ·æ”¯æŒä¸¤ç§æ ¼å¼: <code>exec</code> å’Œ<code>shell</code></p><p>å½“æŒ‡å®šäº†<code>ENTRYPOINT</code>å<code>CMD</code>çš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–,å®ƒä¸åœ¨ç›´æ¥è¿è¡Œå‘½ä»¤,è€Œæ˜¯å°†å†…å®¹ä¼ é€ç»™<code>ENTYRPOINT</code>è¿è¡Œ<br> åŒ<code>CMD</code>,ä¸€ä¸ªæ–‡ä»¶åªå†™ä¸€æ¬¡.</p><h4 id="env" tabindex="-1"><a class="header-anchor" href="#env"><span>ENV</span></a></h4><p>ç¯å¢ƒå˜é‡<br><code>ENV KEY VALUE</code> <code>ENV KEY=VALUE</code> ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥<br> ä¸‹åˆ—æŒ‡ä»¤å¯ä»¥æ”¯æŒç¯å¢ƒå˜é‡å±•å¼€ï¼š<br><code>ADDã€COPYã€ENVã€EXPOSEã€LABELã€USERã€WORKDIRã€VOLUMEã€STOPSIGNALã€ONBUILD</code><br> ä¾‹:(nodeå®˜æ–¹)</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>ENV NODE_VERSION 7.2.0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot; \</span></span>
<span class="line"><span>  &amp;&amp; curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot; \</span></span>
<span class="line"><span>  &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \</span></span>
<span class="line"><span>  &amp;&amp; grep &quot; node-v$NODE_VERSION-linux-x64.tar.xz\$&quot; SHASUMS256.txt | sha256sum -c - \</span></span>
<span class="line"><span>  &amp;&amp; tar -xJf &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; -C /usr/local --strip-components=1 \</span></span>
<span class="line"><span>  &amp;&amp; rm &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; SHASUMS256.txt.asc SHASUMS256.txt \</span></span>
<span class="line"><span>  &amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs</span></span></code></pre></div><h4 id="argå˜é‡" tabindex="-1"><a class="header-anchor" href="#argå˜é‡"><span>ARGå˜é‡</span></a></h4><p><code>ARG key </code> <code>ARG key=value </code><br> ARGæŒ‡ä»¤å®šä¹‰çš„å‚æ•°ï¼Œåœ¨docker buildå‘½ä»¤ä¸­ä»¥--build-arg key=valueå½¢å¼èµ‹å€¼ã€‚<br> ARGå˜é‡ä¸åƒENVå˜é‡å§‹ç»ˆå­˜åœ¨äºé•œåƒä¸­ã€‚ä¸è¿‡ARGå˜é‡ä¼šä»¥ç±»ä¼¼çš„æ–¹å¼å¯¹æ„å»ºç¼“å­˜äº§ç”Ÿå½±å“ã€‚å¦‚æœDockerfileä¸­å®šä¹‰çš„ARGå˜é‡çš„å€¼ä¸ä¹‹å‰å®šä¹‰çš„å˜é‡å€¼ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿâ€œcache missâ€ã€‚æ¯”å¦‚RUNæŒ‡ä»¤ä½¿ç”¨ARGå®šä¹‰çš„å˜é‡æ—¶ï¼ŒARGå˜é‡çš„å€¼å˜äº†ä¹‹åï¼Œå°±ä¼šå¯¼è‡´ç¼“å­˜å¤±æ•ˆã€‚</p><h4 id="volume" tabindex="-1"><a class="header-anchor" href="#volume"><span>VOLUME</span></a></h4><p><code>VOLUME path</code> <code>VOLUME [&quot;path1&quot;,&quot;path2&quot;]</code><br> å®¹å™¨è¿è¡Œ,å°½é‡è®©å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œ,é€šå¸¸æ•°æ®éƒ½å­˜æ”¾åœ¨å·ä¸­,æ­¤å‘½ä»¤å¯å®ç°æŒ‡å®šæŒ‚è½½æŸç›®å½•,ä»¥é˜²ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶ç›®å½•æŒ‚è½½ä¸ºå·.è¿™æ ·å¯ä»¥ä¿è¯å®¹å™¨çš„æ­£å¸¸è¿è¡Œ,å¹¶ä¸”ä¸ä¼šå‘å­˜å‚¨å†™æ•°æ®</p><h4 id="expose" tabindex="-1"><a class="header-anchor" href="#expose"><span>EXPOSE</span></a></h4><p><code>EXPOSE 80</code><br><code>EXPOSE 22</code><br> å£°æ˜è¿è¡Œå®¹å™¨æ—¶æä¾›æœåŠ¡ç«¯å£,å•å•åªæ˜¯å£°æ˜,å¹¶ä¸ä¼šçœŸçš„å»å¼€å¯è¿™ä¸ªç«¯å£.å½“ä½¿ç”¨<code>docker run -P</code>æ—¶,ä¼šè‡ªåŠ¨éšæœºæ˜ å°„EXPOSEçš„ç«¯å£</p><h4 id="workdir" tabindex="-1"><a class="header-anchor" href="#workdir"><span>WORKDIR</span></a></h4><p>æŒ‡å®šå·¥ä½œç›®å½•<br><code>WORKDIR dir</code><br> ç”¨æ¥æŒ‡å®šå·¥ä½œç›®å½•,WORKDIRç±»ä¼¼å‘½ä»¤cdã€‚<br> WORKDIRå‚æ•°åå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–è€…å¸¦/çš„ç»å¯¹è·¯å¾„ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å°±ä¾æ®ä¸Šä¸€ä¸ªWORKDIRå‚æ•°å†³å®šä¸‹é¢çš„Dockerfileå·¥ä½œç›®å½•ã€‚<br> å¯ä»¥é‡å¤å®šä¹‰ï¼Œä»¥åˆ‡æ¢Dockerfileçš„å·¥ä½œç›®å½•ã€‚</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>RUN cd  /app</span></span>
<span class="line"><span>RUN echo    &quot;hello&quot; &gt;   world.txt</span></span></code></pre></div><p>ä¸¤ä¸ªRUN å…¶å®æ˜¯è¿è¡Œäº†ä¸¤ä¸ªå®¹å™¨.ç¬¬ä¸€ä¸ªRUNå¹¶ä¸ä¼šå¯¹ç¬¬äºŒä¸ªäº§ç”Ÿä»»ä½•å½±å“.æ‰€ä»¥ç¬¬äºŒä¸ªå°†ä¼šæ‰¾ä¸åˆ°è·¯å¾„,æ­¤æ—¶å°±éœ€è¦è®¾ç½®å·¥ä½œç›®å½• <code>WORKDIR /app</code></p><h4 id="onbuild" tabindex="-1"><a class="header-anchor" href="#onbuild"><span>ONBUILD</span></a></h4><p>è¯¥å‘½ä»¤å®é™…ä¸Šæ˜¯ä¸ªè§¦å‘å™¨,å…¶å‚æ•°æ˜¯ä»»æ„ä¸€ä¸ªDockerfile æŒ‡ä»¤<br><code>ONBUILD RUN mkdir /testdir</code><br> å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªDockerfileæ–‡ä»¶ä¸­åŠ ä¸ŠONBUILDæŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¯¹åˆ©ç”¨è¯¥Dockerfileæ„å»ºé•œåƒï¼ˆæ¯”å¦‚ä¸ºAé•œåƒï¼‰ä¸ä¼šäº§ç”Ÿå®è´¨æ€§å½±å“ã€‚<br> ä½†æ˜¯å½“æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ–°çš„Dockerfileæ–‡ä»¶æ¥åŸºäºAé•œåƒæ„å»ºä¸€ä¸ªé•œåƒï¼ˆæ¯”å¦‚ä¸ºBé•œåƒï¼‰æ—¶ï¼Œè¿™æ—¶æ„é€ Aé•œåƒçš„Dockerfileæ–‡ä»¶ä¸­çš„ONBUILDæŒ‡ä»¤å°±ç”Ÿæ•ˆäº†.</p><h4 id="user" tabindex="-1"><a class="header-anchor" href="#user"><span>USER</span></a></h4><p><code>USER username</code><br><code>USER</code>ä¼šæ”¹å˜ä»¥åå‘½ä»¤çš„æ‰§è¡Œç”¨æˆ·.æˆ–è€…è¯´,ä»–å°±æ˜¯åˆ‡æ¢ç”¨æˆ·çš„.å‰æ,ç”¨æˆ·æ˜¯å­˜åœ¨çš„,å¦åˆ™å¤±è´¥.</p><p>å¦‚æœä»¥ root æ‰§è¡Œçš„è„šæœ¬ï¼Œåœ¨æ‰§è¡ŒæœŸé—´å¸Œæœ›æ”¹å˜èº«ä»½ï¼Œæ¯”å¦‚å¸Œæœ›ä»¥æŸä¸ªå·²ç»å»ºç«‹å¥½çš„ç”¨æˆ·æ¥è¿è¡ŒæŸä¸ªæœåŠ¡è¿›ç¨‹<br> ä¸è¦ä½¿ç”¨ su æˆ–è€… sudoï¼Œè¿™äº›éƒ½éœ€è¦æ¯”è¾ƒéº»çƒ¦çš„é…ç½®ï¼Œè€Œä¸”åœ¨ TTY ç¼ºå¤±çš„ç¯å¢ƒä¸‹ç»å¸¸å‡ºé”™ã€‚å»ºè®®ä½¿ç”¨ gosuã€‚</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span># å»ºç«‹ redis ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨ gosu æ¢å¦ä¸€ä¸ªç”¨æˆ·æ‰§è¡Œå‘½ä»¤</span></span>
<span class="line"><span>RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis</span></span>
<span class="line"><span># ä¸‹è½½ gosu</span></span>
<span class="line"><span>RUN wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64&quot; \</span></span>
<span class="line"><span>    &amp;&amp; chmod +x /usr/local/bin/gosu \</span></span>
<span class="line"><span>    &amp;&amp; gosu nobody true</span></span>
<span class="line"><span># è®¾ç½® CMDï¼Œå¹¶ä»¥å¦å¤–çš„ç”¨æˆ·æ‰§è¡Œ</span></span>
<span class="line"><span>CMD [ &quot;exec&quot;, &quot;gosu&quot;, &quot;redis&quot;, &quot;redis-server&quot; ]</span></span></code></pre></div><h4 id="healthcheck" tabindex="-1"><a class="header-anchor" href="#healthcheck"><span>HEALTHCHECK</span></a></h4><p><code>HEALTHCHECK [option] CMD &lt;command&gt;</code><br><code>HEALTHCHECK NONE</code> å¯å±è”½åŸºç¡€é•œåƒçš„å¥åº·æ£€æµ‹æŒ‡ä»¤</p><p>å…¶å‘½ä»¤å’ŒENTTYPOINTç±»ä¼¼.<br><code>--interval</code> é—´éš”æ—¶é—´,ä¸¤æ¬¡æ£€æµ‹æ—¶é—´é—´éš”,é»˜è®¤30s<br><code>--timeout</code> è¶…æ—¶.å¥åº·æ£€æµ‹è¿è¡Œè¶…æ—¶æ—¶é—´.é»˜è®¤30s<br><code>--retries</code> é‡è¯•.é»˜è®¤3æ¬¡.<br> è¿”å›å€¼:<code>0</code>:æˆåŠŸ,<code>1</code>:å¤±è´¥ <code>2</code>:ä¿ç•™</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>FROM    nginx</span></span>
<span class="line"><span>RUN apt-get update  &amp;&amp;  apt-get install -y  curl    &amp;&amp;  rm  -rf /var/lib/apt/lists/*</span></span>
<span class="line"><span>HEALTHCHECK --interval=15s  --timeout=5s    \</span></span>
<span class="line"><span>        CMD curl    -fs http://localhost/   ||  exit    1</span></span></code></pre></div><h4 id="dockerfileå¤šé˜¶æ®µæ„å»º" tabindex="-1"><a class="header-anchor" href="#dockerfileå¤šé˜¶æ®µæ„å»º"><span>Dockerfileå¤šé˜¶æ®µæ„å»º</span></a></h4><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>FROM muninn/glide:alpine AS build-env</span></span>
<span class="line"><span>ADD . /go/src/app</span></span>
<span class="line"><span>WORKDIR /go/src/app</span></span>
<span class="line"><span>RUN glide install</span></span>
<span class="line"><span>RUN go build -v -o /go/src/app/app-server</span></span>
<span class="line"><span></span></span>
<span class="line"><span>FROM alpine</span></span>
<span class="line"><span>RUN apk add -U tzdata</span></span>
<span class="line"><span>RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime</span></span>
<span class="line"><span>COPY --from=build-env /go/src/app/app-server /usr/local/bin/app-server</span></span>
<span class="line"><span>EXPOSE 80</span></span>
<span class="line"><span>CMD [&quot;app-server&quot;]</span></span></code></pre></div><p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ª <code>FROM</code> åè¾¹å¤šäº†ä¸ª <code>AS</code> å…³é”®å­—ï¼Œå¯ä»¥ç»™è¿™ä¸ªé˜¶æ®µèµ·ä¸ªåå­—ã€‚<br> ç¬¬äºŒéƒ¨åˆ†ç”¨äº†å®˜æ–¹çš„ alpine é•œåƒï¼Œæ”¹å˜æ—¶åŒºåˆ°ä¸­å›½<br> æ³¨æ„<code>COPY</code> å…³é”®å­—ï¼Œå®ƒç°åœ¨å¯ä»¥æ¥å— --from= è¿™æ ·çš„å‚æ•°ï¼Œä»ä¸Šä¸ªæˆ‘ä»¬èµ·åå­—çš„é˜¶æ®µå¤åˆ¶æ–‡ä»¶è¿‡æ¥ã€‚</p><h3 id="dockerfileæ–‡ä»¶è§£æ" tabindex="-1"><a class="header-anchor" href="#dockerfileæ–‡ä»¶è§£æ"><span>Dockerfileæ–‡ä»¶è§£æ</span></a></h3><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>#docker build -t centos_nginx:v5 .</span></span>
<span class="line"><span>#docker run --name web_5 -d -p 85:80 centos_nginx:v5 </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>FROM centos</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MAINTAINER zili.li</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ADD nginx-1.12.2.tar.gz /usr/local/src</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN buildDeps=&#39;gcc gcc-c++ glib make autoconf openssl openssl-devel libxslt-devel gd gd-devel GeoIP GeoIP-devel pcre pcre-devel wget curl&#39; \ </span></span>
<span class="line"><span>                &amp;&amp; yum -y install $buildDeps \</span></span>
<span class="line"><span>                &amp;&amp; useradd -M -s /sbin/nologin nginx</span></span>
<span class="line"><span>#å¤šä¸ªç”¨é€—å·åˆ†éš”</span></span>
<span class="line"><span>#docker inspect web_5 çš„ Mountsä¸‹å¯çœ‹åˆ°æ–‡ä»¶æŒ‚è½½ä¿¡æ¯.</span></span>
<span class="line"><span>#docker exec -it web_5 /bin/bash è¿›å…¥å®¹å™¨å¯æŸ¥çœ‹åˆ°æŒ‚è½½çš„ç›®å½•,å…¶å†…å®¹å’ŒMountsæ˜¯åŒæ­¥çš„</span></span>
<span class="line"><span>VOLUME [&quot;/usr/local/nginx/html&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>WORKDIR /usr/local/src/nginx-1.12.2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN ./configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-file-aio --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_stub_status_module \</span></span>
<span class="line"><span>                &amp;&amp; make \</span></span>
<span class="line"><span>                &amp;&amp; make install \</span></span>
<span class="line"><span>                &amp;&amp; rm -rf /usr/local/src/nginx-1.12.2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æŒ‡å®šäº†ç¯å¢ƒå˜é‡,æ‰€ä»¥ç”Ÿæˆå®¹å™¨çš„æ—¶å€™ ä¸ç”¨åœ¨æŒ‡å®šè·¯å¾„.ç›´æ¥nginx å³å¯</span></span>
<span class="line"><span>ENV PATH /usr/local/nginx/sbin:$PATH                </span></span>
<span class="line"><span></span></span>
<span class="line"><span>EXPOSE 80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å½“ENTRYPOINTå’ŒCMDè¿ç”¨æ—¶ï¼ŒCMDçš„å‘½ä»¤æ˜¯ENTRYPOINTå‘½ä»¤çš„å‚æ•°ï¼Œä¸¤è€…è¿ç”¨ç›¸å½“äºnginx -g &quot;daemon off;&quot;</span></span>
<span class="line"><span>#å¦‚æœCMD [&quot;-g&quot;,&quot;daemon on;&quot;] é‚£ä¹ˆç”Ÿæˆçš„å®¹å™¨å°†ä¸ä¼šå¤„äºupçŠ¶æ€.ä½†æ˜¯æ‰§è¡Œrunçš„æ—¶å€™åŠ å…¥ -g &quot;daemon off;&quot;æ­¤å‚æ•°å°†ä¼šä¼ å…¥ç»™ENTRYPOINT</span></span>
<span class="line"><span>#å®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œ,å®¹å™¨æ²¡æœ‰åå°æ¦‚å¿µ,-d è¡¨ç¤ºçš„åå°,æ˜¯ç¨‹åºçš„åå°,ç¨‹åºå®Œæ¯•å®¹å™¨åœæ­¢,è€Œä¸æ˜¯å®¹å™¨åå°.å®¹å™¨éƒ½æ˜¯å‰å°çš„.</span></span>
<span class="line"><span>ENTRYPOINT [&quot;nginx&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#CMD service nginx start è¿™æ˜¯åˆå­¦ç»å¸¸ææ¨¡ç³Šçš„åœ°æ–¹!</span></span>
<span class="line"><span>#å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡º.</span></span>
<span class="line"><span># CMD service nginx start ä¼šè¢«ç†è§£ä¸º CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]</span></span>
<span class="line"><span>#å› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯ sh,é‚£ä¹ˆå½“ service nginx start å‘½ä»¤ç»“æŸåï¼Œsh ä¹Ÿå°±ç»“æŸï¼Œshä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†è‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡º</span></span>
<span class="line"><span>#æ­£ç¡®çš„åšæ³•æ˜¯ç›´æ¥æ‰§è¡Œ nginx å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼è¿è¡Œã€‚æ¯”å¦‚ï¼šCMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;],æˆ–CMD /bin/sh -c &#39;nginx -g &quot;daemon off;&quot;&#39;</span></span>
<span class="line"><span>CMD [&quot;-g&quot;,&quot;daemon off;&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="container" tabindex="-1"><a class="header-anchor" href="#container"><span>container</span></a></h2><h3 id="æ–°å»ºå®¹å™¨" tabindex="-1"><a class="header-anchor" href="#æ–°å»ºå®¹å™¨"><span>æ–°å»ºå®¹å™¨</span></a></h3><p><code>docker run</code> æ­¤å‘½ä»¤æ˜¯ç”¨æ¥æ–°å»ºå®¹å™¨<br> ä¾‹å¦‚ï¼š<br><code>docker run ubuntu /bin/echo &#39;test&#39;</code> ä¼šè¾“å‡ºteståç»ˆæ­¢å®¹å™¨ï¼Œç»ˆæ­¢å®¹å™¨å¹¶ä¸æ˜¯åˆ é™¤å®¹å™¨ï¼Œæ‰€ä»¥å®¹å™¨è¿˜æ˜¯å­˜åœ¨çš„ï¼Œæ·»åŠ <code>--rm</code> åˆ™ä¼šä¸´æ—¶æ€§çš„æ‰§è¡Œï¼Œå®Œååˆ é™¤å®¹å™¨<code>docker run --rm ....</code></p><p><code>docker run -it ubuntu /bin/bash</code> ä¼šç”Ÿæˆä¸€ä¸ªä¼ªç»ˆç«¯ã€‚å¯é€šè¿‡ç»ˆç«¯è¿›è¡Œç®€å•çš„æ“ä½œã€‚åŒæ ·ï¼Œæ­¤å®¹å™¨ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚docker ps -aæŸ¥çœ‹</p><p>docker runæµç¨‹</p><ul><li>æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½</li><li>åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</li><li>åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚</li><li>ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»</li><li>ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨</li><li>æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº</li><li>æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢,å¹¶ä¸æ˜¯åˆ é™¤ï¼Œå®¹å™¨è¿˜å¯ä»¥å†æ¬¡å¯åŠ¨</li></ul><h3 id="å¯åŠ¨å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨å®¹å™¨"><span>å¯åŠ¨å®¹å™¨</span></a></h3><p><code>docker container start -i container_id</code>ä¼šé‡æ–°å¯åŠ¨ä¸€ä¸ªå·²ç»ˆæ­¢çš„å®¹å™¨ã€‚</p><p><strong>docker container è¿˜æœ‰å¾ˆå¤šå‘½ä»¤ï¼Œå»ºè®®ä½¿ç”¨ --helpæŸ¥çœ‹ä½¿ç”¨è¯´æ˜</strong></p><h3 id="å®¹å™¨åå°è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#å®¹å™¨åå°è¿è¡Œ"><span>å®¹å™¨åå°è¿è¡Œ</span></a></h3><p><code>docker run -d</code><br> ä¸æ˜¯ç”¨åå°è¿è¡Œæ—¶ï¼Œç»“æœè¾“å‡ºä¼šåˆ°å½“å‰ä¸»æœº</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@zili ~]# docker run ubuntu /bin/sh -c &quot;while true; do echo test -d; sleep 1; done&quot;</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span></code></pre></div><p>ä½¿ç”¨åå°è¿è¡Œæ—¶å€™,å®¹å™¨å°†åå°è¿è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•æŸ¥çœ‹ç»“æœå‘¢ï¼Ÿ</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@zili ~]# docker run -d ubuntu /bin/sh -c &quot;while true; do echo test -d; sleep 1; done&quot;</span></span>
<span class="line"><span>69931b53bfea873daf9cfeb82c926be84980e41a3c0f62f966b039ffbaa0b1c1</span></span></code></pre></div><p><code>docker container log container_id</code> å¯ä»¥æ¥æŸ¥çœ‹ç›¸å…³çš„å®¹å™¨è¾“å‡º</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@zili ~]# docker container logs 699</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>test -d</span></span>
<span class="line"><span>...</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®¹å™¨æ˜¯å¦èƒ½é•¿ä¹…è¿è¡Œå’ŒæŒ‡å®šçš„å‘½ä»¤æœ‰å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‘½ä»¤ç»“æŸï¼Œå®¹å™¨åœæ­¢ï¼Œå’Œ<code>-d</code>å‚æ•°å¹¶æ— å…³ç³»ï¼Œå®ƒåªæ˜¯ç”¨æ¥è®©å®¹å™¨åå°è¿è¡Œè€Œå·²ã€‚<br> åœæ­¢å®¹å™¨è¿è¡Œä½¿ç”¨<code>docker container stop container_id</code></p><h3 id="è¿›å…¥å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#è¿›å…¥å®¹å™¨"><span>è¿›å…¥å®¹å™¨</span></a></h3><p><code>docker attach</code></p><p>ä¸å»ºè®®ä½¿ç”¨,å› ä¸ºä½¿ç”¨æ­¤å‘½ä»¤,å¦‚æœå®¹å™¨æ˜¯<code>-d</code>åå°è¿è¡Œ,stdiné€€å‡ºæ—¶,å®¹å™¨è¿è¡ŒçŠ¶æ€å°†ç»ˆæ­¢.ä¹Ÿå°±æ˜¯è¯´,æ­¤å‘½ä»¤è¿›å…¥å®¹å™¨,é€€å‡ºæ—¶ä¼šå¯¼è‡´åå°è¿è¡Œçš„å®¹å™¨ç»ˆæ­¢</p><p><code>docker exec -it </code> ä¸ä¼šå¯¼è‡´åå°è¿è¡Œä¸­çš„å®¹å™¨ç»ˆæ­¢.æ¨èä½¿ç”¨~!<br> å‚æ•°è¯´æ˜è¯·ä½¿ç”¨ <code>docker exec --help</code></p><h3 id="å¯¼å…¥å’Œå¯¼å‡º" tabindex="-1"><a class="header-anchor" href="#å¯¼å…¥å’Œå¯¼å‡º"><span>å¯¼å…¥å’Œå¯¼å‡º</span></a></h3><p><code>docker container export</code> å¯¼å‡º</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker ~]# docker ps -a</span></span>
<span class="line"><span>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span></span>
<span class="line"><span>0828d964cc2f        ubuntu:16.04        &quot;/bin/bash&quot;         29 minutes ago      Exited (0) 29 minutes ago                       attach</span></span>
<span class="line"><span>[root@docker ~]# docker container export attach &gt; attach.tar</span></span>
<span class="line"><span>[root@docker ~]# ls</span></span>
<span class="line"><span>anaconda-ks.cfg  attach.tar  docker  myip</span></span></code></pre></div><p><code>docker image import</code> å¯¼å…¥</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker ~]# cat attach.tar | docker import - test/ubuntu</span></span>
<span class="line"><span>sha256:e9b17f2d8f7546a1d3e143f684b234ebf2301b95193782d8685d2cdb2f05b2f5</span></span>
<span class="line"><span>[root@docker ~]# docker images</span></span>
<span class="line"><span>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span></span>
<span class="line"><span>test/ubuntu         latest              e9b17f2d8f75        4 seconds ago       98.4MB</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥é€šè¿‡URLå¯¼å…¥<br><code>docker import http://example.com/exampleimage.tgz example/imagerepo</code></p><h3 id="åˆ é™¤å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤å®¹å™¨"><span>åˆ é™¤å®¹å™¨</span></a></h3><p><code>docker rm</code><br><code>docker rm -f</code> åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨<br><code>docker container prune</code> åˆ é™¤æ‰€æœ‰ç»ˆæ­¢çš„å®¹å™¨</p><h3 id="å…¶ä»–å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–å‘½ä»¤"><span>å…¶ä»–å‘½ä»¤</span></a></h3><p><code>docker diff container name</code> æŸ¥çœ‹å®¹å™¨å˜åŒ–<br><code>docker history container:tag</code> æŸ¥çœ‹container å†å²</p><h2 id="repository" tabindex="-1"><a class="header-anchor" href="#repository"><span>Repository</span></a></h2><p>å®˜æ–¹repository <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker hub</a></p><p><code>docker search</code> å‘½ä»¤æŸ¥æ‰¾å®˜æ–¹repositoryçš„é•œåƒ.<br><code>docker pull</code> å‘½ä»¤æŠŠé•œåƒæ‹‰å–ä¸‹æ¥</p><p><code>docker login</code> ç™»å½•docker hub<br><code>docker logout</code> é€€å‡ºdocker hub<br><code>docker push</code> æ¨é€é•œåƒ</p><h3 id="ç§æœ‰ä»“åº“" tabindex="-1"><a class="header-anchor" href="#ç§æœ‰ä»“åº“"><span>ç§æœ‰ä»“åº“</span></a></h3><p><a href="https://yeasy.gitbooks.io/docker_practice/content/repository/registry.html" target="_blank" rel="noopener noreferrer">ç•¥</a></p><h2 id="æ•°æ®ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç®¡ç†"><span>æ•°æ®ç®¡ç†</span></a></h2><p>å®¹å™¨ç®¡ç†æ•°æ®ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼,æ•°æ®å·ï¼ˆVolumesï¼‰å’ŒæŒ‚è½½ä¸»æœºç›®å½•(Bind mounts)</p><h3 id="æ•°æ®å·-volumes" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å·-volumes"><span>æ•°æ®å·(Volumes)</span></a></h3><p>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨,<br> æ•°æ®å· çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆä¸”æ•°æ®å· çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ<br> æ•°æ®å· é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤</p><ul><li>æ³¨æ„ï¼šæ•°æ®å· çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountï¼Œé•œåƒä¸­çš„è¢«æŒ‡å®šä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ä¸­çš„æ–‡ä»¶ä¼šéšè—æ‰ï¼Œèƒ½æ˜¾ç¤ºçœ‹çš„æ˜¯æŒ‚è½½çš„ æ•°æ®å·ã€‚</li></ul><p>æ•°æ®å·æœ‰ <code>--mount</code> <code>-v</code> æˆ–è€… <code>--volume</code> ä½†æ˜¯æ¨èä½¿ç”¨ <code>--mount</code> å‚æ•°</p><h3 id="åˆ›å»º-åˆ é™¤volume" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-åˆ é™¤volume"><span>åˆ›å»º/åˆ é™¤volume</span></a></h3><p><code>docker volume create webtest</code> åˆ›å»ºä¸€ä¸ªwebtestçš„æ•°æ®å·<br><code>docker volume inspect webtest</code> æŸ¥çœ‹æ•°æ®å·</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker ~]# docker volume inspect webtest</span></span>
<span class="line"><span>[</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        &quot;CreatedAt&quot;: &quot;2018-04-15T10:54:40+08:00&quot;,</span></span>
<span class="line"><span>        &quot;Driver&quot;: &quot;local&quot;,</span></span>
<span class="line"><span>        &quot;Labels&quot;: {},</span></span>
<span class="line"><span>        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/webtest/_data&quot;,</span></span>
<span class="line"><span>        &quot;Name&quot;: &quot;webtest&quot;,</span></span>
<span class="line"><span>        &quot;Options&quot;: {},</span></span>
<span class="line"><span>        &quot;Scope&quot;: &quot;local&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>]</span></span></code></pre></div><p><code>docker volume rm webtest</code> åˆ é™¤æ•°æ®å·,å‰ææ•°æ®å·æ²¡æœ‰è¢«å®¹å™¨ä½¿ç”¨</p><p>æ•°æ®å·æ˜¯ç‹¬ç«‹äºå®¹å™¨çš„,ç”¨æ¥åšæ•°æ®åˆå§‹åŒ–çš„,æ‰€ä»¥å®¹å™¨çš„åˆ é™¤ä¸ä¼šå½±å“æ•°æ®å·,è‹¥åˆ é™¤å®¹å™¨æ—¶æƒ³è¦åˆ é™¤æ•°æ®å· åˆ™ä½¿ç”¨<code>docker rm -v</code><br> æ¸…ç†æ— ä¸»çš„æ•°æ®å· <code>docker volume prune</code></p><p>æ¶‰åŠåˆ é™¤çš„æ“ä½œ,<code>æ€ä¹‹,æ…ä¹‹è€Œè¡Œä¹‹</code></p><h3 id="å¯åŠ¨æŒ‚è½½æ•°æ®å·çš„å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨æŒ‚è½½æ•°æ®å·çš„å®¹å™¨"><span>å¯åŠ¨æŒ‚è½½æ•°æ®å·çš„å®¹å™¨</span></a></h3><p><code>docker run</code>æ—¶ï¼Œä½¿ç”¨ <code>--mount</code> æ ‡è®°æ¥å°†æ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨é‡Œ,åœ¨ä¸€æ¬¡ docker run ä¸­å¯ä»¥æŒ‚è½½å¤šä¸ªæ•°æ®å·</p><p><code>-våé¢çš„æ˜ å°„å…³ç³»æ˜¯&quot;å®¿ä¸»æœºæ–‡ä»¶/ç›®å½•:å®¹å™¨é‡Œå¯¹åº”çš„æ–‡ä»¶/ç›®å½•&quot;ï¼Œå…¶ä¸­ï¼Œå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶/ç›®å½•æ˜¯è¦æå‰å­˜åœ¨çš„ï¼Œå®¹å™¨é‡Œå¯¹åº”çš„æ–‡ä»¶/ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</code></p><p>ä¸¤ç§æ–¹å¼æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«,mountæ›´åŠ æ¸…æ™°ç›´è§‚.<br><code> docker run -it --name web -d -p 80:80 --mount source=webtest,target=/webdir nginx</code><br><code>docker run -it --name web -d -p 80:80 -v webtest:/webdir nginx</code></p><p><strong>æŸ¥çœ‹æ•°æ®å·å…·ä½“ä¿¡æ¯</strong><br><code>docker inspect web</code> æ•°æ®å·çš„ä¿¡æ¯åœ¨Mountsä¸‹</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&quot;Mounts&quot;: [</span></span>
<span class="line"><span>            {</span></span>
<span class="line"><span>                &quot;Type&quot;: &quot;volume&quot;,</span></span>
<span class="line"><span>                &quot;Name&quot;: &quot;webtest&quot;,</span></span>
<span class="line"><span>                &quot;Source&quot;: &quot;/var/lib/docker/volumes/webtest/_data&quot;,</span></span>
<span class="line"><span>                &quot;Destination&quot;: &quot;/webdir&quot;,</span></span>
<span class="line"><span>                &quot;Driver&quot;: &quot;local&quot;,</span></span>
<span class="line"><span>                &quot;Mode&quot;: &quot;z&quot;,</span></span>
<span class="line"><span>                &quot;RW&quot;: true,</span></span>
<span class="line"><span>                &quot;Propagation&quot;: &quot;&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        ],</span></span></code></pre></div><p><code>docker exec -it container /bin/bash</code> å¯è¿›å…¥å®¹å™¨æŸ¥çœ‹æŒ‚è½½çš„ç›®å½•å¹¶æ–°å»ºæ–‡ä»¶ç­‰</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>root@f24f73d240d9:/# cd webdir/</span></span>
<span class="line"><span>root@f24f73d240d9:/webdir# touch 123</span></span>
<span class="line"><span>root@f24f73d240d9:/webdir# df -h</span></span>
<span class="line"><span>Filesystem              Size  Used Avail Use%   Mounted on</span></span>
<span class="line"><span>/dev/mapper/centos-root  50G  1.8G   49G   4%   /webdir</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ç„¶åé€€å‡ºå¯åœ¨å®¿ä¸»æœºä¸Šçœ‹åˆ°æ­¤æ–‡ä»¶</span></span>
<span class="line"><span>[root@docker ~]# cd /var/lib/docker/volumes/webtest/_data/</span></span>
<span class="line"><span>[root@docker _data]# ls</span></span>
<span class="line"><span>123</span></span></code></pre></div><h3 id="æŒ‚è½½ç›®å½•-bind-mounts" tabindex="-1"><a class="header-anchor" href="#æŒ‚è½½ç›®å½•-bind-mounts"><span>æŒ‚è½½ç›®å½•(Bind mounts)</span></a></h3><p>å¤šä¸ªç›®å½•çš„æŒ‚è½½ å¤šå†™å‡ æ¬¡<code>--mount</code>å³å¯</p><p><code>[root@docker web]# docker run --name dirbind -d -p 80:80 --mount type=bind,source=/root/web,target=/usr/share/nginx/html nginx</code><br> é¦–å…ˆæˆ‘åœ¨rootä¸‹æ–°å»ºwebç›®å½•å¹¶å†™ä¸ªindex.htmlæ–‡ä»¶å°†å…¶æŒ‚åˆ°ç”±nginxé•œåƒç”Ÿæˆçš„å®¹å™¨<code>dirbind</code>çš„htmlä¸‹.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker web]# docker run --name dirbind -d -p 80:80 --mount type=bind,source=/root/web,target=/usr/share/nginx/html nginx</span></span>
<span class="line"><span>2648c6f9e8ff3660e37dc64b0483bc906e5987082224fb0f8604e2bceef2da65</span></span>
<span class="line"><span>[root@docker web]# docker exec -it 264 /bin/bash</span></span>
<span class="line"><span>#æ­¤æ—¶å·²è¿›å…¥å®¹å™¨</span></span>
<span class="line"><span>root@2648c6f9e8ff:/# cd /usr/share/nginx/html</span></span>
<span class="line"><span>root@2648c6f9e8ff:/usr/share/nginx/html# ls</span></span>
<span class="line"><span>index.html</span></span>
<span class="line"><span>#indexæ–‡ä»¶å·²ç»æŒ‚è½½ä¸Šæ¥äº†. å†æ¬¡è®¿é—®nginxå°±èƒ½çœ‹åˆ°indexçš„å†…å®¹äº†.</span></span></code></pre></div><p>æŸ¥çœ‹å®¹å™¨ä¿¡æ¯<br><code>docker inspect dirbind</code> #Mountséƒ¨åˆ†å¯çœ‹åˆ°æŒ‚è½½ä¿¡æ¯,æ³¨æ„è¿™é‡Œ,<code>RW: true</code><br> è¯´æ˜æ˜¯è¯»å†™æƒé™çš„,å…¶å®è¿˜å¯ä»¥æŒ‚è½½ä¸ªåªè¯»çš„æ–‡ä»¶.åæœ‰è¯´æ˜.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&quot;Mounts&quot;: [</span></span>
<span class="line"><span>            {</span></span>
<span class="line"><span>                &quot;Type&quot;: &quot;bind&quot;,</span></span>
<span class="line"><span>                &quot;Source&quot;: &quot;/root/web&quot;,</span></span>
<span class="line"><span>                &quot;Destination&quot;: &quot;/usr/share/nginx/html&quot;,</span></span>
<span class="line"><span>                &quot;Mode&quot;: &quot;&quot;,</span></span>
<span class="line"><span>                &quot;RW&quot;: true,</span></span>
<span class="line"><span>                &quot;Propagation&quot;: &quot;rprivate&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        ],</span></span></code></pre></div><p>åªè¯»ç›®å½•æŒ‚è½½<br><code>docker run --name dirbind -d -p 80:80 --mount type=bind,source=/root/web,target=/usr/share/nginx/html,readonly nginx</code></p><h3 id="æŒ‚è½½å•ä¸ªæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æŒ‚è½½å•ä¸ªæ–‡ä»¶"><span>æŒ‚è½½å•ä¸ªæ–‡ä»¶</span></a></h3><p><code>docker run --name bindfile -d -p 80:80 \ --mount type=bind,source=/root/web,target=/usr/share/nginx/html \ --mount type=bind,source=/root/a.html,target=/usr/share/nginx/html/index.html nginx</code><br> ç¬¬äºŒä¸ª<code>--mount</code>æ˜¯æŒ‚è½½å•ä¸ªæ–‡ä»¶,å…¶ä¼šè¦†ç›–æŒ‚è½½çš„ç¬¬ä¸€ä¸ªç›®å½•ä¸‹çš„indexæ–‡ä»¶.</p><ul><li>å•ä¸ªæ–‡ä»¶çš„æŒ‚è½½è¦æ±‚å®¹å™¨å†…å¿…é¡»ä¹Ÿå­˜åœ¨æ­¤æ–‡ä»¶</li></ul><h2 id="dockerç½‘ç»œ" tabindex="-1"><a class="header-anchor" href="#dockerç½‘ç»œ"><span>dockerç½‘ç»œ</span></a></h2><p>docker ç½‘ç»œåˆ†ä¸º å¤–éƒ¨è®¿é—®å’Œå®¹å™¨äº’è”ä¸¤ç§æƒ…å†µ</p><h3 id="å¤–éƒ¨è®¿é—®" tabindex="-1"><a class="header-anchor" href="#å¤–éƒ¨è®¿é—®"><span>å¤–éƒ¨è®¿é—®</span></a></h3><p>è¿™ä¸ªå·²ç»å¹¶ä¸é™Œç”Ÿäº†å°±æ˜¯åœ¨<code>docker run</code>çš„æ—¶å€™åŠ ä¸Š<code>-p</code>å‚æ•°å³å¯æŒ‡å®šæœ¬åœ°ç«¯å£å’Œå®¹å™¨ç«¯å£<br> ä¸€ä¸ªæŒ‡å®šç«¯å£ä¸Šåªå¯ä»¥ç»‘å®šä¸€ä¸ªå®¹å™¨<br> æ ¼å¼æœ‰<code> ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort</code><br> è¿˜å¯ä»¥æŒ‡å®šç«¯å£æ ¼å¼(tcpæˆ–udp)<code>127.0.0.1:1111:1111/udp</code></p><ul><li>æ³¨æ„:è‹¥éœ€å¤šä¸ªç«¯å£ç»‘å®š,é‡å¤åªç”¨<code>-p</code> å³å¯</li></ul><p><code>docker port container_id</code> å¯æŸ¥çœ‹å®¹å™¨ç«¯å£æ˜ å°„æƒ…å†µ</p><p>ä½¿ç”¨<code>-P</code> å¤§å†™çš„Pé»˜è®¤ä¼šè‡ªåŠ¨åˆ†é…ç«¯å£è¿›è¡Œæ˜ å°„.</p><h3 id="å®¹å™¨äº’è”" tabindex="-1"><a class="header-anchor" href="#å®¹å™¨äº’è”"><span>å®¹å™¨äº’è”</span></a></h3><p><strong>æ–°å»ºç½‘ç»œ</strong><br><code>docker network create -d bridge web-net</code> æ–°å»ºä¸€ä¸ª<code>web-net</code>çš„ç½‘ç»œ<br><code>-d</code>Â å‚æ•°æŒ‡å®š Docker ç½‘ç»œç±»å‹ï¼Œæœ‰Â <code>bridge</code>Â <code>overlay</code>ã€‚å…¶ä¸­Â <code>overlay</code>Â ç½‘ç»œç±»å‹ç”¨äºÂ <code>Swarm mode</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker ~]# docker network create -d bridge web-net</span></span>
<span class="line"><span>3a06ef1bde3ea75c16afe1d3024d1a161d33c3c9499646521f30a74992607407</span></span>
<span class="line"><span>[root@docker ~]# docker network inspect web-net</span></span>
<span class="line"><span>[</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        &quot;Name&quot;: &quot;web-net&quot;,</span></span>
<span class="line"><span>        &quot;Id&quot;: &quot;3a06ef1bde3ea75c16afe1d3024d1a161d33c3c9499646521f30a74992607407&quot;,</span></span>
<span class="line"><span>        &quot;Created&quot;: &quot;2018-04-15T14:08:13.044203584+08:00&quot;,</span></span>
<span class="line"><span>        &quot;Scope&quot;: &quot;local&quot;,</span></span>
<span class="line"><span>        &quot;Driver&quot;: &quot;bridge&quot;,</span></span>
<span class="line"><span>        &quot;EnableIPv6&quot;: false,</span></span>
<span class="line"><span>        &quot;IPAM&quot;: {</span></span>
<span class="line"><span>            &quot;Driver&quot;: &quot;default&quot;,</span></span>
<span class="line"><span>            &quot;Options&quot;: {},</span></span>
<span class="line"><span>            &quot;Config&quot;: [</span></span>
<span class="line"><span>                {</span></span>
<span class="line"><span>                    &quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,</span></span>
<span class="line"><span>                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        &quot;Internal&quot;: false,</span></span>
<span class="line"><span>        &quot;Attachable&quot;: false,</span></span>
<span class="line"><span>        &quot;Ingress&quot;: false,</span></span>
<span class="line"><span>        &quot;ConfigFrom&quot;: {</span></span>
<span class="line"><span>            &quot;Network&quot;: &quot;&quot;</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        &quot;ConfigOnly&quot;: false,</span></span>
<span class="line"><span>        &quot;Containers&quot;: {},</span></span>
<span class="line"><span>        &quot;Options&quot;: {},</span></span>
<span class="line"><span>        &quot;Labels&quot;: {}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>]</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¹å™¨å…³è”ç½‘ç»œ</strong><br> é€šè¿‡<code>--network</code> å‚æ•°æŒ‡å®šå®¹å™¨ç½‘ç»œ<br><code>docker run --name web1 -d -P --network web-net nginx</code><br><code>docker run --name web2 -d -P --network web-net nginx</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker ~]# docker network inspect web-net</span></span>
<span class="line"><span>[</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        &quot;Name&quot;: &quot;web-net&quot;,</span></span>
<span class="line"><span>        &quot;Id&quot;: &quot;3a06ef1bde3ea75c16afe1d3024d1a161d33c3c9499646521f30a74992607407&quot;,</span></span>
<span class="line"><span>        &quot;Created&quot;: &quot;2018-04-15T14:08:13.044203584+08:00&quot;,</span></span>
<span class="line"><span>        &quot;Scope&quot;: &quot;local&quot;,</span></span>
<span class="line"><span>        &quot;Driver&quot;: &quot;bridge&quot;,</span></span>
<span class="line"><span>        &quot;EnableIPv6&quot;: false,</span></span>
<span class="line"><span>        &quot;IPAM&quot;: {</span></span>
<span class="line"><span>            &quot;Driver&quot;: &quot;default&quot;,</span></span>
<span class="line"><span>            &quot;Options&quot;: {},</span></span>
<span class="line"><span>            &quot;Config&quot;: [</span></span>
<span class="line"><span>                {</span></span>
<span class="line"><span>                    &quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,</span></span>
<span class="line"><span>                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        &quot;Internal&quot;: false,</span></span>
<span class="line"><span>        &quot;Attachable&quot;: false,</span></span>
<span class="line"><span>        &quot;Ingress&quot;: false,</span></span>
<span class="line"><span>        &quot;ConfigFrom&quot;: {</span></span>
<span class="line"><span>            &quot;Network&quot;: &quot;&quot;</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        &quot;ConfigOnly&quot;: false,</span></span>
<span class="line"><span>        &quot;Containers&quot;: {</span></span>
<span class="line"><span>            &quot;21250caa4838de429eeda541aab9d4e6e0697a4b9038d9656e0ee318db9f2636&quot;: {</span></span>
<span class="line"><span>                &quot;Name&quot;: &quot;web2&quot;,</span></span>
<span class="line"><span>                &quot;EndpointID&quot;: &quot;46cac28abeef408daa1351bd2c376376928c82c1bb2836cb729adcd7379022ce&quot;,</span></span>
<span class="line"><span>                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span></span>
<span class="line"><span>                &quot;IPv4Address&quot;: &quot;172.18.0.2/16&quot;,</span></span>
<span class="line"><span>                &quot;IPv6Address&quot;: &quot;&quot;</span></span>
<span class="line"><span>            },</span></span>
<span class="line"><span>            &quot;aca3aa6558188c41a2ab1f79993d845d6cea392fcc8c61d8acc0bc9864550834&quot;: {</span></span>
<span class="line"><span>                &quot;Name&quot;: &quot;web1&quot;,</span></span>
<span class="line"><span>                &quot;EndpointID&quot;: &quot;26e27856326d3bc04f29ecaf083dab789c80b0f64ce7c09159df31e896052ca6&quot;,</span></span>
<span class="line"><span>                &quot;MacAddress&quot;: &quot;02:42:ac:12:00:03&quot;,</span></span>
<span class="line"><span>                &quot;IPv4Address&quot;: &quot;172.18.0.3/16&quot;,</span></span>
<span class="line"><span>                &quot;IPv6Address&quot;: &quot;&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        &quot;Options&quot;: {},</span></span>
<span class="line"><span>        &quot;Labels&quot;: {}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>]</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿›å…¥å®¹å™¨ä¸­<code>docker exec -it /bin/bash</code><br> ubuntuå®¹å™¨æ²¡æœ‰pingåˆ™å®‰è£…</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>apt-get update</span></span>
<span class="line"><span>apt install net-tools       # ifconfig</span></span>
<span class="line"><span>apt install iputils-ping     # ping</span></span></code></pre></div><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>root@0b8f77731024:~# ping web2</span></span>
<span class="line"><span>PING net2 (172.18.0.2) 56(84) bytes of data.</span></span>
<span class="line"><span>64 bytes from web2.web-net (172.18.0.2): icmp_seq=1 ttl=64 time=0.085 ms</span></span>
<span class="line"><span>64 bytes from web2.web-net (172.18.0.2): icmp_seq=2 ttl=64 time=0.043 ms</span></span></code></pre></div><p>å¦‚æœæœ‰è¿‡ä¸ªå®¹å™¨è¦äº’è”,å¦‚æœä½ æœ‰å¤šä¸ªå®¹å™¨ä¹‹é—´éœ€è¦äº’ç›¸è¿æ¥ï¼Œ<code>Docker Compose</code>äº†è§£ä¸€ä¸‹.</p><h3 id="dns" tabindex="-1"><a class="header-anchor" href="#dns"><span>DNS</span></a></h3><p>è¿›å…¥å®¹å™¨ä¸­æ‰§è¡Œ<code>mount</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>root@0b8f77731024:~# mount</span></span>
<span class="line"><span>/dev/mapper/centos-root on /etc/resolv.conf type xfs (rw,relatime,attr2,inode64,noquota)</span></span>
<span class="line"><span>/dev/mapper/centos-root on /etc/hostname type xfs (rw,relatime,attr2,inode64,noquota)</span></span>
<span class="line"><span>/dev/mapper/centos-root on /etc/hosts type xfs (rw,relatime,attr2,inode64,noquota)</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°,dns,ä¸»æœºå,hostsæ–‡ä»¶æ˜¯è¢«æŒ‚è½½ä¸Šå»çš„,è¿™æ ·åªè¦å®¿ä¸»æœºæœ‰å˜æ›´,é‚£ä¹ˆå®¹å™¨å°±èƒ½ç«‹å³å¾—åˆ°æ›´æ–°.<br> åŒç†,å¦‚æœæœ‰éœ€è¦å¯å•ç‹¬è§æ–‡ä»¶è¿›è¡ŒæŒ‚è½½,å¹¶æŒ‡å‘å®¹å™¨å†…ç›¸å…³æ–‡ä»¶.</p><p><strong>è¿˜æœ‰ä¸€ç§æ–¹å¼</strong> é€šè¿‡<code>/etc/docker/daemon.json</code>æ¥é…ç½®,è¿™æ ·å½±å“æ‰€æœ‰å®¹å™¨</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;dns&quot; : [</span></span>
<span class="line"><span>    &quot;114.114.114.114&quot;,</span></span>
<span class="line"><span>    &quot;8.8.8.8&quot;</span></span>
<span class="line"><span>  ]</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>å¦‚æœæƒ³è¦æ‰‹åŠ¨æŒ‡å®šçš„è¯.åœ¨<code>docker run</code>çš„æ—¶å€™å¯ä»¥æ·»åŠ å‚æ•°<br><code>-h HOSTNAME </code>æˆ–è€… <code>--hostname=HOSTNAME </code>è®¾å®šå®¹å™¨çš„ä¸»æœºå,ä½†å®ƒåœ¨å®¹å™¨å¤–éƒ¨çœ‹ä¸åˆ°ï¼Œæ—¢ä¸ä¼šåœ¨ docker container ls ä¸­æ˜¾ç¤ºï¼Œä¹Ÿä¸ä¼šåœ¨å…¶ä»–çš„å®¹å™¨çš„ /etc/hosts çœ‹åˆ°ã€‚<br><code>--dns=IP_ADDRESS</code> æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„<code> /etc/resolv.conf</code> ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£ææ‰€æœ‰ä¸åœ¨ /etc/hosts ä¸­çš„ä¸»æœºåã€‚<br><code>--dns-search=DOMAIN </code>è®¾å®šå®¹å™¨çš„æœç´¢åŸŸï¼Œå½“è®¾å®šæœç´¢åŸŸä¸º <code>.example.com </code>æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢ <code>host.example.com</code></p><h3 id="é«˜çº§ç½‘ç»œé…ç½®" tabindex="-1"><a class="header-anchor" href="#é«˜çº§ç½‘ç»œé…ç½®"><span>é«˜çº§ç½‘ç»œé…ç½®</span></a></h3><p><a href="https://yeasy.gitbooks.io/docker_practice/content/advanced_network/" target="_blank" rel="noopener noreferrer">ç•¥ï¼Œå‚è€ƒé“¾æ¥</a></p><h2 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose"><span>Docker Compose</span></a></h2><p>Docker Compose æ˜¯ Docker å®˜æ–¹ç¼–æ’ï¼ˆOrchestrationï¼‰é¡¹ç›®ä¹‹ä¸€ï¼Œè´Ÿè´£å¿«é€Ÿçš„éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨</p><p>æˆ‘ä»¬çŸ¥é“é€šè¿‡Dockerfileå¯ä»¥å®ç°å•ç‹¬çš„ä¸€ä¸ªåº”ç”¨å®¹å™¨.<br> å®é™…,ä¸€ä¸ªé¡¹ç›®å¯èƒ½éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®Œæˆ.æ¯”å¦‚ä¸€ä¸ªåŠ¨æ€ç½‘ç«™,é™¤äº†é¡µé¢è¿˜æœ‰æ•°æ®åº“ç­‰ç­‰.</p><p>composeä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µ:<br> - æœåŠ¡(service) : ä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹<br> - é¡¹ç›®(project) :ã€€ä¸€ç»„å…³è”å®¹å™¨ç»„æˆçš„å®Œæ•´ä¸šåŠ¡å•å…ƒ</p><h3 id="å®‰è£…-1" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-1"><span>å®‰è£…</span></a></h3><p>äºŒè¿›åˆ¶å®‰è£…</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>sudo curl -L https://github.com/docker/compose/releases/download/1.17.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span></span>
<span class="line"><span></span></span>
<span class="line"><span>sudo chmod +x /usr/local/bin/docker-compose</span></span></code></pre></div><p>pipå®‰è£…<br><code>sudo pip install -U docker-compose</code></p><p>å®¹å™¨ä¸­æ‰§è¡Œ</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>curl -L https://github.com/docker/compose/releases/download/1.8.0/run.sh &gt; /usr/local/bin/docker-compose</span></span>
<span class="line"><span></span></span>
<span class="line"><span>chmod +x /usr/local/bin/docker-compose</span></span></code></pre></div><h3 id="ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨"><span>ä½¿ç”¨</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>â”œâ”€â”€ docker_compose</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ app.py</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ docker-compose.yml</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ Dockerfile</span></span></code></pre></div><p><code>app.py</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>from flask import Flask</span></span>
<span class="line"><span>from redis import Redis</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app = Flask(__name__)</span></span>
<span class="line"><span>redis = Redis(host=&#39;redis&#39;, port=6379)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.route(&#39;/&#39;)</span></span>
<span class="line"><span>def hello():</span></span>
<span class="line"><span>    count = redis.incr(&#39;hits&#39;)</span></span>
<span class="line"><span>    return &#39;Hello World! è¯¥é¡µé¢å·²è¢«è®¿é—® {} æ¬¡ã€‚\n&#39;.format(count)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if __name__ == &quot;__main__&quot;:</span></span>
<span class="line"><span>    app.run(host=&quot;0.0.0.0&quot;, debug=True)</span></span></code></pre></div><p><code>Dockerfile</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>FROM python:3.6-alpine</span></span>
<span class="line"><span>ADD . /code</span></span>
<span class="line"><span>WORKDIR /code</span></span>
<span class="line"><span>RUN pip install redis flask</span></span>
<span class="line"><span>CMD [&quot;python&quot;, &quot;app.py&quot;]</span></span></code></pre></div><p><code>docker-compose.yml</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>version: &#39;3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  web:</span></span>
<span class="line"><span>    build: .</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>     - &quot;5000:5000&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  redis:</span></span>
<span class="line"><span>    image: &quot;redis:alpine&quot;</span></span></code></pre></div><p>ç„¶åæ‰§è¡Œ<code>docker-compose up</code> å³å¯</p><h3 id="å‘½ä»¤å‚æ•°è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤å‚æ•°è¯´æ˜"><span>å‘½ä»¤å‚æ•°è¯´æ˜</span></a></h3><p>docker-compose</p><pre><code>- `-f, --file FILE` æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º `docker-compose.yml`ï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚
- `-p, --project-name NAME` æŒ‡å®šé¡¹ç›®åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨æ‰€åœ¨ç›®å½•åç§°ä½œä¸ºé¡¹ç›®åã€‚
- `--x-networking` ä½¿ç”¨ Docker çš„å¯æ‹”æ’ç½‘ç»œåç«¯ç‰¹æ€§
- `--x-network-driver DRIVER` æŒ‡å®šç½‘ç»œåç«¯çš„é©±åŠ¨ï¼Œé»˜è®¤ä¸º bridge
- `--verbose` è¾“å‡ºæ›´å¤šè°ƒè¯•ä¿¡æ¯
- `-v, --version` æ‰“å°ç‰ˆæœ¬å¹¶é€€å‡º
</code></pre><p>docker-compose <code>build</code><br> ç”¨æ¥åˆ›å»ºæˆ–é‡æ–°åˆ›å»ºæœåŠ¡ä½¿ç”¨çš„é•œåƒ<br> docker-compose build service_a<br> åˆ›å»ºä¸€ä¸ªé•œåƒåå«service_a</p><p>docker-compose <code>kill</code><br> ç”¨äºé€šè¿‡å®¹å™¨å‘é€SIGKILLä¿¡å·å¼ºè¡Œåœæ­¢æœåŠ¡</p><p>docker-compose <code>logs</code><br> æ˜¾ç¤ºserviceçš„æ—¥å¿—ä¿¡æ¯</p><p>docker-compose pause/unpause<br> docker-compose pause #æš‚åœæœåŠ¡<br> docker-compose unpause #æ¢å¤è¢«æš‚åœçš„æœåŠ¡</p><p>docker-compose <code>port</code><br> ç”¨äºæŸ¥çœ‹æœåŠ¡ä¸­çš„ç«¯å£ä¸ç‰©ç†æœºçš„æ˜ å°„å…³ç³»<br> docker-compose port nginx_web 80<br> æŸ¥çœ‹æœåŠ¡ä¸­80ç«¯å£æ˜ å°„åˆ°ç‰©ç†æœºä¸Šçš„é‚£ä¸ªç«¯å£</p><p>dokcer-compose <code>ps</code><br> ç”¨äºæ˜¾ç¤ºå½“å‰é¡¹ç›®ä¸‹çš„å®¹å™¨<br> æ³¨æ„ï¼Œæ­¤å‘½ä»¤ä¸docker psä¸åŒä½œç”¨ï¼Œæ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºåœæ­¢åçš„å®¹å™¨ï¼ˆçŠ¶æ€ä¸ºExitedï¼‰ï¼Œåªå¾å¯¹æŸä¸ªé¡¹ç›®ã€‚</p><p>docker-compose <code>pull</code><br> ç”¨äºæ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒ</p><p>docker-compose <code>restart</code><br> ç”¨äºé‡å¯æŸä¸ªæœåŠ¡ä¸­çš„æ‰€æœ‰å®¹å™¨<br> docker-compose restart service_name<br> åªæœ‰æ­£åœ¨è¿è¡Œçš„æœåŠ¡å¯ä»¥ä½¿ç”¨é‡å¯å‘½ä»¤ï¼Œåœæ­¢çš„æœåŠ¡æ˜¯ä¸å¯ä»¥é‡å¯</p><p>docker-compose <code>rm</code><br> åˆ é™¤åœæ­¢çš„æœåŠ¡ï¼ˆæœåŠ¡é‡Œçš„å®¹å™¨ï¼‰</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>-f #å¼ºåˆ¶åˆ é™¤</span></span>
<span class="line"><span>-v #åˆ é™¤ä¸å®¹å™¨ç›¸å…³çš„å·ï¼ˆvolumesï¼‰</span></span></code></pre></div><p>docker-compose <code>run</code><br> ç”¨äºåœ¨æœåŠ¡ä¸­è¿è¡Œä¸€ä¸ªä¸€æ¬¡æ€§çš„å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤ä¼šæ–°å»ºä¸€ä¸ªå®¹å™¨ï¼Œå®ƒçš„é…ç½®å’Œsrviceçš„é…ç½®ç›¸åŒã€‚<br> ä½†ä¸¤è€…ä¹‹é—´è¿˜æ˜¯æœ‰ä¸¤ç‚¹ä¸åŒä¹‹å¤„</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>1ã€runæŒ‡å®šçš„å‘½ä»¤ä¼šç›´æ¥è¦†ç›–æ‰serviceé…ç½®ä¸­æŒ‡å®šçš„å‘½ä»¤</span></span>
<span class="line"><span>2ã€runå‘½ä»¤å¯åŠ¨çš„å®¹å™¨ä¸ä¼šåˆ›å»ºåœ¨serviceé…ç½®ä¸­æŒ‡å®šçš„ç«¯å£ï¼Œå¦‚æœéœ€è¦æŒ‡å®šä½¿ç”¨--service-portsæŒ‡å®š</span></span></code></pre></div><p>docker-compose start/stop<br> docker-compose start å¯åŠ¨è¿è¡ŒæŸä¸ªæœåŠ¡çš„æ‰€æœ‰å®¹å™¨<br> docker-compose stop å¯åŠ¨è¿è¡ŒæŸä¸ªæœåŠ¡çš„æ‰€æœ‰å®¹å™¨</p><p>docker-compose scale<br> æŒ‡å®šæŸä¸ªæœåŠ¡å¯åŠ¨çš„å®¹å™¨ä¸ªæ•°</p><h3 id="å®ä¾‹ä¸€" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹ä¸€"><span>å®ä¾‹ä¸€</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>[root@docker web-nginx]# tree</span></span>
<span class="line"><span>.</span></span>
<span class="line"><span>â”œâ”€â”€ docker-compose.yml</span></span>
<span class="line"><span>â”œâ”€â”€ nginx</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ nginx.conf</span></span>
<span class="line"><span>â””â”€â”€ webserver</span></span>
<span class="line"><span>    â””â”€â”€ index.html</span></span></code></pre></div><p><code>nginx.conf</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>#user  nginx;</span></span>
<span class="line"><span>worker_processes  1;</span></span>
<span class="line"><span>error_log  /var/log/nginx_error.log warn;</span></span>
<span class="line"><span>pid        /var/run/nginx.pid;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>events {</span></span>
<span class="line"><span>    worker_connections  1024;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>http {</span></span>
<span class="line"><span>    include       mime.types;</span></span>
<span class="line"><span>    default_type  application/octet-stream;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    access_log  /var/log/nginx_access.log  main;</span></span>
<span class="line"><span>    client_max_body_size 10m;  </span></span>
<span class="line"><span>    sendfile        on;</span></span>
<span class="line"><span>    #tcp_nopush     on;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    keepalive_timeout  65;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    #gzip  on;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>    listen       80;</span></span>
<span class="line"><span>    server_name  localhost;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>        root   /webserver;</span></span>
<span class="line"><span>        index  index.html index.htm;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>    #include /usr/local/nginx/conf.d/*.conf;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>index.html</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span>&lt;html lang=&quot;en&quot;&gt;</span></span>
<span class="line"><span>&lt;head&gt;</span></span>
<span class="line"><span>    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span>
<span class="line"><span>    &lt;title&gt;welcome to nginx web stie&lt;/title&gt;</span></span>
<span class="line"><span>&lt;/head&gt;</span></span>
<span class="line"><span>&lt;body&gt;</span></span>
<span class="line"><span>   &lt;h2&gt;compose test1---1&lt;/h2&gt;</span></span>
<span class="line"><span>&lt;/body&gt;</span></span>
<span class="line"><span>&lt;/html&gt;</span></span></code></pre></div><p><code>docker-compose.yml</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>version: &quot;3&quot; #æŒ‡å®šè¯­æ³•ç‰ˆæœ¬</span></span>
<span class="line"><span>services: #å®šä¹‰æœåŠ¡</span></span>
<span class="line"><span>  nginx:</span></span>
<span class="line"><span>    container_name: web-nginx #å®¹å™¨åå­—</span></span>
<span class="line"><span>    image: centos_nginx:v5 #ä¾èµ–é•œåƒ</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    ports:  #ç«¯å£æ˜ å°„</span></span>
<span class="line"><span>      - 80:80</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      #æ˜ å°„æ–‡ä»¶åˆ°å®¹å™¨.ç¬¬ä¸€ä¸ªæ˜¯webçš„,åœ¨nginxé€šè¿‡rootæŒ‡å®šè·¯å¾„.ç¬¬äºŒä¸ªæ˜¯é…ç½®æ–‡ä»¶.</span></span>
<span class="line"><span>      #å¦‚æœä¸æƒ³æŒ‡å®šweb,å¯ç›´æ¥æ˜ å°„åˆ°nginxé»˜è®¤htmlè·¯å¾„.nginxé…ç½®ä¸éœ€è¦æŒ‡å®šè·¯å¾„äº†</span></span>
<span class="line"><span>      #- ./webserver:/usr/local/nginx/html</span></span>
<span class="line"><span>      - ./webserver:/webserver</span></span>
<span class="line"><span>      - ./nginx/nginx.conf:/usr/local/nginx/conf/nginx.conf</span></span></code></pre></div><h3 id="å®ä¾‹äºŒ" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹äºŒ"><span>å®ä¾‹äºŒ</span></a></h3><p>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œtest<code>docker network create --subnet=172.88.0.0/16 test</code><br> ç½‘ç»œåtestå’Œipä¼šåœ¨docker-composeä¸­ä½¿ç”¨,ç”¨æ¥æŒ‡å®šç½‘ç»œå’ŒIP,åŒæ—¶IPä¸nginxè´Ÿè½½æœ‰å…³</p><h4 id="ç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ç»“æ„"><span>ç›®å½•ç»“æ„</span></a></h4><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>â”œâ”€â”€ docker-compose.yml</span></span>
<span class="line"><span>â”œâ”€â”€ etc</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ localtime</span></span>
<span class="line"><span>â”œâ”€â”€ nginx</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ Dockerfile</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ nginx-1.12.2.tar.gz</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ nginx.conf</span></span>
<span class="line"><span>â”œâ”€â”€ tomcat</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ apache-tomcat-8.5.24.tar.gz</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ Dockerfile</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ jdk-8u45-linux-x64.tar.gz</span></span>
<span class="line"><span>â””â”€â”€ webserver</span></span>
<span class="line"><span>    â”œâ”€â”€ tomcatA</span></span>
<span class="line"><span>    â”‚Â Â  â””â”€â”€ index.jsp</span></span>
<span class="line"><span>    â””â”€â”€ tomcatB</span></span>
<span class="line"><span>        â””â”€â”€ index.jsp</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx"><span>nginx</span></a></h4><p><code>nginx.conf</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>#user  nginx;</span></span>
<span class="line"><span>worker_processes  1;</span></span>
<span class="line"><span>error_log  /var/log/nginx_error.log warn;</span></span>
<span class="line"><span>pid        /var/run/nginx.pid;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>events {</span></span>
<span class="line"><span>    worker_connections  1024;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>http {</span></span>
<span class="line"><span>    upstream tomcat  { </span></span>
<span class="line"><span>      server 172.88.0.11:8080; </span></span>
<span class="line"><span>      server 172.88.0.22:8080; </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    include       mime.types;</span></span>
<span class="line"><span>    default_type  application/octet-stream;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    access_log  /var/log/nginx_access.log  main;</span></span>
<span class="line"><span>    client_max_body_size 10m;  </span></span>
<span class="line"><span>    sendfile        on;</span></span>
<span class="line"><span>    #tcp_nopush     on;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    keepalive_timeout  65;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    #gzip  on;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    server {</span></span>
<span class="line"><span>        listen       80;</span></span>
<span class="line"><span>        server_name  tomcat;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        location / {</span></span>
<span class="line"><span>            #root   /webserver;</span></span>
<span class="line"><span>            proxy_pass http://tomcat;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    #include /usr/local/nginx/conf.d/*.conf;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Dcokerfile</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>FROM centos</span></span>
<span class="line"><span></span></span>
<span class="line"><span>MAINTAINER zili.li</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ADD nginx-1.12.2.tar.gz /usr/local/src</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN buildDeps=&#39;gcc gcc-c++ glib make autoconf openssl openssl-devel libxslt-devel gd gd-devel GeoIP GeoIP-devel pcre pcre-devel wget curl&#39; \ </span></span>
<span class="line"><span>                &amp;&amp; yum -y install $buildDeps \</span></span>
<span class="line"><span>                &amp;&amp; useradd -M -s /sbin/nologin nginx</span></span>
<span class="line"><span></span></span>
<span class="line"><span>VOLUME [&quot;/usr/local/nginx/html&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>WORKDIR /usr/local/src/nginx-1.12.2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RUN ./configure --user=nginx --group=nginx --prefix=/usr/local/nginx --with-file-aio --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_stub_status_module \</span></span>
<span class="line"><span>                &amp;&amp; make \</span></span>
<span class="line"><span>                &amp;&amp; make install \</span></span>
<span class="line"><span>                &amp;&amp; rm -rf /usr/local/src/nginx-1.12.2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ENV PATH /usr/local/nginx/sbin:$PATH                </span></span>
<span class="line"><span></span></span>
<span class="line"><span>EXPOSE 80</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ENTRYPOINT [&quot;nginx&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CMD [&quot;-g&quot;,&quot;daemon off;&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="tomcat" tabindex="-1"><a class="header-anchor" href="#tomcat"><span>tomcat</span></a></h4><p><code>Dcokerfile</code></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>FROM centos</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ADD jdk-8u45-linux-x64.tar.gz /usr/local</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ENV RUN_AS_USER=root</span></span>
<span class="line"><span>ENV JAVA_HOME /usr/local/jdk1.8.0_45</span></span>
<span class="line"><span>ENV CLASS_HOME=/usr/local/jdk1.8.0_45/lib:$JAVA_HOME/jre/lib</span></span>
<span class="line"><span>ENV CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span></span>
<span class="line"><span>ENV PATH=$PATH:$JAVA_HOME/bin</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ADD apache-tomcat-8.5.24.tar.gz /usr/local</span></span>
<span class="line"><span></span></span>
<span class="line"><span>EXPOSE 8080</span></span>
<span class="line"><span>ENTRYPOINT [&quot;/usr/local/apache-tomcat-8.5.24/bin/catalina.sh&quot;, &quot;run&quot;]</span></span></code></pre></div><h4 id="docker-compose-1" tabindex="-1"><a class="header-anchor" href="#docker-compose-1"><span>docker-compose</span></a></h4><p><code>docker-compose.yml</code></p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>version: &quot;3&quot;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  nginx:</span></span>
<span class="line"><span>    hostname: nginx</span></span>
<span class="line"><span>    build: ./nginx</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - 80:80</span></span>
<span class="line"><span>    networks:</span></span>
<span class="line"><span>      test:</span></span>
<span class="line"><span>        ipv4_address: 172.88.0.88</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - ./nginx/nginx.conf:/usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"><span>      - ./etc/localtime:/etc/localtime</span></span>
<span class="line"><span>    depends_on:</span></span>
<span class="line"><span>      - tomcat1</span></span>
<span class="line"><span>      - tomcat2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  tomcat1:</span></span>
<span class="line"><span>    hostname: tomcat1</span></span>
<span class="line"><span>    build: ./tomcat</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - ./webserver/tomcatA:/usr/local/apache-tomcat-8.5.24/webapps/ROOT</span></span>
<span class="line"><span>      - ./etc/localtime:/etc/localtime</span></span>
<span class="line"><span>    networks:</span></span>
<span class="line"><span>      test:</span></span>
<span class="line"><span>        ipv4_address: 172.88.0.11</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  tomcat2:</span></span>
<span class="line"><span>    hostname: tomcat2</span></span>
<span class="line"><span>    build: ./tomcat</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - ./webserver/tomcatB/index.jsp:/usr/local/apache-tomcat-8.5.24/webapps/ROOT/index.jsp</span></span>
<span class="line"><span>      - ./etc/localtime:/etc/localtime</span></span>
<span class="line"><span>    networks:</span></span>
<span class="line"><span>      test:</span></span>
<span class="line"><span>        ipv4_address: 172.88.0.22</span></span>
<span class="line"><span></span></span>
<span class="line"><span>networks:</span></span>
<span class="line"><span>  test:</span></span>
<span class="line"><span>    external: true</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>docker-compose up</code></p><h2 id="docker-machine" tabindex="-1"><a class="header-anchor" href="#docker-machine"><span>docker machine</span></a></h2><h3 id="å®‰è£…-2" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-2"><span>å®‰è£…</span></a></h3><ul><li>linux<br><a href="https://github.com/docker/machine/releases" target="_blank" rel="noopener noreferrer">å®˜ç½‘</a>ä¸‹è½½ç›¸å…³å®‰è£…åŒ…,å®‰è£…å³å¯ .</li></ul><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>$ sudo curl -L https://github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-machine</span></span>
<span class="line"><span>$ sudo chmod +x /usr/local/bin/docker-machine</span></span></code></pre></div><h3 id="ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-1"><span>ä½¿ç”¨</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>docker-machine create \</span></span>
<span class="line"><span>    --driver vmwarevsphere \</span></span>
<span class="line"><span>    --vmwarevsphere-vcenter=xxx.xxx.xxx.xxx \</span></span>
<span class="line"><span>    --vmwarevsphere-username=xxxxx \</span></span>
<span class="line"><span>    --vmwarevsphere-password=xxxxxxx \</span></span>
<span class="line"><span>    --vmwarevsphere-cpu-count=1 \</span></span>
<span class="line"><span>    --vmwarevsphere-memory-size=512 \</span></span>
<span class="line"><span>    --vmwarevsphere-disk-size=10240 \</span></span>
<span class="line"><span>    TestDcokerMa</span></span></code></pre></div><p><code>driver vmwarevsphere</code><br> æˆ‘ä»¬çš„è™šæ‹Ÿæœº host ä¸Šå®‰è£…çš„æ˜¯ vmware çš„äº§å“ vSphereï¼Œå› æ­¤éœ€è¦ç»™ Docker Machine æä¾›å¯¹åº”çš„é©±åŠ¨ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿåœ¨ä¸Šé¢å®‰è£…æ–°çš„è™šæ‹Ÿæœºã€‚<br><code>--vmwarevsphere-vcenter=xxx.xxx.xxx.xxx</code><br><code>--vmwarevsphere-username=root </code><br><code>--vmwarevsphere-password=12345678</code><br> ä¸Šé¢ä¸‰è¡Œåˆ†åˆ«æŒ‡å®šäº†è™šæ‹Ÿæœº host çš„ IP åœ°å€ã€ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p><code>--vmwarevsphere-cpu-count=1</code><br><code>--vmwarevsphere-memory-size=512</code><br><code>--vmwarevsphere-disk-size=10240</code><br> ä¸Šé¢ä¸‰è¡Œåˆ™åˆ†åˆ«æŒ‡å®šäº†æ–°åˆ›å»ºçš„è™šæ‹Ÿæœºå ç”¨çš„ cpuã€å†…å­˜å’Œç£ç›˜èµ„æºã€‚<br><code>TestDcokerMa</code><br> æœ€åä¸€ä¸ªå‚æ•°åˆ™æ˜¯æ–°å»ºè™šæ‹Ÿæœºçš„åç§°ã€‚</p><p><a href="https://docs.docker.com/machine/" target="_blank" rel="noopener noreferrer">è¯¦ç»†ä½¿ç”¨å‚è€ƒå®˜ç½‘</a><br> â€‹</p></div><!--[--><Sponsor></Sponsor><!--]--><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/ops/linux/SaltStack%E5%AD%A6%E4%B9%A0.html" aria-label="SaltStack"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->SaltStack</div></a><a class="route-link auto-link next" href="/ops/linux/Nginx.html" aria-label="Nginx"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Nginx<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--17c4bf36:;"><!-- <div class="busuanzi">
      <span id="busuanzi_container_site_pv" style="display: none">
        æœ¬ç«™æ€»è®¿é—®é‡
        <span id="busuanzi_value_site_pv"></span>æ¬¡
        <span class="post-meta-divider">|</span>
      </span>
      <span id="busuanzi_container_site_uv" style="display: none">
        æ‚¨æ˜¯æœ¬ç«™ç¬¬
        <span id="busuanzi_value_site_uv"></span>ä½è®¿é—®è€…
      </span>
    </div> --><div class="footer-content"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2016-2024 z</div></div><span id="runtime_span"></span><div class="footer-link"><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1.gif" alt="" style="width:auto;height:32px;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="https://www.travellings.cn/assets/logo.gif" alt="" style="width:auto;height:32px;" title="å¼€å¾€-å‹é“¾æ¥åŠ›"></a><!-- <a href="https://www.foreverblog.cn/" target="_blank">
        <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width: auto; height: 16px" />
      </a> --></div></footer></div><!--]--><!--[--><!----><!----><div></div><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BfCDUtKQ.js" defer></script>
  </body>
</html>
