<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://docs.lizili.online/ops/linux/SaltStack%E5%AD%A6%E4%B9%A0.html"><meta property="og:site_name" content="lzz's Blog"><meta property="og:title" content="SaltStack"><meta property="og:description" content="è¯·æ³¨æ„ æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚ saltç®€ä»‹ SaltStackæ˜¯ä¸€ä¸ªæœåŠ¡å™¨åŸºç¡€æ¶æ„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå…·å¤‡é…ç½®ç®¡ç†ã€è¿œç¨‹æ‰§è¡Œã€ç›‘æ§ç­‰åŠŸèƒ½ï¼ŒåŸºäºPythonè¯­è¨€å®ç°ï¼Œç»“åˆè½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆZeroMQï¼‰ä¸Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆPyzmqã€PyCryptoã€Pyjinjia2ã€python-msgpackå’ŒPyYAMLç­‰ï¼‰æ„å»ºã€‚ é€šè¿‡éƒ¨ç½²SaltS..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-12-16T05:38:25.000Z"><meta property="article:author" content="z"><meta property="article:tag" content="saltstack"><meta property="article:modified_time" content="2024-12-16T05:38:25.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"SaltStack","image":[""],"dateModified":"2024-12-16T05:38:25.000Z","author":[{"@type":"Person","name":"z","url":"https://docs.lizili.online"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?088df8f788eb6cfa86e86b04cee94211";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
        </script><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://docs.lizili.online/rss.xml" title="lzz's Blog RSS Feed"><title>SaltStack | lzz's Blog</title><meta name="description" content="è¯·æ³¨æ„ æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚ saltç®€ä»‹ SaltStackæ˜¯ä¸€ä¸ªæœåŠ¡å™¨åŸºç¡€æ¶æ„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå…·å¤‡é…ç½®ç®¡ç†ã€è¿œç¨‹æ‰§è¡Œã€ç›‘æ§ç­‰åŠŸèƒ½ï¼ŒåŸºäºPythonè¯­è¨€å®ç°ï¼Œç»“åˆè½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆZeroMQï¼‰ä¸Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆPyzmqã€PyCryptoã€Pyjinjia2ã€python-msgpackå’ŒPyYAMLç­‰ï¼‰æ„å»ºã€‚ é€šè¿‡éƒ¨ç½²SaltS...">
    <link rel="preload" href="/assets/style-BWhSO6JG.css" as="style"><link rel="stylesheet" href="/assets/style-BWhSO6JG.css">
    <link rel="modulepreload" href="/assets/app-BfCDUtKQ.js"><link rel="modulepreload" href="/assets/SaltStackå­¦ä¹ .html-CnSV7cpa.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">lzz&#39;s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="è¿å¼€"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span>è¿å¼€<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">è¿ç»´ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/ops/linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/GitOps/" aria-label="GitOps"><!--[--><span class="font-icon icon iconfont icon-git" style=""></span><!--]-->GitOps<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/ops/monitor/" aria-label="Monitor"><!--[--><span class="font-icon icon iconfont icon-monitor" style=""></span><!--]-->Monitor<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å¼€å‘ç¬”è®°</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/code/" aria-label="Code"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->Code<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/ops/" aria-label="Ops"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Ops<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/script/" aria-label="Script"><!--[--><span class="font-icon icon iconfont icon-script" style=""></span><!--]-->Script<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å…¶ä»–</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/team/" aria-label="Team"><!--[--><span class="font-icon icon iconfont icon-tuandui" style=""></span><!--]-->Team<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/coder/faq/" aria-label="FAQ"><!--[--><span class="font-icon icon iconfont icon-Faq" style=""></span><!--]-->FAQ<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="äº‘åŸç”Ÿ"><!--[--><span class="font-icon icon iconfont icon-yunyuansheng" style=""></span>äº‘åŸç”Ÿ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/kubernetes/" aria-label="kubernetes"><!--[--><span class="font-icon icon iconfont icon-kubernetes" style=""></span><!--]-->kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/backup/" aria-label="backup"><!--[--><span class="font-icon icon iconfont icon-backup" style=""></span><!--]-->backup<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cloud-native/middleware/" aria-label="middleware"><!--[--><span class="font-icon icon iconfont icon-zhongjianjian" style=""></span><!--]-->middleware<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ‰‹å†Œ"><!--[--><span class="font-icon icon iconfont icon-shouce" style=""></span>æ‰‹å†Œ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/shell.html" aria-label="shell"><!--[--><span class="font-icon icon iconfont icon-shell" style=""></span><!--]-->shell<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/markdown/" aria-label="markdown"><!--[--><span class="font-icon icon iconfont icon-markdown" style=""></span><!--]-->markdown<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/guide/vuepress/" aria-label="vuepress"><!--[--><span class="font-icon icon iconfont icon-vue" style=""></span><!--]-->vuepress<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tools/" aria-label="å·¥å…·åˆ†äº«"><!--[--><span class="font-icon icon iconfont icon-tools" style=""></span><!--]-->å·¥å…·åˆ†äº«<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/hobby/" aria-label="çˆ±å¥½"><!--[--><span class="font-icon icon iconfont icon-xingquaihao" style=""></span><!--]-->çˆ±å¥½<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="ç•™è¨€æ¿"><!--[--><span class="font-icon icon iconfont icon-mark" style=""></span><!--]-->ç•™è¨€æ¿<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="å‹é“¾"><!--[--><span class="font-icon icon iconfont icon-link" style=""></span><!--]-->å‹é“¾<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://foreverblog.cn/go.html" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢" target="_blank" rel="noopener noreferrer" aria-label="wormhole"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M644.608 665.6c192.512-171.008 342.016-395.776 254.464-494.592-27.648-31.232-66.56-45.568-108.032-41.472-34.816 3.584-70.656 20.992-107.008 50.176-116.224-59.904-254.464-55.296-366.592 11.776-86.016 51.2-148.48 134.656-172.544 231.936-18.944 74.24-14.336 152.064 12.8 223.744-44.544 50.688-86.528 154.624-34.816 212.992 21.504 24.576 52.736 35.328 90.112 35.328 114.176-0.512 286.72-100.864 431.616-229.888z m155.648-452.608c14.848-1.536 26.624 2.56 36.352 13.824 9.728 10.752 7.168 39.936-10.752 80.896-18.944-28.672-41.984-55.296-68.096-77.824 17.92-10.752 32.256-15.872 42.496-16.896z m-598.528 517.12c18.944 27.136 40.96 51.712 66.048 73.216-43.008 12.8-72.192 11.776-81.92 1.024-8.704-10.752 0.512-45.056 15.872-74.24z m685.568-246.784c-51.2 75.264-122.368 154.112-200.704 224.256-81.408 72.192-171.008 134.656-254.464 176.64 26.112 5.632 52.224 8.704 78.848 8.704 68.096 0 135.168-18.944 194.048-53.76 124.416-73.216 195.072-211.968 182.272-355.84z m0 0" p-id="4157"></path></svg></a></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://www.travellings.cn/go.html" title="å¼€å¾€" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/ansible%E5%AD%A6%E4%B9%A0.html" aria-label="Ansible"><!---->Ansible<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><!---->Centos 9 init<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/ops/linux/SaltStack%E5%AD%A6%E4%B9%A0.html" aria-label="SaltStack"><!---->SaltStack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Docker%E5%AD%A6%E4%B9%A0.html" aria-label="Docker"><!---->Docker<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/Nginx.html" aria-label="Nginx"><!---->Nginx<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/git.html" aria-label="Git"><!---->Git<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/redis.html" aria-label="Redis"><!---->Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/package-rpm.html" aria-label="rpmåŒ…åˆ¶ä½œ"><!---->rpmåŒ…åˆ¶ä½œ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/%E8%A7%A3%E5%8E%8B%E7%BC%A9.html" aria-label="å‹ç¼©ä¸è§£å‹"><!---->å‹ç¼©ä¸è§£å‹<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/ops/linux/keepalived.html" aria-label="keepalived"><!---->keepalived<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->SaltStack</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://docs.lizili.online" target="_blank" rel="noopener noreferrer">z</a></span><span property="author" content="z"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-02T11:08:55.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 25 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">è‡ªåŠ¨åŒ–å·¥å…·</span><span class="page-category-item color8 clickable" role="navigation">linux</span><!--]--><meta property="articleSection" content="è‡ªåŠ¨åŒ–å·¥å…·,linux"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">saltstack</span><!--]--><meta property="keywords" content="saltstack"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#saltç®€ä»‹">saltç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#saltåŸºæœ¬åŸç†">saltåŸºæœ¬åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å®‰è£…salt">å®‰è£…salt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#é…ç½®salt">é…ç½®salt</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#master">master</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#minion">minion</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ·»åŠ key">æ·»åŠ key</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-keyå¸¸ç”¨å‚æ•°">salt-keyå¸¸ç”¨å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ‹è¯•è¿é€šæ€§">æµ‹è¯•è¿é€šæ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•æœåŠ¡çš„å®‰è£…">ç®€å•æœåŠ¡çš„å®‰è£…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#saltå¸¸ç”¨å‘½ä»¤">saltå¸¸ç”¨å‘½ä»¤</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt">salt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-run">salt-run</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-key">salt-key</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-call">salt-call</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-cp">salt-cp</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-master">salt-master</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-minion">salt-minion</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ™®é€šç”¨æˆ·æ‰§è¡Œsalt">æ™®é€šç”¨æˆ·æ‰§è¡Œsalt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#target">target</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¤šmaster">å¤šmaster</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#yaml">YAML</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jinja">Jinja</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#saltå¸¸ç”¨æ¨¡å—å’Œapi">saltå¸¸ç”¨æ¨¡å—å’ŒAPI</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰modules">æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰modules</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#salt-clientè°ƒç”¨apiä¸¾ä¾‹">salt.clientè°ƒç”¨APIä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#archive">Archive</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cmd">cmd</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cp">cp</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cron">cron</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#file">file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#network">network</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pkg">pkg</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#status">status</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#system">system</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#systemd-service">systemd(service)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#grains">grains</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#grainsçš„ä½¿ç”¨">grainsçš„ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è‡ªå®šä¹‰grains-ä¸¤ç§æ–¹æ³•">è‡ªå®šä¹‰grains(ä¸¤ç§æ–¹æ³•)</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#pillar">pillar</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pillaråŸºæœ¬ä½¿ç”¨">pillaråŸºæœ¬ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼–å†™pillar">ç¼–å†™pillar</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#åœ¨stateä¸­é€šè¿‡jinjaä½¿ç”¨pillar">åœ¨stateä¸­é€šè¿‡jinjaä½¿ç”¨pillar</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jinjaé…åˆgrains-æŒ‡å®špillaræ•°æ®">jinjaé…åˆgrains æŒ‡å®špillaræ•°æ®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä½¿ç”¨salt-state">ä½¿ç”¨salt state</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€å•çš„stateæ–‡ä»¶é…ç½®-ä»‹ç»">ç®€å•çš„stateæ–‡ä»¶é…ç½®&amp;ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¾ƒå¤æ‚çš„state">è¾ƒå¤æ‚çš„state</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å…³äºæ¸²æŸ“å™¨-render-system">å…³äºæ¸²æŸ“å™¨ render system</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#pyæ¸²æŸ“å™¨">pyæ¸²æŸ“å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#stateçš„æ‰§è¡Œé¡ºåº">stateçš„æ‰§è¡Œé¡ºåº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#orderçš„è®¾å®š">orderçš„è®¾å®š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä¾èµ–å…³ç³»ç³»ç»Ÿ-requisite-system">ä¾èµ–å…³ç³»ç³»ç»Ÿ requisite system</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#salt-stateå¤šç¯å¢ƒ">salt stateå¤šç¯å¢ƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#salt-schedule-saltä¸­çš„crontab">salt schedule(saltä¸­çš„crontab)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#salt-ssh">salt ssh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#returners">Returners</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ‰©å±•salt">æ‰©å±•salt</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1><div class="hint-container caution"><p class="hint-container-title">è¯·æ³¨æ„</p><p>æœ¬æ–‡å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è‡ªè¡Œç”„åˆ«ã€‚</p></div><h2 id="saltç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#saltç®€ä»‹"><span>saltç®€ä»‹</span></a></h2><p>SaltStackæ˜¯ä¸€ä¸ªæœåŠ¡å™¨åŸºç¡€æ¶æ„é›†ä¸­åŒ–ç®¡ç†å¹³å°ï¼Œå…·å¤‡é…ç½®ç®¡ç†ã€è¿œç¨‹æ‰§è¡Œã€ç›‘æ§ç­‰åŠŸèƒ½ï¼ŒåŸºäºPythonè¯­è¨€å®ç°ï¼Œç»“åˆè½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆZeroMQï¼‰ä¸Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆPyzmqã€PyCryptoã€Pyjinjia2ã€python-msgpackå’ŒPyYAMLç­‰ï¼‰æ„å»ºã€‚</p><p>é€šè¿‡éƒ¨ç½²SaltStackï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆåƒä¸‡å°æœåŠ¡å™¨ä¸Šåšåˆ°æ‰¹é‡æ‰§è¡Œå‘½ä»¤ï¼Œæ ¹æ®ä¸åŒä¸šåŠ¡è¿›è¡Œé…ç½®é›†ä¸­åŒ–ç®¡ç†ã€åˆ†å‘æ–‡ä»¶ã€é‡‡é›†æœåŠ¡å™¨æ•°æ®ã€æ“ä½œç³»ç»ŸåŸºç¡€åŠè½¯ä»¶åŒ…ç®¡ç†ç­‰ï¼ŒSaltStackæ˜¯è¿ç»´äººå‘˜æé«˜å·¥ä½œæ•ˆç‡ã€è§„èŒƒä¸šåŠ¡é…ç½®ä¸æ“ä½œçš„åˆ©å™¨ã€‚</p><!--more--><h2 id="saltåŸºæœ¬åŸç†" tabindex="-1"><a class="header-anchor" href="#saltåŸºæœ¬åŸç†"><span>saltåŸºæœ¬åŸç†</span></a></h2><blockquote><p>SaltStack é‡‡ç”¨ C/Sæ¨¡å¼ï¼Œserverç«¯å°±æ˜¯saltçš„masterï¼Œclientç«¯å°±æ˜¯minionï¼Œminionä¸masterä¹‹é—´é€šè¿‡ZeroMQæ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡</p><p>minionä¸Šçº¿åå…ˆä¸masterç«¯è”ç³»ï¼ŒæŠŠè‡ªå·±çš„pub keyå‘è¿‡å»ï¼Œè¿™æ—¶masterç«¯é€šè¿‡salt-key -Lå‘½ä»¤å°±ä¼šçœ‹åˆ°minionçš„keyï¼Œæ¥å—è¯¥minion-keyåï¼Œä¹Ÿå°±æ˜¯masterä¸minionå·²ç»äº’ä¿¡</p><p>masterå¯ä»¥å‘é€ä»»ä½•æŒ‡ä»¤è®©minionæ‰§è¡Œäº†ï¼Œsaltæœ‰å¾ˆå¤šå¯æ‰§è¡Œæ¨¡å—ï¼Œæ¯”å¦‚è¯´cmdæ¨¡å—ï¼Œåœ¨å®‰è£…minionçš„æ—¶å€™å·²ç»è‡ªå¸¦äº†ï¼Œå®ƒä»¬é€šå¸¸ä½äºä½ çš„pythonåº“ä¸­ï¼Œ<code>locate salt | grep /usr/</code> å¯ä»¥çœ‹åˆ°saltè‡ªå¸¦çš„æ‰€æœ‰ä¸œè¥¿ã€‚</p><p>è¿™äº›æ¨¡å—æ˜¯pythonå†™æˆçš„æ–‡ä»¶ï¼Œé‡Œé¢ä¼šæœ‰å¥½å¤šå‡½æ•°ï¼Œå¦‚cmd.runï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>salt &#39;*&#39; cmd.run &#39;uptime&#39;</code>çš„æ—¶å€™ï¼Œmasterä¸‹å‘ä»»åŠ¡åŒ¹é…åˆ°çš„minionä¸Šå»ï¼Œminionæ‰§è¡Œæ¨¡å—å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœã€‚masterç›‘å¬4505å’Œ4506ç«¯å£ï¼Œ4505å¯¹åº”çš„æ˜¯ZMQçš„PUB systemï¼Œç”¨æ¥å‘é€æ¶ˆæ¯ï¼Œ4506å¯¹åº”çš„æ˜¯REP systemæ˜¯æ¥æ¥å—æ¶ˆæ¯çš„ã€‚</p></blockquote><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹</p><ol><li>Salt stackçš„Masterä¸Minionä¹‹é—´é€šè¿‡ZeroMqè¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œä½¿ç”¨äº†ZeroMqçš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œè¿æ¥æ–¹å¼åŒ…æ‹¬tcpï¼Œipc</li><li>saltå‘½ä»¤ï¼Œå°†<code>cmd.run ls</code>å‘½ä»¤ä»<code>salt.client.LocalClient.cmd_cli</code>å‘å¸ƒåˆ°masterï¼Œè·å–ä¸€ä¸ªJodidï¼Œæ ¹æ®jobidè·å–å‘½ä»¤æ‰§è¡Œç»“æœã€‚</li><li>masteræ¥æ”¶åˆ°å‘½ä»¤åï¼Œå°†è¦æ‰§è¡Œçš„å‘½ä»¤å‘é€ç»™å®¢æˆ·ç«¯minionã€‚</li><li>minionä»æ¶ˆæ¯æ€»çº¿ä¸Šæ¥æ”¶åˆ°è¦å¤„ç†çš„å‘½ä»¤ï¼Œäº¤ç»™<code>minion._handle_aes</code>å¤„ç†</li><li><code>minion._handle_aes</code>å‘èµ·ä¸€ä¸ªæœ¬åœ°çº¿ç¨‹è°ƒç”¨cmdmodæ‰§è¡Œlså‘½ä»¤ã€‚çº¿ç¨‹æ‰§è¡Œå®Œlsåï¼Œè°ƒç”¨<code>minion._return_pub</code>æ–¹æ³•ï¼Œå°†æ‰§è¡Œç»“æœé€šè¿‡æ¶ˆæ¯æ€»çº¿è¿”å›ç»™master</li><li>masteræ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿”å›çš„ç»“æœï¼Œè°ƒç”¨<code>master._handle_aes</code>æ–¹æ³•ï¼Œå°†ç»“æœå†™çš„æ–‡ä»¶ä¸­</li><li><code>salt.client.LocalClient.cmd_cli</code>é€šè¿‡è½®è¯¢è·å–Jobæ‰§è¡Œç»“æœï¼Œå°†ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ã€‚</li></ol><h2 id="å®‰è£…salt" tabindex="-1"><a class="header-anchor" href="#å®‰è£…salt"><span>å®‰è£…salt</span></a></h2><blockquote><p>å¯¼å…¥salt å¯†é’¥</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">7ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --import</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://repo.saltstack.com/yum/redhat/7/x86_64/latest/SALTSTACK-GPG-KEY.pub</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --import</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://repo.saltstack.com/yum/redhat/6/x86_64/latest/SALTSTACK-GPG-KEY.pub</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ–°å¢ /etc/yum.repos.d/saltstack.repo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &amp; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6ç‰ˆæœ¬</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[saltstack-repo] </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">name</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> RHEL</span><span style="color:#98C379;--shiki-dark:#98C379;"> /</span><span style="color:#98C379;--shiki-dark:#98C379;"> CentOS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> $ </span><span style="color:#98C379;--shiki-dark:#98C379;">releaseverçš„</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SaltStack</span><span style="color:#98C379;--shiki-dark:#98C379;"> repo</span><span style="color:#98C379;--shiki-dark:#98C379;"> baseurl</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://repo.saltstack.com/yum/redhat/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$releasever</span><span style="color:#98C379;--shiki-dark:#98C379;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$basearch</span><span style="color:#98C379;--shiki-dark:#98C379;">/latest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">enabled</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">gpgcheck</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">gpgkey</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpsï¼š//</span><span style="color:#98C379;--shiki-dark:#98C379;"> repo.saltstack.com/yum/redhat/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$releasever</span><span style="color:#98C379;--shiki-dark:#98C379;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$basearch</span><span style="color:#98C379;--shiki-dark:#98C379;">/latest/SALTSTACK-GPG-KEY.pub</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å®‰è£… salt-minion, salt-master,æˆ–Salt components:</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-minion</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-ssh</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-syndic</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-cloud</span></span></code></pre></div><h2 id="é…ç½®salt" tabindex="-1"><a class="header-anchor" href="#é…ç½®salt"><span>é…ç½®salt</span></a></h2><h3 id="master" tabindex="-1"><a class="header-anchor" href="#master"><span>master</span></a></h3><blockquote><p>ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å°±å¥½ (/etc/salt/master)</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŒ‡å®šmasterï¼Œå†’å·åæœ‰ä¸€ä¸ªç©ºæ ¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">master:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.2.22</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#-------ä»¥ä¸‹ä¸ºå¯é€‰--------------</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># saltè¿è¡Œçš„ç”¨æˆ·ï¼Œå½±å“åˆ°saltçš„æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#s altçš„è¿è¡Œçº¿ç¨‹ï¼Œå¼€çš„çº¿ç¨‹è¶Šå¤šä¸€èˆ¬å¤„ç†çš„é€Ÿåº¦è¶Šå¿«ï¼Œä½†ä¸€èˆ¬ä¸è¦è¶…è¿‡CPUçš„ä¸ªæ•°</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">worker_threads:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># masterçš„ç®¡ç†ç«¯å£</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">publish_port</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4505</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># masterè·Ÿminionçš„é€šè®¯ç«¯å£ï¼Œç”¨äºæ–‡ä»¶æœåŠ¡ï¼Œè®¤è¯ï¼Œæ¥å—è¿”å›ç»“æœç­‰</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ret_port</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4506</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¦‚æœè¿™ä¸ªmasterè¿è¡Œçš„salt-syndicè¿æ¥åˆ°äº†ä¸€ä¸ªæ›´é«˜å±‚çº§çš„master,é‚£ä¹ˆè¿™ä¸ªå‚æ•°éœ€è¦é…ç½®æˆè¿æ¥åˆ°çš„è¿™ä¸ªé«˜å±‚çº§masterçš„ç›‘å¬ç«¯å£</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">syndic_master_port</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4506</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æŒ‡å®špidæ–‡ä»¶ä½ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pidfile:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/run/salt-master.pid</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># saltstack å¯ä»¥æ§åˆ¶çš„æ–‡ä»¶ç³»ç»Ÿçš„å¼€å§‹ä½ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root_dir:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ—¥å¿—æ–‡ä»¶åœ°å€</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">log_file:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/log/salt_master.log</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åˆ†ç»„è®¾ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nodegroups:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  group_all:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># salt stateæ‰§è¡Œæ—¶å€™çš„æ ¹ç›®å½•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">file_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è®¾ç½®pillar çš„æ ¹ç›®å½•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pillar_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/pillar</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨master</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>systemctl start salt-master</span></span>
<span class="line"><span>systemctl enable salt-master</span></span></code></pre></div><h3 id="minion" tabindex="-1"><a class="header-anchor" href="#minion"><span>minion</span></a></h3><p>(/etc/salt/minion)</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŒ‡å®šmasterï¼Œå†’å·åæœ‰ä¸€ä¸ªç©ºæ ¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">master:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.2.22</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">id:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minion-01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#-------ä»¥ä¸‹ä¸ºå¯é€‰--------------</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># minionçš„è¯†åˆ«IDï¼Œå¯ä»¥æ˜¯IPï¼ŒåŸŸåï¼Œæˆ–æ˜¯å¯ä»¥é€šè¿‡DNSè§£æçš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">id:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.0.100</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># saltè¿è¡Œçš„ç”¨æˆ·æƒé™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># masterçš„è¯†åˆ«IDï¼Œå¯ä»¥æ˜¯IPï¼ŒåŸŸåï¼Œæˆ–æ˜¯å¯ä»¥é€šè¿‡DNSè§£æçš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">master</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.0.100</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># masteré€šè®¯ç«¯å£</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">master_port:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4506</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤‡ä»½æ¨¡å¼ï¼Œminionæ˜¯æœ¬åœ°å¤‡ä»½ï¼Œå½“è¿›è¡Œæ–‡ä»¶ç®¡ç†æ—¶çš„æ–‡ä»¶å¤‡ä»½æ¨¡å¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">backup_mode:</span><span style="color:#98C379;--shiki-dark:#98C379;"> minion</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰§è¡Œsalt-callæ—¶å€™çš„è¾“å‡ºæ–¹å¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">output:</span><span style="color:#98C379;--shiki-dark:#98C379;"> nested</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># minionç­‰å¾…masteræ¥å—è®¤è¯çš„æ—¶é—´</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">acceptance_wait_time:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤±è´¥é‡è¿æ¬¡æ•°ï¼Œ0è¡¨ç¤ºæ— é™æ¬¡ï¼Œéé›¶ä¼šä¸æ–­å°è¯•åˆ°è®¾ç½®å€¼ååœæ­¢å°è¯•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">acceptance_wait_time_max:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é‡æ–°è®¤è¯å»¶è¿Ÿæ—¶é—´ï¼Œå¯ä»¥é¿å…å› ä¸ºmasterçš„keyæ”¹å˜å¯¼è‡´minionéœ€è¦é‡æ–°è®¤è¯çš„syné£æš´</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">random_reauth_delay:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 60</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ—¥å¿—æ–‡ä»¶ä½ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">log_file:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/logs/salt_minion.log</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ–‡ä»¶è·¯å¾„åŸºæœ¬ä½ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">file_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/salt/minion/file</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pillaråŸºæœ¬ä½ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pillar_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /data/salt/minion/pillar</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨minion</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>systemctl start salt-master</span></span>
<span class="line"><span>systemctl enable salt-master</span></span></code></pre></div><h2 id="æ·»åŠ key" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ key"><span>æ·»åŠ key</span></a></h2><blockquote><p>master ç«¯æŸ¥çœ‹key</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt-key </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Accepted</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Denied</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Unaccepted</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #å¯çœ‹åˆ° minionå·²ç»æ£€æµ‹åˆ°ï¼Œæ²¡æœ‰è®¤è¯key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Rejected</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt-key -a minion-01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">The</span><span style="color:#98C379;--shiki-dark:#98C379;"> following</span><span style="color:#98C379;--shiki-dark:#98C379;"> keys</span><span style="color:#98C379;--shiki-dark:#98C379;"> are</span><span style="color:#98C379;--shiki-dark:#98C379;"> going</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> be</span><span style="color:#98C379;--shiki-dark:#98C379;"> accepted:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Unaccepted</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Proceed?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [n/Y] y    </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#Yç¡®è®¤æ·»åŠ </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Key</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> minion</span><span style="color:#98C379;--shiki-dark:#98C379;"> minion-01</span><span style="color:#98C379;--shiki-dark:#98C379;"> accepted.</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #æ·»åŠ æˆåŠŸ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt-key </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Accepted</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Denied</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Unaccepted</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Rejected</span><span style="color:#98C379;--shiki-dark:#98C379;"> Keys:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]#</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="salt-keyå¸¸ç”¨å‚æ•°" tabindex="-1"><a class="header-anchor" href="#salt-keyå¸¸ç”¨å‚æ•°"><span>salt-keyå¸¸ç”¨å‚æ•°</span></a></h3><table><thead><tr><th style="text-align:left;">-a</th><th style="text-align:left;">æ·»åŠ æŒ‡å®šID çš„key</th></tr></thead><tbody><tr><td style="text-align:left;">-A</td><td style="text-align:left;">æ·»åŠ å…¨éƒ¨</td></tr><tr><td style="text-align:left;">-R</td><td style="text-align:left;">æ‹’ç»å…¨éƒ¨</td></tr><tr><td style="text-align:left;">-d</td><td style="text-align:left;">åˆ é™¤æŒ‡å®šIDçš„</td></tr><tr><td style="text-align:left;">-D</td><td style="text-align:left;">åˆ é™¤å…¨éƒ¨</td></tr></tbody></table><h3 id="æµ‹è¯•è¿é€šæ€§" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•è¿é€šæ€§"><span>æµ‹è¯•è¿é€šæ€§</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #è¿”å›ç»“æœè¡¨ç¤ºæˆåŠŸ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]#</span></span></code></pre></div><h3 id="ç®€å•æœåŠ¡çš„å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ç®€å•æœåŠ¡çš„å®‰è£…"><span>ç®€å•æœåŠ¡çš„å®‰è£…</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pkg.install ftp  </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è§£é‡Š</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ftp:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        new:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            0.17-67.el7</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        old:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/] ]$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å»minionæŸ¥çœ‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@minion-01 tmp]# rpm -qa ftp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ftp-0.17-67.el7.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#salt &#39;minion-01&#39; pkg.install ftp</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#1.&#39;*&#39; ä»£è¡¨çš„æ˜¯targetæ˜¯æŒ‡åœ¨é‚£äº›minionä¸Šæ“ä½œ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#2. &#39;pkg&#39; æ˜¯ä¸€ä¸ªæ‰§è¡Œæ¨¡å—,å°±åƒ&#39;test&#39; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#3.&#39;install&#39; æ˜¯æ‰§è¡Œæ¨¡å—ä¸‹é¢çš„å‡½æ•°ï¼Œåƒtestä¸‹çš„ping</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#4.&#39;ftp&#39; æ˜¯å‡½æ•°çš„å‚æ•°(arg)ï¼Œæœ‰çš„å‡½æ•°éœ€è¦å‚æ•°ï¼Œæœ‰çš„ä¸éœ€è¦æ¯”å¦‚test.pingå°±ä¸éœ€è¦å‚æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> ##æŸ¥çœ‹æ‰€æœ‰æ‰§è¡Œæ¨¡å—çš„doc</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> sys.doc</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> ##æŸ¥çœ‹testæ¨¡å—çš„å¸®åŠ©</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> sys.doc</span><span style="color:#98C379;--shiki-dark:#98C379;"> test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> ##æŸ¥çœ‹test.pingå‡½æ•°çš„å¸®åŠ©</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> sys.doc</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.ping</span></span></code></pre></div><h2 id="saltå¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#saltå¸¸ç”¨å‘½ä»¤"><span>saltå¸¸ç”¨å‘½ä»¤</span></a></h2><h3 id="salt" tabindex="-1"><a class="header-anchor" href="#salt"><span>salt</span></a></h3><blockquote><p>è¯¥å‘½ä»¤æ‰§è¡Œsaltçš„æ‰§è¡Œæ¨¡å—,é€šå¸¸åœ¨masterç«¯è¿è¡Œ.å¸¸ç”¨å‘½ä»¤</p></blockquote><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [option] </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&lt; target &gt;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt; </span><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> &gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [ arguments ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¾‹å¦‚</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cmd.run</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;ip addr&#39;</span></span></code></pre></div><h3 id="salt-run" tabindex="-1"><a class="header-anchor" href="#salt-run"><span>salt-run</span></a></h3><blockquote><p>è¯¥å‘½ä»¤æ‰§è¡Œrunner(saltè‡ªå¸¦æˆ–è€…è‡ªå®šä¹‰çš„ï¼Œ)ï¼Œé€šå¸¸åœ¨masterç«¯æ‰§è¡Œï¼Œæ¯”å¦‚ç»å¸¸ç”¨åˆ°çš„manage</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [options] [runner.func]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¾‹å¦‚</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-run</span><span style="color:#98C379;--shiki-dark:#98C379;"> manage.status</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   ##æŸ¥çœ‹æ‰€æœ‰minionçŠ¶æ€</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-run</span><span style="color:#98C379;--shiki-dark:#98C379;"> manage.down</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     ##æŸ¥çœ‹æ‰€æœ‰æ²¡åœ¨çº¿minion</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-run</span><span style="color:#98C379;--shiki-dark:#98C379;"> manged.up</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">       ##æŸ¥çœ‹æ‰€æœ‰åœ¨çº¿minion</span></span></code></pre></div><h3 id="salt-key" tabindex="-1"><a class="header-anchor" href="#salt-key"><span>salt-key</span></a></h3><blockquote><p>å¯†é’¥ç®¡ç†ï¼Œé€šå¸¸åœ¨masterç«¯æ‰§è¡Œ</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [options]</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -L</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">              ##æŸ¥çœ‹æ‰€æœ‰minion-key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">key-nam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">e&gt;   </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##æ¥å—æŸä¸ªminion-key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">key-nam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">e&gt;   </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##åˆ é™¤æŸä¸ªminion-key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -A</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">              ##æ¥å—æ‰€æœ‰çš„minion-key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -D</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">              ##åˆ é™¤æ‰€æœ‰çš„minion-key</span></span></code></pre></div><h3 id="salt-call" tabindex="-1"><a class="header-anchor" href="#salt-call"><span>salt-call</span></a></h3><blockquote><p>è¯¥å‘½ä»¤é€šå¸¸åœ¨minionä¸Šæ‰§è¡Œï¼Œminionè‡ªå·±æ‰§è¡Œå¯æ‰§è¡Œæ¨¡å—ï¼Œä¸é€šè¿‡masterä¸‹å‘job</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-call</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [options] &lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [arguments]</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-call</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.ping</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           ##è‡ªå·±æ‰§è¡Œtest.pingå‘½ä»¤</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-call</span><span style="color:#98C379;--shiki-dark:#98C379;"> cmd.run</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;ifconfig&#39;</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  ##è‡ªå·±æ‰§è¡Œcmd.runå‡½æ•°</span></span></code></pre></div><h3 id="salt-cp" tabindex="-1"><a class="header-anchor" href="#salt-cp"><span>salt-cp</span></a></h3><blockquote><p>åˆ†å‘æ–‡ä»¶åˆ°minionä¸Š,ä¸æ”¯æŒç›®å½•åˆ†å‘.è¿è¡Œåœ¨master</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-cp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [options] </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&lt; target &gt;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> SOURCE DEST</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¾‹å¦‚</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-cp</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> testfile.html</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-cp</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;test*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> index.html</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/a.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœminion æ˜¯windowsç«¯ é»˜è®¤/ æŒ‡çš„æ˜¯ C:\   /test = C:\test</span></span></code></pre></div><h3 id="salt-master" tabindex="-1"><a class="header-anchor" href="#salt-master"><span>salt-master</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-master</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [options]</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-master</span><span style="color:#98C379;--shiki-dark:#98C379;"> Â  Â  Â  Â  Â  Â ##å‰å°è¿è¡Œmaster</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-master</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> Â  Â  Â  Â  ##åå°è¿è¡Œmaster</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-master</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -l</span><span style="color:#98C379;--shiki-dark:#98C379;"> debug</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> Â  ##å‰å°debugè¾“å‡º</span></span></code></pre></div><h3 id="salt-minion" tabindex="-1"><a class="header-anchor" href="#salt-minion"><span>salt-minion</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-minion</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [options]</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-minion</span><span style="color:#98C379;--shiki-dark:#98C379;"> Â  Â  Â  Â  Â  Â ##å‰å°è¿è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-minion</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> Â  Â  Â  Â  ##åå°è¿è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-minion</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -l</span><span style="color:#98C379;--shiki-dark:#98C379;"> debug</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> Â  ##å‰å°debugè¾“å‡º</span></span></code></pre></div><h2 id="æ™®é€šç”¨æˆ·æ‰§è¡Œsalt" tabindex="-1"><a class="header-anchor" href="#æ™®é€šç”¨æˆ·æ‰§è¡Œsalt"><span>æ™®é€šç”¨æˆ·æ‰§è¡Œsalt</span></a></h2><p>ä¸¤ç§æ–¹æ³•</p><blockquote><p>1: ACL(ä¿®æ”¹master)</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;"> Â  Â client_acl:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  monitor:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #uonghu</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  Â -</span><span style="color:#98C379;--shiki-dark:#98C379;"> test</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #æƒé™</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  dev:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  Â -</span><span style="color:#98C379;--shiki-dark:#98C379;"> service.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  sa:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  Â -</span><span style="color:#98C379;--shiki-dark:#98C379;"> .</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡å¯master</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  Â </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç»™äºˆç›®å½•å’Œæ–‡ä»¶æƒé™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> +r</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/salt/master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> +x</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/run/salt</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> +x</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/cache/salt</span></span></code></pre></div><blockquote><p>2 external_auth(ä¿®æ”¹master)</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pam:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    fred:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡å¯master</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">Â  Â  Â </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç»™äºˆç›®å½•å’Œæ–‡ä»¶æƒé™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> +r</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/salt/master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> +x</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/run/salt</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> +x</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/cache/salt</span></span></code></pre></div><p>ä½¿ç”¨Tokenä¸å¿…æ¯æ¬¡éƒ½è¾“å…¥è´¦å·å¯†ç ï¼Œä½¿ç”¨external_authæ¯æ¬¡éƒ½æ˜¯éœ€è¦å¯†ç çš„ï¼Œè¿™æ ·å¤šéº»çƒ¦ï¼Œè¿™é‡Œå¼•å…¥äº†Tokenï¼Œå®ƒä¼šä¿å­˜ä¸€ä¸²å­—ç¬¦åˆ°åœ¨å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹.salt_tokenä¸­ï¼Œåœ¨æœ‰æ•ˆæ—¶é—´å†…ä½¿ç”¨external_authæ˜¯ä¸éœ€è¦è¾“å…¥å¯†ç çš„ï¼Œé»˜è®¤æ—¶é—´12hourï¼Œå¯ä»¥é€šè¿‡masteré…ç½®æ–‡ä»¶ä¿®æ”¹</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>salt -T -a pam &#39;*&#39; test.ping</span></span></code></pre></div><h2 id="target" tabindex="-1"><a class="header-anchor" href="#target"><span>target</span></a></h2><blockquote><p>targetä¹Ÿå°±æ˜¯ç›®æ ‡,ç›®çš„.æŒ‡å®šmasterå‘½ä»¤åº”è¯¥å¯¹è°æ‰§è¡Œ</p></blockquote><ul><li>æ­£åˆ™åŒ¹é…</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master /]# salt -E  </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;mini*&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span></code></pre></div><ul><li>åˆ—è¡¨åŒ¹é…</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master ~]# salt -L minion-01,minion-02 test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span></code></pre></div><ul><li>grainsåŒ¹é…</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master ~]# salt -G </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;os:CentOs&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span></code></pre></div><ul><li>ç»„åŒ¹é…</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¼€å¯master çš„default_include</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/salt/master.d/nodegroup.conf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å†™åˆ°masterä¸­ä¹Ÿæ˜¯è¿™ä¸ªæ ¼å¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nodegroups:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test1:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;L@test1,test2 or test3*&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test2:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;G@os:CenOS or test2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -N</span><span style="color:#98C379;--shiki-dark:#98C379;"> test1</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.ping</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #-NæŒ‡å®šgroupname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">åœ¨top</span><span style="color:#98C379;--shiki-dark:#98C379;"> fileä¸­ä½¿ç”¨nodegroups</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;test1&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> -</span><span style="color:#98C379;--shiki-dark:#98C379;"> match:</span><span style="color:#98C379;--shiki-dark:#98C379;"> nodegroup</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     ##æ²¡s,åŒ¹é…çš„æ˜¯æ–‡ä»¶</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span></code></pre></div><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master ~]# salt -N nodegroups test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç»„éœ€è¦åœ¨masterä¸­é¢„å…ˆå®šä¹‰</span></span></code></pre></div><ul><li>å¤åˆåŒ¹é… <code>salt -C &#39;G@os:MacOS or L@Minion1&#39;</code></li><li>PillaråŒ¹é… <code>salt -I &#39;key:value&#39; test.ping</code></li><li>CIDRåŒ¹é… <code>salt -S &#39;192.168.1.0/24&#39; test.ping</code></li></ul><blockquote><p>åœ¨topæ–‡ä»¶ä¸­åŒ¹é… grains</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;node_type:web&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> match:</span><span style="color:#98C379;--shiki-dark:#98C379;"> grain</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         #æ²¡æœ‰s</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span></code></pre></div><blockquote><p>topæ–‡ä»¶ä¸­ä½¿ç”¨jinja</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> self</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains[&#39;node_type&#39;]</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> match:</span><span style="color:#98C379;--shiki-dark:#98C379;"> grain</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-</span><span style="color:#98C379;--shiki-dark:#98C379;"> {{ self }}</span></span></code></pre></div><ul><li>ä¸€æ¬¡åœ¨nä¸ªminionä¸Šæ‰§è¡Œ</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-b</span><span style="color:#98C379;--shiki-dark:#98C379;"> n</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">--batch-size</span><span style="color:#98C379;--shiki-dark:#98C379;"> n</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¾‹ï¼š</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -b</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.ping</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#5ä¸ª5ä¸ªçš„ping</span></span></code></pre></div><h2 id="å¤šmaster" tabindex="-1"><a class="header-anchor" href="#å¤šmaster"><span>å¤šmaster</span></a></h2><blockquote><blockquote><p>2ä¸ªmasterå¹¶ä¸ä¼šå…±äº«Minion keysï¼Œä¸€ä¸ªmasteråˆ é™¤äº†ä¸€ä¸ªkeyä¸ä¼šå½±å“å¦ä¸€ä¸ª</p></blockquote><blockquote><p>ä¸ä¼šè‡ªåŠ¨åŒæ­¥File_roots,æ‰€ä»¥éœ€è¦æ‰‹åŠ¨å»ç»´æŠ¤ï¼Œå¦‚æœç”¨gitå°±æ²¡é—®é¢˜äº†</p></blockquote><blockquote><p>ä¸ä¼šè‡ªåŠ¨åŒæ­¥Pillar_Rootsï¼Œæ‰€ä»¥éœ€è¦æ‰‹å·¥å»ç»´æŠ¤ï¼Œä¹Ÿå¯ä»¥ç”¨git</p></blockquote><blockquote><p>Masterçš„é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯ç‹¬ç«‹çš„</p></blockquote></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®‰è£… salt-master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŸmasterçš„å¯†é’¥cpä¸€ä»½åˆ°æ–°çš„master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">scp</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/salt/pki/master/master</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span><span style="color:#98C379;--shiki-dark:#98C379;"> newmaster:/etc/salt/pki/master/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯åŠ¨æ–°çš„Master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¿®æ”¹é…ç½®minionçš„é…ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">master:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> master1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> master2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡å¯minion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ–°masteræ¥å—æ‰€æœ‰çš„key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -L</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt-key</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -A</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="yaml" tabindex="-1"><a class="header-anchor" href="#yaml"><span>YAML</span></a></h2><blockquote><p>è¯­æ³•é£æ ¼</p></blockquote><ul><li><p>ç©ºæ ¼å’ŒTAB</p><p>yamlä¸¤ä¸ªç©ºæ ¼ä¸ºç¼©è¿›, TABä¸è¦ä½¿ç”¨!</p></li><li><p>å†’å·: å’Œå‡å·-</p><p>: å’Œ- åé¢è¦è·Ÿä¸Šä¸€ä¸ªç©ºæ ¼åœ¨å†™</p></li><li><p>æ•°å­—è§£æ</p><p>mode: 0644 ä¼šè§£ææˆä¸ºmode: 644 æœ€å¥½ä½¿ç”¨mode: (0644)</p></li><li><p>ç®€å†™</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pkg.installed</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #ç¬¬ä¸€ä¸ªç®€å†™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  user.present</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #ç¬¬äºŒä¸ªç®€å†™.ä¸è¢«æ”¯æŒ,å› ä¸ºä¸æ”¯æŒåŒç®€å†™</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å»ºè®®è§„èŒƒä¹¦å†™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pkg:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  user:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> present</span></span></code></pre></div></li></ul><h2 id="jinja" tabindex="-1"><a class="header-anchor" href="#jinja"><span>Jinja</span></a></h2><blockquote><p>Jinja åŸºäºPythonæ¨¡æ¿å¼•æ“å¼€å‘,saltstacké»˜è®¤ä½¿ç”¨yaml_jinjaæ¸²æŸ“å™¨,æ¸²æŸ“æµç¨‹æ—¶å…ˆjinjaåœ¨yamlè§£æ.æ‰€ä»¥åœ¨å¼€å§‹è§£æyamlçš„æ—¶å€™å¯ä»¥ä½¿ç”¨jinja&quot;å·ä¸ªè…¥&quot;</p></blockquote><ul><li>åŒºåˆ†æ¨¡æ¿æ–‡ä»¶</li></ul><p>åœ¨saltä¸­,fileså’Œtemplateséƒ½ä½¿ç”¨fileè¿™ä¸ªstateæ¨¡å—.é‚£ä¹ˆå¦‚ä½•åŒºåˆ†æ¨¡æ¿æ˜¯ä»€ä¹ˆæ–‡ä»¶å‘¢.</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> templates:</span><span style="color:#98C379;--shiki-dark:#98C379;"> jinja</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">file.managed:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://tmp/test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> template:</span><span style="color:#98C379;--shiki-dark:#98C379;"> jinja</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> defaults:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Server:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {{ pillar[&#39;.....&#39;] }}</span></span></code></pre></div><ul><li>jinjaä¸­ä½¿ç”¨grains</li></ul><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>{{ grains[&#39;os&#39;] }}</span></span></code></pre></div><ul><li>jinjaä¸­ä½¿ç”¨æ‰§è¡Œæ¨¡å—</li></ul><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">{{ salt[&#39;network.hw_addr&#39;](&#39;eth0&#39;) }}</span></span></code></pre></div><ul><li>jinjaä¸­ä½¿ç”¨Pillar</li></ul><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>{{ pillar[&#39;apache&#39;][&#39;PORT&#39;] }}</span></span></code></pre></div><p><strong>Jinjaçš„é€»è¾‘å…³ç³»</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>{% if grains[&#39;os&#39;] == &#39;RedHat&#39; %}</span></span>
<span class="line"><span>apache: httpd</span></span>
<span class="line"><span>{% elif grains[&#39;os&#39;] == &#39;Debian&#39; %}</span></span>
<span class="line"><span>apache: apache2</span></span>
<span class="line"><span>{% endif %}</span></span></code></pre></div><p><strong>æ›´å¤šä½¿ç”¨è‡ªè¡Œç ”ç©¶</strong></p><h2 id="saltå¸¸ç”¨æ¨¡å—å’Œapi" tabindex="-1"><a class="header-anchor" href="#saltå¸¸ç”¨æ¨¡å—å’Œapi"><span>saltå¸¸ç”¨æ¨¡å—å’ŒAPI</span></a></h2><h3 id="æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰modules" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰modules"><span>æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰modules</span></a></h3><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sys.list_modules</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> acl</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">...</span></span></code></pre></div><h3 id="salt-clientè°ƒç”¨apiä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#salt-clientè°ƒç”¨apiä¸¾ä¾‹"><span>salt.clientè°ƒç”¨APIä¸¾ä¾‹</span></a></h3><p><strong><code>[root/] ]$cd /usr/lib/python2.7/site-packages/salt/modules/</code></strong> æ¨¡å—path</p><p><strong>APIè°ƒç”¨ç¤ºä¾‹</strong></p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">cat test.py </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/usr/bin/python</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> salt.client</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">client </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> salt.client.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">LocalClient</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">res </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> client.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">cmd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;*&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;test.ping&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> res</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">test.py </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;minion-02&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">True</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##è§£é‡Šä¸€ä¸‹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å½“æˆ‘ä»¬è°ƒç”¨salt.client.LocalClientçš„æ—¶å€™,å…¶å®å°±ç­‰äºæˆ‘ä»¬æ‰§è¡Œäº† salt &#39;*&#39; test.ping</span></span></code></pre></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>client.cmd(&#39;*&#39;,&#39;file.remove&#39;,[&#39;/tmp/foo&#39;])</span></span></code></pre></div><blockquote><p>salt &lt; target &gt; sys.doc module</p><p>å¯ä»¥æŸ¥çœ‹æ¨¡å—æ”¯æŒé‚£äº›å‘½ä»¤</p></blockquote><h3 id="archive" tabindex="-1"><a class="header-anchor" href="#archive"><span>Archive</span></a></h3><blockquote><p>å®ç°å¯¹ç³»ç»Ÿæ›¾ç»çš„å‹ç¼©åŒ…è°ƒç”¨æ”¯æŒgzip,gunzip.rar,tar,unrar,unzipç­‰</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡‡ç”¨gunzipè§£å‹sourcefile.txt.gzåŒ…</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> archive.gunzip</span><span style="color:#98C379;--shiki-dark:#98C379;"> sourcefile.txt.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é‡‡ç”¨gzipå‹ç¼©sourcefile.txtæ–‡ä»¶</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> archive.gzip</span><span style="color:#98C379;--shiki-dark:#98C379;"> sourcefile.txt</span></span></code></pre></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>client.cmd(&#39;*&#39;,&#39;archive.gunzip&#39;,[&#39;sourcefile.txt.gz&#39;])</span></span></code></pre></div><h3 id="cmd" tabindex="-1"><a class="header-anchor" href="#cmd"><span>cmd</span></a></h3><blockquote><p>å®ç°å¯¹è¿œç¨‹å‘½ä»¤çš„è°ƒç”¨æ‰§è¡Œ,(é»˜è®¤å…·å¤‡rootæƒé™!è°¨æ…ä½¿ç”¨)</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æ‰€æ¬²è¢«æ§ä¸»æœºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cmd.run</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;free -m&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åœ¨wxä¸»æœºä¸Šè¿è¡Œtest.pyè„šæœ¬ï¼Œå…¶ä¸­script/test.pyå­˜æ”¾åœ¨file_rootsæŒ‡å®šçš„ç›®å½•ï¼ˆé»˜è®¤æ˜¯åœ¨/srv/salt,è‡ªå®šä¹‰åœ¨/etc/salt/masteræ–‡ä»¶ä¸­å®šä¹‰ï¼‰ï¼Œ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¯¥å‘½ä»¤ä¼šåš2ä¸ªåŠ¨ä½œï¼šé¦–å…ˆåŒæ­¥test.pyåˆ°minionçš„cacheç›®å½•ï¼›èµ·åºŠè¿è¡Œè¯¥è„šæœ¬</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cmd.script</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://script/test.py</span></span></code></pre></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>client.cmd(&#39;*&#39;,&#39;cmd.run&#39;,[&#39;free -m&#39;])</span></span></code></pre></div><h3 id="cp" tabindex="-1"><a class="header-anchor" href="#cp"><span>cp</span></a></h3><blockquote><p>å®ç°è¿œç¨‹æ–‡ä»¶ç›®å½•çš„å¤åˆ¶,ä»¥åŠä¸‹è½½URLæ–‡ä»¶ç­‰æ“ä½œ</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†è¢«æ§ä¸»æœºçš„/etc/hostsæ–‡ä»¶å¤åˆ¶åˆ°è¢«æ§ä¸»æœºæœ¬åœ°çš„salt cacheç›®å½•ï¼ˆ/var/cache/salt/minion/localfiles/ï¼‰</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cp.cache_local_file</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†ä¸»æ§ç«¯file_rootsæŒ‡å®šä½ç½®ä¸‹çš„ç›®å½•å¤åˆ¶åˆ°è¢«æ§ä¸»æœº/minion/ç›®å½•ä¸‹</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cp.get_dir</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://script/</span><span style="color:#98C379;--shiki-dark:#98C379;"> /minion/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†ä¸»æ§ç«¯file_rootsæŒ‡å®šä½ç½®ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°è¢«æ§ä¸»æœº/minion/test.pyæ–‡ä»¶(fileä¸ºæ–‡ä»¶å)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cp.get_dir</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://script/test.py</span><span style="color:#98C379;--shiki-dark:#98C379;"> /minion/test.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¸‹è½½URLå†…å®¹åˆ°è¢«æ§ä¸»æœºæŒ‡å®šä½ç½®(/tmp/index.html)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cp.get_url</span><span style="color:#98C379;--shiki-dark:#98C379;"> http://www.slashdot.ort</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/index.html</span></span></code></pre></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>client.cmd(&#39;*&#39;,&#39;cp.get_file&#39;,[&#39;salt://script/test.py&#39;,&#39;/minion/test.py&#39;])</span></span></code></pre></div><h3 id="cron" tabindex="-1"><a class="header-anchor" href="#cron"><span>cron</span></a></h3><blockquote><p>å®ç°å¯¹minionçš„crontabæ§åˆ¶</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŸ¥çœ‹æŒ‡å®šè¢«æ§ä¸»æœºã€rootç”¨æˆ·çš„crontabæ“ä½œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cron.raw_cron</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¸ºæŒ‡å®šè¢«æ§ä¸»æœºã€rootç”¨æˆ·æ·»åŠ /usr/local/weeklyä»»åŠ¡zuoye</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cron.set_job</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/weekly</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åˆ é™¤æŒ‡å®šè¢«æ§ä¸»æœºã€rootç”¨æˆ·crontabçš„/usr/local/weeklyä»»åŠ¡zuoye</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> cron.rm_job</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/local/weekly</span></span></code></pre></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">client.cmd(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;wx&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;cron.set_job&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,[</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;root&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;*&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;*&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;*&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;*&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,1,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;/usr/local/weekly&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h3 id="file" tabindex="-1"><a class="header-anchor" href="#file"><span>file</span></a></h3><blockquote><p>å¯¹minionçš„æ–‡ä»¶æ“ä½œ,åŒ…æ‹¬æ–‡ä»¶è¯»å†™,æƒé™,æŸ¥æ‰¾æ ¡éªŒ</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ ¡éªŒæ‰€æœ‰è¢«æ§ä¸»æœº/etc/fstabæ–‡ä»¶çš„md5å€¼æ˜¯å¦ä¸ºxxxxxxxxxxxxx,ä¸€è‡´åˆ™è¿”å›Trueå€¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.check_hash</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/fstab</span><span style="color:#98C379;--shiki-dark:#98C379;"> md5=xxxxxxxxxxxxxxxxxxxxx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ ¡éªŒæ‰€æœ‰è¢«æ§ä¸»æœºæ–‡ä»¶çš„åŠ å¯†ä¿¡æ¯ï¼Œæ”¯æŒmd5ã€sha1ã€sha224ã€shs256ã€sha384ã€sha512åŠ å¯†ç®—æ³•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.get_sum</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/passwd</span><span style="color:#98C379;--shiki-dark:#98C379;"> md5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¿®æ”¹æ‰€æœ‰è¢«æ§ä¸»æœº/etc/passwdæ–‡ä»¶çš„å±ç»„ã€ç”¨æˆ·æƒé™ã€ç­‰ä»·äºchown root:root /etc/passwd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.chown</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/passwd</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¤åˆ¶æ‰€æœ‰è¢«æ§ä¸»æœº/path/to/srcæ–‡ä»¶åˆ°æœ¬åœ°çš„/path/to/dstæ–‡ä»¶</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.copy</span><span style="color:#98C379;--shiki-dark:#98C379;"> /path/to/src</span><span style="color:#98C379;--shiki-dark:#98C379;"> /path/to/dst</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ£€æŸ¥æ‰€æœ‰è¢«æ§ä¸»æœº/etcç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å›True,æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨file.file_existsæ–¹æ³•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.directory_exists</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æ‰€æœ‰è¢«æ§ä¸»æœº/etc/passwdçš„statsä¿¡æ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.stats</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/passwd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æ‰€æœ‰è¢«æ§ä¸»æœº/etc/passwdçš„æƒé™modeï¼Œå¦‚755ï¼Œ644</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.get_mode</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/passwd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¿®æ”¹æ‰€æœ‰è¢«æ§ä¸»æœº/etc/passwdçš„æƒé™modeä¸º0644</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.set_mode</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/passwd</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0644</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åœ¨æ‰€æœ‰è¢«æ§ä¸»æœºåˆ›å»º/opt/testç›®å½•</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.mkdir</span><span style="color:#98C379;--shiki-dark:#98C379;"> /opt/test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å°†æ‰€æœ‰è¢«æ§ä¸»æœº/etc/httpd/httpd.confæ–‡ä»¶çš„LogLevelå‚æ•°çš„warnå€¼ä¿®æ”¹ä¸ºinfo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.sed</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/httpd/httpd.conf</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;LogLevel warn&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;LogLevel info&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç»™æ‰€æœ‰è¢«æ§ä¸»æœºçš„/tmp/test/test.confæ–‡ä»¶è¿½åŠ å†…å®¹â€˜maxclient 100â€™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.append</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/test/test.conf</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;maxclient 100&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åˆ é™¤æ‰€æœ‰è¢«æ§ä¸»æœºçš„/tmp/fooæ–‡ä»¶</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> file.remove</span><span style="color:#98C379;--shiki-dark:#98C379;"> /tmp/foo</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="network" tabindex="-1"><a class="header-anchor" href="#network"><span>network</span></a></h3><blockquote><p>è¿”å›minionçš„ä¸»æœºä¿¡æ¯</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åœ¨æŒ‡å®šè¢«æ§ä¸»æœºè·å–digã€pingã€tracerouteç›®å½•åŸŸåä¿¡æ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.dig</span><span style="color:#98C379;--shiki-dark:#98C379;"> www.qq.com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.ping</span><span style="color:#98C379;--shiki-dark:#98C379;"> www.qq.com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.traceroute</span><span style="color:#98C379;--shiki-dark:#98C379;"> www.qq.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æŒ‡å®šè¢«æ§ä¸»æœºçš„macåœ°å€</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.hwaddr</span><span style="color:#98C379;--shiki-dark:#98C379;"> eth0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ£€æµ‹æŒ‡å®šè¢«æ§ä¸»æœºæ˜¯å¦å±äº10.0.0.0/16å­ç½‘èŒƒå›´ï¼Œå±äºåˆ™è¿”å›True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.in_subnet</span><span style="color:#98C379;--shiki-dark:#98C379;"> 10.0.0.0/16</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æŒ‡å®šè¢«æ§ä¸»æœºçš„ç½‘å¡é…ç½®ä¿¡æ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.interfaces</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æŒ‡å®šè¢«æ§ä¸»æœºçš„IPåœ°å€é…ç½®ä¿¡æ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.ip_addrs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è·å–æŒ‡å®šè¢«æ§ä¸»æœºçš„å­ç½‘ä¿¡æ¯</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> network.subnets</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">client.cmd(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;minion-01&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;network.ip_addrs&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h3 id="pkg" tabindex="-1"><a class="header-anchor" href="#pkg"><span>pkg</span></a></h3><blockquote><p>minionçš„ç¨‹åºåŒ…ç®¡ç†,å¦‚yum, apt-getç­‰</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ä¸ºæ‰€æœ‰è¢«æ§ä¸»æœºå®‰è£…PHPç¯å¢ƒï¼Œæ ¹æ®ä¸åŒç³»ç»Ÿå‘è¡Œç‰ˆè°ƒç”¨ä¸åŒå®‰è£…å·¥å…·è¿›è¡Œéƒ¨ç½²ï¼Œå¦‚redhatå¹³å°çš„yumï¼Œç­‰ä»·äºyum -y install php</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg.install</span><span style="color:#98C379;--shiki-dark:#98C379;"> php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¸è½½æ‰€æœ‰è¢«æ§ä¸»æœºçš„PHPç¯å¢ƒ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg.remove</span><span style="color:#98C379;--shiki-dark:#98C379;"> php</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å‡çº§æ‰€æœ‰è¢«æ§ä¸»æœºçš„è½¯ä»¶åŒ…</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg.upgrade</span></span></code></pre></div><p><strong>APIè°ƒç”¨ï¼š</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>client.cmd(&#39;*&#39;,&#39;pkg.remove&#39;,[&#39;php&#39;])</span></span></code></pre></div><h3 id="status" tabindex="-1"><a class="header-anchor" href="#status"><span>status</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>salt &#39;*&#39; status.version</span></span></code></pre></div><p>API</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> salt.client</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">client </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> salt.client.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">LocalClient</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">client.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">cmd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;*&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;status.uptime&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h3 id="system" tabindex="-1"><a class="header-anchor" href="#system"><span>system</span></a></h3><blockquote><p>ç”¨æ¥æ—¥å¸¸æ“ä½œè®¡ç®—æœº</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">system.halt</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #åœæ­¢æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">system.init</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #åˆ‡æ¢åˆ°å­—ç¬¦ç•Œé¢ï¼Œ5æ˜¯å›¾å½¢ç•Œé¢</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">system.poweroff</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">system.reboot</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">system.shutdown</span></span></code></pre></div><h3 id="systemd-service" tabindex="-1"><a class="header-anchor" href="#systemd-service"><span>systemd(service)</span></a></h3><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>  service.available sshd            #æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯ç”¨</span></span>
<span class="line"><span>  service.disable &lt;service name&gt;    #è®¾ç½®å¼€æœºå¯åŠ¨çš„æœåŠ¡</span></span>
<span class="line"><span>  service.enable &lt;service name&gt;</span></span>
<span class="line"><span>  service.disabled &lt;service name&gt;   #æŸ¥çœ‹æœåŠ¡æ˜¯ä¸æ˜¯å¼€æœºå¯åŠ¨</span></span>
<span class="line"><span>  service.enabled &lt;service name&gt;</span></span>
<span class="line"><span>  service.get_disabled              #è¿”å›æ‰€æœ‰å…³é—­çš„æœåŠ¡</span></span>
<span class="line"><span>  service.get_enabled               #è¿”å›æ‰€æœ‰å¼€å¯çš„æœåŠ¡</span></span>
<span class="line"><span>  service.get_all                   #è¿”å›æ‰€æœ‰æœåŠ¡</span></span>
<span class="line"><span>  service.reload &lt;service name&gt;     #é‡æ–°è½½å…¥æŒ‡å®šçš„æœåŠ¡</span></span>
<span class="line"><span>  service.restart &lt;service name&gt;    #é‡å¯æœåŠ¡</span></span>
<span class="line"><span>  service.start &lt;service name&gt;</span></span>
<span class="line"><span>  service.stop &lt;service name&gt;</span></span>
<span class="line"><span>  service.status &lt;service name&gt;</span></span>
<span class="line"><span>  service.force_reload &lt;service name&gt;  #å¼ºåˆ¶è½½å…¥æŒ‡å®šçš„æœåŠ¡</span></span></code></pre></div><p><strong>ä½¿ç”¨</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@mail python]# salt </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;*&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> service.available sshdmonitor:    True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">apiè°ƒç”¨:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">client.cmd(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;*&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;service.available&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,[</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;sshd&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">){</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;monitor&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> True}</span></span></code></pre></div><h2 id="grains" tabindex="-1"><a class="header-anchor" href="#grains"><span>grains</span></a></h2><blockquote><p>æœåŠ¡å™¨çš„ä¸€äº›é™æ€ä¿¡æ¯ï¼Œå¼ºè°ƒçš„æ˜¯é™æ€ï¼Œå°±æ˜¯ä¸ä¼šå˜çš„ä¸œè¥¿ï¼Œæ¯”å¦‚è¯´osæ˜¯centosï¼Œä¸ä¼šå˜åŒ–ï¼Œé™¤éé‡æ–°å®‰è£…ç³»ç»Ÿ</p></blockquote><h3 id="grainsçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#grainsçš„ä½¿ç”¨"><span>grainsçš„ä½¿ç”¨</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŸ¥è¯¢æ‰€æœ‰grainsä¿¡æ¯</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> grains.items </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    SSDs:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    biosreleasedate:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        09/21/2015</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    biosversion:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        6.00</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    cpu_flags:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        -</span><span style="color:#98C379;--shiki-dark:#98C379;"> fpu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        -</span><span style="color:#98C379;--shiki-dark:#98C379;"> vme</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        -</span><span style="color:#98C379;--shiki-dark:#98C379;"> de</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">.....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŸ¥è¯¢grainsæŒ‡å®šé¡¹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;*&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> grains.item os</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    os:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        CentOS</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    os:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        CentOS</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master salt]# salt -G </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;os:CentOS&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯¹ç³»ç»Ÿæ˜¯CentOSçš„æœåŠ¡å™¨è¿›è¡Œpingæµ‹è¯•æ“ä½œ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#os:CentOS ; å°±æ˜¯å¯¹åº”ä¸Šé¢grains.itemsæ˜¾ç¤ºå‡ºæ¥çš„oså€¼æ˜¯CentOsçš„å¯¹è±¡è¿›è¡ŒåŒ¹é… </span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯¹cpuæ¶æ„æ˜¯x86_64çš„æœåŠ¡å™¨æ˜¾ç¤ºCPUçš„ä¸ªæ•°</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -G</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;cpuarch:x86_64&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains.item</span><span style="color:#98C379;--shiki-dark:#98C379;"> num_cpus</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯¹å­—å…¸å€¼çš„å¯¹è±¡è¿›è¡ŒåŒ¹é…</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -G</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;ip_interfaces:eno16777728:192.168.2.*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> test.ping</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åœ¨SLSä¸­ç”¨grains</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœ¨xxx.slsä¸­ä½¿ç”¨grains</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;os:CentOS&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> match:</span><span style="color:#98C379;--shiki-dark:#98C379;"> grain</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span></code></pre></div><h3 id="è‡ªå®šä¹‰grains-ä¸¤ç§æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰grains-ä¸¤ç§æ–¹æ³•"><span>è‡ªå®šä¹‰grains(ä¸¤ç§æ–¹æ³•)</span></a></h3><p><strong>1 . minionç«¯ä¿®æ”¹</strong> é‡å¯ç”Ÿæ•ˆ</p><blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/salt/minion æˆ–è€…å†™åœ¨/etc/salt/grainsä¸­</p><p>æ‰“å¼€ default_include: minion.d/*.conf æˆ–è€…ç›´æ¥æ·»åŠ æ­¤å‘½ä»¤</p><p>åœ¨minionç«¯çš„/etc/salt/minion.d/ ç›®å½•ä¸‹æ–°å»ºå¹¶ç¼–è¾‘.confåç¼€æ–‡ä»¶</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grains:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å¦‚æœæ˜¯/etc/salt/grainsä¸­,ä¸éœ€æ­¤è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  roles:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  sex:</span><span style="color:#98C379;--shiki-dark:#98C379;"> boy</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #åå­—ï¼šå€¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  age:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #åå­—ï¼šå¤šä¸ªå€¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 33</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 44</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # é‡å¯ç”Ÿæ•ˆ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master ~]# salt </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> grains.item age</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    age:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        -</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 33</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        -</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 44</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@master ~]#</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**2 . minionç«¯ä¿®æ”¹ ** åŒæ­¥ä¹‹åç”Ÿæ•ˆ</p><blockquote><p>baseç›®å½•ï¼ˆåœ¨/etc/salt/masterä¸­é…ç½®çš„file_rootsé¡¹ï¼Œé»˜è®¤åœ¨/srv/saltï¼‰ä¸‹ç”Ÿæˆ**_grains** ç›®å½•,æ–°å»ºæ–‡ä»¶,ç”¨pythonæ¥å†™</p></blockquote><p>ç¼–å†™æ–‡ä»¶,éœ€è¦è¿”å›ä¸€ä¸ªå­—å…¸</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> test1.py</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> hello</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> ##å‡½æ•°åå­—æ— æ‰€è°“ï¼Œåº”è¯¥æ˜¯æ‰€æœ‰å‡½æ•°éƒ½ä¼šè¿è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    agrain</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> {}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    agrain[</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;hello&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">]</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;lzl&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#98C379;--shiki-dark:#98C379;"> agrain</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   ##è¿”å›è¿™ä¸ªå­—å…¸</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">========================</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/usr/bin/python</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -*- coding:utf-8 -*-</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">import</span><span style="color:#98C379;--shiki-dark:#98C379;"> os</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">def</span><span style="color:#98C379;--shiki-dark:#98C379;"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    grains</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{}#åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸ï¼Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    file</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> os.popen</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;ulimit -n&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">.read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    grains[</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;my_file&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">]</span><span style="color:#98C379;--shiki-dark:#98C379;">=file</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ³¨æ„æ–‡ä»¶èµ‹äºˆæƒé™</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chmod</span><span style="color:#98C379;--shiki-dark:#98C379;"> a+x</span><span style="color:#98C379;--shiki-dark:#98C379;"> .py</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŒæ­¥åˆ°å„ä¸ªminionä¸­å»</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> saltutil.sync_all</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŸ¥çœ‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/salt/_grains] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> grains.item hello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    hello:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        lzl</span></span></code></pre></div><h2 id="pillar" tabindex="-1"><a class="header-anchor" href="#pillar"><span>pillar</span></a></h2><blockquote><p>Pillaråœ¨saltä¸­æ˜¯éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®Œæˆå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æŒ‡å®šä¸€äº›ä¿¡æ¯åˆ°æŒ‡å®šçš„minionä¸Šï¼Œä¸åƒgrainsä¸€æ ·æ˜¯åˆ†å‘åˆ°æ‰€æœ‰Minionä¸Šçš„ï¼Œå®ƒä¿å­˜çš„æ•°æ®å¯ä»¥æ˜¯åŠ¨æ€çš„,Pillarä»¥slsæ¥å†™çš„ï¼Œæ ¼å¼æ˜¯é”®å€¼</p><p>é€‚ç”¨</p><p>1.æ¯”è¾ƒæ•æ„Ÿçš„æ•°æ®ï¼Œæ¯”å¦‚å¯†ç ï¼Œkeyç­‰</p><p>2.ç‰¹æ®Šæ•°æ®åˆ°ç‰¹å®šMinionä¸Š</p><p>3.åŠ¨æ€çš„å†…å®¹</p><p>4.å…¶ä»–æ•°æ®ç±»å‹</p></blockquote><h3 id="pillaråŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#pillaråŸºæœ¬ä½¿ç”¨"><span>pillaråŸºæœ¬ä½¿ç”¨</span></a></h3><p><strong>æŸ¥çœ‹æ‰€æœ‰</strong></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>salt &#39;*&#39; pillar.items</span></span></code></pre></div><p><strong>æŸ¥çœ‹æŸä¸ª</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> pillar.item</span><span style="color:#98C379;--shiki-dark:#98C379;"> KEY</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¯ä»¥å–åˆ°æ›´å°ç²’åº¦çš„</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> pillar.get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">ke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">y&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#98C379;--shiki-dark:#98C379;">ke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">y&gt;</span></span></code></pre></div><h3 id="ç¼–å†™pillar" tabindex="-1"><a class="header-anchor" href="#ç¼–å†™pillar"><span>ç¼–å†™pillar</span></a></h3><blockquote><p>æŒ‡å®špillar_roots</p><p>é»˜è®¤æ˜¯/srv/pillar/(å¯é€šè¿‡ä¿®æ”¹masteré…ç½®æ–‡ä»¶ä¿®æ”¹),å»ºç«‹ç›®å½•</p></blockquote><p><strong>top.sls</strong></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">base:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           #æŒ‡å®šç¯å¢ƒ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  &#39;*&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          #target</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> test1</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     #å¼•ç”¨test1.sls æˆ–è€…test1/init.sls</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é€šè¿‡åˆ†ç»„ååŒ¹é…ï¼Œ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  group1:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> match:</span><span style="color:#98C379;--shiki-dark:#98C379;"> nodegroup</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #å¿…é¡»è¦æœ‰ - match: nodegroup  </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é€šè¿‡grainæ¨¡å—åŒ¹é…çš„ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  &#39;os:CentOS&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> match:</span><span style="color:#98C379;--shiki-dark:#98C379;"> grain</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #å¿…é¡»è¦æœ‰- match: grain</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>test1.sls</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> test1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> lzl</span></span></code></pre></div><p><strong>åˆ·æ–°</strong> pillaræ•°æ®</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>salt &#39;*&#39; saltutil.refresh_pillar</span></span></code></pre></div><p><strong>æŸ¥çœ‹ç»“æœ</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/pillar] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pillar.items</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    name:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        test1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    user:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        lzl</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/pillar] ]$</span></span></code></pre></div><h2 id="åœ¨stateä¸­é€šè¿‡jinjaä½¿ç”¨pillar" tabindex="-1"><a class="header-anchor" href="#åœ¨stateä¸­é€šè¿‡jinjaä½¿ç”¨pillar"><span>åœ¨stateä¸­é€šè¿‡jinjaä½¿ç”¨pillar</span></a></h2><p>é»˜è®¤stateæ–‡ä»¶ä½ç½®/src/salt/</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">user.sls</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> user,</span><span style="color:#98C379;--shiki-dark:#98C379;"> uid</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> pillar.get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;users&#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;"> {}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#98C379;--shiki-dark:#98C379;">.items</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#98C379;--shiki-dark:#98C379;">%}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> ##pillar.get(&#39;users&#39;,{})å¯ç”¨pillar[&#39;users&#39;]ä»£æ›¿ï¼Œå‰è€…åœ¨æ²¡æœ‰å¾—åˆ°å€¼çš„æƒ…å†µä¸‹ï¼Œèµ‹é»˜è®¤å€¼</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">{{user}}:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  user.present:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> uid:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {{uid}}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> endfor</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span></code></pre></div><h2 id="jinjaé…åˆgrains-æŒ‡å®špillaræ•°æ®" tabindex="-1"><a class="header-anchor" href="#jinjaé…åˆgrains-æŒ‡å®špillaræ•°æ®"><span>jinjaé…åˆgrains æŒ‡å®špillaræ•°æ®</span></a></h2><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains[&#39;os_family&#39;]</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;RedHat&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">apache:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> elif</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains[&#39;os&#39;]</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;CentOS&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">apache:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim:</span><span style="color:#98C379;--shiki-dark:#98C379;"> vim</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> elif</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains[&#39;os&#39;]</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;Arch&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">apache:</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim:</span><span style="color:#98C379;--shiki-dark:#98C379;"> vim</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> endif</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span></code></pre></div><h2 id="ä½¿ç”¨salt-state" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨salt-state"><span>ä½¿ç”¨salt state</span></a></h2><blockquote><p>å®ƒçš„æ ¸å¿ƒæ˜¯å†™sls(SaLt State file)æ–‡ä»¶,slsæ–‡ä»¶é»˜è®¤æ ¼å¼æ˜¯YAMLæ ¼å¼ï¼Œå¹¶é»˜è®¤ä½¿ç”¨jinjaæ¨¡æ¿ï¼Œjinjaæ˜¯æ ¹æ®djangoçš„æ¨¡æ¿è¯­è¨€å‘å±•è€Œæ¥çš„è¯­è¨€ï¼Œç®€å•å¹¶å¼ºå¤§ï¼Œæ”¯æŒfor if ç­‰å¾ªç¯åˆ¤æ–­ã€‚salt stateä¸»è¦ç”¨æ¥æè¿°ç³»ç»Ÿï¼Œè½¯æ€§ï¼ŒæœåŠ¡ï¼Œé…ç½®æ–‡ä»¶çš„çŠ¶æ€ï¼Œå¸¸å¸¸è¢«ç§°ä¸ºé…ç½®ç®¡ç†ï¼</p></blockquote><blockquote><p>é€šå¸¸stateï¼Œpillar,top fileä¼šç”¨slsæ–‡ä»¶æ¥ç¼–å†™ã€‚stateæ–‡ä»¶é»˜è®¤æ˜¯æ”¾åœ¨/srv/saltä¸­ï¼Œå®ƒä¸ä½ çš„masteré…ç½®æ–‡ä»¶ä¸­çš„file_rootsè®¾ç½®æœ‰å…³</p></blockquote><h3 id="ç®€å•çš„stateæ–‡ä»¶é…ç½®-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ç®€å•çš„stateæ–‡ä»¶é…ç½®-ä»‹ç»"><span>ç®€å•çš„stateæ–‡ä»¶é…ç½®&amp;ä»‹ç»</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#/srv/salt/apahce.sls</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">apache:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">           ##state IDï¼Œå…¨æ–‡ä»¶å”¯ä¸€,å¦‚æœæ¨¡å—æ²¡è·Ÿ-nameé»˜è®¤ç”¨çš„IDä½œä¸º-name</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> pkg:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             ##æ¨¡å—</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   #- name: apache ##å‡½æ•°å‚æ•°ï¼Œå¯ä»¥çœç•¥</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> installed</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    ##å‡½æ•°</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> service:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         ##æ¨¡å—</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      ##å‡½æ•°</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #- name: apache ##å‡½æ•°å‚æ•°ï¼Œè¿™ä¸ªæ˜¯çœç•¥çš„ï¼Œä¹Ÿå¯ä»¥å†™ä¸Š</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require:</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     ##ä¾èµ–ç³»ç»Ÿ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  ##è¡¨ç¤ºä¾èµ–idä¸ºapacheçš„pkgçŠ¶æ€</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å£°æ˜ä¸€ä¸ªå«apacheçš„çŠ¶æ€id,è¯¥idå¯ä»¥éšæ„ï¼Œæœ€å¥½èƒ½è¡¨ç¤ºä¸€å®šæ„æ€</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#pkgä»£è¡¨çš„æ˜¯pkgæ¨¡å—</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#installedæ˜¯pkgæ¨¡å—ä¸‹çš„ä¸€ä¸ªå‡½æ•°ï¼Œæè¿°çš„æ˜¯çŠ¶æ€ï¼Œè¯¥å‡½æ•°è¡¨ç¤ºapacheæ˜¯å¦éƒ¨ç½²ï¼Œè¿”å›å€¼ä¸ºTrueæˆ–è€…Falseï¼Œä¸ºçœŸæ—¶ï¼Œè¡¨ç¤ºçŠ¶æ€OKï¼Œå¦åˆ™ä¼šå»æ»¡è¶³è¯¥çŠ¶æ€(ä¸‹è½½å®‰è£…apache)ï¼Œå¦‚æœæ»¡è¶³ä¸äº†ä¼šæç¤ºerror,åœ¨è¯¥æ¨¡å—ä¸Šé¢çœç•¥äº†å‚æ•°-name: apache,å› ä¸ºIDä¸ºapache,è¿™äº›å‚æ•°æ˜¯æ¨¡å—å‡½æ•°éœ€è¦çš„ï¼ˆå¯ä»¥å»æŸ¥çœ‹æºç ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#serviceæ˜¯æŒ‡çš„serviceæ¨¡å—</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™ä¸ªæ¨¡å—ä¸‹ä¸»è¦æ˜¯æè¿°serviceçŠ¶æ€çš„å‡½æ•°ï¼ŒrunningçŠ¶æ€å‡½æ•°è¡¨ç¤ºapacheåœ¨è¿è¡Œï¼Œçœç•¥-nameä¸åœ¨è¡¨è¿°ï¼Œ-requireè¡¨ç¤ºä¾èµ–ç³»ç»Ÿï¼Œä¾èµ–ç³»ç»Ÿæ˜¯state systemçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨è¯¥å¤„æè¿°äº†apacheæœåŠ¡çš„è¿è¡Œéœ€è¦ä¾èµ–apacheè½¯ä»¶çš„éƒ¨ç½²ï¼Œè¿™é‡Œå°±è¦ç‰µæ¶‰åˆ°slsæ–‡ä»¶çš„æ‰§è¡Œï¼Œslsæ–‡ä»¶åœ¨saltä¸­æ‰§è¡Œæ—¶æ— åº(å¦‚æœæ²¡æœ‰æŒ‡å®šé¡ºåºï¼Œåé¢ä¼šè®²åˆ°order)ï¼Œå‡å¦‚å…ˆæ‰§è¡Œäº†serviceè¿™ä¸ªçŠ¶æ€ï¼Œå®ƒå‘ç°ä¾èµ–pkgåŒ…çš„å®‰è£…ï¼Œä¼šå»å…ˆéªŒè¯pkgçš„çŠ¶æ€æœ‰æ²¡æœ‰æ»¡è¶³ï¼Œå¦‚æœæ²¡æœ‰ä¾èµ–å…³ç³»çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…apacheï¼Œapache çš„serviceè‚¯å®šè¿è¡Œä¼šå¤±è´¥çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆæ‰§è¡Œè¿™ä¸ªslsæ–‡ä»¶:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> state.sls</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åœ¨å‘½ä»¤è¡Œé‡Œè¿™æ ·æ‰§è¡Œï¼Œ.slsä¸å†™ï¼Œå¦‚æœåœ¨ç›®å½•ä¸‹ï¼Œå°†ç›®å½•ä¸æ–‡ä»¶ç”¨â€™.â€™éš”å¼€ï¼Œ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚ï¼š httpd/apache.sls â€“&gt; httpd.apache</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æˆ–è€…</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> state.highstate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å‰ææ˜¯å­˜åœ¨top.sls å»æŒ‡å®šminionè¿è¡Œçš„æ˜¯å“ªä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#top.sls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  &#39;*&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>state.slsé»˜è®¤çš„è¿è¡Œç¯å¢ƒæ˜¯baseç¯å¢ƒï¼Œä½†æ˜¯å®ƒå¹¶ä¸è¯»å–top.slsï¼ˆtop.slså®šä¹‰äº†è¿è¡Œç¯å¢ƒä»¥åŠéœ€è¦è¿è¡Œçš„slsï¼‰</p><p>state.slsä¹Ÿå¯ä»¥æŒ‡å®šè¯»å–å“ªä¸ªç¯å¢ƒï¼šstate.sls salt_env=&#39;prod&#39; xxxx.slsï¼Œè¿™ä¸ªxxxx.slså¯ä»¥ä¸åœ¨top.slsä¸­è®°å½•ã€‚</p><p>state.highstate: è¿™ä¸ªæ˜¯å…¨å±€çš„æ‰€æœ‰ç¯å¢ƒï¼Œä»¥åŠæ‰€æœ‰çŠ¶æ€éƒ½ç”Ÿæ•ˆã€‚å®ƒä¼šè¯»å–æ¯ä¸€ä¸ªç¯å¢ƒçš„top.slsï¼Œå¹¶ä¸”å¯¹æ‰€æœ‰slséƒ½ç”Ÿæ•ˆã€‚ä¸åœ¨top.slsæ–‡ä»¶é‡Œé¢è®°å½•çš„slsåˆ™ä¸ä¼šè¢«æ‰§è¡Œï¼›</p></blockquote><p>é˜…è¯»åå†™çš„ç‰ˆæœ¬</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">webserver:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pkg:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  service:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> reqire:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/salt] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-02&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> state.sls webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          ID:</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Function:</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg.installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        Name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      Result:</span><span style="color:#98C379;--shiki-dark:#98C379;"> True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Comment:</span><span style="color:#98C379;--shiki-dark:#98C379;"> The</span><span style="color:#98C379;--shiki-dark:#98C379;"> following</span><span style="color:#98C379;--shiki-dark:#98C379;"> packages</span><span style="color:#98C379;--shiki-dark:#98C379;"> were</span><span style="color:#98C379;--shiki-dark:#98C379;"> installed/updated:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Started:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 18:24:07.033564</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Duration:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 65091.443</span><span style="color:#98C379;--shiki-dark:#98C379;"> ms</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Changes:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              httpd:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  new:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                      2.4.6-45.el7.centos</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  old:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              httpd-tools:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  new:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                      2.4.6-45.el7.centos</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  old:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              mailcap:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  new:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                      2.1.41-2.el7</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  old:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          ID:</span><span style="color:#98C379;--shiki-dark:#98C379;"> webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Function:</span><span style="color:#98C379;--shiki-dark:#98C379;"> service.running</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        Name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      Result:</span><span style="color:#98C379;--shiki-dark:#98C379;"> True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Comment:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Started</span><span style="color:#98C379;--shiki-dark:#98C379;"> Service</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Started:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 18:25:12.142495</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Duration:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5599.171</span><span style="color:#98C379;--shiki-dark:#98C379;"> ms</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Changes:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              httpd:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Summary</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Succeeded:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (changed=2)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Failed:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Total</span><span style="color:#98C379;--shiki-dark:#98C379;"> states</span><span style="color:#98C379;--shiki-dark:#98C379;"> run:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/salt] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¾ƒå¤æ‚çš„state" tabindex="-1"><a class="header-anchor" href="#è¾ƒå¤æ‚çš„state"><span>è¾ƒå¤æ‚çš„state</span></a></h3><p><strong>/srv/salt/ssh/init.sls</strong></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">openssh-client:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pkg.installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/etc/ssh/ssh_config:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  file.managed:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> group:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> mode:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 644</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://ssh/ssh_config</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> openssh-client</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ssh/init.sls æ„æ€æ˜¯å½“æ‰§è¡Œ salt &#39;*&#39; state.sls sshçš„æ—¶å€™å…¶å®å°±æ˜¯æ‰§è¡Œinit.sls</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç¬¬ä¸€è¡Œ:æ–‡ä»¶å,å…¨æ–‡ä»¶å”¯ä¸€,å¦‚æœpkgç­‰æ¨¡å—æ²¡è·Ÿ- name åŒ…å, é»˜è®¤ç”¨çš„IDä½œä¸º-name</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç¬¬äºŒè¡Œ: ç®€å†™,æ„æ€pkgä¸‹çš„installedå‡½æ•°</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç¬¬ä¸‰è¡Œ: ID å‘Šè¯‰minionä¸‹è½½çš„æ–‡ä»¶åº”è¯¥æ”¾å“ªé‡Œ!</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç¬¬å››è¡Œ:ç®€å†™</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç¬¬å…«è¡Œ:sourceæ˜¯å‘Šè¯‰minionä»å“ªé‡Œä¸‹è½½æºæ–‡ä»¶!</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#salt://ssh/ssh_configå…¶å®å°±æ˜¯/srv/salt/ssh/ssh_config å‰é¢/srv/saltè¿™ä¸ªè·¯å¾„å’Œfile_rootsçš„é…ç½®æœ‰å…³</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>/srv/salt/ssh/server.sls</strong></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">include:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#includeè¡¨ç¤ºåŒ…å«æ„æ€ï¼Œå°±æ˜¯æŠŠssh/init.slsç›´æ¥åŒ…å«è¿›æ¥</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">openssh-server:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> pkg.installed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sshd:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  service.running:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> openssh-client</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> openssh-server</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> file:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/ssh/banner</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> file:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/etc/ssh/sshd_config:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  file.managed:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> group:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> mode:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 644</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://ssh/sshd_config</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> openssh-server</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/etc/ssh/banner:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  file:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> managed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> group:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> mode:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 644</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://ssh/banner</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> openssh-server</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ­¤æ—¶çš„ç›®å½•ç»“æ„åº”è¯¥æ˜¯</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>â”œâ”€â”€ ssh</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ banner</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ init.sls</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ server.sls</span></span>
<span class="line"><span>â”‚Â Â  â”œâ”€â”€ ssh_config</span></span>
<span class="line"><span>â”‚Â Â  â””â”€â”€ sshd_config</span></span></code></pre></div><p><strong>å…³äºinclude</strong>å¤å®˜ç½‘çš„demo</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">include:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> ssh.server</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">extend:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  /etc/ssh/banner:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    file:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://ssh/custom-banner</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŒ…å«ssh/server.sls,æ‰©å±•/etc/ssh/bannerï¼Œé‡æ–°å…¶sourceè€Œå…¶å®ƒçš„å¦‚user,groupç­‰ä¸å˜ï¼Œä¸includeä¸€è‡´ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">include:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">extend:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  apache:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  service:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> watch:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> mod_python</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æŠŠapache.slsåŒ…å«è¿›æ¥ï¼Œæƒ³apache-serviceæ˜¯è¿½åŠ äº†ä¾èµ–å…³ç³»(watchä¹Ÿæ˜¯ä¾èµ–ç³»ç»Ÿçš„å‡½æ•°).</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…³äºæ¸²æŸ“å™¨-render-system" tabindex="-1"><a class="header-anchor" href="#å…³äºæ¸²æŸ“å™¨-render-system"><span>å…³äºæ¸²æŸ“å™¨ render system</span></a></h2><blockquote><p>salté»˜è®¤æ˜¯ç”¨çš„yaml_jinjaæ¸²æŸ“å™¨å¤„ç†ssæ–‡ä»¶,ä¼šä¼˜å…ˆä½¿ç”¨jinjiaå¤„ç†,ç„¶åä¼ ç»™yamlå¤„ç†ç„¶åç”Ÿæˆsaltéœ€è¦çš„pythonæ•°æ®ç±»å‹.</p></blockquote><p><strong>apache/init.sls</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">apache:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pkg:installed:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains[&#39;os&#39;]</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;CentoOS&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> endif</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  service.running:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> grains[&#39;os&#39;]</span><span style="color:#98C379;--shiki-dark:#98C379;"> ==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;CentoOS&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> endif</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> watch:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> apache</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç®€å•çš„ä¾‹å­,ä½¿ç”¨jinjaç»“åˆgrainsè¿›è¡Œåˆ¤æ–­</span></span></code></pre></div><p><strong>user/init.sls</strong></p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> set</span><span style="color:#98C379;--shiki-dark:#98C379;"> users</span><span style="color:#98C379;--shiki-dark:#98C379;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;jerry&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;tom&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;gaga&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] %}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> user</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> users</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">{{ user }}:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> user.present:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /bin/bash</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> home:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /home/{{ user }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> endfor</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">---------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> if</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt[&#39;cmd.run&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;uname -i&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;x86_64&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hadoop:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> user.present:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /bin/bash</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> home:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /home/hadoop</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> elif</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt[&#39;cmd.run&#39;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&#39;uname -i&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;i386&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">openstack:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> user.present:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /bin/bash</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-</span><span style="color:#98C379;--shiki-dark:#98C379;"> home:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /home/openstack</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> else</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">django:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> user.present:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">   -</span><span style="color:#98C379;--shiki-dark:#98C379;"> shell:</span><span style="color:#98C379;--shiki-dark:#98C379;"> /sbin/nologin</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">%</span><span style="color:#98C379;--shiki-dark:#98C379;"> endif</span><span style="color:#98C379;--shiki-dark:#98C379;"> %}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pyæ¸²æŸ“å™¨" tabindex="-1"><a class="header-anchor" href="#pyæ¸²æŸ“å™¨"><span>pyæ¸²æŸ“å™¨</span></a></h2><blockquote><p>çº¯pythonå†™çš„slsæ–‡ä»¶.å¦‚æœä½¿ç”¨å…¶ä»–çš„æ¸²æŸ“å™¨,éœ€è¦åœ¨æ–‡ä»¶å¼€å¤´å£°æ˜,!pyå°±æ˜¯å£°æ˜ç”¨çš„pyæ¸²æŸ“å™¨,</p><p>pyä¸­å¯ç”¨çš„å˜é‡æœ‰<strong>salt</strong>,<strong>grains</strong>,<strong>pillar</strong>,<strong>opts</strong>,<strong>env</strong>,<strong>sls</strong>,å‰ä¸‰ä¸ªåˆ†åˆ«å¯¹åº”jinjaé‡Œçš„salt,grains,pillar,<strong>opts</strong>æ˜¯minionçš„é…ç½®æ–‡ä»¶çš„å­—å…¸ï¼Œ<strong>env</strong>å¯¹åº”çš„æ˜¯ç¯å¢ƒå¦‚base,<strong>sls</strong>å¯¹åº”çš„æ˜¯slsçš„æ–‡ä»¶å</p></blockquote><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!py</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">   &#39;&#39;&#39;add user hadoop&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">platform </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> os.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">popen</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;uname -a&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">strip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> platform </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;x86_64&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;hadoop&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;present&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,{</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;shell&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/bin/bash&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}, {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;home&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/home/hadoop&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}]}}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">elif</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> platform </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;i386&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">       return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;openstack&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;present&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;shell&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/bin/bash&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}, {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;home&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/home/openstack&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}]}}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;django&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;present&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;shell&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;/sbin/nologin&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}]}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ³¨æ„çš„æ˜¯returnçš„æ•°æ®ç»“æ„{ID: {module: [func, arg1,arg2,...,]}} æˆ– {ID: {module.func: [arg1,arg2,..,]}} ã€‚è¡¨ç¤ºçš„å†…å®¹ä¸â€œç¤ºä¾‹ï¼›saltå­—å…¸â€è¡¨è¾¾çš„ç›¸åŒ</span></span></code></pre></div><h2 id="stateçš„æ‰§è¡Œé¡ºåº" tabindex="-1"><a class="header-anchor" href="#stateçš„æ‰§è¡Œé¡ºåº"><span>stateçš„æ‰§è¡Œé¡ºåº</span></a></h2><blockquote><p>stataæ‰§è¡Œ,ä¹Ÿå°±æ˜¯.slsæ–‡ä»¶çš„æ‰§è¡Œæ˜¯æ— åºçš„.ä¸ºäº†ä¿è¯æ¯æ¬¡çš„é¡ºåºæ˜¯ä¸€è‡´çš„,å°±åŠ å…¥äº†state order ,</p><p>å…ˆäº†è§£ä¸‹é«˜çº§æ•°æ®(High Data)å’Œä½çº§æ•°æ®(Low Data).</p><p>é«˜çº§æ•°æ®å°±æ˜¯æŒ‡ç¼–å†™çš„slsæ–‡ä»¶çš„æ•°æ®</p><p>ä½çº§æ•°æ®å°±æ˜¯ç»è¿‡renderå’Œparserç¼–è¯‘è¿‡çš„æ•°æ®</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> state.show_highstate</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    webserver:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        __env__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            base</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        __sls__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        pkg:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              name:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            -</span><span style="color:#98C379;--shiki-dark:#98C379;"> installed</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              order:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  10000</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        service:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              name:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            -</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              -pkg:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              reqire:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  None</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              order:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                  10001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> state.show_lowstate</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      __env__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          base</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      __id__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      __sls__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      fun:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      name:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      order:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          10000</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      state:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          pkg</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    |</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">_</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -pkg:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      __env__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          base</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      __id__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      __sls__:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          webserver</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      fun:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          running</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      name:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      order:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          10001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      reqire:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          None</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      state:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          service</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æŸ¥çœ‹å¯çŸ¥,é‡Œé¢æœ‰ä¸ªorder,è¿™ä¸ªæ˜¯é»˜è®¤salt ä¼šè‡ªåŠ¨è®¾ç½®,ä»10000å¼€å§‹.å¯é€šè¿‡ä¿®æ”¹master <code>state_auto_order: False</code>æ¥å…³é—­</p></blockquote><h2 id="orderçš„è®¾å®š" tabindex="-1"><a class="header-anchor" href="#orderçš„è®¾å®š"><span>orderçš„è®¾å®š</span></a></h2><ul><li>include</li></ul><blockquote><p>è¢«includeçš„æ–‡ä»¶Orderé å‰,å…ˆæ‰§è¡Œ</p></blockquote><ul><li>æ‰‹åŠ¨å®šä¹‰order</li></ul><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>httpd:</span></span>
<span class="line"><span>  pkg:</span></span>
<span class="line"><span>    - installed</span></span>
<span class="line"><span>    - order: 1</span></span>
<span class="line"><span>#orderçš„å€¼è¶Šå°,ä¼˜å…ˆçº§è¶Šé«˜.ä½†æ˜¯-1 æ˜¯æœ€å!</span></span></code></pre></div><ul><li>ä¾èµ–å…³ç³»ç³»ç»Ÿ</li></ul><p>å°±æ˜¯å‰é¢ä½¿ç”¨è¿‡çš„ - require</p><h2 id="ä¾èµ–å…³ç³»ç³»ç»Ÿ-requisite-system" tabindex="-1"><a class="header-anchor" href="#ä¾èµ–å…³ç³»ç³»ç»Ÿ-requisite-system"><span>ä¾èµ–å…³ç³»ç³»ç»Ÿ requisite system</span></a></h2><blockquote><p>æˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡ä¾èµ–å…³ç³»ç³»ç»Ÿäº†,å°±æ˜¯å®šä¹‰çŠ¶æ€å’ŒçŠ¶æ€ä¹‹é—´çš„ä¾èµ–å…³ç³»,å¸¸ç”¨çš„å‡½æ•°æœ‰ <code>require</code>å’Œ<code>watch</code> ä»¥åŠä»–ä»¬çš„å˜ç§<code>require_in</code>å’Œ<code>watch-in</code></p><p>å››è€…æœ‰ä½•åŒºåˆ«?</p><p>require,watchæ˜¯æŒ‡ä¾èµ–ï¼Œrequire_in,watch_inæ˜¯æŒ‡è¢«ä¾èµ–</p></blockquote><blockquote><p>watch å¸¸ç”¨äºservice,è€Œä¸”å½“ä¾èµ–æ¡ä»¶å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ä¼šæ‰§è¡Œä¸€äº›åŠ¨ä½œ</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/etc/httpd/httpd.conf:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  file:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> managed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://httpd/httpd.conf</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  pkg.installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  service:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> pkg:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> watch:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> file://etc/httpd/httpd.conf</span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #å½“httpd.confæ”¹å˜æ—¶ï¼Œé‡å¯httpdæœåŠ¡</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">============================</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/etc/httpd/httpd.conf:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  file:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> managed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> source:</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt://httpd/httpd.conf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> watch_in:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> service:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  httpd:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    pkg:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> installed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> require_in:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        -</span><span style="color:#98C379;--shiki-dark:#98C379;"> service:</span><span style="color:#98C379;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    service:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> running</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="salt-stateå¤šç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#salt-stateå¤šç¯å¢ƒ"><span>salt stateå¤šç¯å¢ƒ</span></a></h2><blockquote><p>é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒ,åº”ç”¨ä¸åŒstateçš„file,æ¯”å¦‚å¼€å‘,æµ‹è¯•,ç”Ÿäº§ç­‰.</p><p>é€šè¿‡ä¿®æ”¹masterå¯¹ä¸åŒçš„ç¯å¢ƒåº”ç”¨ä¸é€šè¿‡çš„ç›®å½•</p></blockquote><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å®˜æ–¹demo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Example:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  file_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    dev:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/dev/services</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/dev/states</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    prod:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/prod/services</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/prod/states</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#file_roots é…ç½®salté…ç½®çš„å­˜æ”¾ç›®å½•, å…¶ä¸­baseç¯å¢ƒæ˜¯å¿…è¦çš„, æŒ‡å®štop.slså­˜æ”¾çš„ä½ç½®.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é»˜è®¤æ²¡æŒ‡å®šç¯å¢ƒæ—¶åˆ™ä»baseç›®å½•è·å–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å…¶å®ƒåˆ™æ˜¯ä¸€äº›è‡ªå®šä¹‰çš„, å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®š.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#è¿™æ ·å¯ä»¥é€»è¾‘ä¸Šéš”ç¦»ä¸€äº›ç¯å¢ƒé…ç½®.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ¯ä¸€ä¸ªç¯å¢ƒéƒ½å¯ä»¥å®šä¹‰å¤šä¸ªç›®å½•, ä¼˜å…ˆçº§å…³ç³»ç”±å®šä¹‰ç›®å½•çš„é¡ºåºå†³å®š.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">file_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/foo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/bar</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœå¯»æ‰¾ salt://file.sls, å¦‚æœéƒ½å­˜åœ¨/srv/salt/foo/file.slså’Œ/srv/salt/bar/file.sls, åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ä¸ªä¾‹å­</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">file_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/prod</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  qa:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/qa</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/prod</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  dev:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/dev</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/qa</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /srv/salt/prod</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#/srv/salt/prod é‡Œçš„é…ç½®æ˜¯åœ¨ä¸‰ç§ç¯å¢ƒä¸‹éƒ½å¯ä»¥, /srv/salt/qa åªåœ¨qaå’Œdevç¯å¢ƒä¸‹å¯ç”¨, /srv/salt/devåˆ™åªåœ¨devç¯å¢ƒä¸‹å¯ç”¨.</span></span></code></pre></div><p>ç®€ç­”ä½ çš„å®æ–½æ¡ˆä¾‹</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#masteré…ç½®</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">file_roots:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  base:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /home/base/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  dev:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /home/dev/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> /home/base/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#baseç¯å¢ƒ   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#/home/base</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="color:#98C379;--shiki-dark:#98C379;"> envtest.sls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">â””â”€â”€</span><span style="color:#98C379;--shiki-dark:#98C379;"> top.sls</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#cat /home/base/envtest.sls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">envtest:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  cmd.run:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;echo &#39;[base] env&#39;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#devç¯å¢ƒ</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#/home/dev/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="color:#98C379;--shiki-dark:#98C379;"> mytest.sls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">â””â”€â”€</span><span style="color:#98C379;--shiki-dark:#98C379;"> top.sls</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#cat /home/dev/mytest.sls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">envtest:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  cmd.run:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    -</span><span style="color:#98C379;--shiki-dark:#98C379;"> name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;echo &#39;[dev] env&#39;&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##æ‰§è¡Œæ•ˆæœå¦‚ä¸‹,å¦‚æœä¸æ·»åŠ ç¯å¢ƒå˜é‡,åˆ™æç¤ºæ‰¾ä¸åˆ°æ–‡ä»¶</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/salt/dev] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> state.sls mytest  </span><span style="color:#E06C75;--shiki-dark:#E06C75;">test</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Data</span><span style="color:#98C379;--shiki-dark:#98C379;"> failed</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> compile:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    No</span><span style="color:#98C379;--shiki-dark:#98C379;"> matching</span><span style="color:#98C379;--shiki-dark:#98C379;"> sls</span><span style="color:#98C379;--shiki-dark:#98C379;"> found</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;mytest&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> env</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;base&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ERROR:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Minions</span><span style="color:#98C379;--shiki-dark:#98C379;"> returned</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#98C379;--shiki-dark:#98C379;"> non-zero</span><span style="color:#98C379;--shiki-dark:#98C379;"> exit</span><span style="color:#98C379;--shiki-dark:#98C379;"> code</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åŠ ä¸Šç¯å¢ƒå˜é‡æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/salt/dev] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> state.sls mytest </span><span style="color:#E06C75;--shiki-dark:#E06C75;">saltenv</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;dev&#39;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> test</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">True</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">          ID:</span><span style="color:#98C379;--shiki-dark:#98C379;"> mytest</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Function:</span><span style="color:#98C379;--shiki-dark:#98C379;"> cmd.run</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        Name:</span><span style="color:#98C379;--shiki-dark:#98C379;"> echo</span><span style="color:#98C379;--shiki-dark:#98C379;"> dev-env</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      Result:</span><span style="color:#98C379;--shiki-dark:#98C379;"> None</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Comment:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Command</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;echo dev-env&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> would</span><span style="color:#98C379;--shiki-dark:#98C379;"> have</span><span style="color:#98C379;--shiki-dark:#98C379;"> been</span><span style="color:#98C379;--shiki-dark:#98C379;"> executed</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Started:</span><span style="color:#98C379;--shiki-dark:#98C379;"> 23:54:46.298421</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    Duration:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0.422</span><span style="color:#98C379;--shiki-dark:#98C379;"> ms</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     Changes:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Summary</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Succeeded:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (unchanged=1)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Failed:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">------------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Total</span><span style="color:#98C379;--shiki-dark:#98C379;"> states</span><span style="color:#98C379;--shiki-dark:#98C379;"> run:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">     1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root/srv/salt/dev] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="salt-schedule-saltä¸­çš„crontab" tabindex="-1"><a class="header-anchor" href="#salt-schedule-saltä¸­çš„crontab"><span>salt schedule(saltä¸­çš„crontab)</span></a></h2><blockquote><p>å‘¨æœŸæ€§çš„æ‰§è¡Œä¸€äº›å‡½æ•°,éœ€è¦æ³¨æ„çš„æ˜¯: åœ¨minionä¸Šæ‰§è¡Œsaltå¯æ‰§è¡Œæ¨¡å—é‡Œçš„å‡½æ•°,åœ¨masteræ‰§è¡Œçš„æ˜¯runneræ¨¡å—çš„å‡½æ•°.</p><p>å…±æœ‰ä¸‰ç§æ–¹å¼:master minion pillar</p></blockquote><ul><li>masterç«¯</li><li>minionç«¯</li><li>pillar</li></ul><blockquote><p>ä¸€èˆ¬è€Œè¨€,å°¤å…¶æ˜¯åœ¨minionç«¯é…ç½®,åŸºæœ¬ä¸ä¼šç”¨åˆ°çš„,ä¸»è¦è¿˜æ˜¯ä¸€pillarä¸ºä¸»</p></blockquote><p><strong>ä¿®æ”¹top.sls</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ·»åŠ </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="color:#98C379;--shiki-dark:#98C379;"> schedule</span></span></code></pre></div><p><strong>/srv/pillar/schedule.sls</strong></p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">schedule:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  test-job:</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    function</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> cmd.run</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    seconds:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    args:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">      -</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;date &gt;&gt; /date.log&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ²¡éš”10S åœ¨/ç›®å½•çš„date.logæ–‡ä»¶ä¸­è®°å½•ä¸€æ¡æ—¶é—´</span></span></code></pre></div><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">salt</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;*&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> saltutil.refresh_pillar</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#åˆ·æ–°pillaråˆ°minion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å›åˆ°minion å¯ä»¥æŸ¥çœ‹åˆ°</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@minion-01 /]# ls</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">bin</span><span style="color:#98C379;--shiki-dark:#98C379;">  boot</span><span style="color:#98C379;--shiki-dark:#98C379;">  date.log</span><span style="color:#98C379;--shiki-dark:#98C379;">  dev</span><span style="color:#98C379;--shiki-dark:#98C379;">  etc</span><span style="color:#98C379;--shiki-dark:#98C379;">  home</span><span style="color:#98C379;--shiki-dark:#98C379;">  lib</span><span style="color:#98C379;--shiki-dark:#98C379;">  lib64</span><span style="color:#98C379;--shiki-dark:#98C379;">  media</span><span style="color:#98C379;--shiki-dark:#98C379;">  mnt</span><span style="color:#98C379;--shiki-dark:#98C379;">  opt</span><span style="color:#98C379;--shiki-dark:#98C379;">  proc</span><span style="color:#98C379;--shiki-dark:#98C379;">  root</span><span style="color:#98C379;--shiki-dark:#98C379;">  run</span><span style="color:#98C379;--shiki-dark:#98C379;">  sbin</span><span style="color:#98C379;--shiki-dark:#98C379;">  srv</span><span style="color:#98C379;--shiki-dark:#98C379;">  sys</span><span style="color:#98C379;--shiki-dark:#98C379;">  tmp</span><span style="color:#98C379;--shiki-dark:#98C379;">  usr</span><span style="color:#98C379;--shiki-dark:#98C379;">  var</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root@minion-01 /]# cat date.log </span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Fri</span><span style="color:#98C379;--shiki-dark:#98C379;"> Mar</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 24</span><span style="color:#98C379;--shiki-dark:#98C379;"> 02:27:40</span><span style="color:#98C379;--shiki-dark:#98C379;"> CST</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2017</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Fri</span><span style="color:#98C379;--shiki-dark:#98C379;"> Mar</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 24</span><span style="color:#98C379;--shiki-dark:#98C379;"> 02:27:50</span><span style="color:#98C379;--shiki-dark:#98C379;"> CST</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2017</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Fri</span><span style="color:#98C379;--shiki-dark:#98C379;"> Mar</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 24</span><span style="color:#98C379;--shiki-dark:#98C379;"> 02:28:00</span><span style="color:#98C379;--shiki-dark:#98C379;"> CST</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2017</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">....</span></span></code></pre></div><h2 id="salt-ssh" tabindex="-1"><a class="header-anchor" href="#salt-ssh"><span>salt ssh</span></a></h2><blockquote><p>salt-ssh æ˜¯ 0.17.0 æ–°å‡ºç°çš„ä¸€ä¸ªåŠŸèƒ½.å¯¹äºæœ‰äº›ä¸èƒ½å®‰è£…minionçš„æœºå™¨,sshä¸å¤±ä¸ºä¸€ç§å¥½çš„é€‰æ‹©ä½†æ˜¯SSHå¹¶ä¸èƒ½å–ä»£minion,saltçš„æœ‰äº›åŠŸèƒ½ä¸æ”¯æŒssh.è€Œä¸”èµ°çš„æ˜¯SSH å¹¶ä¸æ˜¯ZeroMQ,æ‰€ä»¥é€Ÿåº¦ä¼šæœ‰æ‰€å½±å“</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#é¦–å…ˆå®‰è£…salt-ssh.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -y</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-ssh</span></span></code></pre></div><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$cat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> /etc/salt/roster </span><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#rosteræ–‡ä»¶åå’Œè·¯å¾„!</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  host:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.153</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  passwd:</span><span style="color:#98C379;--shiki-dark:#98C379;"> centos</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-02:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  host:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 192.168.247.154</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  user:</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  passwd:</span><span style="color:#98C379;--shiki-dark:#98C379;"> centos</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  sudo:</span><span style="color:#98C379;--shiki-dark:#98C379;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#å¦‚æœä¸ç»™passwdçš„è¯,æ‰§è¡Œsalt-sshä¼šæç¤ºè¾“å…¥å¯†ç </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#æ™®é€šç”¨æˆ·ç»™sudoæƒé™</span></span></code></pre></div><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ç¬¬ä¸€æ¬¡ä½¿ç”¨è®°å¾—åŠ å‚æ•° -i å¦åˆ™æŠ¥é”™å¦‚ä¸‹</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[root~] ]</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$salt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-ssh </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;minion-01&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> test.ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">minion-01:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ----------</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    retcode:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        254</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    stderr:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    stdout:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        The</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> needs</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> be</span><span style="color:#98C379;--shiki-dark:#98C379;"> accepted,</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> auto</span><span style="color:#98C379;--shiki-dark:#98C379;"> accept</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#98C379;--shiki-dark:#98C379;"> salt-ssh</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -i</span><span style="color:#98C379;--shiki-dark:#98C379;"> flag:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        The</span><span style="color:#98C379;--shiki-dark:#98C379;"> authenticity</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> host</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;192.168.247.153 (192.168.247.153)&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> can&#39;t be established.</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        ECDSA key fingerprint is 16:f6:f5:49:24:9c:91:da:d7:02:58:a2:14:08:e4:15.</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        Are you sure you want to continue connecting (yes/no)? </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        </span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">#ç¬¬ä¸€æ¬¡è¿è¡Œ æ·»åŠ -iå‚æ•°</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">[root~] ]$salt-ssh &#39;minion-01&#39; test.ping -i</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">minion-01:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    True</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">[root~] ]$salt-ssh &#39;minion-01&#39; test.ping</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">minion-01:</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    True</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">[root~] ]$</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="returners" tabindex="-1"><a class="header-anchor" href="#returners"><span>Returners</span></a></h2><p>ç•¥</p><h2 id="æ‰©å±•salt" tabindex="-1"><a class="header-anchor" href="#æ‰©å±•salt"><span>æ‰©å±•salt</span></a></h2><p>ç•¥</p></div><!--[--><Sponsor></Sponsor><!--]--><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/ops/linux/Centos9.html" aria-label="Centos 9 init"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Centos 9 init</div></a><a class="route-link auto-link next" href="/ops/linux/Docker%E5%AD%A6%E4%B9%A0.html" aria-label="Docker"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Docker<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--17c4bf36:;"><!-- <div class="busuanzi">
      <span id="busuanzi_container_site_pv" style="display: none">
        æœ¬ç«™æ€»è®¿é—®é‡
        <span id="busuanzi_value_site_pv"></span>æ¬¡
        <span class="post-meta-divider">|</span>
      </span>
      <span id="busuanzi_container_site_uv" style="display: none">
        æ‚¨æ˜¯æœ¬ç«™ç¬¬
        <span id="busuanzi_value_site_uv"></span>ä½è®¿é—®è€…
      </span>
    </div> --><div class="footer-content"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2016-2024 z</div></div><span id="runtime_span"></span><div class="footer-link"><a href="https://www.foreverblog.cn/go.html" target="_blank"><img src="https://img.foreverblog.cn/wormhole_1.gif" alt="" style="width:auto;height:32px;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></a><a href="https://www.travellings.cn/go.html" target="_blank"><img src="https://www.travellings.cn/assets/logo.gif" alt="" style="width:auto;height:32px;" title="å¼€å¾€-å‹é“¾æ¥åŠ›"></a><!-- <a href="https://www.foreverblog.cn/" target="_blank">
        <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width: auto; height: 16px" />
      </a> --></div></footer></div><!--]--><!--[--><!----><!----><div></div><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BfCDUtKQ.js" defer></script>
  </body>
</html>
